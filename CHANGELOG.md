# Changelog

All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [Unreleased]

### 🚀 今後のロードマップ

#### 短期（1-2週間）
- [ ] ゲームバランスの微調整
- [ ] アクセシビリティ対応（音声読み上げ）

#### 中期（1ヶ月）
- [ ] 実績システムの追加
- [ ] 詳細な統計表示（プレイ履歴、成功率など）
- [ ] 追加シナリオ（結婚、出産、転職イベント）
- [ ] より多様な保険商品の追加
- [ ] カードアニメーションの拡張
- [ ] レスポンシブデザインの改善（モバイル対応）

#### 長期（3ヶ月以降）
- [ ] オンラインランキング機能
- [ ] 実際の保険商品データとの連携
- [ ] 教育機関向けカスタマイズ版
- [ ] WebGLシェーダーエフェクトの導入
- [ ] PWA対応とオフライン機能

## [0.2.5] - 2025-01-28

### 🎵 Added - Web Audio APIサウンドシステム完全実装
- **WebAudioSoundGeneratorクラス**: ファイル不要の高品質な合成音生成システム
  - 15種類のサウンドエフェクト（ボタンクリック、カード操作、チャレンジ結果など）
  - 各音響に専用設計された周波数・波形・エンベロープパラメータ
  - ファイルサイズゼロで即座に使用可能な動的音生成

- **SoundManagerクラス**: 包括的なサウンド管理システム
  - カード操作音：ドロー、選択、選択解除、プレイ、シャッフル
  - チャレンジ音：開始、成功、失敗
  - UI操作音：ボタンクリック、ホバー、ダイアログ
  - 保険関連音：獲得、期限切れ、更新
  - 活力変化音：増加、減少、警告
  - ゲーム進行音：ステージクリア、ゲームオーバー、勝利
  - 通知音：情報、警告、エラー

- **サウンド設定機能**: 
  - Mキーでサウンドの有効/無効を瞬時切り替え
  - ローカルストレージによる音量・有効状態の永続化
  - ユーザーインタラクション後の自動AudioContext開始

### 🛠 Enhanced - 高度な音響体験
- **音楽理論に基づく音程設計**: 
  - 成功音：C5-E5-G5の和音構成による心地よいハーモニー
  - 勝利音：ファンファーレ風の音階進行
  - 通知音：ド→ミの完全3度音程

- **心理音響学応用**: 
  - カードドロー音：ホワイトノイズ＋ハイパスフィルターでリアルなシャッフル音
  - 警告音：2回のビープ音による緊急度表現
  - 失敗音：のこぎり波による不協和音で挫折感を演出

### 🐛 Fixed - エラー修正とシステム安定化
- **CardPowerエンティティの負の値エラー**: `CardPower.subtract()`メソッドで負の値になる場合の適切な0値設定
- **チャレンジ時のカード選択エラー**: 不正な選択状態での例外処理を改善
- **型安全性の向上**: TypeScript strict modeでの型エラーを全て解決

### 📚 Technical Improvements
- AudioContext生成時のブラウザ互換性対応（webkit prefixサポート）
- 音響リソースの適切なクリーンアップとメモリリーク防止
- 例外処理の強化（サウンド再生失敗時のグレースフルな継続）
- パフォーマンス最適化（音響処理の非同期化）

### 🎮 User Experience
- 操作フィードバックの即座性向上（視覚＋聴覚の統合体験）
- アクセシビリティ対応の強化（キーボード操作時の音響フィードバック）
- 没入感の向上（各アクションに適切な音響フィードバックを提供）


## [0.2.4] - 2025-01-27

### 🎮 Added - 高度なドラッグ&ドロップシステム
- **DropZoneManager**: 効率的なゾーン管理と60fps維持のためのフレームレート制御
- **マグネティックスナップ**: 80-120px範囲での磁気吸着機能
- **ビジュアルフィードバック強化**: ゾーンハイライト、ホバー状態、成功/失敗エフェクト
- **モバイル最適化**: デバイス検出、タッチオフセット調整、振動フィードバック
- **パフォーマンス最適化**: 矩形判定による高速コリジョン検出、スロットリング制御

### 🔧 Enhanced - システムアーキテクチャ
- **モジュラーバリデーション**: 組み合わせ可能なドロップゾーンバリデーター
- **統合レイヤー**: 既存GameSceneとの無縫統合
- **エラーハンドリング**: 堅牢なエラー復旧とグレースフルな失敗処理
- **メモリ管理**: 適切なリソースクリーンアップとリーク防止

### 🧪 Technical Improvements
- **包括的テストスイート**: 986+ テストケースでパフォーマンスとエッジケースを網羅
- **フレームレート保証**: 60fps維持のための最適化されたアルゴリズム
- **スケーラビリティ**: 100+ ドロップゾーンでも効率的な動作
- **クロスプラットフォーム**: デスクトップとモバイルの両環境対応

### 🎨 Visual Experience
- **アニメーション強化**: スムーズなスナップアニメーション（200ms Back.out イージング）
- **パーティクルエフェクト**: 成功時の放射状パーティクル散布
- **ドラッグトレイル**: リアルタイムトレイルエフェクト
- **レスポンシブフィードバック**: タッチデバイスでの適切な振動とオフセット

## [0.2.3] - 2025-01-27

### 🎓 Added - インタラクティブチュートリアルシステム
- **実際のゲームプレイ統合**: プレイヤーが実際にゲームを操作しながら学べる体験型チュートリアル
- **ゲームアクション検証システム**: `wait_for_game_action`タイプでゲームプレイの進行を待機・検証
- **動的スキップ機能**: チャレンジ失敗時は保険選択ステップを自動スキップ
- **リアルタイムゲーム状態追跡**: 250ms間隔でゲーム状態をポーリングして進行を監視
- **包括的なチュートリアルステップ**: 基本操作から保険システムまで段階的に学習

### 🛠 Enhanced - チュートリアルシステムの高度化
- **GameActionValidation型**: カードドロー、カード選択、チャレンジ解決などのアクション検証
- **状態同期メカニズム**: GameSceneとTutorialManager間の双方向データ同期
- **ステップ固有の検証ロジック**: 各アクションに応じたカスタム検証関数
- **タイムアウト処理**: 30秒のデフォルトタイムアウトで無限待機を防止

### 📚 Technical Improvements
- `InteractiveTutorialConfig.ts`の作成でゲームプレイ統合チュートリアル定義
- `TutorialStep`インターフェースを`GameActionValidation`で拡張
- `TutorialManager`にゲームアクション検証メソッド追加
- `GameScene`に`updateGameStateForTutorial()`メソッド実装
- GameCanvasの参照取得タイミング問題を修正

### 🎮 User Experience
- 「読むだけ」から「実際に操作する」学習体験への進化
- プレイヤーの操作に応じた動的な進行
- 失敗時の適切なステップスキップで挫折感を軽減
- 実際のゲームプレイと同じ操作感でスムーズな学習

## [0.2.2] - 2025-01-27

### 🏦 Added - 保険更新システム完全実装
- **期限切れ警告システム**: 残り2ターンでオレンジ色、残り1ターンで赤色の警告表示
- **保険更新選択ダイアログ**: 期限切れ時に「更新」or「失効」を選択可能
- **年齢別更新コスト**: 青年期+1、中年期+2、充実期+3の現実的なコスト増加
- **活力不足対応**: 更新コストが足りない場合の視覚的フィードバック
- **自動期限切れ処理**: ターン進行時の自動的な期限切れ保険検出

### 🛠 Enhanced - 既存システムの改善
- 保険リスト表示の色分け強化（警告状況に応じたカラー変更）
- 期限切れ通知システムの改良（緊急度別のアイコンと表示時間調整）
- 警告アニメーションの追加（パルス効果とタイミング調整）

### 📚 Technical Improvements
- `InsuranceRenewalOption`と`InsuranceRenewalResult`型定義を追加
- 包括的なテストスイート作成（20のテストケース）
- 型安全性の向上とエラーハンドリングの強化

## [0.2.1] - 2025-01-27

### 🎨 Added - モダンUI & 視覚エフェクト大幅改善
- **ダークテーマカラースキーム**: 信頼感のある青紫系グラデーションを基調とした統一デザイン
- **角丸カードデザイン**: グラデーション背景とガラスモルフィズム効果を実装
- **スムーズアニメーション**: 800ms Cubic.out イージングによる滑らかな動作
- **インタラクティブカードエフェクト**: ホバー時のスケール変化とグローエフェクト
- **活力バー高度化**: 数値カウントアップ、動的カラー変化、増減時エフェクト
- **視覚的フィードバック**: パルス（減少時）・グロー（増加時）エフェクト

### 🎯 Changed - UI/UX大幅刷新
- カード表示をフラットデザインから立体的グラデーションデザインに変更
- パワー・コスト表示を円形バッジ化（視認性向上）
- ヘッダー・サイドバーを半透明ガラス風デザインに統一
- テキストにシャドウ効果追加（可読性向上）
- ホバーエフェクトを即座変更からスムーズアニメーションに改善

### 🔧 Technical Improvements
- CSS変数によるカラーパレット管理システム導入
- Phaser 3 Graphics APIによる動的図形描画実装
- Tweenアニメーションシステムの活用
- カードタイプ別グラデーション色分けシステム

### 🎮 Visual Experience
- 信頼感と現代性を両立したプロフェッショナルな外観
- ゲームらしいワクワク感のあるインタラクション
- 保険ゲームらしい落ち着いた色調とスタイリッシュさの融合

## [0.2.0] - 2025-01-27

### 🎮 Added - GAME_RULES_REALISTIC_FINAL完全実装
- **年齢別活力システム**: ライフステージ（青年期35→中年期30→充実期27）で活力上限が変化
- **保険種別選択システム**: 終身保険（高コスト・永続）と定期保険（低コスト・10ターン）の選択可能
- **保険料負担システム**: 保険カード3枚ごとに-1パワーの負担が発生
- **年齢別夢難易度**: 体力系の夢は年齢で+3困難に、知識系は-2容易に
- **判断支援システム**: 年齢別保険推奨、保険見直しタイミング通知
- **視覚的フィードバック**: 保険カードの色分け（金色：終身、銀色：定期）、期限切れ警告

### 🛠 Changed
- 活力バーが年齢に応じて動的に変化するように改善
- チャレンジ解決時のパワー計算を詳細化（基本・保険・負担の内訳表示）
- 保険カードリストを右サイドバーに常時表示
- ステージ移行時に体力減少の視覚的フィードバック追加

### 🐛 Fixed
- ゲーム起動時のボタン構造エラーを修正
- TypeScript型定義の整合性を改善

### 📚 Documentation
- GAME_RULES_REALISTIC_FINAL実装レポート作成
- 各フェーズのテストガイド追加

## [0.1.1] - 2025-01-26

### Added
- 保険カード報酬システムの実装
- ドキュメント管理ガイドライン（CLAUDE.md）
- アーカイブディレクトリ構造（`.archive/`）

### Changed
- ディレクトリ構造を整理（docs/, scripts/をカテゴリ別に再編成）
- テストが全て通過するように修正（49/49）
- 不要な`console.log`を削除

### Fixed
- Windows環境でのテスト実行問題
- 手札上限を超えた場合の処理
- デッキ再シャッフル機能
- ターン進行時の統計更新

## [0.1.0] - 2025-01-26

### Added
- Phase 1 プロトタイプ完成
- 基本的なゲームループ実装
- カードシステム（ドロー、手札管理、捨て札）
- チャレンジシステム
- ステージ進行システム（青年期→中年期→充実期）
- Phaser 3とVue 3の統合
- GitHub Pagesへの自動デプロイ

### Technical Stack
- Vue 3 + TypeScript
- Phaser 3（ゲームエンジン）
- Vite（ビルドツール）
- UnoCSS（スタイリング）
- Vitest（テスティング）