/**\n * ã‚²ãƒ¼ãƒ çŠ¶æ…‹ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  - ãƒ¡ã‚¤ãƒ³ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ\n * \n * ã“ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯åŒ…æ‹¬çš„ãªçŠ¶æ…‹ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã‚’æä¾›ã—ã¾ã™ï¼š\n * - ã‚»ãƒ¼ãƒ–/ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½\n * - æ‹¡å¼µçµ±è¨ˆã‚·ã‚¹ãƒ†ãƒ \n * - Undo/Redoæ©Ÿèƒ½\n * - LocalStorageæœ€é©åŒ–\n * - ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆ†æ\n */\n\n// çŠ¶æ…‹ç®¡ç†ã®ä¸­æ ¸\nexport { GameStateManager } from './GameStateManager'\nexport type { \n  SaveData, \n  SaveMetadata, \n  EnhancedPlayerStats,\n  InsuranceUsagePattern,\n  Achievement,\n  DailyProgress,\n  PlayStreak,\n  GameStateSnapshot,\n  SaveSlot\n} from './GameStateManager'\n\n// ã‚»ãƒ¼ãƒ–/ãƒ­ãƒ¼ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹\nexport { SaveLoadService, SaveLoadUtils } from './SaveLoadService'\nexport type { \n  SaveLoadResult,\n  SaveOptions,\n  LoadOptions\n} from './SaveLoadService'\n\n// ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸æœ€é©åŒ–\nexport { StorageOptimizer } from '../storage/StorageOptimizer'\nexport type {\n  CompressionOptions,\n  CacheOptions,\n  BatchOptions,\n  StorageOptimizerConfig,\n  StorageStats\n} from '../storage/StorageOptimizer'\n\n// ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆ†æ\nexport { GameAnalytics } from '../analytics/GameAnalytics'\nexport type {\n  PlayerAction,\n  StrategyPattern,\n  EfficiencyMetrics,\n  LearningProgress\n} from '../analytics/GameAnalytics'\n\n// Undo/Redoæ©Ÿèƒ½\nexport { UndoRedoManager } from '../commands/UndoRedoManager'\nexport { CommandHistory } from '../commands/CommandHistory'\nexport type {\n  UndoRedoEvent,\n  UndoRedoConfig,\n  CommandHistoryConfig,\n  CommandHistoryStats,\n  UndoRedoResult\n} from '../commands/UndoRedoManager'\n\n// ã‚³ãƒãƒ³ãƒ‰ã‚·ã‚¹ãƒ†ãƒ \nexport {\n  CardSelectionCommand,\n  ChallengeCommand,\n  InsurancePurchaseCommand,\n  NextTurnCommand,\n  NoOpCommand,\n  CompositeCommand,\n  SnapshotCommand\n} from '../commands/GameCommand'\nexport type {\n  GameCommand,\n  CommandCategory\n} from '../commands/GameCommand'\n\n// UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ\nexport { SaveLoadMenu } from '../ui/SaveLoadMenu'\nexport { StatisticsPanel } from '../ui/StatisticsPanel'\n\n/**\n * çµ±åˆã‚²ãƒ¼ãƒ çŠ¶æ…‹ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ \n * ã™ã¹ã¦ã®çŠ¶æ…‹ç®¡ç†æ©Ÿèƒ½ã‚’çµ±åˆã—ã¦æä¾›ã™ã‚‹é«˜ãƒ¬ãƒ™ãƒ«APIã‚¯ãƒ©ã‚¹\n */\nexport class IntegratedGameStateSystem {\n  private stateManager: GameStateManager\n  private saveLoadService: SaveLoadService\n  private storageOptimizer: StorageOptimizer\n  private analytics: GameAnalytics\n  private undoRedoManager: UndoRedoManager\n  \n  constructor(config?: {\n    storageConfig?: Partial<StorageOptimizerConfig>\n    undoRedoConfig?: Partial<UndoRedoConfig>\n  }) {\n    this.stateManager = GameStateManager.getInstance()\n    this.saveLoadService = new SaveLoadService()\n    this.storageOptimizer = StorageOptimizer.getInstance(config?.storageConfig)\n    this.analytics = new GameAnalytics()\n    this.undoRedoManager = new UndoRedoManager(config?.undoRedoConfig)\n  }\n  \n  /**\n   * ã‚·ã‚¹ãƒ†ãƒ ã‚’åˆæœŸåŒ–\n   */\n  initialize(game: Game): void {\n    this.stateManager.setCurrentGame(game)\n    this.undoRedoManager.setCurrentGame(game)\n    \n    // åˆ†æã‚·ã‚¹ãƒ†ãƒ ã«ã‚²ãƒ¼ãƒ é–‹å§‹ã‚’è¨˜éŒ²\n    this.analytics.recordAction({\n      type: 'game_complete',\n      gameStage: game.stage,\n      turn: game.turn,\n      vitality: game.vitality,\n      data: { sessionStart: true }\n    })\n    \n    console.log('ğŸ® çµ±åˆã‚²ãƒ¼ãƒ çŠ¶æ…‹ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã‚’åˆæœŸåŒ–ã—ã¾ã—ãŸ')\n  }\n  \n  /**\n   * åŒ…æ‹¬çš„ãªçŠ¶æ…‹æƒ…å ±ã‚’å–å¾—\n   */\n  getSystemStatus(): {\n    saveSlots: SaveSlot[]\n    storageInfo: ReturnType<StorageOptimizer['getStorageInfo']>\n    undoRedoState: ReturnType<UndoRedoManager['getHistoryState']>\n    analytics: {\n      stats: EnhancedPlayerStats\n      efficiency: EfficiencyMetrics\n      patterns: StrategyPattern[]\n      learning: LearningProgress\n    }\n    performance: {\n      storageStats: StorageStats\n      undoRedoStats: CommandHistoryStats\n    }\n  } {\n    return {\n      saveSlots: this.saveLoadService.getSaveSlots(),\n      storageInfo: this.storageOptimizer.getStorageInfo(),\n      undoRedoState: this.undoRedoManager.getHistoryState(),\n      analytics: {\n        stats: this.stateManager.getEnhancedStats(),\n        efficiency: this.analytics.getEfficiencyMetrics(),\n        patterns: this.analytics.getStrategyPatterns(),\n        learning: this.analytics.getLearningProgress()\n      },\n      performance: {\n        storageStats: this.storageOptimizer.getStats(),\n        undoRedoStats: this.undoRedoManager.getHistoryStats()\n      }\n    }\n  }\n  \n  /**\n   * ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã‚’æœ€é©åŒ–\n   */\n  async optimizeSystem(): Promise<{\n    cleanupResult: Awaited<ReturnType<StorageOptimizer['cleanup']>>\n    performanceGain: number\n  }> {\n    const beforeStats = this.storageOptimizer.getStats()\n    \n    // ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—\n    const cleanupResult = await this.storageOptimizer.cleanup()\n    \n    // ãƒãƒƒãƒå‡¦ç†ã‚’å¼·åˆ¶å®Ÿè¡Œ\n    await this.storageOptimizer.flushBatch()\n    \n    const afterStats = this.storageOptimizer.getStats()\n    const performanceGain = afterStats.averageOperationTime > 0 \n      ? (beforeStats.averageOperationTime - afterStats.averageOperationTime) / beforeStats.averageOperationTime\n      : 0\n    \n    console.log('âš¡ ã‚·ã‚¹ãƒ†ãƒ æœ€é©åŒ–å®Œäº†:', {\n      freedSpace: cleanupResult.freedSpace,\n      performanceGain: `${(performanceGain * 100).toFixed(1)}%`\n    })\n    \n    return { cleanupResult, performanceGain }\n  }\n  \n  /**\n   * ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã‚’ãƒªã‚»ãƒƒãƒˆ\n   */\n  async resetSystem(): Promise<void> {\n    // å…¨ãƒ‡ãƒ¼ã‚¿ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’ä½œæˆ\n    const backup = this.saveLoadService.exportSaveData()\n    \n    // å„ã‚·ã‚¹ãƒ†ãƒ ã‚’ã‚¯ãƒªã‚¢\n    this.stateManager = GameStateManager.getInstance()\n    this.undoRedoManager.clearHistory()\n    this.storageOptimizer.clearCache()\n    this.analytics.resetAnalytics()\n    \n    console.log('ğŸ”„ ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ')\n    \n    // ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’ãƒ­ã‚°ã«å‡ºåŠ›ï¼ˆæ‰‹å‹•å¾©æ—§ç”¨ï¼‰\n    if (backup.success) {\n      console.log('ğŸ’¾ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ã‚¿:', backup.data)\n    }\n  }\n  \n  /**\n   * ã‚·ã‚¹ãƒ†ãƒ ã‚’å®‰å…¨ã«çµ‚äº†\n   */\n  async shutdown(): Promise<void> {\n    // æœªä¿å­˜ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜\n    await this.storageOptimizer.flushBatch()\n    \n    // å„ã‚·ã‚¹ãƒ†ãƒ ã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—\n    this.storageOptimizer.destroy()\n    this.undoRedoManager.destroy()\n    this.stateManager.destroy()\n    \n    console.log('â¹ï¸ çµ±åˆã‚²ãƒ¼ãƒ çŠ¶æ…‹ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã‚’çµ‚äº†ã—ã¾ã—ãŸ')\n  }\n  \n  // ===== ä¾¿åˆ©ãªãƒ˜ãƒ«ãƒ‘ãƒ¼ãƒ¡ã‚½ãƒƒãƒ‰ =====\n  \n  /**\n   * ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯ã§ã‚²ãƒ¼ãƒ ã‚’ã‚»ãƒ¼ãƒ–ã€çµ±è¨ˆæ›´æ–°ã€æœ€é©åŒ–ã‚’å®Ÿè¡Œ\n   */\n  async quickSave(game: Game, slotId: string = 'quick'): Promise<SaveLoadResult> {\n    // ã‚²ãƒ¼ãƒ å®Œäº†çµ±è¨ˆã‚’æ›´æ–°\n    this.stateManager.onGameComplete(game.stats)\n    \n    // ã‚»ãƒ¼ãƒ–ã‚’å®Ÿè¡Œ\n    const saveResult = await this.saveLoadService.saveGame(game, slotId, {\n      slotName: `ã‚¯ã‚¤ãƒƒã‚¯ã‚»ãƒ¼ãƒ– - ${new Date().toLocaleString()}`,\n      overwrite: true\n    })\n    \n    if (saveResult.success) {\n      // ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§æœ€é©åŒ–\n      setTimeout(() => {\n        this.optimizeSystem().catch(console.error)\n      }, 100)\n    }\n    \n    return saveResult\n  }\n  \n  /**\n   * ã‚¤ãƒ³ãƒ†ãƒªã‚¸ã‚§ãƒ³ãƒˆãªãƒ­ãƒ¼ãƒ‰ï¼ˆæœ€é©ãªã‚»ãƒ¼ãƒ–ãƒ‡ãƒ¼ã‚¿ã‚’è‡ªå‹•é¸æŠï¼‰\n   */\n  async smartLoad(): Promise<SaveLoadResult> {\n    const slots = this.saveLoadService.getSaveSlots()\n    const nonEmptySlots = slots.filter(slot => !slot.isEmpty)\n    \n    if (nonEmptySlots.length === 0) {\n      return {\n        success: false,\n        message: 'ãƒ­ãƒ¼ãƒ‰å¯èƒ½ãªã‚»ãƒ¼ãƒ–ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“',\n        affectedCommands: 0\n      }\n    }\n    \n    // æœ€æ–°ã®ã‚»ãƒ¼ãƒ–ãƒ‡ãƒ¼ã‚¿ã‚’é¸æŠ\n    const latestSlot = nonEmptySlots.reduce((latest, current) => \n      current.lastSaved > latest.lastSaved ? current : latest\n    )\n    \n    return await this.saveLoadService.loadGame(latestSlot.id, {\n      validateData: true\n    })\n  }\n  \n  /**\n   * AIã«ã‚ˆã‚‹ãƒ—ãƒ¬ã‚¤æ”¹å–„ææ¡ˆ\n   */\n  getPlayImprovementSuggestions(): {\n    immediate: string[]\n    strategic: string[]\n    longTerm: string[]\n  } {\n    const advice = this.analytics.generatePersonalizedAdvice()\n    const efficiency = this.analytics.getEfficiencyMetrics()\n    const patterns = this.analytics.getStrategyPatterns()\n    \n    const immediate: string[] = []\n    const strategic: string[] = []\n    const longTerm: string[] = []\n    \n    // å³åº§ã«æ”¹å–„å¯èƒ½ãªç‚¹\n    if (efficiency.decisionSpeed > 8) {\n      immediate.push('æ±ºå®šæ™‚é–“ã‚’çŸ­ç¸®ã™ã‚‹ã“ã¨ã§é›†ä¸­åŠ›ãŒå‘ä¸Šã—ã¾ã™')\n    }\n    \n    if (efficiency.optimalPlayRate < 60) {\n      immediate.push('ã‚ˆã‚Šå¼·åŠ›ãªã‚«ãƒ¼ãƒ‰ã®çµ„ã¿åˆã‚ã›ã‚’æ„è­˜ã—ã¦ã¿ã¦ãã ã•ã„')\n    }\n    \n    // æˆ¦ç•¥çš„æ”¹å–„ç‚¹\n    if (patterns.length > 0) {\n      const dominantPattern = patterns[0]\n      if (dominantPattern.successRate < 0.7) {\n        strategic.push(`ç¾åœ¨ã®ã€Œ${dominantPattern.name}ã€ã®æˆåŠŸç‡ã‚’å‘ä¸Šã•ã›ã‚‹ã‹ã€ä»–ã®æˆ¦ç•¥ã‚’è©¦ã—ã¦ã¿ã¦ãã ã•ã„`)\n      }\n    }\n    \n    strategic.push(...advice.slice(0, 2))\n    \n    // é•·æœŸçš„ãªç›®æ¨™\n    const stats = this.stateManager.getEnhancedStats()\n    if (stats.gamesCompleted < 10) {\n      longTerm.push('æ§˜ã€…ãªæˆ¦ç•¥ã‚’è©¦ã—ã¦è‡ªåˆ†ã«åˆã£ãŸãƒ—ãƒ¬ã‚¤ã‚¹ã‚¿ã‚¤ãƒ«ã‚’è¦‹ã¤ã‘ã¾ã—ã‚‡ã†')\n    } else if (stats.gamesCompleted >= 10) {\n      longTerm.push('ä¸€è²«ã—ãŸãƒ—ãƒ¬ã‚¤ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ç¢ºç«‹ã—ã€åŠ¹ç‡æ€§ã‚’è¿½æ±‚ã—ã¾ã—ã‚‡ã†')\n    }\n    \n    return { immediate, strategic, longTerm }\n  }\n}\n\n// ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ\nexport default IntegratedGameStateSystem"