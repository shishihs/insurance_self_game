# セキュリティチェックリスト

> **最終更新**: 2025/01/31  
> **文書種別**: 正式仕様書  
> **更新頻度**: 月次更新

保険ゲームプロジェクトの開発・デプロイ・運用各段階におけるセキュリティチェックリストです。

## 🏗️ 開発段階のセキュリティチェック

### 📝 コーディング時

#### 基本セキュリティ
- [ ] **入力検証**: すべてのユーザー入力を検証・サニタイズしている
- [ ] **出力エスケープ**: 動的コンテンツを適切にエスケープしている  
- [ ] **型安全性**: TypeScriptの厳格な型定義を使用している
- [ ] **エラーハンドリング**: エラーメッセージで機密情報を漏洩していない
- [ ] **セキュリティライブラリ**: プロジェクトのセキュリティユーティリティを使用している

```typescript
// ✅ セキュリティチェック例
import { sanitizeInput, validateNumber } from '@/utils/security'

function handleUserInput(input: unknown): string {
  // 型チェック
  if (typeof input !== 'string') {
    throw new Error('Invalid input type')
  }
  
  // サニタイゼーション
  return sanitizeInput(input)
}
```

#### Vue.js 固有のセキュリティ
- [ ] **v-html の制限**: `v-html` 使用時は事前にサニタイズしている
- [ ] **動的プロパティ**: 動的なプロパティ名やイベントハンドラを避けている
- [ ] **テンプレート注入**: ユーザー入力をテンプレートに直接埋め込んでいない
- [ ] **スクリプト実行**: `eval()` や `new Function()` を使用していない

```vue
<!-- ✅ セキュアなVueテンプレート例 -->
<template>
  <!-- 安全: テキストコンテンツ -->
  <div>{{ userContent }}</div>
  
  <!-- 条件付きで安全: サニタイズ済み -->
  <div v-html="sanitizedHtml"></div>
</template>

<script setup lang="ts">
import { XSSProtection } from '@/utils/xss-csrf-protection'

const sanitizedHtml = computed(() => {
  return XSSProtection.getInstance().sanitizeHTML(userContent.value)
})
</script>
```

#### 認証・認可
- [ ] **セッション管理**: セキュアなセッション管理を実装している
- [ ] **CSRF保護**: フォーム送信にCSRF保護を実装している
- [ ] **権限チェック**: 適切な権限チェックを実装している
- [ ] **トークン管理**: 認証トークンを安全に管理している

### 🧪 テスト時

#### セキュリティテストの実装
- [ ] **XSS テスト**: XSS攻撃に対するテストを作成している
- [ ] **入力検証テスト**: 不正な入力値のテストを作成している
- [ ] **認証テスト**: 認証・認可機能のテストを作成している
- [ ] **エラーハンドリングテスト**: エラー処理のセキュリティテストを作成している

```bash
# セキュリティテスト実行コマンド
npm run test:run src/__tests__/security
npm run test:e2e tests/e2e/security-e2e.spec.ts
npm run test:e2e tests/e2e/penetration-testing.spec.ts
```

#### テストカバレッジ
- [ ] **セキュリティ機能カバレッジ**: セキュリティ関連機能のテストカバレッジが80%以上
- [ ] **攻撃パターンテスト**: 一般的な攻撃パターンのテストを実装している
- [ ] **境界値テスト**: 入力値の境界でのテストを実装している
- [ ] **異常系テスト**: 異常な状況でのセキュリティテストを実装している

### 🔧 コード品質

#### ESLint セキュリティルール
- [ ] **セキュリティルール**: ESLintのセキュリティルールを設定している
- [ ] **危険関数の禁止**: `eval()`, `innerHTML` 等の危険な関数使用を禁止している
- [ ] **セキュリティプラグイン**: `eslint-plugin-security` を設定している
- [ ] **カスタムルール**: プロジェクト固有のセキュリティルールを設定している

```javascript
// eslint.config.mjs での設定確認
export default defineConfigWithVueTs(
  // セキュリティプラグインの設定
  pluginSecurity.configs.recommended,
  {
    rules: {
      // セキュリティ関連ルールの設定
      'no-eval': 'error',
      'no-implied-eval': 'error',
      'no-new-func': 'error'
    }
  }
)
```

#### 依存関係のセキュリティ
- [ ] **脆弱性スキャン**: `npm audit` で脆弱性をチェックしている
- [ ] **依存関係の最小化**: 不要な依存関係を削除している
- [ ] **信頼できるパッケージ**: 信頼できるソースのパッケージのみを使用している
- [ ] **バージョン固定**: セキュリティ上重要なパッケージのバージョンを固定している

## 🚀 デプロイ段階のセキュリティチェック

### 🔧 ビルド・CI/CD

#### GitHub Actions セキュリティ
- [ ] **セキュリティワークフロー**: セキュリティスキャンのワークフローを設定している
- [ ] **権限制限**: 必要最小限の権限のみを付与している
- [ ] **機密情報管理**: シークレット情報を適切に管理している
- [ ] **依存関係スキャン**: 自動的な依存関係脆弱性スキャンを設定している

```yaml
# .github/workflows/security-advanced.yml の確認
permissions:
  contents: read
  security-events: write
  pull-requests: write
```

#### ビルドセキュリティ
- [ ] **ソースマップ**: 本番環境でソースマップを公開していない
- [ ] **デバッグ情報**: デバッグ情報を本番ビルドから除外している
- [ ] **環境変数**: 機密な環境変数をビルドに含めていない
- [ ] **ファイル権限**: ビルドファイルの適切な権限設定をしている

### 🌐 デプロイメント設定

#### セキュリティヘッダー
- [ ] **CSP**: Content Security Policy を適切に設定している
- [ ] **HSTS**: HTTPS Strict Transport Security を設定している
- [ ] **X-Frame-Options**: Clickjacking 防止ヘッダーを設定している
- [ ] **X-Content-Type-Options**: MIME sniffing 防止ヘッダーを設定している

```html
<!-- index.html でのセキュリティヘッダー設定例 -->
<meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline';">
<meta http-equiv="X-Frame-Options" content="DENY">
<meta http-equiv="X-Content-Type-Options" content="nosniff">
```

#### HTTPS 設定
- [ ] **HTTPS 強制**: すべての通信をHTTPS化している
- [ ] **混合コンテンツ**: HTTP/HTTPS混合コンテンツを排除している
- [ ] **証明書**: 有効なSSL/TLS証明書を使用している
- [ ] **プロトコル**: 安全なTLSバージョンのみを使用している

### 📊 モニタリング設定

#### セキュリティログ
- [ ] **監査ログ**: セキュリティイベントのログを設定している
- [ ] **アクセスログ**: 異常なアクセスパターンを検出できる
- [ ] **エラーログ**: セキュリティエラーを適切にログ記録している
- [ ] **ログ保護**: ログファイル自体のセキュリティを確保している

```typescript
// セキュリティログの設定確認
import { SecurityAuditLogger } from '@/utils/security-audit-logger'

const auditLogger = SecurityAuditLogger.getInstance()
// ログ設定の確認
console.log('Audit logging configured:', auditLogger.getConfig())
```

## 🛡️ 運用段階のセキュリティチェック

### 📈 継続的監視

#### 日次チェック
- [ ] **セキュリティアラート**: GitHub Security Advisories をチェックしている
- [ ] **アクセス解析**: 異常なアクセスパターンがないか確認している
- [ ] **エラーレート**: セキュリティエラーの発生率を監視している
- [ ] **パフォーマンス**: DDoS攻撃等によるパフォーマンス低下がないか確認している

#### 週次チェック
- [ ] **脆弱性スキャン**: 依存関係の脆弱性スキャンを実行している
- [ ] **セキュリティテスト**: 定期的なセキュリティテストを実行している
- [ ] **ログ分析**: セキュリティログの詳細分析を実行している
- [ ] **バックアップ**: セキュリティデータのバックアップを確認している

```bash
# 定期的なセキュリティチェックスクリプト
#!/bin/bash
echo "🔍 週次セキュリティチェック: $(date)"

# 脆弱性スキャン
npm audit --audit-level moderate

# セキュリティテスト
npm run test:run src/__tests__/security

# E2Eセキュリティテスト
npm run test:e2e tests/e2e/security-e2e.spec.ts

echo "✅ 週次セキュリティチェック完了"
```

#### 月次チェック
- [ ] **セキュリティレビュー**: コードのセキュリティレビューを実施している
- [ ] **ペネトレーションテスト**: より詳細なペネトレーションテストを実施している
- [ ] **依存関係更新**: セキュリティパッチの依存関係更新を実施している
- [ ] **インシデント対応訓練**: セキュリティインシデント対応の訓練を実施している

### 🔄 更新・メンテナンス

#### セキュリティ更新
- [ ] **依存関係更新**: セキュリティパッチを含む依存関係を定期更新している
- [ ] **セキュリティポリシー更新**: 脅威の変化に応じてポリシーを更新している
- [ ] **文書更新**: セキュリティ関連文書を最新の状態に保っている
- [ ] **訓練更新**: セキュリティ訓練内容を最新の脅威に対応させている

#### バックアップ・復旧
- [ ] **データバックアップ**: 重要なデータの定期バックアップを実施している
- [ ] **設定バックアップ**: セキュリティ設定のバックアップを実施している
- [ ] **復旧テスト**: 定期的な復旧テストを実施している
- [ ] **災害対策**: セキュリティインシデント時の災害対策を準備している

## 🚨 緊急時チェックリスト

### インシデント発生時（即座実行）
- [ ] **1. インシデント確認**: セキュリティインシデントの発生を確認している
- [ ] **2. 初動対応**: 被害拡大防止の初動対応を実施している
- [ ] **3. 証拠保全**: インシデントの証拠を保全している
- [ ] **4. 関係者通知**: 関係者への緊急通知を実施している
- [ ] **5. 状況記録**: インシデントの詳細を記録している

### インシデント調査時（1時間以内）
- [ ] **6. 影響範囲特定**: インシデントの影響範囲を特定している
- [ ] **7. 原因分析**: インシデントの根本原因を分析している
- [ ] **8. 攻撃分析**: 攻撃手法と攻撃者を分析している
- [ ] **9. 被害評価**: インシデントによる被害を評価している
- [ ] **10. 対応計画**: 復旧・対策計画を策定している

### 復旧・対策時（24時間以内）
- [ ] **11. 緊急修正**: 脆弱性の緊急修正を実施している
- [ ] **12. セキュリティ強化**: セキュリティ対策を強化している
- [ ] **13. 復旧確認**: システム復旧を確認している
- [ ] **14. 機能テスト**: 全機能の正常動作を確認している
- [ ] **15. セキュリティテスト**: セキュリティテストで対策を検証している

## 📊 セキュリティメトリクス

### 測定指標
- **脆弱性発見数**: 月次で発見された脆弱性の数
- **修正時間**: 脆弱性発見から修正完了までの時間
- **テストカバレッジ**: セキュリティテストのカバレッジ率
- **インシデント対応時間**: インシデント発生から解決までの時間
- **セキュリティスコア**: 総合的なセキュリティレベル

### 目標値
- 🎯 **高危険度脆弱性修正**: 24時間以内
- 🎯 **中危険度脆弱性修正**: 1週間以内  
- 🎯 **セキュリティテストカバレッジ**: 80%以上
- 🎯 **インシデント初動対応**: 15分以内
- 🎯 **セキュリティスコア**: 85点以上

## 🔧 自動化チェックリスト

### 自動実行されるセキュリティチェック
- [ ] **pre-commit hook**: コミット前にセキュリティチェックが実行される
- [ ] **GitHub Actions**: プッシュ時にセキュリティスキャンが実行される  
- [ ] **依存関係チェック**: 定期的な依存関係脆弱性チェックが実行される
- [ ] **セキュリティテスト**: CI/CDパイプラインでセキュリティテストが実行される

### 手動実行が必要なセキュリティチェック
- [ ] **包括的セキュリティレビュー**: 月次でのマニュアルセキュリティレビュー
- [ ] **ペネトレーションテスト**: 四半期でのペネトレーションテスト
- [ ] **セキュリティポリシー見直し**: 年次でのセキュリティポリシー見直し
- [ ] **インシデント対応訓練**: 半年次でのインシデント対応訓練

## 📚 参考資料とツール

### セキュリティツール
```bash
# 必須セキュリティツール
npm audit                     # 依存関係脆弱性チェック
npm run lint                  # ESLintセキュリティルール
npm run test:run src/__tests__/security  # セキュリティテスト
npm run test:e2e tests/e2e/security-e2e.spec.ts  # E2Eセキュリティテスト
```

### 外部リソース
- [OWASP Top 10](https://owasp.org/www-project-top-ten/)
- [CWE/SANS Top 25](https://cwe.mitre.org/top25/)
- [GitHub Security Lab](https://securitylab.github.com/)
- [Vue.js Security Guide](https://vuejs.org/guide/best-practices/security.html)

### プロジェクト固有リソース
- [セキュリティガイドライン](./SECURITY_GUIDELINES.md)
- [インシデント対応手順](./INCIDENT_RESPONSE.md)  
- [セキュリティテスト実装](../../src/__tests__/security/)

---

## ✅ チェックリスト使用方法

### 開発者向け
1. **機能開発時**: 「開発段階のセキュリティチェック」を実行
2. **プルリクエスト時**: テスト関連チェックを実行
3. **デプロイ前**: デプロイ段階チェックを実行

### DevOps/運用担当者向け
1. **日次**: 継続的監視のチェックを実行
2. **週次**: 定期チェックスクリプトを実行
3. **月次**: 包括的なセキュリティレビューを実行

### マネージャー向け
1. **月次**: セキュリティメトリクスの確認
2. **四半期**: セキュリティポリシーの見直し
3. **年次**: 全体的なセキュリティ戦略の評価

**🔒 セキュリティは継続的なプロセスです。このチェックリストを定期的に更新し、チーム全体で実践しましょう。**