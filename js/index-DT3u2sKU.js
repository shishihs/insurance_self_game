const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/analytics-C86SJn4N-d5L.js","js/game-logic-CE8B7gRniTtZ.js","js/vue-vendor-CHt8BYjp.js","js/vendor-CRDobNJa.js","js/chart-vendor--kNoNNFK7XBt.js","css/analytics-BQHCqjr6.css","js/MobileErrorHandler-BRrrHLkgh4HU.js","css/MobileErrorHandler-BRt2uNlx.css","js/feedback-GtyItvJ2eE-G.js","css/feedback-e4moMCIz.css"])))=>i.map(i=>d[i]);
var e,t=Object.defineProperty,i=(e,i,s)=>((e,i,s)=>i in e?t(e,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[i]=s)(e,"symbol"!=typeof i?i+"":i,s);/* empty css                       */import{d as s,g as n,c as a,o as r,l as o,T as c,L as l,M as u,f as d,h,w as m,y as p,b as y,p as v,a as f,j as w,k as b,t as S,v as k,s as E,u as C,i as I,e as x,n as _,F as A,r as T,N as L,O as P,q as R,P as D,Q as M,R as O,S as $,U as N,V as F,W as z,X as H,Y as j}from"./vue-vendor-CHt8BYjp.js";import{_ as U}from"./analytics-C86SJn4N-d5L.js";import{U as V,V as q}from"./vendor-CRDobNJa.js";import{G as B}from"./game-logic-CE8B7gRniTtZ.js";import"./chart-vendor--kNoNNFK7XBt.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const i of e)if("childList"===i.type)for(const e of i.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const G={},W=function(e,t,i){let s=Promise.resolve();if(t&&t.length>0){let e=function(e){return Promise.all(e.map(e=>Promise.resolve(e).then(e=>({status:"fulfilled",value:e}),e=>({status:"rejected",reason:e}))))};document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),n=i?.nonce||i?.getAttribute("nonce");s=e(t.map(e=>{if((e=function(e){return"/insurance_self_game/"+e}(e))in G)return;G[e]=!0;const t=e.endsWith(".css"),i=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${i}`))return;const s=document.createElement("link");return s.rel=t?"stylesheet":"modulepreload",t||(s.as="script"),s.crossOrigin="",s.href=e,n&&s.setAttribute("nonce",n),document.head.appendChild(s),t?new Promise((t,i)=>{s.addEventListener("load",t),s.addEventListener("error",()=>i(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function n(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return s.then(t=>{for(const e of t||[])"rejected"===e.status&&n(e.reason);return e().catch(n)})},K={class:"transition-animations"},Q=U(s({__name:"TransitionAnimations",props:{type:{default:"fade"},direction:{default:"right"},duration:{default:300},easing:{default:"cubic-bezier(0.4, 0, 0.2, 1)"},intensity:{default:"normal"}},setup(e){const t=e,i=n(()=>`${t.type}-${t.direction}-${t.intensity}`),s=e=>{const i=e;i.style.transitionDuration=`${t.duration}ms`,i.style.transitionTimingFunction=t.easing},d=(e,i)=>{setTimeout(i,t.duration)},h=(e,i)=>{setTimeout(i,t.duration)};return(e,t)=>(r(),a("div",K,[o(c,{name:i.value,mode:"out-in",onBeforeEnter:s,onEnter:d,onLeave:h},{default:l(()=>[u(e.$slots,"default",{},void 0)]),_:3},8,["name"])]))}}),[["__scopeId","data-v-23af9bdf"]]);class J{constructor(){i(this,"liveRegions",new Map),i(this,"gameStatusElement"),i(this,"cardDetailsElement"),i(this,"announcementQueue",[]),i(this,"isProcessingQueue",!1),this.createLiveRegions(),this.createGameStatusElements(),this.setupAriaDescriptions()}announce(e,t={priority:"polite"}){t.interrupt&&this.clearQueue(),this.announcementQueue.push({message:e,options:t}),this.processQueue()}announceGameState(e){const{type:t,message:i,context:s}=e;this.updateGameStatus(t,i,s);const n=this.getPriorityForGameState(t);this.announce(i,{priority:n,persist:!0})}announceCardDetails(e){const t=this.createCardDescription(e);this.cardDetailsElement.textContent=t,this.announce(`ã‚«ãƒ¼ãƒ‰é¸æŠ: ${t}`,{priority:"polite"})}announceError(e){this.announce(`ã‚¨ãƒ©ãƒ¼: ${e}`,{priority:"assertive",interrupt:!0})}announceSuccess(e){this.announce(`æˆåŠŸ: ${e}`,{priority:"polite"})}announceProgress(e,t,i){const s=`${i}: ${e}/${t} (${Math.round(e/t*100)}%)`;this.announce(s,{priority:"polite"})}announceOptions(e,t){const i=`é¸æŠè‚¢ ${t+1}/${e.length}: ${e[t]}`;this.announce(i,{priority:"polite"})}announceTimer(e,t="seconds"){const i="seconds"===t?"ç§’":"åˆ†";let s;s=e<=0?"æ™‚é–“åˆ‡ã‚Œã§ã™":e<=10&&"seconds"===t||e<=60&&"seconds"===t?`æ®‹ã‚Š${e}${i}`:`æ®‹ã‚Šæ™‚é–“: ${e}${i}`;const n=e<=10?"assertive":"polite";this.announce(s,{priority:n})}announceScreenChange(e,t){let i=`ç”»é¢ãŒå¤‰æ›´ã•ã‚Œã¾ã—ãŸ: ${e}`;t&&(i+=`. ${t}`),this.announce(i,{priority:"assertive",persist:!0})}announceKeyboardHelp(){const e=`ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ: ${["Tabã‚­ãƒ¼ã§æ¬¡ã®è¦ç´ ã«ç§»å‹•","Shift+Tabã§å‰ã®è¦ç´ ã«ç§»å‹•","Enterã‚­ãƒ¼ã¾ãŸã¯ã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼ã§é¸æŠ","F1ã‚­ãƒ¼ã§ãƒ˜ãƒ«ãƒ—ã‚’è¡¨ç¤º"].join(", ")}`;this.announce(e,{priority:"polite",persist:!0})}announceGameStats(e){const t=`ã‚²ãƒ¼ãƒ çµ±è¨ˆ. ${Object.entries(e).map(([e,t])=>`${this.translateStatKey(e)}: ${t}`).join(", ")}`;this.announce(t,{priority:"polite",persist:!0})}announceRegionStatus(e,t){const i=t.length,s=this.getItemType(t);let n;n=0===i?`${e}ã¯ç©ºã§ã™`:1===i?`${e}ã«${s}ãŒ1ã¤ã‚ã‚Šã¾ã™`:`${e}ã«${s}ãŒ${i}å€‹ã‚ã‚Šã¾ã™`,this.announce(n,{priority:"polite"})}announceDragDrop(e,t){let i;switch(e){case"start":i=`${t.itemName}ã®ãƒ‰ãƒ©ãƒƒã‚°ã‚’é–‹å§‹ã—ã¾ã—ãŸ`;break;case"move":i=`${t.targetName}ã®ä¸Šã«ç§»å‹•ä¸­`;break;case"drop":i=t.success?`${t.targetName}ã«${t.itemName}ã‚’ãƒ‰ãƒ­ãƒƒãƒ—ã—ã¾ã—ãŸ`:`ãƒ‰ãƒ­ãƒƒãƒ—ã«å¤±æ•—ã—ã¾ã—ãŸ: ${t.reason}`;break;case"cancel":i="ãƒ‰ãƒ©ãƒƒã‚°æ“ä½œã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã—ãŸ"}const s="drop"!==e||t.success?"polite":"assertive";this.announce(i,{priority:s})}createLiveRegions(){const e=document.createElement("div");e.setAttribute("aria-live","polite"),e.setAttribute("aria-relevant","additions text"),e.setAttribute("aria-atomic","false"),e.className="sr-only",e.id="live-region-polite",document.body.appendChild(e),this.liveRegions.set("polite",e);const t=document.createElement("div");t.setAttribute("aria-live","assertive"),t.setAttribute("aria-relevant","additions text"),t.setAttribute("aria-atomic","true"),t.className="sr-only",t.id="live-region-assertive",document.body.appendChild(t),this.liveRegions.set("assertive",t)}createGameStatusElements(){this.gameStatusElement=document.createElement("div"),this.gameStatusElement.id="game-status",this.gameStatusElement.className="sr-only",this.gameStatusElement.setAttribute("aria-label","ã‚²ãƒ¼ãƒ çŠ¶æ…‹"),document.body.appendChild(this.gameStatusElement),this.cardDetailsElement=document.createElement("div"),this.cardDetailsElement.id="card-details",this.cardDetailsElement.className="sr-only",this.cardDetailsElement.setAttribute("aria-label","ã‚«ãƒ¼ãƒ‰è©³ç´°"),document.body.appendChild(this.cardDetailsElement)}setupAriaDescriptions(){const e=document.createElement("style");e.textContent="\n      .sr-only {\n        position: absolute;\n        width: 1px;\n        height: 1px;\n        padding: 0;\n        margin: -1px;\n        overflow: hidden;\n        clip: rect(0, 0, 0, 0);\n        white-space: nowrap;\n        border: 0;\n      }\n      \n      .sr-only-focusable:focus {\n        position: static;\n        width: auto;\n        height: auto;\n        padding: inherit;\n        margin: inherit;\n        overflow: visible;\n        clip: auto;\n        white-space: normal;\n      }\n    ",document.head.appendChild(e)}async processQueue(){if(!this.isProcessingQueue&&0!==this.announcementQueue.length){for(this.isProcessingQueue=!0;this.announcementQueue.length>0;){const{message:e,options:t}=this.announcementQueue.shift();t.delay&&await this.delay(t.delay),await this.performAnnouncement(e,t),await this.delay(100)}this.isProcessingQueue=!1}}async performAnnouncement(e,t){const i=this.liveRegions.get(t.priority);if(i)if(t.persist||(i.textContent="",await this.delay(10)),t.persist){const t=document.createElement("div");t.textContent=e,i.appendChild(t),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t)},5e3)}else i.textContent=e}updateGameStatus(e,t,i){const s={type:e,message:t,timestamp:(new Date).toISOString(),...i};this.gameStatusElement.setAttribute("data-game-state",JSON.stringify(s)),this.gameStatusElement.textContent=t}createCardDescription(e){const t=[e.name];return e.type&&t.push(`ç¨®é¡: ${this.translateCardType(e.type)}`),void 0!==e.power&&t.push(`ãƒ‘ãƒ¯ãƒ¼: ${e.power}`),void 0!==e.cost&&t.push(`ã‚³ã‚¹ãƒˆ: ${e.cost}`),e.description&&t.push(`èª¬æ˜: ${e.description}`),t.join(", ")}getPriorityForGameState(e){return["challenge_result","game_end","error"].includes(e)?"assertive":"polite"}translateStatKey(e){return{vitality:"æ´»åŠ›",turn:"ã‚¿ãƒ¼ãƒ³",cardsInHand:"æ‰‹æœ­æšæ•°",challengesCompleted:"å®Œäº†ãƒãƒ£ãƒ¬ãƒ³ã‚¸æ•°",insuranceCards:"ä¿é™ºã‚«ãƒ¼ãƒ‰æ•°"}[e]||e}translateCardType(e){return{life:"ãƒ©ã‚¤ãƒ•ã‚«ãƒ¼ãƒ‰",insurance:"ä¿é™ºã‚«ãƒ¼ãƒ‰",challenge:"ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã‚«ãƒ¼ãƒ‰",dream:"ãƒ‰ãƒªãƒ¼ãƒ ã‚«ãƒ¼ãƒ‰"}[e]||e}getItemType(e){if(0===e.length)return"ã‚¢ã‚¤ãƒ†ãƒ ";const t=e[0];return t.type?this.translateCardType(t.type):"ã‚¢ã‚¤ãƒ†ãƒ "}clearQueue(){this.announcementQueue=[],this.liveRegions.forEach(e=>{e.textContent=""})}async delay(e){return new Promise(t=>setTimeout(t,e))}destroy(){this.liveRegions.forEach(e=>{e.parentNode&&e.parentNode.removeChild(e)}),this.gameStatusElement?.parentNode&&this.gameStatusElement.parentNode.removeChild(this.gameStatusElement),this.cardDetailsElement?.parentNode&&this.cardDetailsElement.parentNode.removeChild(this.cardDetailsElement),this.clearQueue()}}const Y={class:"modal-content",role:"dialog","aria-labelledby":"accessibility-title","aria-describedby":"accessibility-description"},X={style:{position:"absolute",width:"0",height:"0"}},Z=["innerHTML"],ee={class:"modal-header"},te={class:"modal-body"},ie={class:"settings-section"},se={class:"setting-item"},ne={class:"setting-item"},ae={for:"high-contrast"},re={class:"setting-item"},oe={class:"settings-section"},ce={class:"setting-item"},le={for:"reduce-motion"},ue={key:0,class:"setting-item"},de={class:"range-value"},he={class:"settings-section"},ge={class:"setting-item"},me={for:"screen-reader"},pe={class:"setting-item"},ye={for:"audio-descriptions"},ve={class:"setting-item"},fe={class:"range-value"},we={class:"settings-section"},be={class:"setting-item"},Se={for:"sticky-keys"},ke={class:"setting-item"},Ee={class:"modal-footer"},Ce=U(s({__name:"AccessibilitySettings",props:{isOpen:{type:Boolean}},emits:["close","settingsChanged"],setup(e,{emit:t}){const i=e,s=t,n={colorScheme:"default",highContrast:!1,fontSize:"medium",reduceMotion:!1,animationSpeed:1,screenReaderEnabled:!1,audioDescriptions:!1,soundEffectsVolume:70,stickyKeys:!1,keyRepeatDelay:500,touchTargetSize:"default"},o=d({...n}),u=d(null),g={default:"",protanopia:'\n    <filter id="protanopia">\n      <feColorMatrix type="matrix" values="\n        0.567, 0.433, 0,     0, 0\n        0.558, 0.442, 0,     0, 0\n        0,     0.242, 0.758, 0, 0\n        0,     0,     0,     1, 0\n      "/>\n    </filter>\n  ',deuteranopia:'\n    <filter id="deuteranopia">\n      <feColorMatrix type="matrix" values="\n        0.625, 0.375, 0,   0, 0\n        0.7,   0.3,   0,   0, 0\n        0,     0.3,   0.7, 0, 0\n        0,     0,     0,   1, 0\n      "/>\n    </filter>\n  ',tritanopia:'\n    <filter id="tritanopia">\n      <feColorMatrix type="matrix" values="\n        0.95, 0.05,  0,     0, 0\n        0,    0.433, 0.567, 0, 0\n        0,    0.475, 0.525, 0, 0\n        0,    0,     0,     1, 0\n      "/>\n    </filter>\n  ',achromatopsia:'\n    <filter id="achromatopsia">\n      <feColorMatrix type="matrix" values="\n        0.299, 0.587, 0.114, 0, 0\n        0.299, 0.587, 0.114, 0, 0\n        0.299, 0.587, 0.114, 0, 0\n        0,     0,     0,     1, 0\n      "/>\n    </filter>\n  '},I=()=>{localStorage.setItem("accessibility-settings",JSON.stringify(o.value)),s("settingsChanged",o.value),x()},x=()=>{const e=document.documentElement;"default"!==o.value.colorScheme?e.style.filter=`url(#${o.value.colorScheme})`:e.style.filter="",e.classList.toggle("high-contrast",o.value.highContrast),e.style.setProperty("--base-font-size",{small:"14px",medium:"16px",large:"20px","extra-large":"24px"}[o.value.fontSize]),e.classList.toggle("reduce-motion",o.value.reduceMotion),e.style.setProperty("--animation-speed-multiplier",String(o.value.animationSpeed)),e.style.setProperty("--touch-target-size",{default:"44px",large:"56px","extra-large":"72px"}[o.value.touchTargetSize]),u.value&&u.value.announce("ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£è¨­å®šãŒæ›´æ–°ã•ã‚Œã¾ã—ãŸ",{priority:"polite"})},_=()=>{o.value={...n},I(),u.value&&u.value.announce("ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£è¨­å®šã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ",{priority:"assertive"})};return h(()=>{(()=>{const e=localStorage.getItem("accessibility-settings");if(e)try{o.value={...n,...JSON.parse(e)}}catch(t){}})(),x(),u.value=new J;const e=(()=>{const e=e=>{if(i.isOpen&&e.ctrlKey&&e.altKey)switch(e.key){case"c":const e=["default","protanopia","deuteranopia","tritanopia","achromatopsia"],t=e.indexOf(o.value.colorScheme);o.value.colorScheme=e[(t+1)%e.length],I();break;case"h":o.value.highContrast=!o.value.highContrast,I();break;case"m":o.value.reduceMotion=!o.value.reduceMotion,I()}};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}})();return()=>{e(),u.value?.destroy()}}),m(()=>o.value,()=>{I()},{deep:!0}),(e,t)=>(r(),p(c,{name:"modal"},{default:l(()=>[e.isOpen?(r(),a("div",{key:0,class:"accessibility-modal",onClick:t[13]||(t[13]=v(e=>s("close"),["self"]))},[f("div",Y,[(r(),a("svg",X,[f("defs",{innerHTML:Object.values(g).join("")},null,8,Z)])),f("div",ee,[t[15]||(t[15]=f("h2",{id:"accessibility-title"},"ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£è¨­å®š",-1)),f("button",{class:"close-button","aria-label":"è¨­å®šã‚’é–‰ã˜ã‚‹",onClick:t[0]||(t[0]=e=>s("close"))},t[14]||(t[14]=[f("span",{"aria-hidden":"true"},"Ã—",-1)]))]),t[36]||(t[36]=f("div",{id:"accessibility-description",class:"sr-only"}," ã‚²ãƒ¼ãƒ ã®ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¨­å®šã§ãã¾ã™ã€‚ Ctrl+Alt+Cã§è‰²è¦šè¨­å®šã€Ctrl+Alt+Hã§ãƒã‚¤ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆã€Ctrl+Alt+Mã§ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³å‰Šæ¸›ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‰ã‚Œã¾ã™ã€‚ ",-1)),f("div",te,[f("section",ie,[t[22]||(t[22]=f("h3",null,"è¦–è¦šè¨­å®š",-1)),f("div",se,[t[17]||(t[17]=f("label",{for:"color-scheme"},"è‰²è¦šã‚µãƒãƒ¼ãƒˆ",-1)),w(f("select",{id:"color-scheme","onUpdate:modelValue":t[1]||(t[1]=e=>o.value.colorScheme=e),onChange:I},t[16]||(t[16]=[f("option",{value:"default"},"æ¨™æº–",-1),f("option",{value:"protanopia"},"èµ¤è‰²è¦šç•°å¸¸ï¼ˆ1å‹ï¼‰",-1),f("option",{value:"deuteranopia"},"ç·‘è‰²è¦šç•°å¸¸ï¼ˆ2å‹ï¼‰",-1),f("option",{value:"tritanopia"},"é’è‰²è¦šç•°å¸¸ï¼ˆ3å‹ï¼‰",-1),f("option",{value:"achromatopsia"},"å…¨è‰²è¦šç•°å¸¸",-1)]),544),[[k,o.value.colorScheme]]),f("button",{class:"preview-button","aria-label":"è‰²è¦šè¨­å®šã‚’ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼",onClick:t[2]||(t[2]=e=>((e,t)=>{const i=o.value[e];o.value[e]=t,x(),setTimeout(()=>{o.value[e]===t&&(o.value[e]=i,x())},3e3)})("colorScheme",o.value.colorScheme))}," ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ ")]),f("div",ne,[f("label",ae,[w(f("input",{id:"high-contrast","onUpdate:modelValue":t[3]||(t[3]=e=>o.value.highContrast=e),type:"checkbox",onChange:I},null,544),[[E,o.value.highContrast]]),t[18]||(t[18]=b(" ãƒã‚¤ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰ ",-1))]),t[19]||(t[19]=f("span",{class:"setting-description"}," ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆã‚’é«˜ã‚ã¦è¦–èªæ€§ã‚’å‘ä¸Šã•ã›ã¾ã™ ",-1))]),f("div",re,[t[21]||(t[21]=f("label",{for:"font-size"},"æ–‡å­—ã‚µã‚¤ã‚º",-1)),w(f("select",{id:"font-size","onUpdate:modelValue":t[4]||(t[4]=e=>o.value.fontSize=e),onChange:I},t[20]||(t[20]=[f("option",{value:"small"},"å°ï¼ˆ14pxï¼‰",-1),f("option",{value:"medium"},"ä¸­ï¼ˆ16pxï¼‰",-1),f("option",{value:"large"},"å¤§ï¼ˆ20pxï¼‰",-1),f("option",{value:"extra-large"},"ç‰¹å¤§ï¼ˆ24pxï¼‰",-1)]),544),[[k,o.value.fontSize]])])]),f("section",oe,[t[26]||(t[26]=f("h3",null,"ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š",-1)),f("div",ce,[f("label",le,[w(f("input",{id:"reduce-motion","onUpdate:modelValue":t[5]||(t[5]=e=>o.value.reduceMotion=e),type:"checkbox",onChange:I},null,544),[[E,o.value.reduceMotion]]),t[23]||(t[23]=b(" ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å‰Šæ¸› ",-1))]),t[24]||(t[24]=f("span",{class:"setting-description"}," ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æœ€å°é™ã«æŠ‘ãˆã¾ã™ ",-1))]),o.value.reduceMotion?y("",!0):(r(),a("div",ue,[t[25]||(t[25]=f("label",{for:"animation-speed"},"ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é€Ÿåº¦",-1)),w(f("input",{id:"animation-speed","onUpdate:modelValue":t[6]||(t[6]=e=>o.value.animationSpeed=e),type:"range",min:"0.1",max:"2.0",step:"0.1",onChange:I},null,544),[[C,o.value.animationSpeed,void 0,{number:!0}]]),f("span",de,S(o.value.animationSpeed)+"x",1)]))]),f("section",he,[t[30]||(t[30]=f("h3",null,"ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªè¨­å®š",-1)),f("div",ge,[f("label",me,[w(f("input",{id:"screen-reader","onUpdate:modelValue":t[7]||(t[7]=e=>o.value.screenReaderEnabled=e),type:"checkbox",onChange:I},null,544),[[E,o.value.screenReaderEnabled]]),t[27]||(t[27]=b(" ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒªãƒ¼ãƒ€ãƒ¼å¯¾å¿œã‚’æœ‰åŠ¹åŒ– ",-1))])]),f("div",pe,[f("label",ye,[w(f("input",{id:"audio-descriptions","onUpdate:modelValue":t[8]||(t[8]=e=>o.value.audioDescriptions=e),type:"checkbox",onChange:I},null,544),[[E,o.value.audioDescriptions]]),t[28]||(t[28]=b(" éŸ³å£°èª¬æ˜ã‚’æœ‰åŠ¹åŒ– ",-1))])]),f("div",ve,[t[29]||(t[29]=f("label",{for:"sound-volume"},"åŠ¹æœéŸ³ã®éŸ³é‡",-1)),w(f("input",{id:"sound-volume","onUpdate:modelValue":t[9]||(t[9]=e=>o.value.soundEffectsVolume=e),type:"range",min:"0",max:"100",step:"5",onChange:I},null,544),[[C,o.value.soundEffectsVolume,void 0,{number:!0}]]),f("span",fe,S(o.value.soundEffectsVolume)+"%",1)])]),f("section",we,[t[35]||(t[35]=f("h3",null,"ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³è¨­å®š",-1)),f("div",be,[f("label",Se,[w(f("input",{id:"sticky-keys","onUpdate:modelValue":t[10]||(t[10]=e=>o.value.stickyKeys=e),type:"checkbox",onChange:I},null,544),[[E,o.value.stickyKeys]]),t[31]||(t[31]=b(" ã‚¹ãƒ†ã‚£ãƒƒã‚­ãƒ¼ã‚­ãƒ¼ ",-1))]),t[32]||(t[32]=f("span",{class:"setting-description"}," ä¿®é£¾ã‚­ãƒ¼ã‚’ä¸€åº¦ã«æŠ¼ã™å¿…è¦ãŒã‚ã‚Šã¾ã›ã‚“ ",-1))]),f("div",ke,[t[34]||(t[34]=f("label",{for:"touch-target-size"},"ã‚¿ãƒƒãƒã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚µã‚¤ã‚º",-1)),w(f("select",{id:"touch-target-size","onUpdate:modelValue":t[11]||(t[11]=e=>o.value.touchTargetSize=e),onChange:I},t[33]||(t[33]=[f("option",{value:"default"},"æ¨™æº–ï¼ˆ44pxï¼‰",-1),f("option",{value:"large"},"å¤§ï¼ˆ56pxï¼‰",-1),f("option",{value:"extra-large"},"ç‰¹å¤§ï¼ˆ72pxï¼‰",-1)]),544),[[k,o.value.touchTargetSize]])])])]),f("div",Ee,[f("button",{class:"reset-button","aria-label":"ã™ã¹ã¦ã®è¨­å®šã‚’ãƒªã‚»ãƒƒãƒˆ",onClick:_}," è¨­å®šã‚’ãƒªã‚»ãƒƒãƒˆ "),f("button",{class:"save-button","aria-label":"è¨­å®šã‚’ä¿å­˜ã—ã¦é–‰ã˜ã‚‹",onClick:t[12]||(t[12]=e=>s("close"))}," ä¿å­˜ã—ã¦é–‰ã˜ã‚‹ ")])])])):y("",!0)]),_:1}))}}),[["__scopeId","data-v-a0f37523"]]);class Ie{constructor(e={}){i(this,"focusedElement",null),i(this,"indicator"),i(this,"options"),this.options={color:e.color||"#818CF8",width:e.width||3,style:e.style||"solid",offset:e.offset||4,borderRadius:e.borderRadius||8},this.indicator=this.createIndicator(),document.body.appendChild(this.indicator),this.setupEventListeners()}createIndicator(){const e=document.createElement("div");return e.className="focus-indicator",e.style.cssText=`\n      position: fixed;\n      pointer-events: none;\n      z-index: 10000;\n      transition: all 200ms cubic-bezier(0.25, 0.46, 0.45, 0.94);\n      opacity: 0;\n      border: ${this.options.width}px ${this.options.style} ${this.options.color};\n      border-radius: ${this.options.borderRadius}px;\n      box-shadow: 0 0 20px rgba(129, 140, 248, 0.4);\n    `,e}setupEventListeners(){document.addEventListener("focusin",this.handleFocusIn.bind(this)),document.addEventListener("focusout",this.handleFocusOut.bind(this)),window.addEventListener("scroll",this.updatePosition.bind(this),!0),window.addEventListener("resize",this.updatePosition.bind(this)),new MutationObserver(()=>{this.focusedElement&&this.updatePosition()}).observe(document.body,{attributes:!0,childList:!0,subtree:!0,attributeFilter:["style","class"]})}handleFocusIn(e){const t=e.target;this.isFocusableElement(t)&&(this.focusedElement=t,this.showIndicator(t))}handleFocusOut(){this.focusedElement=null,this.hideIndicator()}isFocusableElement(e){return["button","input","select","textarea","a[href]",'[tabindex]:not([tabindex="-1"])',"[contenteditable]"].some(t=>e.matches(t)||e.closest(t))}showIndicator(e){const t=e.getBoundingClientRect(),i=this.options.offset;this.indicator.style.left=t.left-i+"px",this.indicator.style.top=t.top-i+"px",this.indicator.style.width=`${t.width+2*i}px`,this.indicator.style.height=`${t.height+2*i}px`,this.indicator.style.opacity="1";const s=window.getComputedStyle(e).borderRadius;s&&"0px"!==s&&(this.indicator.style.borderRadius=s)}hideIndicator(){this.indicator.style.opacity="0"}updatePosition(){this.focusedElement&&this.focusedElement===document.activeElement&&this.showIndicator(this.focusedElement)}setOptions(e){Object.assign(this.options,e),this.indicator.style.border=`${this.options.width}px ${this.options.style} ${this.options.color}`,this.indicator.style.borderRadius=`${this.options.borderRadius}px`,this.focusedElement&&this.updatePosition()}destroy(){this.indicator.remove(),document.removeEventListener("focusin",this.handleFocusIn.bind(this)),document.removeEventListener("focusout",this.handleFocusOut.bind(this)),window.removeEventListener("scroll",this.updatePosition.bind(this),!0),window.removeEventListener("resize",this.updatePosition.bind(this))}}const xe={key:0,class:"keyboard-hints",role:"tooltip","aria-live":"polite"},_e={class:"hints-list"},Ae={class:"hint-key"},Te={class:"hint-description"},Le={key:0,class:"settings-panel"},Pe=["value"],Re=["value"],De=U(s({__name:"VisualIndicators",props:{enabled:{type:Boolean,default:!0},color:{default:"#818CF8"},width:{default:3},style:{default:"solid"},offset:{default:4},borderRadius:{default:8},showKeyboardHints:{type:Boolean,default:!0},reducedMotion:{type:Boolean,default:!1}},setup(e,{expose:t}){const i=e,s=d(i.enabled),u=d({color:i.color,width:i.width,style:i.style,offset:i.offset,borderRadius:i.borderRadius});let g=null;const m=d(!1),p=d(null),v=n(()=>({"--focus-color":u.value.color,"--focus-width":`${u.value.width}px`,"--focus-offset":`${u.value.offset}px`,"--focus-radius":`${u.value.borderRadius}px`})),k=n(()=>[{key:"Tab",description:"æ¬¡ã®è¦ç´ ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹"},{key:"Shift + Tab",description:"å‰ã®è¦ç´ ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹"},{key:"Enter",description:"é¸æŠã—ãŸè¦ç´ ã‚’å®Ÿè¡Œ"},{key:"Space",description:"ãƒœã‚¿ãƒ³ã‚„ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’æ“ä½œ"},{key:"Arrow Keys",description:"ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚„é¸æŠè‚¢ã‚’ç§»å‹•"},{key:"Escape",description:"ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚„ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‰ã˜ã‚‹"}]),C=()=>{s.value&&!g&&(g=new Ie(u.value))},P=()=>{g&&(g.destroy(),g=null)},R=()=>{g&&g.setOptions(u.value)},D=()=>{i.showKeyboardHints&&(m.value=!0,p.value&&clearTimeout(p.value),p.value=window.setTimeout(()=>{m.value=!1},5e3))},M=()=>{m.value=!1,p.value&&(clearTimeout(p.value),p.value=null)},O=e=>{"Tab"===e.key&&D()},$=e=>{Object.assign(u.value,e),R()},N=()=>{s.value=!s.value,s.value?C():P()};return h(()=>{C(),document.addEventListener("keydown",O),window.matchMedia("(prefers-reduced-motion: reduce)").matches&&(u.value={...u.value,offset:2},R())}),I(()=>{P(),document.removeEventListener("keydown",O),p.value&&clearTimeout(p.value)}),t({updateSettings:$,toggleEnabled:N,showKeyboardHints:D,hideKeyboardHints:M}),(e,t)=>(r(),a("div",{class:_(["visual-indicators",{"reduced-motion":e.reducedMotion,"hints-visible":m.value}]),style:x(v.value)},[o(c,{name:"hints-fade"},{default:l(()=>[m.value&&D?(r(),a("div",xe,[f("div",{class:"hints-header"},[t[3]||(t[3]=f("h3",{class:"hints-title"},"ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ",-1)),f("button",{class:"hints-close","aria-label":"ãƒ’ãƒ³ãƒˆã‚’é–‰ã˜ã‚‹",onClick:M}," Ã— ")]),f("ul",_e,[(r(!0),a(A,null,T(k.value,e=>(r(),a("li",{key:e.key,class:"hint-item"},[f("kbd",Ae,S(e.key),1),f("span",Te,S(e.description),1)]))),128))])])):y("",!0)]),_:1}),L(!1)?(r(),a("div",Le,[t[7]||(t[7]=f("h4",null,"ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼è¨­å®š",-1)),f("label",null,[w(f("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>s.value=e),type:"checkbox",onChange:N},null,544),[[E,s.value]]),t[4]||(t[4]=b(" æœ‰åŠ¹ ",-1))]),f("label",null,[t[5]||(t[5]=b(" è‰²: ",-1)),f("input",{value:u.value.color,type:"color",onInput:t[1]||(t[1]=e=>$({color:e.target.value}))},null,40,Pe)]),f("label",null,[t[6]||(t[6]=b(" å¹…: ",-1)),f("input",{value:u.value.width,type:"range",min:"1",max:"10",onInput:t[2]||(t[2]=e=>$({width:parseInt(e.target.value)}))},null,40,Re)])])):y("",!0)],6))}}),[["__scopeId","data-v-3bb81bcd"]]),Me=["data-severity"],Oe={key:0,class:"error-minimal"},$e={key:1,class:"error-detailed"},Ne={class:"error-user-message"},Fe={class:"error-actions"},ze=["disabled"],He={key:0,class:"error-details"},je={class:"error-technical"},Ue={key:0,class:"error-stack"},Ve={key:2,class:"error-custom"},qe=U(s({__name:"ErrorBoundary",props:{fallback:{default:"detailed"},onError:{},canRecover:{type:Boolean,default:!0},recoveryMessage:{default:"ã‚¨ãƒ©ãƒ¼ã‹ã‚‰å›å¾©ã™ã‚‹ã«ã¯ã€ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„"}},emits:["error","recover"],setup(e,{emit:t}){const i=e,s=t,o=d(!1),c=d(null),l=d(""),h=d(0),g=d(!1),m=n(()=>{if(!c.value)return"low";const e=c.value.message.toLowerCase();return e.includes("cannot read")||e.includes("undefined")?"high":e.includes("network")||e.includes("fetch")?"medium":"low"}),p=n(()=>{if(!c.value)return"";const e=c.value.message;return e.includes("dynamically imported module")||e.includes("Failed to fetch")?"ã‚¢ãƒ—ãƒªã®ä¸€éƒ¨ãŒèª­ã¿è¾¼ã‚ã¾ã›ã‚“ã§ã—ãŸã€‚ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šã‚’ç¢ºèªã—ã¦ãã ã•ã„":e.includes("Network")||e.includes("fetch")?"ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã«å•é¡ŒãŒç™ºç”Ÿã—ã¾ã—ãŸ":e.includes("Cannot read")||e.includes("Cannot access")?"ç”»é¢ã®è¡¨ç¤ºä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ":e.includes("undefined")||e.includes("null")?"ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ":e.includes("timeout")?"å‡¦ç†ãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„":e.includes("Permission denied")||e.includes("CORS")?"ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“":"äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ"});P((e,t,n)=>(o.value=!0,c.value=e,l.value=n,h.value++,i.onError&&i.onError(e,t,n),s("error",e,n),!1));const v=async()=>{g.value=!0;try{o.value=!1,c.value=null,l.value="",s("recover"),await new Promise(e=>setTimeout(e,100))}catch(e){o.value=!0}finally{g.value=!1}},w=()=>{window.location.reload()},k=async()=>{if(!c.value)return;const e=`\nã‚¨ãƒ©ãƒ¼: ${c.value.message}\nã‚¹ã‚¿ãƒƒã‚¯: ${c.value.stack||"N/A"}\næƒ…å ±: ${l.value}\næ™‚åˆ»: ${(new Date).toISOString()}\nãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ: ${navigator.userAgent}\n  `.trim();try{await navigator.clipboard.writeText(e),alert("ã‚¨ãƒ©ãƒ¼è©³ç´°ã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ")}catch(t){}},E=()=>{if(!c.value)return;const e=new CustomEvent("app:send-error-report",{detail:{error:c.value,info:l.value,component:"ErrorBoundary"}});window.dispatchEvent(e),alert("ã‚¨ãƒ©ãƒ¼ãƒ¬ãƒãƒ¼ãƒˆã‚’é€ä¿¡ã—ã¾ã—ãŸ")};return(e,t)=>o.value?(r(),a("div",{key:0,class:"error-boundary","data-severity":m.value},["minimal"===e.fallback?(r(),a("div",Oe,[t[0]||(t[0]=f("p",{class:"error-message"},"ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ",-1)),f("button",{class:"error-action-btn",onClick:w}," ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ ")])):"detailed"===e.fallback?(r(),a("div",$e,[t[5]||(t[5]=R('<div class="error-icon" aria-hidden="true" data-v-e6800a6b><svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" data-v-e6800a6b><circle cx="12" cy="12" r="10" stroke-width="2" data-v-e6800a6b></circle><line x1="12" y1="8" x2="12" y2="12" stroke-width="2" data-v-e6800a6b></line><line x1="12" y1="16" x2="12.01" y2="16" stroke-width="2" data-v-e6800a6b></line></svg></div><h2 class="error-title" data-v-e6800a6b>ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ</h2>',2)),f("p",Ne,S(p.value),1),f("div",Fe,[e.canRecover&&!g.value?(r(),a("button",{key:0,class:"error-action-btn primary",disabled:h.value>3,onClick:v},S(h.value>3?"å›å¾©ã§ãã¾ã›ã‚“":"å›å¾©ã‚’è©¦ã¿ã‚‹"),9,ze)):y("",!0),f("button",{class:"error-action-btn secondary",onClick:w}," ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ ")]),L(!1)?(r(),a("details",He,[t[4]||(t[4]=f("summary",null,"ã‚¨ãƒ©ãƒ¼è©³ç´°ï¼ˆé–‹ç™ºè€…å‘ã‘ï¼‰",-1)),f("div",je,[f("p",null,[t[1]||(t[1]=f("strong",null,"ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:",-1)),b(" "+S(c.value?.message),1)]),f("p",null,[t[2]||(t[2]=f("strong",null,"ã‚¨ãƒ©ãƒ¼æƒ…å ±:",-1)),b(" "+S(l.value),1)]),f("p",null,[t[3]||(t[3]=f("strong",null,"ã‚¨ãƒ©ãƒ¼å›æ•°:",-1)),b(" "+S(h.value),1)]),c.value?.stack?(r(),a("pre",Ue,S(c.value.stack),1)):y("",!0),f("div",{class:"error-dev-actions"},[f("button",{class:"error-action-btn small",onClick:k}," è©³ç´°ã‚’ã‚³ãƒ”ãƒ¼ "),f("button",{class:"error-action-btn small",onClick:E}," ãƒ¬ãƒãƒ¼ãƒˆé€ä¿¡ ")])])])):y("",!0)])):"custom"===e.fallback?(r(),a("div",Ve,[u(e.$slots,"error",{error:c.value,retry:v,reload:w},void 0)])):y("",!0)],8,Me)):u(e.$slots,"default",{key:1},void 0)}}),[["__scopeId","data-v-e6800a6b"]]),Be=new class{constructor(){i(this,"patterns",[]),i(this,"fallbackMessages",new Map),this.initializeDefaultPatterns(),this.initializeFallbackMessages()}initializeDefaultPatterns(){this.patterns.push({id:"network-offline",pattern:/network|offline|connection/i,message:{title:"ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šãŒåˆ‡æ–­ã•ã‚Œã¦ã„ã¾ã™",description:"ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šã‚’ç¢ºèªã—ã¦ã€ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚",actionLabel:"å†è©¦è¡Œ",actionType:"retry",icon:"ğŸ“¡",severity:"error",helpUrl:"/help/network-issues"},conditions:{category:["network"]}}),this.patterns.push({id:"network-timeout",pattern:/timeout|slow/i,message:{title:"æ¥ç¶šãŒé…ããªã£ã¦ã„ã¾ã™",description:"ã‚µãƒ¼ãƒãƒ¼ã¸ã®æ¥ç¶šã«æ™‚é–“ãŒã‹ã‹ã£ã¦ã„ã¾ã™ã€‚ã—ã°ã‚‰ãå¾…ã£ã¦ã‹ã‚‰å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚",actionLabel:"ã‚‚ã†ä¸€åº¦è©¦ã™",actionType:"retry",icon:"â°",severity:"warning"},conditions:{category:["network","async"]}}),this.patterns.push({id:"game-save-failed",pattern:/save|storage|quota/i,message:{title:"ã‚²ãƒ¼ãƒ ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ",description:"ã‚²ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å®¹é‡ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚",actionLabel:"ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’ç¢ºèª",actionType:"navigate",actionData:{url:"/settings/storage"},icon:"ğŸ’¾",severity:"error",showDetails:!0},conditions:{category:["game","system"]}}),this.patterns.push({id:"game-state-corrupted",pattern:/corrupted|invalid.*state|cannot.*read.*game/i,message:{title:"ã‚²ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã«å•é¡ŒãŒã‚ã‚Šã¾ã™",description:"ã‚²ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ãŒç ´æã—ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚æ–°ã—ã„ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹ã™ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚",actionLabel:"æ–°ã—ã„ã‚²ãƒ¼ãƒ ",actionType:"navigate",actionData:{url:"/new-game"},icon:"ğŸ®",severity:"critical",showDetails:!0},conditions:{category:["game"],severity:["high","critical"]}}),this.patterns.push({id:"ui-component-error",pattern:/component|render|mount/i,message:{title:"ç”»é¢ã®è¡¨ç¤ºã‚¨ãƒ©ãƒ¼",description:"ç”»é¢ã®ä¸€éƒ¨ãŒæ­£ã—ãè¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã™ã‚‹ã¨è§£æ±ºã™ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚",actionLabel:"ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿",actionType:"reload",icon:"ğŸ–¥ï¸",severity:"warning"},conditions:{category:["vue"]}}),this.patterns.push({id:"performance-memory",pattern:/memory|heap|stack.*overflow/i,message:{title:"ãƒ¡ãƒ¢ãƒªä¸è¶³ã®å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™",description:"ä»–ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é–‰ã˜ã¦ã€ãƒ¡ãƒ¢ãƒªã‚’è§£æ”¾ã—ã¦ãã ã•ã„ã€‚",actionLabel:"ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿",actionType:"reload",icon:"âš¡",severity:"error",helpUrl:"/help/performance"},conditions:{category:["performance","system"]}}),this.patterns.push({id:"security-cors",pattern:/cors|cross.*origin|blocked/i,message:{title:"ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£åˆ¶é™ãŒç™ºç”Ÿã—ã¾ã—ãŸ",description:"ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šã«ã‚ˆã‚Šã€ä¸€éƒ¨ã®æ©Ÿèƒ½ãŒåˆ¶é™ã•ã‚Œã¦ã„ã¾ã™ã€‚",actionLabel:"ã‚µãƒãƒ¼ãƒˆã«é€£çµ¡",actionType:"contact",icon:"ğŸ”’",severity:"error",helpUrl:"/help/security-issues"},conditions:{category:["security"]}}),this.patterns.push({id:"js-undefined",pattern:/undefined|null.*property|cannot.*read/i,message:{title:"äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ",description:"ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§äºˆæœŸã—ãªã„å•é¡ŒãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚é–‹ç™ºãƒãƒ¼ãƒ ã«å ±å‘Šã•ã‚Œã¾ã™ã€‚",actionLabel:"ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿",actionType:"reload",icon:"âš ï¸",severity:"error",showDetails:!0},conditions:{category:["javascript"],severity:["high","critical"]}}),this.patterns.push({id:"resource-load-failed",pattern:/loading|chunk.*error|failed.*fetch.*resource/i,message:{title:"ãƒªã‚½ãƒ¼ã‚¹ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ",description:"ãƒšãƒ¼ã‚¸ã®ä¸€éƒ¨ã®ãƒªã‚½ãƒ¼ã‚¹ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„ã€‚",actionLabel:"ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿",actionType:"reload",icon:"ğŸ“¦",severity:"warning"},conditions:{category:["network","system"]}})}initializeFallbackMessages(){this.fallbackMessages.set("network",{title:"ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼",description:"ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã«å•é¡ŒãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚",actionLabel:"å†è©¦è¡Œ",actionType:"retry",icon:"ğŸŒ",severity:"error"}),this.fallbackMessages.set("vue",{title:"UI ã‚¨ãƒ©ãƒ¼",description:"ç”»é¢ã®è¡¨ç¤ºã«å•é¡ŒãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚",actionLabel:"ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿",actionType:"reload",icon:"ğŸ–¼ï¸",severity:"warning"}),this.fallbackMessages.set("javascript",{title:"ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼",description:"ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§å•é¡ŒãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚",actionLabel:"ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿",actionType:"reload",icon:"âš™ï¸",severity:"error"}),this.fallbackMessages.set("game",{title:"ã‚²ãƒ¼ãƒ ã‚¨ãƒ©ãƒ¼",description:"ã‚²ãƒ¼ãƒ ä¸­ã«å•é¡ŒãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚",actionLabel:"ã‚²ãƒ¼ãƒ ã‚’å†é–‹",actionType:"retry",icon:"ğŸ®",severity:"error"}),this.fallbackMessages.set("async",{title:"å‡¦ç†ã‚¨ãƒ©ãƒ¼",description:"éåŒæœŸå‡¦ç†ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚",actionLabel:"å†è©¦è¡Œ",actionType:"retry",icon:"â³",severity:"warning"}),this.fallbackMessages.set("performance",{title:"ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®å•é¡Œ",description:"ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å‹•ä½œãŒé‡ããªã£ã¦ã„ã¾ã™ã€‚",actionLabel:"ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿",actionType:"reload",icon:"ğŸš€",severity:"warning"}),this.fallbackMessages.set("security",{title:"ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¨ãƒ©ãƒ¼",description:"ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£åˆ¶é™ã«ã‚ˆã‚Šæ“ä½œãŒåˆ¶é™ã•ã‚Œã¾ã—ãŸã€‚",actionLabel:"ã‚µãƒãƒ¼ãƒˆã«é€£çµ¡",actionType:"contact",icon:"ğŸ”",severity:"error"}),this.fallbackMessages.set("user",{title:"ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œã‚¨ãƒ©ãƒ¼",description:"æ“ä½œã«å•é¡ŒãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚",actionLabel:"ã‚‚ã†ä¸€åº¦è©¦ã™",actionType:"retry",icon:"ğŸ‘¤",severity:"info"}),this.fallbackMessages.set("system",{title:"ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼",description:"ã‚·ã‚¹ãƒ†ãƒ ã§å•é¡ŒãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚",actionLabel:"ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿",actionType:"reload",icon:"ğŸ–¥ï¸",severity:"error"})}generateUserMessage(e){for(const i of this.patterns)if(this.matchesPattern(e,i))return this.enrichMessage(i.message,e);const t=this.fallbackMessages.get(e.category);return t?this.enrichMessage(t,e):this.enrichMessage({title:"ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ",description:"ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§å•é¡ŒãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã—ã°ã‚‰ãæ™‚é–“ã‚’ãŠã„ã¦ã‹ã‚‰å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚",actionLabel:"ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿",actionType:"reload",icon:"â—",severity:"error"},e)}matchesPattern(e,t){if(!(t.pattern instanceof RegExp?t.pattern.test(e.message):e.message.toLowerCase().includes(t.pattern.toLowerCase())))return!1;if(t.conditions){const{category:i,severity:s,context:n}=t.conditions;if(i&&!i.includes(e.category))return!1;if(s&&!s.includes(e.severity))return!1;if(n&&!n(e))return!1}return!0}enrichMessage(e,t){return new Date(t.timestamp).toLocaleTimeString(),{...e,description:`${e.description}${t.context?.deviceInfo?.isMobile?" (ãƒ¢ãƒã‚¤ãƒ«)":""}`,actionData:{...e.actionData,timestamp:t.timestamp,errorId:t.fingerprint,component:t.component}}}addPattern(e){this.patterns.some(t=>t.id===e.id)||this.patterns.unshift(e)}removePattern(e){const t=this.patterns.findIndex(t=>t.id===e);return-1!==t&&(this.patterns.splice(t,1),!0)}getPatterns(){return[...this.patterns]}previewMessage(e,t,i="medium"){const s={message:e,category:t,severity:i,timestamp:Date.now(),userAgent:navigator.userAgent};return this.generateUserMessage(s)}getStats(){return{patternsCount:this.patterns.length,categoriesCount:this.fallbackMessages.size,patterns:this.patterns.map(e=>({id:e.id,hasConditions:Boolean(e.conditions)}))}}},Ge={class:"error-notification-container",role:"alert","aria-live":"polite"},We=["aria-label"],Ke={class:"notification-content"},Qe={class:"notification-icon","aria-hidden":"true"},Je={class:"notification-body"},Ye={class:"notification-title"},Xe={class:"notification-description"},Ze={key:0,class:"notification-actions"},et=["onClick"],tt=["onClick"],it=["onClick"],st={key:1,class:"notification-details"},nt={class:"detail-section"},at={key:0,class:"detail-section"},rt={class:"detail-section"},ot={class:"detail-tag"},ct={class:"detail-tag"},lt={key:1,class:"detail-section"},ut={class:"detail-section"},dt=["aria-label","onClick"],ht=U(s({__name:"ErrorNotification",setup(e,{expose:t}){const i=d([]),s=e=>{const t=`${Date.now()}-${Math.random()}`,s={...e,id:t,timestamp:Date.now(),autoHide:e.autoHide??"critical"!==e.userMessage.severity,hideDelay:e.hideDelay??5e3,isExpanded:!1};i.value.unshift(s),i.value.length>3&&(i.value=i.value.slice(0,3)),s.autoHide&&setTimeout(()=>{c(t)},s.hideDelay)},c=e=>{const t=i.value.findIndex(t=>t.id===e);-1!==t&&i.value.splice(t,1)},u=e=>{const t=e.detail;if(i.value.some(e=>e.originalError.fingerprint===t.fingerprint))return;const n=Be.generateUserMessage(t);s({userMessage:n,originalError:t})},g=e=>{switch(e){case"critical":return"ğŸš¨";case"error":return"âš ï¸";case"warning":return"â„¹ï¸";case"info":return"ğŸ’¡"}},m=e=>{switch(e){case"critical":return"notification-critical";case"error":return"notification-error";case"warning":return"notification-warning";case"info":return"notification-info"}},v=e=>{const{actionType:t,actionData:i}=e.userMessage;switch(t){case"reload":window.location.reload();break;case"retry":const t=new CustomEvent("app:retry-action",{detail:{errorId:i?.errorId,component:i?.component}});window.dispatchEvent(t),c(e.id);break;case"navigate":i?.url&&(window.location.href=i.url);break;case"contact":const s=new CustomEvent("app:open-support",{detail:{errorInfo:e.originalError}});window.dispatchEvent(s);break;default:c(e.id)}},w=e=>{const t=i.value.find(t=>t.id===e);t&&(t.isExpanded=!t.isExpanded)},k=n(()=>i.value.map((e,t)=>({...e,offset:t*(e.isExpanded?120:80),opacity:t<3?1:.5})));return h(()=>{window.addEventListener("app:error",u),window.addEventListener("app:system-alert",e=>{const{message:t}=e.detail;s({userMessage:{title:"ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ©ãƒ¼ãƒˆ",description:t,actionLabel:"ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿",actionType:"reload",icon:"ğŸš€",severity:"critical",showDetails:!1},originalError:{message:t,category:"system",severity:"critical",timestamp:Date.now(),userAgent:navigator.userAgent},autoHide:!1})})}),I(()=>{window.removeEventListener("app:error",u),window.removeEventListener("app:system-alert",()=>{})}),t({addNotification:s,removeNotification:c,clearAll:()=>{i.value=[]},executeAction:v,toggleDetails:w}),(e,t)=>(r(),p(M,{to:"body"},[f("div",Ge,[o(D,{name:"notification",tag:"div"},{default:l(()=>[(r(!0),a(A,null,T(k.value,(e,i)=>{return r(),a("div",{key:e.id,class:_(["error-notification",m(e.userMessage.severity),{expanded:e.isExpanded}]),style:x({transform:`translateY(${e.offset}px)`,opacity:e.opacity,zIndex:1e3-i}),role:"alertdialog","aria-label":`${e.userMessage.severity}ã‚¨ãƒ©ãƒ¼: ${e.userMessage.title}`},[f("div",Ke,[f("span",Qe,S((s=e.userMessage,s.icon||g(s.severity))),1),f("div",Je,[f("h4",Ye,S(e.userMessage.title),1),f("p",Xe,S(e.userMessage.description),1),e.userMessage.actionLabel?(r(),a("div",Ze,[f("button",{class:"notification-action-btn primary",onClick:t=>v(e)},S(e.userMessage.actionLabel),9,et),e.userMessage.helpUrl?(r(),a("button",{key:0,class:"notification-action-btn secondary small",onClick:t=>{return i=e.userMessage.helpUrl,void window.open(i,"_blank","noopener,noreferrer");var i}}," ãƒ˜ãƒ«ãƒ— ",8,tt)):y("",!0),e.userMessage.showDetails?(r(),a("button",{key:1,class:"notification-action-btn secondary small",onClick:t=>w(e.id)},S(e.isExpanded?"è©³ç´°ã‚’éš ã™":"è©³ç´°ã‚’è¡¨ç¤º"),9,it)):y("",!0)])):y("",!0),e.isExpanded&&e.userMessage.showDetails?(r(),a("div",st,[f("div",nt,[t[0]||(t[0]=f("strong",null,"ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:",-1)),f("code",null,S(e.originalError.message),1)]),e.originalError.component?(r(),a("div",at,[t[1]||(t[1]=f("strong",null,"ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ:",-1)),f("code",null,S(e.originalError.component),1)])):y("",!0),f("div",rt,[t[2]||(t[2]=f("strong",null,"ã‚«ãƒ†ã‚´ãƒª:",-1)),f("span",ot,S(e.originalError.category),1),t[3]||(t[3]=f("strong",null,"æ·±åˆ»åº¦:",-1)),f("span",ct,S(e.originalError.severity),1)]),e.originalError.context?.route?(r(),a("div",lt,[t[4]||(t[4]=f("strong",null,"ãƒšãƒ¼ã‚¸:",-1)),f("code",null,S(e.originalError.context.route),1)])):y("",!0),f("div",ut,[t[5]||(t[5]=f("strong",null,"æ™‚åˆ»:",-1)),b(" "+S(new Date(e.originalError.timestamp).toLocaleString()),1)])])):y("",!0)]),f("button",{class:"notification-close","aria-label":`é€šçŸ¥ã‚’é–‰ã˜ã‚‹: ${e.userMessage.title}`,onClick:t=>c(e.id)},t[6]||(t[6]=[f("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[f("line",{x1:"18",y1:"6",x2:"6",y2:"18","stroke-width":"2"}),f("line",{x1:"6",y1:"6",x2:"18",y2:"18","stroke-width":"2"})],-1)]),8,dt)]),e.autoHide?(r(),a("div",{key:0,class:"notification-progress",style:x({animationDuration:`${e.hideDelay}ms`})},null,4)):y("",!0)],14,We);var s}),128))]),_:1})])]))}}),[["__scopeId","data-v-eac2682b"]]);function gt(e){if("string"!=typeof e)throw new Error("å…¥åŠ›ã¯æ–‡å­—åˆ—ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™");return e.replace(/<[^>]*>/g,"").replace(/javascript:/gi,"").replace(/on\w+\s*=/gi,"").replace(/[<>"'&]/g,e=>({"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","&":"&amp;"}[e]||e)).replace(/[\u0002-\u001F\u007F-\u009F]/g,"").trim().slice(0,1e3)}class mt{constructor(){i(this,"attempts",new Map)}isAllowed(e,t,i){const s=Date.now(),n=(this.attempts.get(e)||[]).filter(e=>s-e<i);return!(n.length>=t||(n.push(s),this.attempts.set(e,n),0))}reset(e){this.attempts.delete(e)}clear(){this.attempts.clear()}getRemainingAttempts(e,t,i){const s=Date.now(),n=(this.attempts.get(e)||[]).filter(e=>s-e<i);return Math.max(0,t-n.length)}getNextAttemptTime(e,t){const i=this.attempts.get(e)||[];return 0===i.length?Date.now():Math.min(...i)+t}cleanup(){const e=Date.now();for(const[t,i]of this.attempts.entries()){const s=i.filter(t=>e-t<864e5);0===s.length?this.attempts.delete(t):this.attempts.set(t,s)}}}function pt(e){if(e<=0||e>256)throw new Error("é•·ã•ã¯1ã‹ã‚‰256ã®é–“ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™");const t=new Uint8Array(e);if("undefined"!=typeof window&&window.crypto&&window.crypto.getRandomValues)window.crypto.getRandomValues(t);else for(let i=0;i<e;i++)t[i]=Math.floor(256*Math.random());return Array.from(t,e=>"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"[e%62]).join("")}async function yt(e){if("undefined"!=typeof window&&window.crypto&&window.crypto.subtle){const t=(new TextEncoder).encode(e),i=await window.crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(i)).map(e=>e.toString(16).padStart(2,"0")).join("")}let t=0;for(let i=0;i<e.length;i++)t=(t<<5)-t+e.charCodeAt(i),t&=t;return Math.abs(t).toString(16)}function vt(){const e="_integrity";return{async setItem(t,i,s=!1){try{const n=gt(t);let a=JSON.stringify(i);if(s){const e=await this.getOrCreateEncryptionKey();a=await this.simpleEncrypt(a,e)}const r=await yt(a);localStorage.setItem(n,a),localStorage.setItem(n+e,r)}catch(n){throw new Error(`ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ä¿å­˜ã«å¤±æ•—: ${n instanceof Error?n.message:String(n)}`)}},async getItem(t,i=!1){try{const s=gt(t),n=localStorage.getItem(s),a=localStorage.getItem(s+e);if(!n)return null;if(a&&await yt(n)!==a)throw this.removeItem(s),new Error("ãƒ‡ãƒ¼ã‚¿æ”¹ã–ã‚“ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸ");let r=n;if(i){const e=await this.getOrCreateEncryptionKey();try{r=await this.simpleDecrypt(r,e)}catch{return this.removeItem(s),null}}return JSON.parse(r)}catch(s){if(s instanceof SyntaxError){const e=gt(t);this.removeItem(e)}return null}},removeItem(t){try{const i=gt(t);localStorage.removeItem(i),localStorage.removeItem(i+e)}catch(i){}},async getOrCreateEncryptionKey(){const e="game_enc_master";let t=localStorage.getItem(e);return t||(t=pt(32),localStorage.setItem(e,t)),t},async simpleEncrypt(e,t){const i=[];for(let s=0;s<e.length;s++){const n=t.charCodeAt(s%t.length),a=e.charCodeAt(s);i.push(String.fromCharCode(a^n))}return btoa(i.join(""))},async simpleDecrypt(e,t){try{if(!e||""===e.trim())throw new Error("æš—å·åŒ–ãƒ‡ãƒ¼ã‚¿ãŒç©ºã§ã™");const i=atob(e),s=[];for(let e=0;e<i.length;e++){const n=t.charCodeAt(e%t.length),a=i.charCodeAt(e);s.push(String.fromCharCode(a^n))}return s.join("")}catch(i){const e=i instanceof Error?i.message:"ä¸æ˜ãªã‚¨ãƒ©ãƒ¼";throw new Error(`å¾©å·åŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ: ${e}`)}}}}class ft{constructor(){i(this,"focusableElements",[]),i(this,"currentFocusIndex",-1),i(this,"shortcuts",new Map),i(this,"isActive",!0),i(this,"focusVisibleEnabled",!0),this.setupEventListeners(),this.setupFocusVisible()}registerFocusableElement(e,t={}){const i={element:e,priority:t.priority||0,group:t.group,onFocus:t.onFocus,onBlur:t.onBlur,onActivate:t.onActivate},s=this.focusableElements.findIndex(t=>t.element===e);s>=0?this.focusableElements[s]=i:this.focusableElements.push(i),this.focusableElements.sort((e,t)=>t.priority-e.priority),this.setupElementAccessibility(e)}unregisterFocusableElement(e){const t=this.focusableElements.findIndex(t=>t.element===e);t>=0&&(this.focusableElements.splice(t,1),this.currentFocusIndex>=t&&(this.currentFocusIndex=Math.max(0,this.currentFocusIndex-1)))}registerShortcut(e){const t=this.createShortcutKey(e.key,e.modifiers||[]);this.shortcuts.set(t,e)}unregisterShortcut(e,t=[]){const i=this.createShortcutKey(e,t);this.shortcuts.delete(i)}focusNext(){0!==this.focusableElements.length&&(this.currentFocusIndex=(this.currentFocusIndex+1)%this.focusableElements.length,this.setFocus(this.currentFocusIndex))}focusPrevious(){0!==this.focusableElements.length&&(this.currentFocusIndex=this.currentFocusIndex<=0?this.focusableElements.length-1:this.currentFocusIndex-1,this.setFocus(this.currentFocusIndex))}focusGroup(e){const t=this.focusableElements.filter(t=>t.group===e);if(t.length>0){const e=this.focusableElements.indexOf(t[0]);e>=0&&(this.currentFocusIndex=e,this.setFocus(e))}}focusElement(e){const t=this.focusableElements.findIndex(t=>t.element===e);t>=0&&(this.currentFocusIndex=t,this.setFocus(t))}getCurrentFocusedElement(){return this.currentFocusIndex>=0&&this.currentFocusIndex<this.focusableElements.length?this.focusableElements[this.currentFocusIndex].element:null}startFocusTrap(e){const t=this.focusableElements.filter(t=>e.contains(t.element));t.length>0&&(this.focusableElements.forEach(t=>{e.contains(t.element)||(t.element.setAttribute("tabindex","-1"),t.element.setAttribute("aria-hidden","true"))}),this.focusElement(t[0].element))}endFocusTrap(){this.focusableElements.forEach(e=>{e.element.removeAttribute("tabindex"),e.element.removeAttribute("aria-hidden")})}toggleHelp(){const e=this.createHelpPanel();document.body.appendChild(e);const t=i=>{"Escape"===i.key&&(e.remove(),document.removeEventListener("keydown",t))};document.addEventListener("keydown",t);const i=e.querySelector("button");i&&i.focus()}createSkipLinks(){const e=document.createElement("div");e.className="skip-links",e.setAttribute("aria-label","ã‚¹ã‚­ãƒƒãƒ—ãƒªãƒ³ã‚¯");const t=this.createSkipLink("ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã«ç§»å‹•","#main-content"),i=this.createSkipLink("ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã«ç§»å‹•","#navigation"),s=this.createSkipLink("ãƒ•ãƒƒã‚¿ãƒ¼ã«ç§»å‹•","#footer");return e.appendChild(t),e.appendChild(i),e.appendChild(s),e}setActive(e){if(this.isActive=e,!e){const e=this.getCurrentFocusedElement();e&&e.blur()}}setFocusVisible(e){this.focusVisibleEnabled=e,document.documentElement.classList.toggle("keyboard-navigation",e)}setupEventListeners(){document.addEventListener("keydown",this.handleKeyDown.bind(this)),document.addEventListener("focusin",this.handleFocusIn.bind(this)),document.addEventListener("focusout",this.handleFocusOut.bind(this)),document.addEventListener("mousedown",()=>{document.documentElement.classList.remove("keyboard-navigation")})}handleKeyDown(e){if(!this.isActive)return;const t=this.createShortcutKey(e.key,this.getActiveModifiers(e)),i=this.shortcuts.get(t);if(i)return e.preventDefault(),void i.action();switch(e.key){case"Tab":e.preventDefault(),e.shiftKey?this.focusPrevious():this.focusNext();break;case"ArrowDown":case"ArrowRight":e.preventDefault(),this.focusNext();break;case"ArrowUp":case"ArrowLeft":e.preventDefault(),this.focusPrevious();break;case"Home":e.preventDefault(),this.currentFocusIndex=0,this.setFocus(0);break;case"End":e.preventDefault(),this.currentFocusIndex=this.focusableElements.length-1,this.setFocus(this.currentFocusIndex);break;case"Enter":case" ":const t=this.getCurrentFocusedElement();if(t){e.preventDefault();const i=this.focusableElements[this.currentFocusIndex];i.onActivate?i.onActivate():t.click()}break;case"F1":e.preventDefault(),this.toggleHelp()}}handleFocusIn(e){if(!this.focusVisibleEnabled)return;const t=e.target,i=this.focusableElements.findIndex(e=>e.element===t);if(i>=0){this.currentFocusIndex=i;const e=this.focusableElements[i];e.onFocus&&e.onFocus(),document.documentElement.classList.add("keyboard-navigation")}}handleFocusOut(e){const t=e.target,i=this.focusableElements.findIndex(e=>e.element===t);if(i>=0){const e=this.focusableElements[i];e.onBlur&&e.onBlur()}}setFocus(e){if(e<0||e>=this.focusableElements.length)return;const t=this.focusableElements[e].element;null!==t.offsetParent?(t.focus(),t.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})):this.focusNext()}setupElementAccessibility(e){if(e.hasAttribute("tabindex")||e.setAttribute("tabindex","0"),!e.hasAttribute("role")){const t=e.tagName.toLowerCase();"div"!==t&&"span"!==t||e.setAttribute("role","button")}if(!e.hasAttribute("aria-label")&&!e.hasAttribute("aria-labelledby")){const t=e.textContent?.trim();t&&e.setAttribute("aria-label",t)}}createShortcutKey(e,t){return`${t.sort().join("+")}+${e.toLowerCase()}`}getActiveModifiers(e){const t=[];return e.ctrlKey&&t.push("ctrl"),e.altKey&&t.push("alt"),e.shiftKey&&t.push("shift"),e.metaKey&&t.push("meta"),t}createSkipLink(e,t){const i=document.createElement("a");return i.href=t,i.textContent=e,i.className="skip-link",i.addEventListener("click",e=>{e.preventDefault();const i=document.querySelector(t);i&&i.focus()}),i}createHelpPanel(){const e=document.createElement("div");e.className="keyboard-help-panel",e.setAttribute("role","dialog"),e.setAttribute("aria-labelledby","help-title"),e.setAttribute("aria-modal","true");const t=Array.from(this.shortcuts.values()),i=document.createElement("div");i.className="help-content";const s=document.createElement("h2");s.id="help-title",s.textContent="ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ";const n=document.createElement("div");n.className="shortcuts-list";const a=document.createElement("div");a.className="shortcut-group";const r=document.createElement("h3");r.textContent="åŸºæœ¬ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³";const o=document.createElement("dl");if([{key:"Tab / Shift+Tab",desc:"æ¬¡/å‰ã®è¦ç´ ã«ç§»å‹•"},{key:"çŸ¢å°ã‚­ãƒ¼",desc:"æ–¹å‘ã«å¿œã˜ã¦ç§»å‹•"},{key:"Enter / Space",desc:"è¦ç´ ã‚’é¸æŠ/å®Ÿè¡Œ"},{key:"Home / End",desc:"æœ€åˆ/æœ€å¾Œã®è¦ç´ ã«ç§»å‹•"}].forEach(({key:e,desc:t})=>{const i=document.createElement("dt");i.textContent=e;const s=document.createElement("dd");s.textContent=t,o.appendChild(i),o.appendChild(s)}),a.appendChild(r),a.appendChild(o),n.appendChild(a),t.length>0){const e=document.createElement("div");e.className="shortcut-group";const i=document.createElement("h3");i.textContent="ã‚²ãƒ¼ãƒ æ“ä½œ";const s=document.createElement("dl");t.forEach(e=>{const t=document.createElement("dt");t.textContent=gt(this.formatShortcut(e));const i=document.createElement("dd");i.textContent=gt(e.description),s.appendChild(t),s.appendChild(i)}),e.appendChild(i),e.appendChild(s),n.appendChild(e)}const c=document.createElement("button");return c.type="button",c.textContent="é–‰ã˜ã‚‹ (Esc)",c.onclick=()=>{e.remove()},i.appendChild(s),i.appendChild(n),i.appendChild(c),e.appendChild(i),e}formatShortcut(e){return[...(e.modifiers||[]).map(e=>e.charAt(0).toUpperCase()+e.slice(1)),e.key].join(" + ")}setupFocusVisible(){const e=document.createElement("style");e.textContent="\n      .keyboard-navigation *:focus {\n        outline: 2px solid #818CF8;\n        outline-offset: 2px;\n        border-radius: 4px;\n      }\n      \n      .skip-links {\n        position: absolute;\n        top: -40px;\n        left: 6px;\n        z-index: 1000;\n      }\n      \n      .skip-link {\n        position: absolute;\n        left: -10000px;\n        top: auto;\n        width: 1px;\n        height: 1px;\n        overflow: hidden;\n        background: #000;\n        color: #fff;\n        padding: 8px 16px;\n        text-decoration: none;\n        border-radius: 4px;\n      }\n      \n      .skip-link:focus {\n        position: static;\n        width: auto;\n        height: auto;\n        left: auto;\n        top: auto;\n      }\n      \n      .keyboard-help-panel {\n        position: fixed;\n        top: 50%;\n        left: 50%;\n        transform: translate(-50%, -50%);\n        background: rgba(0, 0, 0, 0.95);\n        color: white;\n        padding: 2rem;\n        border-radius: 12px;\n        max-width: 500px;\n        max-height: 80vh;\n        overflow-y: auto;\n        z-index: 10000;\n      }\n      \n      .help-content h2 {\n        margin-top: 0;\n        color: #818CF8;\n      }\n      \n      .shortcuts-list dt {\n        font-weight: bold;\n        color: #FFD43B;\n        margin-top: 0.5rem;\n      }\n      \n      .shortcuts-list dd {\n        margin-left: 1rem;\n        margin-bottom: 0.5rem;\n      }\n      \n      .help-content button {\n        margin-top: 1rem;\n        padding: 0.5rem 1rem;\n        background: #818CF8;\n        color: white;\n        border: none;\n        border-radius: 4px;\n        cursor: pointer;\n      }\n    ",document.head.appendChild(e)}destroy(){this.focusableElements=[],this.shortcuts.clear(),document.removeEventListener("keydown",this.handleKeyDown.bind(this)),document.removeEventListener("focusin",this.handleFocusIn.bind(this)),document.removeEventListener("focusout",this.handleFocusOut.bind(this))}}const wt={class:"app-header"},bt=U(s({__name:"AppHeader",setup:e=>(e,t)=>(r(),a("header",wt,t[0]||(t[0]=[R('<div class="hero-section" data-v-dc8e6b29><div class="hero-background" data-v-dc8e6b29><div class="hero-orb hero-orb-1" data-v-dc8e6b29></div><div class="hero-orb hero-orb-2" data-v-dc8e6b29></div><div class="hero-orb hero-orb-3" data-v-dc8e6b29></div></div><div class="hero-content" data-v-dc8e6b29><div class="brand-logo pulse" data-v-dc8e6b29><div class="logo-glow" data-v-dc8e6b29></div><span class="logo-icon" data-v-dc8e6b29>ğŸ›¡ï¸</span></div><h1 class="hero-title bounce-in" style="animation-delay:0.2s;" data-v-dc8e6b29> äººç”Ÿå……å®Ÿã‚²ãƒ¼ãƒ  </h1><p class="hero-subtitle bounce-in" style="animation-delay:0.4s;" data-v-dc8e6b29> Life Fulfillment - ç”Ÿå‘½ä¿é™ºã‚’ã€Œäººç”Ÿã®å‘³æ–¹ã€ã¨ã—ã¦æã </p><div class="hero-accent bounce-in" style="animation-delay:0.6s;" data-v-dc8e6b29><span class="accent-icon" data-v-dc8e6b29>âœ¨</span><span class="accent-text" data-v-dc8e6b29>ä¸€äººã®æ™‚é–“ã‚’ã€æœ€é«˜ã®å†’é™ºã«</span><span class="accent-icon" data-v-dc8e6b29>âœ¨</span></div><div class="hero-stats bounce-in" style="animation-delay:0.8s;" data-v-dc8e6b29><div class="stat-item" data-v-dc8e6b29><span class="stat-value" data-v-dc8e6b29>100+</span><span class="stat-label" data-v-dc8e6b29>ã‚¤ãƒ™ãƒ³ãƒˆã‚«ãƒ¼ãƒ‰</span></div><div class="stat-divider" data-v-dc8e6b29></div><div class="stat-item" data-v-dc8e6b29><span class="stat-value" data-v-dc8e6b29>7</span><span class="stat-label" data-v-dc8e6b29>äººç”Ÿã‚¹ãƒ†ãƒ¼ã‚¸</span></div><div class="stat-divider" data-v-dc8e6b29></div><div class="stat-item" data-v-dc8e6b29><span class="stat-value" data-v-dc8e6b29>âˆ</span><span class="stat-label" data-v-dc8e6b29>ãƒ—ãƒ¬ã‚¤ãƒ‘ã‚¿ãƒ¼ãƒ³</span></div></div></div></div>',1)])))}),[["__scopeId","data-v-dc8e6b29"]]),St={id:"navigation",class:"action-section",role:"navigation","aria-label":"ãƒ¡ã‚¤ãƒ³ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³"},kt={class:"button-group"},Et=U(s({__name:"NavigationActions",emits:["start-game","start-tutorial","open-statistics"],setup(e,{expose:t}){const i=d(),s=d();return t({gameButtonRef:i,tutorialButtonRef:s}),(e,t)=>(r(),a("section",St,[f("div",kt,[f("button",{ref_key:"gameButtonRef",ref:i,class:"btn btn-primary ripple-container glow-on-hover bounce-in","aria-label":"ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹ã™ã‚‹ (Alt+G)","aria-keyshortcuts":"Alt+G","aria-describedby":"game-description",onClick:t[0]||(t[0]=t=>e.$emit("start-game"))},t[3]||(t[3]=[f("span",{class:"btn-bg-effect"},null,-1),f("span",{class:"btn-icon","aria-hidden":"true"},"ğŸ®",-1),f("span",{class:"btn-text"},"ã‚²ãƒ¼ãƒ ã‚’ãƒ—ãƒ¬ã‚¤",-1),f("span",{class:"btn-arrow","aria-hidden":"true"},"â†’",-1)]),512),f("button",{ref_key:"tutorialButtonRef",ref:s,class:"btn btn-secondary ripple-container","aria-label":"ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’é–‹å§‹ã™ã‚‹ (Alt+T)","aria-keyshortcuts":"Alt+T","aria-describedby":"tutorial-description",onClick:t[1]||(t[1]=t=>e.$emit("start-tutorial"))},t[4]||(t[4]=[f("span",{class:"btn-bg-effect"},null,-1),f("span",{class:"btn-icon","aria-hidden":"true"},"ğŸ“š",-1),f("span",{class:"btn-text"},"ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«",-1)]),512),f("button",{class:"btn btn-secondary ripple-container","aria-label":"çµ±è¨ˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’é–‹ã (Alt+S)","aria-keyshortcuts":"Alt+S","aria-describedby":"statistics-description",onClick:t[2]||(t[2]=t=>e.$emit("open-statistics"))},t[5]||(t[5]=[f("span",{class:"btn-bg-effect"},null,-1),f("span",{class:"btn-icon","aria-hidden":"true"},"ğŸ“Š",-1),f("span",{class:"btn-text"},"çµ±è¨ˆ",-1)]))]),t[6]||(t[6]=f("div",{class:"sr-only"},[f("div",{id:"game-description"},"ä¿é™ºã‚’ãƒ†ãƒ¼ãƒã«ã—ãŸäººç”Ÿã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹ã—ã¾ã™"),f("div",{id:"tutorial-description"},"ã‚²ãƒ¼ãƒ ã®éŠã³æ–¹ã‚’å­¦ç¿’ã™ã‚‹ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’é–‹å§‹ã—ã¾ã™"),f("div",{id:"statistics-description"},"ãƒ—ãƒ¬ã‚¤çµ±è¨ˆã¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æã‚’è¡¨ç¤ºã—ã¾ã™")],-1))]))}}),[["__scopeId","data-v-0517c0ed"]]),Ct={class:"info-section"},It=U(s({__name:"FeatureShowcase",setup:e=>(e,t)=>(r(),a("section",Ct,t[0]||(t[0]=[R('<div class="info-grid" data-v-fae2a0a7><div class="interactive-card glow-on-hover card-latest" data-v-fae2a0a7><div class="card-badge" data-v-fae2a0a7>NEW</div><div class="card-header" data-v-fae2a0a7><div class="card-icon-wrapper" data-v-fae2a0a7><span class="card-icon" data-v-fae2a0a7>ğŸš€</span></div><h2 class="card-title" data-v-fae2a0a7> æœ¬ç•ªãƒªãƒªãƒ¼ã‚¹ v0.3.0 </h2></div><div class="text-left space-y-3" data-v-fae2a0a7><div data-v-fae2a0a7><h3 class="font-semibold text-lg mb-2" data-v-fae2a0a7>Production Release - æœ¬ç•ªç’°å¢ƒå¯¾å¿œå®Œäº†</h3><ul class="space-y-1 text-sm" data-v-fae2a0a7><li class="flex items-start gap-2" data-v-fae2a0a7><span class="text-success mt-1" data-v-fae2a0a7>ğŸ¯</span><span data-v-fae2a0a7><strong data-v-fae2a0a7>ãƒªãƒªãƒ¼ã‚¹å“è³ª100%</strong>: ãƒ“ãƒ«ãƒ‰ãƒ»ãƒ†ã‚¹ãƒˆãƒ»å‹ãƒã‚§ãƒƒã‚¯å…¨ã¦å®Œäº†</span></li><li class="flex items-start gap-2" data-v-fae2a0a7><span class="text-success mt-1" data-v-fae2a0a7>â™¿</span><span data-v-fae2a0a7><strong data-v-fae2a0a7>ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£å®Œå…¨å¯¾å¿œ</strong>: WCAG 2.1 AA 100%æº–æ‹ </span></li><li class="flex items-start gap-2" data-v-fae2a0a7><span class="text-success mt-1" data-v-fae2a0a7>ğŸ“±</span><span data-v-fae2a0a7><strong data-v-fae2a0a7>ãƒ¢ãƒã‚¤ãƒ«æœ€é©åŒ–å®Œäº†</strong>: ã‚¿ãƒƒãƒæ“ä½œãƒ»ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³å¯¾å¿œ</span></li><li class="flex items-start gap-2" data-v-fae2a0a7><span class="text-success mt-1" data-v-fae2a0a7>âš¡</span><span data-v-fae2a0a7><strong data-v-fae2a0a7>ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–</strong>: ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚º55.8%å‰Šæ¸›é”æˆ</span></li><li class="flex items-start gap-2" data-v-fae2a0a7><span class="text-success mt-1" data-v-fae2a0a7>âœ…</span><span data-v-fae2a0a7><strong data-v-fae2a0a7>ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»</strong>: è‡ªå‹•è„†å¼±æ€§æ¤œå‡ºã€ã‚³ãƒ¼ãƒ‰å“è³ªåˆ†æ</span></li></ul></div></div></div><div class="interactive-card glow-on-hover card-roadmap" data-v-fae2a0a7><div class="card-badge badge-secondary" data-v-fae2a0a7>ROADMAP</div><div class="card-header" data-v-fae2a0a7><div class="card-icon-wrapper icon-wrapper-secondary" data-v-fae2a0a7><span class="card-icon" data-v-fae2a0a7>ğŸ—ºï¸</span></div><h2 class="card-title" data-v-fae2a0a7> ä»Šå¾Œã®ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ— </h2></div><div class="text-left space-y-3" data-v-fae2a0a7><div data-v-fae2a0a7><h3 class="font-semibold mb-2" data-v-fae2a0a7>çŸ­æœŸï¼ˆ1-2é€±é–“ï¼‰</h3><ul class="space-y-1 text-sm" data-v-fae2a0a7><li class="flex items-center gap-2" data-v-fae2a0a7><span class="text-success" data-v-fae2a0a7>âœ…</span> ä¿é™ºæ›´æ–°ã‚·ã‚¹ãƒ†ãƒ  </li><li class="flex items-center gap-2" data-v-fae2a0a7><span class="text-success" data-v-fae2a0a7>âœ…</span> ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ãƒ¢ãƒ¼ãƒ‰ </li><li class="flex items-center gap-2" data-v-fae2a0a7><span class="text-success" data-v-fae2a0a7>âœ…</span> ã‚µã‚¦ãƒ³ãƒ‰ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ </li><li class="flex items-center gap-2" data-v-fae2a0a7><span class="text-gray-400" data-v-fae2a0a7>â­•</span> ã‚²ãƒ¼ãƒ ãƒãƒ©ãƒ³ã‚¹å¾®èª¿æ•´ </li></ul></div><div data-v-fae2a0a7><h3 class="font-semibold mb-2" data-v-fae2a0a7>ä¸­æœŸï¼ˆ1ãƒ¶æœˆï¼‰</h3><ul class="space-y-1 text-sm" data-v-fae2a0a7><li class="flex items-center gap-2" data-v-fae2a0a7><span class="text-gray-400" data-v-fae2a0a7>â­•</span> å®Ÿç¸¾ã‚·ã‚¹ãƒ†ãƒ  </li><li class="flex items-center gap-2" data-v-fae2a0a7><span class="text-gray-400" data-v-fae2a0a7>â­•</span> è¿½åŠ ã‚·ãƒŠãƒªã‚ªï¼ˆçµå©šã€å‡ºç”£ãªã©ï¼‰ </li></ul></div></div><div class="mt-4 text-sm text-gray-600 dark:text-gray-400" data-v-fae2a0a7><a href="https://github.com/shishihs/insurance_self_game/blob/master/CHANGELOG.md" target="_blank" class="hover:text-primary transition-colors" data-v-fae2a0a7> è©³ç´°ãªå¤‰æ›´å±¥æ­´ã¨ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ— â†’ </a></div></div></div><div class="text-center mt-8 text-sm text-gray-600 dark:text-gray-400" data-v-fae2a0a7><p data-v-fae2a0a7><a href="https://github.com/shishihs/insurance_self_game" target="_blank" class="hover:text-primary transition-colors" data-v-fae2a0a7> GitHub </a><span class="mx-2" data-v-fae2a0a7>â€¢</span><a href="https://github.com/shishihs/insurance_self_game/issues" target="_blank" class="hover:text-primary transition-colors" data-v-fae2a0a7> ãƒã‚°å ±å‘Šãƒ»è¦æœ› </a></p></div>',2)])))}),[["__scopeId","data-v-fae2a0a7"]]),xt=["ja","en","zh","ko"],_t={ja:"æ—¥æœ¬èª",en:"English",zh:"ä¸­æ–‡ï¼ˆç®€ä½“ï¼‰",ko:"í•œêµ­ì–´"},At=[],Tt=O({legacy:!1,locale:function(){try{const e=localStorage.getItem("insurance-game-locale");return xt.includes(e)?e:null}catch{return null}}()||function(){const e=navigator.language.split("-")[0];return xt.includes(e)?e:"ja"}(),fallbackLocale:"ja",messages:{ja:{ui:{navigation:{home:"ãƒ›ãƒ¼ãƒ ",back:"ãƒ›ãƒ¼ãƒ ",game:"ã‚²ãƒ¼ãƒ ",tutorial:"ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«",statistics:"çµ±è¨ˆ",settings:"è¨­å®š",accessibility:"ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£è¨­å®š",feedback:"ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯"},buttons:{start:"é–‹å§‹",startGame:"ã‚²ãƒ¼ãƒ é–‹å§‹",startTutorial:"ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«é–‹å§‹",close:"é–‰ã˜ã‚‹",cancel:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«",ok:"OK",yes:"ã¯ã„",no:"ã„ã„ãˆ",continue:"ç¶šè¡Œ",skip:"ã‚¹ã‚­ãƒƒãƒ—",next:"æ¬¡ã¸",previous:"å‰ã¸",finish:"å®Œäº†",reset:"ãƒªã‚»ãƒƒãƒˆ",save:"ä¿å­˜",load:"èª­ã¿è¾¼ã¿"},common:{loading:"èª­ã¿è¾¼ã¿ä¸­...",error:"ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ",success:"æˆåŠŸã—ã¾ã—ãŸ",warning:"è­¦å‘Š",info:"æƒ…å ±",confirm:"ç¢ºèª",welcome:"ã‚ˆã†ã“ã",congratulations:"ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼",gameOver:"ã‚²ãƒ¼ãƒ çµ‚äº†",newGame:"æ–°ã—ã„ã‚²ãƒ¼ãƒ ",retry:"ã‚‚ã†ä¸€åº¦"}},game:{title:"äººç”Ÿå……å®Ÿã‚²ãƒ¼ãƒ ",subtitle:"æˆ¦ç•¥çš„ãƒ©ã‚¤ãƒ•ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³",description:"äººç”Ÿã®ã•ã¾ã–ã¾ãªæ®µéšã§ãƒªã‚¹ã‚¯ã¨ä¿é™ºã®ãƒãƒ©ãƒ³ã‚¹ã‚’è€ƒãˆãªãŒã‚‰ã€å……å®Ÿã—ãŸäººç”Ÿã‚’ç›®æŒ‡ã™ã‚²ãƒ¼ãƒ ã§ã™ã€‚",stages:{youth:"é’å¹´æœŸ",adult:"æˆäººæœŸ",middleAge:"ä¸­å¹´æœŸ",elderly:"é«˜é½¢æœŸ"},elements:{vitality:"ç”Ÿå‘½åŠ›",turn:"ã‚¿ãƒ¼ãƒ³",phase:"ãƒ•ã‚§ãƒ¼ã‚º",stage:"ã‚¹ãƒ†ãƒ¼ã‚¸",round:"ãƒ©ã‚¦ãƒ³ãƒ‰",score:"ã‚¹ã‚³ã‚¢",level:"ãƒ¬ãƒ™ãƒ«"},cards:{riskCard:"ãƒªã‚¹ã‚¯ã‚«ãƒ¼ãƒ‰",insuranceCard:"ä¿é™ºã‚«ãƒ¼ãƒ‰",eventCard:"ã‚¤ãƒ™ãƒ³ãƒˆã‚«ãƒ¼ãƒ‰",actionCard:"ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚«ãƒ¼ãƒ‰",powerCard:"ãƒ‘ãƒ¯ãƒ¼ã‚«ãƒ¼ãƒ‰"},actions:{draw:"ã‚«ãƒ¼ãƒ‰ã‚’å¼•ã",play:"ã‚«ãƒ¼ãƒ‰ã‚’ä½¿ã†",discard:"ã‚«ãƒ¼ãƒ‰ã‚’æ¨ã¦ã‚‹",buyInsurance:"ä¿é™ºã‚’è³¼å…¥",cancelInsurance:"ä¿é™ºã‚’è§£ç´„",takeRisk:"ãƒªã‚¹ã‚¯ã‚’å–ã‚‹",avoidRisk:"ãƒªã‚¹ã‚¯ã‚’å›é¿"},insurance:{types:{life:"ç”Ÿå‘½ä¿é™º",health:"å¥åº·ä¿é™º",auto:"è‡ªå‹•è»Šä¿é™º",home:"ç«ç½ä¿é™º",travel:"æ—…è¡Œä¿é™º",income:"æ‰€å¾—ä¿éšœä¿é™º",disability:"å‚·å®³ä¿é™º",longTermCare:"ä»‹è­·ä¿é™º"},terms:{premium:"ä¿é™ºæ–™",coverage:"ä¿éšœé¡",deductible:"å…è²¬é‡‘é¡",beneficiary:"å—ç›Šè€…",policy:"ä¿é™ºè¨¼åˆ¸",claim:"ä¿é™ºé‡‘è«‹æ±‚",renewal:"æ›´æ–°",cancellation:"è§£ç´„"}},risks:{categories:{health:"å¥åº·ãƒªã‚¹ã‚¯",financial:"çµŒæ¸ˆãƒªã‚¹ã‚¯",accident:"äº‹æ•…ãƒªã‚¹ã‚¯",natural:"è‡ªç„¶ç½å®³ãƒªã‚¹ã‚¯",career:"ã‚­ãƒ£ãƒªã‚¢ãƒªã‚¹ã‚¯",family:"å®¶æ—ãƒªã‚¹ã‚¯"},levels:{low:"ä½ãƒªã‚¹ã‚¯",medium:"ä¸­ãƒªã‚¹ã‚¯",high:"é«˜ãƒªã‚¹ã‚¯",extreme:"æ¥µé«˜ãƒªã‚¹ã‚¯"}}},tutorial:{title:"ã‚²ãƒ¼ãƒ ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«",welcome:"ã‚ˆã†ã“ãï¼äººç”Ÿå……å®Ÿã‚²ãƒ¼ãƒ ã®ä¸–ç•Œã¸",steps:{introduction:{title:"ã¯ã˜ã‚ã«",content:"ã“ã®ã‚²ãƒ¼ãƒ ã§ã¯ã€äººç”Ÿã®ã•ã¾ã–ã¾ãªæ®µéšã§ãƒªã‚¹ã‚¯ã¨ä¿é™ºã®ãƒãƒ©ãƒ³ã‚¹ã‚’è€ƒãˆãªãŒã‚‰é€²ã‚ã¦ã„ãã¾ã™ã€‚"},basicRules:{title:"åŸºæœ¬ãƒ«ãƒ¼ãƒ«",content:"å„ã‚¿ãƒ¼ãƒ³ã§ã‚«ãƒ¼ãƒ‰ã‚’å¼•ãã€ãƒªã‚¹ã‚¯ã«å¯¾å‡¦ã™ã‚‹ã‹ä¿é™ºã§å‚™ãˆã‚‹ã‹ã‚’æ±ºã‚ã¾ã™ã€‚"},cardTypes:{title:"ã‚«ãƒ¼ãƒ‰ã®ç¨®é¡",content:"ãƒªã‚¹ã‚¯ã‚«ãƒ¼ãƒ‰ã€ä¿é™ºã‚«ãƒ¼ãƒ‰ã€ã‚¤ãƒ™ãƒ³ãƒˆã‚«ãƒ¼ãƒ‰ãŒã‚ã‚Šã¾ã™ã€‚ãã‚Œãã‚Œã®ç‰¹å¾´ã‚’ç†è§£ã—ã¾ã—ã‚‡ã†ã€‚"},insuranceSystem:{title:"ä¿é™ºã‚·ã‚¹ãƒ†ãƒ ",content:"ä¿é™ºã¯äº‹å‰ã«è³¼å…¥ã™ã‚‹ã“ã¨ã§ãƒªã‚¹ã‚¯ã«å‚™ãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ä¿é™ºæ–™ã¨ä¿éšœé¡ã‚’è€ƒæ…®ã—ã¦é¸æŠã—ã¾ã—ã‚‡ã†ã€‚"},strategy:{title:"æˆ¦ç•¥ã®ãƒã‚¤ãƒ³ãƒˆ",content:"ç”Ÿå‘½åŠ›ã‚’ç¶­æŒã—ãªãŒã‚‰ã€åŠ¹æœçš„ãªä¿é™ºæˆ¦ç•¥ã‚’ç«‹ã¦ã‚‹ã“ã¨ãŒæˆåŠŸã®éµã§ã™ã€‚"}}},statistics:{title:"çµ±è¨ˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰",sections:{overview:"æ¦‚è¦",performance:"ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹",trends:"ãƒˆãƒ¬ãƒ³ãƒ‰",detailed:"è©³ç´°åˆ†æ"},metrics:{gamesPlayed:"ãƒ—ãƒ¬ã‚¤å›æ•°",winRate:"å‹ç‡",averageScore:"å¹³å‡ã‚¹ã‚³ã‚¢",bestScore:"æœ€é«˜ã‚¹ã‚³ã‚¢",totalPlayTime:"ç·ãƒ—ãƒ¬ã‚¤æ™‚é–“",averageGameTime:"å¹³å‡ã‚²ãƒ¼ãƒ æ™‚é–“",survivalRate:"ç”Ÿå­˜ç‡",insuranceEfficiency:"ä¿é™ºåŠ¹ç‡"},charts:{vitalityTrend:"ç”Ÿå‘½åŠ›æ¨ç§»",stageAnalysis:"ã‚¹ãƒ†ãƒ¼ã‚¸åˆ¥åˆ†æ",cardUsage:"ã‚«ãƒ¼ãƒ‰ä½¿ç”¨çŠ¶æ³",decisionAnalysis:"æ„æ€æ±ºå®šåˆ†æ",riskManagement:"ãƒªã‚¹ã‚¯ç®¡ç†",insuranceCoverage:"ä¿é™ºã‚«ãƒãƒ¬ãƒƒã‚¸"}},accessibility:{title:"ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£è¨­å®š",sections:{visual:"è¦–è¦šè¨­å®š",audio:"éŸ³å£°è¨­å®š",interaction:"æ“ä½œè¨­å®š",display:"è¡¨ç¤ºè¨­å®š"},options:{highContrast:"ãƒã‚¤ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆ",largeText:"å¤§ããªæ–‡å­—",reduceMotion:"ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³è»½æ¸›",screenReader:"ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒªãƒ¼ãƒ€ãƒ¼å¯¾å¿œ",keyboardNavigation:"ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³",audioCues:"éŸ³å£°ã‚­ãƒ¥ãƒ¼",subtitles:"å­—å¹•",slowAnimations:"ã‚†ã£ãã‚Šã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³",changeLanguage:"è¨€èªåˆ‡ã‚Šæ›¿ãˆ"},keyboardShortcuts:{title:"ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ",homeScreen:"ãƒ›ãƒ¼ãƒ ç”»é¢ã«æˆ»ã‚‹ (Alt+H)",startGame:"ã‚²ãƒ¼ãƒ é–‹å§‹ (Alt+G)",startTutorial:"ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«é–‹å§‹ (Alt+T)",openStatistics:"çµ±è¨ˆã‚’é–‹ã (Alt+S)",openAccessibility:"ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£è¨­å®š (Alt+A)",help:"ãƒ˜ãƒ«ãƒ—ã‚’è¡¨ç¤º (F1)"}},feedback:{title:"ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯",types:{bug:"ãƒã‚°å ±å‘Š",suggestion:"æ”¹å–„ææ¡ˆ",general:"ä¸€èˆ¬çš„ãªæ„è¦‹",rating:"è©•ä¾¡"},form:{subject:"ä»¶å",message:"ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸",email:"ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆä»»æ„ï¼‰",category:"ã‚«ãƒ†ã‚´ãƒª",priority:"å„ªå…ˆåº¦",submit:"é€ä¿¡",thankYou:"ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸï¼"}},errors:{general:"ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚",network:"ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚",gameState:"ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚",save:"ã‚²ãƒ¼ãƒ ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸã€‚",load:"ã‚²ãƒ¼ãƒ ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚",invalidAction:"ç„¡åŠ¹ãªæ“ä½œã§ã™ã€‚",cardNotFound:"ã‚«ãƒ¼ãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚",insufficientFunds:"è³‡é‡‘ãŒä¸è¶³ã—ã¦ã„ã¾ã™ã€‚",insuranceNotActive:"ä¿é™ºãŒæœ‰åŠ¹ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚"},success:{gameSaved:"ã‚²ãƒ¼ãƒ ã‚’ä¿å­˜ã—ã¾ã—ãŸã€‚",gameLoaded:"ã‚²ãƒ¼ãƒ ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸã€‚",insurancePurchased:"ä¿é™ºã‚’è³¼å…¥ã—ã¾ã—ãŸã€‚",riskAvoided:"ãƒªã‚¹ã‚¯ã‚’å›é¿ã—ã¾ã—ãŸã€‚",levelCompleted:"ãƒ¬ãƒ™ãƒ«ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸï¼",achievementUnlocked:"å®Ÿç¸¾ã‚’ç²å¾—ã—ã¾ã—ãŸï¼"},region:{currency:"å††",currencySymbol:"Â¥",dateFormat:"YYYYå¹´MMæœˆDDæ—¥",numberFormat:"1,234",insuranceSystem:{nationalHealth:"å›½æ°‘å¥åº·ä¿é™º",employeeHealth:"å¥åº·ä¿é™º",nationalPension:"å›½æ°‘å¹´é‡‘",employeePension:"åšç”Ÿå¹´é‡‘",longTermCare:"ä»‹è­·ä¿é™º",workersComp:"åŠ´ç½ä¿é™º",unemployment:"é›‡ç”¨ä¿é™º"},risks:{earthquake:"åœ°éœ‡",typhoon:"å°é¢¨",flood:"æ´ªæ°´",aging:"é«˜é½¢åŒ–",recession:"ä¸æ³",deflation:"ãƒ‡ãƒ•ãƒ¬"}},ageGroups:{young:{title:"è‹¥ã„ä¸–ä»£ã¸ã®ä¿é™ºã‚¢ãƒ‰ãƒã‚¤ã‚¹",message:"å°†æ¥ã«å‘ã‘ãŸåŸºç›¤ä½œã‚ŠãŒé‡è¦ã§ã™ã€‚"},middle:{title:"åƒãç››ã‚Šä¸–ä»£ã¸ã®ä¿é™ºã‚¢ãƒ‰ãƒã‚¤ã‚¹",message:"å®¶æ—ã‚’å®ˆã‚‹ãŸã‚ã®ä¿éšœã‚’æ¤œè¨ã—ã¾ã—ã‚‡ã†ã€‚"},senior:{title:"ã‚·ãƒ‹ã‚¢ä¸–ä»£ã¸ã®ä¿é™ºã‚¢ãƒ‰ãƒã‚¤ã‚¹",message:"åŒ»ç™‚ãƒ»ä»‹è­·ãƒªã‚¹ã‚¯ã¸ã®å‚™ãˆãŒå¤§åˆ‡ã§ã™ã€‚"}}},en:{ui:{navigation:{home:"Home",back:"Home",game:"Game",tutorial:"Tutorial",statistics:"Statistics",settings:"Settings",accessibility:"Accessibility Settings",feedback:"Feedback"},buttons:{start:"Start",startGame:"Start Game",startTutorial:"Start Tutorial",close:"Close",cancel:"Cancel",ok:"OK",yes:"Yes",no:"No",continue:"Continue",skip:"Skip",next:"Next",previous:"Previous",finish:"Finish",reset:"Reset",save:"Save",load:"Load"},common:{loading:"Loading...",error:"An error occurred",success:"Success",warning:"Warning",info:"Information",confirm:"Confirm",welcome:"Welcome",congratulations:"Congratulations!",gameOver:"Game Over",newGame:"New Game",retry:"Try Again"}},game:{title:"Life Enrichment Game",subtitle:"Strategic Life Simulation",description:"A game where you navigate through different life stages, balancing risks and insurance to achieve a fulfilling life.",stages:{youth:"Youth",adult:"Adulthood",middleAge:"Middle Age",elderly:"Elderly"},elements:{vitality:"Vitality",turn:"Turn",phase:"Phase",stage:"Stage",round:"Round",score:"Score",level:"Level"},cards:{riskCard:"Risk Card",insuranceCard:"Insurance Card",eventCard:"Event Card",actionCard:"Action Card",powerCard:"Power Card"},actions:{draw:"Draw Card",play:"Play Card",discard:"Discard Card",buyInsurance:"Buy Insurance",cancelInsurance:"Cancel Insurance",takeRisk:"Take Risk",avoidRisk:"Avoid Risk"},insurance:{types:{life:"Life Insurance",health:"Health Insurance",auto:"Auto Insurance",home:"Home Insurance",travel:"Travel Insurance",income:"Income Protection",disability:"Disability Insurance",longTermCare:"Long-term Care Insurance"},terms:{premium:"Premium",coverage:"Coverage",deductible:"Deductible",beneficiary:"Beneficiary",policy:"Policy",claim:"Claim",renewal:"Renewal",cancellation:"Cancellation"}},risks:{categories:{health:"Health Risk",financial:"Financial Risk",accident:"Accident Risk",natural:"Natural Disaster Risk",career:"Career Risk",family:"Family Risk"},levels:{low:"Low Risk",medium:"Medium Risk",high:"High Risk",extreme:"Extreme Risk"}}},tutorial:{title:"Game Tutorial",welcome:"Welcome to the Life Enrichment Game!",steps:{introduction:{title:"Introduction",content:"In this game, you'll navigate through different life stages while balancing risks and insurance."},basicRules:{title:"Basic Rules",content:"Each turn, draw cards and decide whether to face risks or protect yourself with insurance."},cardTypes:{title:"Card Types",content:"There are risk cards, insurance cards, and event cards. Learn their characteristics."},insuranceSystem:{title:"Insurance System",content:"Purchase insurance in advance to prepare for risks. Consider premiums and coverage amounts."},strategy:{title:"Strategy Tips",content:"Maintain your vitality while developing an effective insurance strategy for success."}}},statistics:{title:"Statistics Dashboard",sections:{overview:"Overview",performance:"Performance",trends:"Trends",detailed:"Detailed Analysis"},metrics:{gamesPlayed:"Games Played",winRate:"Win Rate",averageScore:"Average Score",bestScore:"Best Score",totalPlayTime:"Total Play Time",averageGameTime:"Average Game Time",survivalRate:"Survival Rate",insuranceEfficiency:"Insurance Efficiency"},charts:{vitalityTrend:"Vitality Trend",stageAnalysis:"Stage Analysis",cardUsage:"Card Usage",decisionAnalysis:"Decision Analysis",riskManagement:"Risk Management",insuranceCoverage:"Insurance Coverage"}},accessibility:{title:"Accessibility Settings",sections:{visual:"Visual Settings",audio:"Audio Settings",interaction:"Interaction Settings",display:"Display Settings"},options:{highContrast:"High Contrast",largeText:"Large Text",reduceMotion:"Reduce Motion",screenReader:"Screen Reader Support",keyboardNavigation:"Keyboard Navigation",audioCues:"Audio Cues",subtitles:"Subtitles",slowAnimations:"Slow Animations"},keyboardShortcuts:{title:"Keyboard Shortcuts",homeScreen:"Return to Home Screen (Alt+H)",startGame:"Start Game (Alt+G)",startTutorial:"Start Tutorial (Alt+T)",openStatistics:"Open Statistics (Alt+S)",openAccessibility:"Accessibility Settings (Alt+A)",help:"Show Help (F1)"}},feedback:{title:"Feedback",types:{bug:"Bug Report",suggestion:"Suggestion",general:"General Opinion",rating:"Rating"},form:{subject:"Subject",message:"Message",email:"Email (Optional)",category:"Category",priority:"Priority",submit:"Submit",thankYou:"Thank you for your feedback!"}},errors:{general:"An error occurred.",network:"A network error occurred.",gameState:"Failed to load game state.",save:"Failed to save game.",load:"Failed to load game.",invalidAction:"Invalid action.",cardNotFound:"Card not found.",insufficientFunds:"Insufficient funds.",insuranceNotActive:"Insurance is not active."},success:{gameSaved:"Game saved.",gameLoaded:"Game loaded.",insurancePurchased:"Insurance purchased.",riskAvoided:"Risk avoided.",levelCompleted:"Level completed!",achievementUnlocked:"Achievement unlocked!"},region:{currency:"USD",currencySymbol:"$",dateFormat:"MM/DD/YYYY",numberFormat:"1,234",insuranceSystem:{nationalHealth:"Medicare",employeeHealth:"Employer Health Insurance",nationalPension:"Social Security",employeePension:"401(k)",longTermCare:"Long-term Care Insurance",workersComp:"Workers' Compensation",unemployment:"Unemployment Insurance"},risks:{earthquake:"Earthquake",hurricane:"Hurricane",flood:"Flood",recession:"Recession",inflation:"Inflation",jobLoss:"Job Loss"}},ageGroups:{young:{title:"Insurance Advice for Young Adults",message:"Building a foundation for your future is important."},middle:{title:"Insurance Advice for Working Adults",message:"Consider protection for your family."},senior:{title:"Insurance Advice for Seniors",message:"Healthcare and long-term care preparation is essential."}}},zh:{ui:{navigation:{home:"é¦–é¡µ",back:"é¦–é¡µ",game:"æ¸¸æˆ",tutorial:"æ•™ç¨‹",statistics:"ç»Ÿè®¡",settings:"è®¾ç½®",accessibility:"æ— éšœç¢è®¾ç½®",feedback:"åé¦ˆ"},buttons:{start:"å¼€å§‹",startGame:"å¼€å§‹æ¸¸æˆ",startTutorial:"å¼€å§‹æ•™ç¨‹",close:"å…³é—­",cancel:"å–æ¶ˆ",ok:"ç¡®å®š",yes:"æ˜¯",no:"å¦",continue:"ç»§ç»­",skip:"è·³è¿‡",next:"ä¸‹ä¸€æ­¥",previous:"ä¸Šä¸€æ­¥",finish:"å®Œæˆ",reset:"é‡ç½®",save:"ä¿å­˜",load:"åŠ è½½"},common:{loading:"åŠ è½½ä¸­...",error:"å‘ç”Ÿé”™è¯¯",success:"æˆåŠŸ",warning:"è­¦å‘Š",info:"ä¿¡æ¯",confirm:"ç¡®è®¤",welcome:"æ¬¢è¿",congratulations:"æ­å–œï¼",gameOver:"æ¸¸æˆç»“æŸ",newGame:"æ–°æ¸¸æˆ",retry:"é‡è¯•"}},game:{title:"äººç”Ÿå……å®æ¸¸æˆ",subtitle:"æˆ˜ç•¥äººç”Ÿæ¨¡æ‹Ÿ",description:"åœ¨äººç”Ÿçš„ä¸åŒé˜¶æ®µä¸­ï¼Œå¹³è¡¡é£é™©ä¸ä¿é™©ï¼Œè¿½æ±‚å……å®äººç”Ÿçš„æ¸¸æˆã€‚",stages:{youth:"é’å¹´æœŸ",adult:"æˆå¹´æœŸ",middleAge:"ä¸­å¹´æœŸ",elderly:"è€å¹´æœŸ"},elements:{vitality:"ç”Ÿå‘½åŠ›",turn:"å›åˆ",phase:"é˜¶æ®µ",stage:"å…³å¡",round:"è½®æ¬¡",score:"å¾—åˆ†",level:"ç­‰çº§"},cards:{riskCard:"é£é™©å¡",insuranceCard:"ä¿é™©å¡",eventCard:"äº‹ä»¶å¡",actionCard:"è¡ŒåŠ¨å¡",powerCard:"åŠ›é‡å¡"},actions:{draw:"æŠ½å¡",play:"å‡ºç‰Œ",discard:"å¼ƒç‰Œ",buyInsurance:"è´­ä¹°ä¿é™©",cancelInsurance:"å–æ¶ˆä¿é™©",takeRisk:"æ‰¿æ‹…é£é™©",avoidRisk:"è§„é¿é£é™©"},insurance:{types:{life:"äººå¯¿ä¿é™©",health:"å¥åº·ä¿é™©",auto:"è½¦é™©",home:"æˆ¿å±‹ä¿é™©",travel:"æ—…è¡Œä¿é™©",income:"æ”¶å…¥ä¿éšœä¿é™©",disability:"æ„å¤–ä¼¤å®³ä¿é™©",longTermCare:"é•¿æœŸæŠ¤ç†ä¿é™©"},terms:{premium:"ä¿è´¹",coverage:"ä¿é¢",deductible:"å…èµ”é¢",beneficiary:"å—ç›Šäºº",policy:"ä¿å•",claim:"ç†èµ”",renewal:"ç»­ä¿",cancellation:"é€€ä¿"}},risks:{categories:{health:"å¥åº·é£é™©",financial:"ç»æµé£é™©",accident:"æ„å¤–é£é™©",natural:"è‡ªç„¶ç¾å®³é£é™©",career:"èŒä¸šé£é™©",family:"å®¶åº­é£é™©"},levels:{low:"ä½é£é™©",medium:"ä¸­ç­‰é£é™©",high:"é«˜é£é™©",extreme:"æé«˜é£é™©"}}},tutorial:{title:"æ¸¸æˆæ•™ç¨‹",welcome:"æ¬¢è¿æ¥åˆ°äººç”Ÿå……å®æ¸¸æˆçš„ä¸–ç•Œï¼",steps:{introduction:{title:"ä»‹ç»",content:"åœ¨è¿™ä¸ªæ¸¸æˆä¸­ï¼Œæ‚¨å°†åœ¨äººç”Ÿçš„ä¸åŒé˜¶æ®µä¸­å¹³è¡¡é£é™©ä¸ä¿é™©ã€‚"},basicRules:{title:"åŸºæœ¬è§„åˆ™",content:"æ¯å›åˆæŠ½å–å¡ç‰Œï¼Œå†³å®šæ˜¯é¢å¯¹é£é™©è¿˜æ˜¯ç”¨ä¿é™©æ¥é˜²èŒƒã€‚"},cardTypes:{title:"å¡ç‰Œç±»å‹",content:"æœ‰é£é™©å¡ã€ä¿é™©å¡å’Œäº‹ä»¶å¡ã€‚äº†è§£å®ƒä»¬å„è‡ªçš„ç‰¹ç‚¹ã€‚"},insuranceSystem:{title:"ä¿é™©ç³»ç»Ÿ",content:"æå‰è´­ä¹°ä¿é™©æ¥é˜²èŒƒé£é™©ã€‚è¦è€ƒè™‘ä¿è´¹å’Œä¿é¢ã€‚"},strategy:{title:"ç­–ç•¥è¦ç‚¹",content:"åœ¨ç»´æŒç”Ÿå‘½åŠ›çš„åŒæ—¶ï¼Œåˆ¶å®šæœ‰æ•ˆçš„ä¿é™©ç­–ç•¥æ˜¯æˆåŠŸçš„å…³é”®ã€‚"}}},statistics:{title:"ç»Ÿè®¡ä»ªè¡¨æ¿",sections:{overview:"æ¦‚è§ˆ",performance:"è¡¨ç°",trends:"è¶‹åŠ¿",detailed:"è¯¦ç»†åˆ†æ"},metrics:{gamesPlayed:"æ¸¸æˆæ¬¡æ•°",winRate:"èƒœç‡",averageScore:"å¹³å‡å¾—åˆ†",bestScore:"æœ€é«˜å¾—åˆ†",totalPlayTime:"æ€»æ¸¸æˆæ—¶é—´",averageGameTime:"å¹³å‡æ¸¸æˆæ—¶é—´",survivalRate:"ç”Ÿå­˜ç‡",insuranceEfficiency:"ä¿é™©æ•ˆç‡"},charts:{vitalityTrend:"ç”Ÿå‘½åŠ›è¶‹åŠ¿",stageAnalysis:"é˜¶æ®µåˆ†æ",cardUsage:"å¡ç‰Œä½¿ç”¨æƒ…å†µ",decisionAnalysis:"å†³ç­–åˆ†æ",riskManagement:"é£é™©ç®¡ç†",insuranceCoverage:"ä¿é™©è¦†ç›–"}},accessibility:{title:"æ— éšœç¢è®¾ç½®",sections:{visual:"è§†è§‰è®¾ç½®",audio:"éŸ³é¢‘è®¾ç½®",interaction:"äº¤äº’è®¾ç½®",display:"æ˜¾ç¤ºè®¾ç½®"},options:{highContrast:"é«˜å¯¹æ¯”åº¦",largeText:"å¤§å­—ä½“",reduceMotion:"å‡å°‘åŠ¨ç”»",screenReader:"å±å¹•é˜…è¯»å™¨æ”¯æŒ",keyboardNavigation:"é”®ç›˜å¯¼èˆª",audioCues:"éŸ³é¢‘æç¤º",subtitles:"å­—å¹•",slowAnimations:"æ…¢é€ŸåŠ¨ç”»"},keyboardShortcuts:{title:"é”®ç›˜å¿«æ·é”®",homeScreen:"è¿”å›é¦–é¡µ (Alt+H)",startGame:"å¼€å§‹æ¸¸æˆ (Alt+G)",startTutorial:"å¼€å§‹æ•™ç¨‹ (Alt+T)",openStatistics:"æ‰“å¼€ç»Ÿè®¡ (Alt+S)",openAccessibility:"æ— éšœç¢è®¾ç½® (Alt+A)",help:"æ˜¾ç¤ºå¸®åŠ© (F1)"}},feedback:{title:"åé¦ˆ",types:{bug:"é”™è¯¯æŠ¥å‘Š",suggestion:"æ”¹è¿›å»ºè®®",general:"ä¸€èˆ¬æ„è§",rating:"è¯„ä»·"},form:{subject:"ä¸»é¢˜",message:"æ¶ˆæ¯",email:"é‚®ç®±ï¼ˆå¯é€‰ï¼‰",category:"ç±»åˆ«",priority:"ä¼˜å…ˆçº§",submit:"æäº¤",thankYou:"æ„Ÿè°¢æ‚¨çš„åé¦ˆï¼"}},errors:{general:"å‘ç”Ÿé”™è¯¯ã€‚",network:"ç½‘ç»œé”™è¯¯ã€‚",gameState:"æ¸¸æˆçŠ¶æ€åŠ è½½å¤±è´¥ã€‚",save:"æ¸¸æˆä¿å­˜å¤±è´¥ã€‚",load:"æ¸¸æˆåŠ è½½å¤±è´¥ã€‚",invalidAction:"æ— æ•ˆæ“ä½œã€‚",cardNotFound:"æœªæ‰¾åˆ°å¡ç‰Œã€‚",insufficientFunds:"èµ„é‡‘ä¸è¶³ã€‚",insuranceNotActive:"ä¿é™©æœªç”Ÿæ•ˆã€‚"},success:{gameSaved:"æ¸¸æˆå·²ä¿å­˜ã€‚",gameLoaded:"æ¸¸æˆå·²åŠ è½½ã€‚",insurancePurchased:"ä¿é™©å·²è´­ä¹°ã€‚",riskAvoided:"é£é™©å·²è§„é¿ã€‚",levelCompleted:"å…³å¡å®Œæˆï¼",achievementUnlocked:"æˆå°±è§£é”ï¼"},region:{currency:"äººæ°‘å¸",currencySymbol:"Â¥",dateFormat:"YYYYå¹´MMæœˆDDæ—¥",numberFormat:"1,234",insuranceSystem:{nationalHealth:"åŸé•‡èŒå·¥åŸºæœ¬åŒ»ç–—ä¿é™©",employeeHealth:"èŒå·¥åŒ»ç–—ä¿é™©",nationalPension:"åŸé•‡èŒå·¥åŸºæœ¬å…»è€ä¿é™©",employeePension:"ä¼ä¸šå¹´é‡‘",longTermCare:"é•¿æœŸæŠ¤ç†ä¿é™©",workersComp:"å·¥ä¼¤ä¿é™©",unemployment:"å¤±ä¸šä¿é™©"},risks:{earthquake:"åœ°éœ‡",flood:"æ´ªæ°´",typhoon:"å°é£",smog:"é›¾éœ¾",economicSlowdown:"ç»æµæ”¾ç¼“",agingPopulation:"äººå£è€é¾„åŒ–"}},ageGroups:{young:{title:"å¹´è½»äººä¿é™©å»ºè®®",message:"ä¸ºæœªæ¥æ‰“å¥½åŸºç¡€å¾ˆé‡è¦ã€‚"},middle:{title:"ä¸­å¹´äººä¿é™©å»ºè®®",message:"è€ƒè™‘ä¸ºå®¶åº­æä¾›ä¿éšœã€‚"},senior:{title:"è€å¹´äººä¿é™©å»ºè®®",message:"åŒ»ç–—å’ŒæŠ¤ç†é£é™©çš„å‡†å¤‡è‡³å…³é‡è¦ã€‚"}}},ko:{ui:{navigation:{home:"í™ˆ",back:"í™ˆ",game:"ê²Œì„",tutorial:"íŠœí† ë¦¬ì–¼",statistics:"í†µê³„",settings:"ì„¤ì •",accessibility:"ì ‘ê·¼ì„± ì„¤ì •",feedback:"í”¼ë“œë°±"},buttons:{start:"ì‹œì‘",startGame:"ê²Œì„ ì‹œì‘",startTutorial:"íŠœí† ë¦¬ì–¼ ì‹œì‘",close:"ë‹«ê¸°",cancel:"ì·¨ì†Œ",ok:"í™•ì¸",yes:"ì˜ˆ",no:"ì•„ë‹ˆì˜¤",continue:"ê³„ì†",skip:"ê±´ë„ˆë›°ê¸°",next:"ë‹¤ìŒ",previous:"ì´ì „",finish:"ì™„ë£Œ",reset:"ì´ˆê¸°í™”",save:"ì €ì¥",load:"ë¶ˆëŸ¬ì˜¤ê¸°"},common:{loading:"ë¡œë”© ì¤‘...",error:"ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤",success:"ì„±ê³µ",warning:"ê²½ê³ ",info:"ì •ë³´",confirm:"í™•ì¸",welcome:"í™˜ì˜í•©ë‹ˆë‹¤",congratulations:"ì¶•í•˜í•©ë‹ˆë‹¤!",gameOver:"ê²Œì„ ì¢…ë£Œ",newGame:"ìƒˆ ê²Œì„",retry:"ë‹¤ì‹œ ì‹œë„"}},game:{title:"ì¸ìƒ ì¶©ì‹¤ ê²Œì„",subtitle:"ì „ëµì  ì¸ìƒ ì‹œë®¬ë ˆì´ì…˜",description:"ì¸ìƒì˜ ë‹¤ì–‘í•œ ë‹¨ê³„ì—ì„œ ìœ„í—˜ê³¼ ë³´í—˜ì˜ ê· í˜•ì„ ê³ ë ¤í•˜ë©° ì¶©ì‹¤í•œ ì¸ìƒì„ ëª©í‘œë¡œ í•˜ëŠ” ê²Œì„ì…ë‹ˆë‹¤.",stages:{youth:"ì²­ë…„ê¸°",adult:"ì„±ì¸ê¸°",middleAge:"ì¤‘ë…„ê¸°",elderly:"ë…¸ë…„ê¸°"},elements:{vitality:"ìƒëª…ë ¥",turn:"í„´",phase:"í˜ì´ì¦ˆ",stage:"ìŠ¤í…Œì´ì§€",round:"ë¼ìš´ë“œ",score:"ì ìˆ˜",level:"ë ˆë²¨"},cards:{riskCard:"ìœ„í—˜ ì¹´ë“œ",insuranceCard:"ë³´í—˜ ì¹´ë“œ",eventCard:"ì´ë²¤íŠ¸ ì¹´ë“œ",actionCard:"ì•¡ì…˜ ì¹´ë“œ",powerCard:"íŒŒì›Œ ì¹´ë“œ"},actions:{draw:"ì¹´ë“œ ë½‘ê¸°",play:"ì¹´ë“œ ì‚¬ìš©",discard:"ì¹´ë“œ ë²„ë¦¬ê¸°",buyInsurance:"ë³´í—˜ êµ¬ë§¤",cancelInsurance:"ë³´í—˜ í•´ì§€",takeRisk:"ìœ„í—˜ ê°ìˆ˜",avoidRisk:"ìœ„í—˜ íšŒí”¼"},insurance:{types:{life:"ìƒëª…ë³´í—˜",health:"ê±´ê°•ë³´í—˜",auto:"ìë™ì°¨ë³´í—˜",home:"í™”ì¬ë³´í—˜",travel:"ì—¬í–‰ìë³´í—˜",income:"ì†Œë“ë³´ì¥ë³´í—˜",disability:"ìƒí•´ë³´í—˜",longTermCare:"ì¥ê¸°ìš”ì–‘ë³´í—˜"},terms:{premium:"ë³´í—˜ë£Œ",coverage:"ë³´ì¥ê¸ˆì•¡",deductible:"ìê¸°ë¶€ë‹´ê¸ˆ",beneficiary:"ìˆ˜ìµì",policy:"ë³´í—˜ì¦ê¶Œ",claim:"ë³´í—˜ê¸ˆ ì²­êµ¬",renewal:"ê°±ì‹ ",cancellation:"í•´ì§€"}},risks:{categories:{health:"ê±´ê°• ìœ„í—˜",financial:"ê²½ì œì  ìœ„í—˜",accident:"ì‚¬ê³  ìœ„í—˜",natural:"ìì—°ì¬í•´ ìœ„í—˜",career:"ì§ì—… ìœ„í—˜",family:"ê°€ì¡± ìœ„í—˜"},levels:{low:"ë‚®ì€ ìœ„í—˜",medium:"ì¤‘ê°„ ìœ„í—˜",high:"ë†’ì€ ìœ„í—˜",extreme:"ê·¹ë„ë¡œ ë†’ì€ ìœ„í—˜"}}},tutorial:{title:"ê²Œì„ íŠœí† ë¦¬ì–¼",welcome:"ì¸ìƒ ì¶©ì‹¤ ê²Œì„ì˜ ì„¸ê³„ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!",steps:{introduction:{title:"ì†Œê°œ",content:"ì´ ê²Œì„ì—ì„œëŠ” ì¸ìƒì˜ ë‹¤ì–‘í•œ ë‹¨ê³„ì—ì„œ ìœ„í—˜ê³¼ ë³´í—˜ì˜ ê· í˜•ì„ ê³ ë ¤í•˜ë©° ì§„í–‰í•©ë‹ˆë‹¤."},basicRules:{title:"ê¸°ë³¸ ê·œì¹™",content:"ê° í„´ì—ì„œ ì¹´ë“œë¥¼ ë½‘ê³ , ìœ„í—˜ì— ëŒ€ì²˜í•˜ê±°ë‚˜ ë³´í—˜ìœ¼ë¡œ ëŒ€ë¹„í• ì§€ ê²°ì •í•©ë‹ˆë‹¤."},cardTypes:{title:"ì¹´ë“œ ì¢…ë¥˜",content:"ìœ„í—˜ ì¹´ë“œ, ë³´í—˜ ì¹´ë“œ, ì´ë²¤íŠ¸ ì¹´ë“œê°€ ìˆìŠµë‹ˆë‹¤. ê°ê°ì˜ íŠ¹ì§•ì„ ì´í•´í•´ë´…ì‹œë‹¤."},insuranceSystem:{title:"ë³´í—˜ ì‹œìŠ¤í…œ",content:"ë¯¸ë¦¬ ë³´í—˜ì„ êµ¬ë§¤í•˜ì—¬ ìœ„í—˜ì— ëŒ€ë¹„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë³´í—˜ë£Œì™€ ë³´ì¥ê¸ˆì•¡ì„ ê³ ë ¤í•˜ì—¬ ì„ íƒí•˜ì„¸ìš”."},strategy:{title:"ì „ëµ í¬ì¸íŠ¸",content:"ìƒëª…ë ¥ì„ ìœ ì§€í•˜ë©´ì„œ íš¨ê³¼ì ì¸ ë³´í—˜ ì „ëµì„ ì„¸ìš°ëŠ” ê²ƒì´ ì„±ê³µì˜ ì—´ì‡ ì…ë‹ˆë‹¤."}}},statistics:{title:"í†µê³„ ëŒ€ì‹œë³´ë“œ",sections:{overview:"ê°œìš”",performance:"ì„±ê³¼",trends:"íŠ¸ë Œë“œ",detailed:"ìƒì„¸ ë¶„ì„"},metrics:{gamesPlayed:"í”Œë ˆì´ íšŸìˆ˜",winRate:"ìŠ¹ë¥ ",averageScore:"í‰ê·  ì ìˆ˜",bestScore:"ìµœê³  ì ìˆ˜",totalPlayTime:"ì´ í”Œë ˆì´ ì‹œê°„",averageGameTime:"í‰ê·  ê²Œì„ ì‹œê°„",survivalRate:"ìƒì¡´ìœ¨",insuranceEfficiency:"ë³´í—˜ íš¨ìœ¨ì„±"},charts:{vitalityTrend:"ìƒëª…ë ¥ ì¶”ì´",stageAnalysis:"ìŠ¤í…Œì´ì§€ë³„ ë¶„ì„",cardUsage:"ì¹´ë“œ ì‚¬ìš© í˜„í™©",decisionAnalysis:"ì˜ì‚¬ê²°ì • ë¶„ì„",riskManagement:"ìœ„í—˜ ê´€ë¦¬",insuranceCoverage:"ë³´í—˜ ì»¤ë²„ë¦¬ì§€"}},accessibility:{title:"ì ‘ê·¼ì„± ì„¤ì •",sections:{visual:"ì‹œê° ì„¤ì •",audio:"ìŒì„± ì„¤ì •",interaction:"ì¡°ì‘ ì„¤ì •",display:"í‘œì‹œ ì„¤ì •"},options:{highContrast:"ê³ ëŒ€ë¹„",largeText:"í° ê¸€ì",reduceMotion:"ì• ë‹ˆë©”ì´ì…˜ ê°ì†Œ",screenReader:"ìŠ¤í¬ë¦° ë¦¬ë” ì§€ì›",keyboardNavigation:"í‚¤ë³´ë“œ ë‚´ë¹„ê²Œì´ì…˜",audioCues:"ìŒì„± ì‹ í˜¸",subtitles:"ìë§‰",slowAnimations:"ëŠë¦° ì• ë‹ˆë©”ì´ì…˜"},keyboardShortcuts:{title:"í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤",homeScreen:"í™ˆ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ê¸° (Alt+H)",startGame:"ê²Œì„ ì‹œì‘ (Alt+G)",startTutorial:"íŠœí† ë¦¬ì–¼ ì‹œì‘ (Alt+T)",openStatistics:"í†µê³„ ì—´ê¸° (Alt+S)",openAccessibility:"ì ‘ê·¼ì„± ì„¤ì • (Alt+A)",help:"ë„ì›€ë§ í‘œì‹œ (F1)"}},feedback:{title:"í”¼ë“œë°±",types:{bug:"ë²„ê·¸ ë¦¬í¬íŠ¸",suggestion:"ê°œì„  ì œì•ˆ",general:"ì¼ë°˜ ì˜ê²¬",rating:"í‰ê°€"},form:{subject:"ì œëª©",message:"ë©”ì‹œì§€",email:"ì´ë©”ì¼ (ì„ íƒì‚¬í•­)",category:"ì¹´í…Œê³ ë¦¬",priority:"ìš°ì„ ìˆœìœ„",submit:"ì œì¶œ",thankYou:"í”¼ë“œë°±ì„ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤!"}},errors:{general:"ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.",network:"ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.",gameState:"ê²Œì„ ìƒíƒœ ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.",save:"ê²Œì„ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.",load:"ê²Œì„ ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.",invalidAction:"ìœ íš¨í•˜ì§€ ì•Šì€ ë™ì‘ì…ë‹ˆë‹¤.",cardNotFound:"ì¹´ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.",insufficientFunds:"ìê¸ˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤.",insuranceNotActive:"ë³´í—˜ì´ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."},success:{gameSaved:"ê²Œì„ì„ ì €ì¥í–ˆìŠµë‹ˆë‹¤.",gameLoaded:"ê²Œì„ì„ ë¡œë“œí–ˆìŠµë‹ˆë‹¤.",insurancePurchased:"ë³´í—˜ì„ êµ¬ë§¤í–ˆìŠµë‹ˆë‹¤.",riskAvoided:"ìœ„í—˜ì„ íšŒí”¼í–ˆìŠµë‹ˆë‹¤.",levelCompleted:"ë ˆë²¨ì„ í´ë¦¬ì–´í–ˆìŠµë‹ˆë‹¤!",achievementUnlocked:"ì—…ì ì„ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤!"},region:{currency:"ì›",currencySymbol:"â‚©",dateFormat:"YYYYë…„ MMì›” DDì¼",numberFormat:"1,234",insuranceSystem:{nationalHealth:"êµ­ë¯¼ê±´ê°•ë³´í—˜",employeeHealth:"ì§ì¥ê±´ê°•ë³´í—˜",nationalPension:"êµ­ë¯¼ì—°ê¸ˆ",employeePension:"í‡´ì§ì—°ê¸ˆ",longTermCare:"ì¥ê¸°ìš”ì–‘ë³´í—˜",workersComp:"ì‚°ì¬ë³´í—˜",unemployment:"ê³ ìš©ë³´í—˜"},risks:{earthquake:"ì§€ì§„",typhoon:"íƒœí’",flood:"í™ìˆ˜",fineDust:"ë¯¸ì„¸ë¨¼ì§€",economicRecession:"ê²½ê¸°ì¹¨ì²´",agingSociety:"ê³ ë ¹í™” ì‚¬íšŒ"}},ageGroups:{young:{title:"ì Šì€ ì„¸ëŒ€ë¥¼ ìœ„í•œ ë³´í—˜ ì¡°ì–¸",message:"ë¯¸ë˜ë¥¼ ìœ„í•œ ê¸°ë°˜ ë§ˆë ¨ì´ ì¤‘ìš”í•©ë‹ˆë‹¤."},middle:{title:"ì§ì¥ì¸ ì„¸ëŒ€ë¥¼ ìœ„í•œ ë³´í—˜ ì¡°ì–¸",message:"ê°€ì¡±ì„ ì§€í‚¤ê¸° ìœ„í•œ ë³´ì¥ì„ ê³ ë ¤í•´ë³´ì„¸ìš”."},senior:{title:"ì‹œë‹ˆì–´ ì„¸ëŒ€ë¥¼ ìœ„í•œ ë³´í—˜ ì¡°ì–¸",message:"ì˜ë£Œ ë° ìš”ì–‘ ìœ„í—˜ì— ëŒ€í•œ ëŒ€ë¹„ê°€ ì¤‘ìš”í•©ë‹ˆë‹¤."}}}},numberFormats:{ja:{currency:{style:"currency",currency:"JPY",currencyDisplay:"symbol"},decimal:{style:"decimal",minimumFractionDigits:0,maximumFractionDigits:2}},en:{currency:{style:"currency",currency:"USD",currencyDisplay:"symbol"},decimal:{style:"decimal",minimumFractionDigits:0,maximumFractionDigits:2}},zh:{currency:{style:"currency",currency:"CNY",currencyDisplay:"symbol"},decimal:{style:"decimal",minimumFractionDigits:0,maximumFractionDigits:2}},ko:{currency:{style:"currency",currency:"KRW",currencyDisplay:"symbol"},decimal:{style:"decimal",minimumFractionDigits:0,maximumFractionDigits:0}}},datetimeFormats:{ja:{short:{year:"numeric",month:"short",day:"numeric"},long:{year:"numeric",month:"long",day:"numeric",weekday:"long"}},en:{short:{year:"numeric",month:"short",day:"numeric"},long:{year:"numeric",month:"long",day:"numeric",weekday:"long"}},zh:{short:{year:"numeric",month:"short",day:"numeric"},long:{year:"numeric",month:"long",day:"numeric",weekday:"long"}},ko:{short:{year:"numeric",month:"short",day:"numeric"},long:{year:"numeric",month:"long",day:"numeric",weekday:"long"}}}});const Lt={key:0,class:"language-dropdown"},Pt=["aria-label","aria-expanded"],Rt={class:"current-flag","aria-hidden":"true"},Dt={key:0,class:"current-label"},Mt=["aria-label"],Ot=["aria-selected","tabindex","onClick","onKeydown"],$t={class:"option-flag","aria-hidden":"true"},Nt={class:"option-label"},Ft={key:0,class:"option-check","aria-hidden":"true"},zt={key:1,class:"language-buttons"},Ht=["aria-label","aria-pressed","onClick"],jt={class:"button-flag","aria-hidden":"true"},Ut={key:0,class:"button-label"},Vt={key:2,class:"language-flags"},qt=["aria-label","title","onClick"],Bt=U(s({__name:"LanguageSwitcher",props:{mode:{default:"dropdown"},compact:{type:Boolean,default:!1},ariaLabel:{default:""}},setup(e){const{t:t}=$(),i=e,s=d(!1),u=d(Tt.global.locale.value),g=n(()=>_t[u.value]),m=n(()=>xt.map(e=>({value:e,label:_t[e],flag:p(e),isActive:e===u.value})));function p(e){return{ja:"ğŸ‡¯ğŸ‡µ",en:"ğŸ‡ºğŸ‡¸",zh:"ğŸ‡¨ğŸ‡³",ko:"ğŸ‡°ğŸ‡·"}[e]}function v(e){u.value=e,function(e){xt.includes(e)&&(Tt.global.locale.value=e,function(e){try{localStorage.setItem("insurance-game-locale",e)}catch(t){}}(e),document.documentElement.lang=e,document.documentElement.dir=At.includes(e)?"rtl":"ltr")}(e),s.value=!1,function(e){const t=document.createElement("div");t.setAttribute("aria-live","polite"),t.setAttribute("aria-atomic","true"),t.className="sr-only",t.textContent=e,document.body.appendChild(t),setTimeout(()=>document.body.removeChild(t),1e3)}(`Language changed to ${_t[e]}`)}function w(){s.value=!s.value}function b(e){e.target.closest(".language-switcher")||(s.value=!1)}function k(e,t){switch(e.key){case"Enter":case" ":e.preventDefault(),t?v(t):w();break;case"Escape":if(s.value){s.value=!1;const e=document.querySelector(".language-trigger");e?.focus()}break;case"ArrowDown":if("dropdown"===i.mode&&s.value){e.preventDefault();const t=document.querySelector('.language-option:not([aria-selected="true"]) + .language-option');t?.focus()}break;case"ArrowUp":if("dropdown"===i.mode&&s.value){e.preventDefault();const t=document.querySelector('.language-option[aria-selected="true"]')?.previousElementSibling;t?.focus()}}}return h(()=>{document.addEventListener("click",b)}),I(()=>{document.removeEventListener("click",b)}),(e,i)=>(r(),a("div",{class:_(["language-switcher",[`language-switcher--${e.mode}`,{"language-switcher--compact":e.compact}]])},["dropdown"===e.mode?(r(),a("div",Lt,[f("button",{class:"language-trigger","aria-label":e.ariaLabel||L(t)("accessibility.options.changeLanguage","Change Language"),"aria-expanded":s.value,"aria-haspopup":"listbox",onClick:w,onKeydown:k},[f("span",Rt,S(p(u.value)),1),e.compact?y("",!0):(r(),a("span",Dt,S(g.value),1)),f("span",{class:_(["dropdown-icon",{"dropdown-icon--open":s.value}]),"aria-hidden":"true"}," â–¼ ",2)],40,Pt),o(c,{name:"dropdown"},{default:l(()=>[s.value?(r(),a("ul",{key:0,class:"language-options",role:"listbox","aria-label":L(t)("ui.navigation.selectLanguage","Select Language")},[(r(!0),a(A,null,T(m.value,e=>(r(),a("li",{key:e.value,class:"language-option",role:"option","aria-selected":e.isActive,tabindex:e.isActive?0:-1,onClick:t=>v(e.value),onKeydown:t=>k(t,e.value)},[f("span",$t,S(e.flag),1),f("span",Nt,S(e.label),1),e.isActive?(r(),a("span",Ft,"âœ“")):y("",!0)],40,Ot))),128))],8,Mt)):y("",!0)]),_:1})])):"buttons"===e.mode?(r(),a("div",zt,[(r(!0),a(A,null,T(m.value,i=>(r(),a("button",{key:i.value,class:_(["language-button",{"language-button--active":i.isActive}]),"aria-label":`${L(t)("ui.navigation.switchTo","Switch to")} ${i.label}`,"aria-pressed":i.isActive,onClick:e=>v(i.value)},[f("span",jt,S(i.flag),1),e.compact?y("",!0):(r(),a("span",Ut,S(i.label),1))],10,Ht))),128))])):"flags"===e.mode?(r(),a("div",Vt,[(r(!0),a(A,null,T(m.value,e=>(r(),a("button",{key:e.value,class:_(["language-flag",{"language-flag--active":e.isActive}]),"aria-label":`${L(t)("ui.navigation.switchTo","Switch to")} ${e.label}`,title:e.label,onClick:t=>v(e.value)},S(e.flag),11,qt))),128))])):y("",!0)],2))}}),[["__scopeId","data-v-2382e005"]]),Gt=class e{constructor(e){i(this,"serviceWorker",null),i(this,"pushSubscription",null),i(this,"installPrompt",null),i(this,"isOnline",navigator.onLine),i(this,"config"),i(this,"notificationPermission","default"),this.config=e,this.init()}static getInstance(t){if(!e.instance){const i={enablePushNotifications:!0,enableBackgroundSync:!0,enableOfflineMode:!0,notificationSettings:{gameReminders:!0,performanceAlerts:!1,updateNotifications:!0,reminderInterval:30}};e.instance=new e(t||i)}return e.instance}async init(){try{await this.registerServiceWorker(),this.setupOnlineOfflineHandling(),this.setupInstallPrompt(),this.config.enablePushNotifications&&await this.initializePushNotifications(),this.config.enableBackgroundSync&&this.setupBackgroundSync()}catch(e){}}async registerServiceWorker(){if(!("serviceWorker"in navigator))throw new Error("Service Worker not supported");try{const e=await navigator.serviceWorker.register("/insurance_self_game/service-worker.js",{scope:"/insurance_self_game/",updateViaCache:"none"});e.addEventListener("updatefound",()=>{const t=e.installing;t&&t.addEventListener("statechange",()=>{"installed"===t.state&&navigator.serviceWorker.controller&&this.notifyServiceWorkerUpdate()})}),this.serviceWorker=e.active,navigator.serviceWorker.addEventListener("message",this.handleServiceWorkerMessage.bind(this))}catch(e){throw e}}handleServiceWorkerMessage(e){const{data:t}=e;switch(t.type){case"SYNC_GAME_DATA":this.handleGameDataSync();break;case"CACHE_UPDATED":break;case"PERFORMANCE_DATA":this.handlePerformanceData(t.metrics)}}async initializePushNotifications(){if("Notification"in window&&"PushManager"in window)try{this.notificationPermission=await this.requestNotificationPermission(),"granted"===this.notificationPermission&&(await this.subscribeToPushNotifications(),this.setupNotificationScheduler())}catch(e){}}async requestNotificationPermission(){return"default"===Notification.permission?await Notification.requestPermission():Notification.permission}async subscribeToPushNotifications(){const e=await navigator.serviceWorker.ready;try{this.pushSubscription=await e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:this.config.vapidKey||this.generateVAPIDKey()}),await this.sendSubscriptionToServer(this.pushSubscription)}catch(t){}}generateVAPIDKey(){return"BEl62iUYgUivxIkv69yViUAHu2OtQgV0RmI1R1K2o7wnpCGhAWo6QjBdKYBgQwJP4eSCyWOmfLgdaVrLmRMb6Uk"}async sendSubscriptionToServer(e){localStorage.setItem("pwa_push_subscription",JSON.stringify(e.toJSON()))}setupNotificationScheduler(){if(!this.config.notificationSettings?.gameReminders)return;const e=60*this.config.notificationSettings.reminderInterval*1e3;setInterval(()=>{this.scheduleGameReminder()},e)}async scheduleGameReminder(){document.hidden&&this.isOnline&&await this.sendNotification({title:"äººç”Ÿå……å®Ÿã‚²ãƒ¼ãƒ ",body:"æ–°ã—ã„ãƒãƒ£ãƒ¬ãƒ³ã‚¸ãŒå¾…ã£ã¦ã„ã¾ã™ï¼ãƒ—ãƒ¬ã‚¤ã‚’å†é–‹ã—ã¾ã›ã‚“ã‹ï¼Ÿ",icon:"/insurance_self_game/favicon.ico",tag:"game-reminder",data:{action:"resume-game",timestamp:Date.now()}})}async sendNotification(e){if("granted"===this.notificationPermission)try{const t=await navigator.serviceWorker.ready;await t.showNotification(e.title,e)}catch(t){}}setupOnlineOfflineHandling(){window.addEventListener("online",()=>{this.isOnline=!0,this.handleOnlineStatus(!0)}),window.addEventListener("offline",()=>{this.isOnline=!1,this.handleOnlineStatus(!1)})}handleOnlineStatus(e){e?(this.syncPendingData(),this.preloadCriticalAssets()):this.showOfflineMessage(),this.notifyNetworkStatus(e)}async syncPendingData(){if(this.serviceWorker)try{const e=await navigator.serviceWorker.ready;await e.sync.register("sync-game-data")}catch(e){}}setupBackgroundSync(){setInterval(()=>{this.isOnline&&this.syncPendingData()},6e4)}handleGameDataSync(){const e=this.getLocalGameData();e&&this.sendGameDataToServer(e)}getLocalGameData(){try{const e=localStorage.getItem("game_progress");return e?JSON.parse(e):null}catch(e){return null}}sendGameDataToServer(e){}setupInstallPrompt(){window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),this.installPrompt=e,this.showInstallBanner()}),window.addEventListener("appinstalled",()=>{this.hideInstallBanner(),this.trackInstallEvent()})}showInstallBanner(){const e=new CustomEvent("pwa-install-available");window.dispatchEvent(e)}hideInstallBanner(){const e=new CustomEvent("pwa-installed");window.dispatchEvent(e)}async promptInstall(){if(!this.installPrompt)return!1;try{return await this.installPrompt.prompt(),"accepted"===(await this.installPrompt.userChoice).outcome&&(this.trackInstallEvent(),!0)}catch(e){return!1}}trackInstallEvent(){}async preloadCriticalAssets(){if(!this.serviceWorker)return;const e=["/insurance_self_game/manifest.json","/insurance_self_game/favicon.ico","/insurance_self_game/favicon.svg"];try{navigator.serviceWorker.controller?.postMessage({type:"PRELOAD_RESOURCES",resources:e})}catch(t){}}showOfflineMessage(){const e=new CustomEvent("pwa-offline-mode");window.dispatchEvent(e)}notifyNetworkStatus(e){const t=new CustomEvent("pwa-network-status",{detail:{isOnline:e}});window.dispatchEvent(t)}notifyServiceWorkerUpdate(){const e=new CustomEvent("pwa-update-available");window.dispatchEvent(e)}handlePerformanceData(e){e.responseTime>3e3&&this.sendPerformanceAlert("ã‚µã‚¤ãƒˆã®å¿œç­”ãŒé…ããªã£ã¦ã„ã¾ã™")}async sendPerformanceAlert(e){this.config.notificationSettings?.performanceAlerts&&await this.sendNotification({title:"ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è­¦å‘Š",body:e,icon:"/favicon.ico",tag:"performance-alert",data:{action:"check-performance",timestamp:Date.now()}})}getStatus(){return{isOnline:this.isOnline,hasServiceWorker:Boolean(this.serviceWorker),hasPushSubscription:Boolean(this.pushSubscription),notificationPermission:this.notificationPermission,canInstall:Boolean(this.installPrompt)}}async manageCaches(){this.serviceWorker&&navigator.serviceWorker.controller?.postMessage({type:"CLEAR_CACHE_TYPE",cacheType:"dynamic"})}updateConfig(e){this.config={...this.config,...e},navigator.serviceWorker.controller?.postMessage({type:"UPDATE_CONFIG",config:this.config})}async disable(){try{const e=await navigator.serviceWorker.getRegistrations();for(const t of e)await t.unregister();this.pushSubscription&&await this.pushSubscription.unsubscribe()}catch(e){}}};i(Gt,"instance");const Wt=Gt.getInstance(),Kt={key:0,class:"fixed inset-x-0 bottom-0 z-50 p-4 sm:p-6",role:"dialog","aria-labelledby":"install-prompt-title","aria-describedby":"install-prompt-description"},Qt={class:"mx-auto max-w-md"},Jt={class:"flex items-center justify-between rounded-lg bg-white p-4 shadow-lg ring-1 ring-black/5 dark:bg-gray-800 dark:ring-white/10"},Yt={class:"flex items-center space-x-2"},Xt=["disabled"],Zt={key:0},ei={key:1,class:"flex items-center"},ti=U(s({__name:"PWAInstallPrompt",setup(e){const t=d(!1),i=d(!1),s=()=>{t.value=!0},n=()=>{t.value=!1,i.value=!1;const e=new CustomEvent("pwa-install-success");window.dispatchEvent(e)},u=async()=>{i.value=!0;try{await Wt.promptInstall()&&(t.value=!1,setTimeout(()=>{const e=new CustomEvent("show-toast",{detail:{title:"ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å®Œäº†",message:"ã‚¢ãƒ—ãƒªãŒãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ã•ã‚Œã¾ã—ãŸï¼",type:"success"}});window.dispatchEvent(e)},500))}catch(e){const t=new CustomEvent("show-toast",{detail:{title:"ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¤±æ•—",message:"ã‚¢ãƒ—ãƒªã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã«å¤±æ•—ã—ã¾ã—ãŸ",type:"error"}});window.dispatchEvent(t)}finally{i.value=!1}},g=()=>{t.value=!1,localStorage.setItem("pwa-install-dismissed",Date.now().toString());const e=new CustomEvent("pwa-install-dismissed");window.dispatchEvent(e)};return h(()=>{const e=localStorage.getItem("pwa-install-dismissed");e&&Date.now()-parseInt(e)<864e5||(window.addEventListener("pwa-install-available",s),window.addEventListener("pwa-installed",n),Wt.getStatus().canInstall&&setTimeout(()=>{t.value=!0},3e3))}),I(()=>{window.removeEventListener("pwa-install-available",s),window.removeEventListener("pwa-installed",n)}),(e,s)=>(r(),p(M,{to:"body"},[o(c,{name:"install-prompt","enter-active-class":"duration-300 ease-out","enter-from-class":"transform scale-95 opacity-0","enter-to-class":"transform scale-100 opacity-100","leave-active-class":"duration-200 ease-in","leave-from-class":"transform scale-100 opacity-100","leave-to-class":"transform scale-95 opacity-0"},{default:l(()=>[t.value?(r(),a("div",Kt,[f("div",Qt,[f("div",Jt,[s[1]||(s[1]=f("div",{class:"flex items-center space-x-3"},[f("div",{class:"flex-shrink-0"},[f("div",{class:"flex h-10 w-10 items-center justify-center rounded-lg bg-blue-600"},[f("svg",{class:"h-6 w-6 text-white",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[f("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3"})])])]),f("div",{class:"min-w-0 flex-1"},[f("h3",{id:"install-prompt-title",class:"text-sm font-medium text-gray-900 dark:text-white"}," ã‚¢ãƒ—ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« "),f("p",{id:"install-prompt-description",class:"text-sm text-gray-500 dark:text-gray-400"}," ãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ã—ã¦ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã§ã‚‚ãƒ—ãƒ¬ã‚¤ ")])],-1)),f("div",Yt,[f("button",{type:"button",class:"inline-flex items-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-600 disabled:opacity-50 disabled:cursor-not-allowed",disabled:i.value,onClick:u},[i.value?(r(),a("span",ei,s[0]||(s[0]=[f("svg",{class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[f("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),f("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),b(" ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ä¸­... ",-1)]))):(r(),a("span",Zt,"ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«"))],8,Xt),f("button",{type:"button",class:"inline-flex items-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-gray-300 hover:bg-gray-50 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-600 dark:bg-gray-700 dark:text-white dark:ring-gray-600 dark:hover:bg-gray-600",onClick:g}," å¾Œã§ ")])])])])):y("",!0)]),_:1})]))}}),[["__scopeId","data-v-99b8262e"]]),ii={class:"fixed top-4 right-4 z-40"},si={key:0,class:"mb-2 flex items-center rounded-lg bg-amber-50 px-3 py-2 shadow-lg ring-1 ring-amber-200 dark:bg-amber-900/20 dark:ring-amber-800",role:"alert","aria-live":"polite"},ni={key:0,class:"mb-2 flex items-center rounded-lg bg-blue-50 px-3 py-2 shadow-lg ring-1 ring-blue-200 dark:bg-blue-900/20 dark:ring-blue-800",role:"alert","aria-live":"polite"},ai=["title"],ri={class:"flex items-center space-x-1"},oi={class:"flex items-center space-x-1"},ci={class:"flex items-center space-x-1"},li={key:0,class:"flex items-center space-x-1"},ui=U(s({__name:"PWAStatusIndicator",setup(e){const t=d(!1),i=d(!1),s=d(!1),u=d(Wt.getStatus()),g=n(()=>{const e=[];switch(u.value.hasServiceWorker?e.push("Service Worker: æœ‰åŠ¹"):e.push("Service Worker: ç„¡åŠ¹"),u.value.isOnline?e.push("ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯: ã‚ªãƒ³ãƒ©ã‚¤ãƒ³"):e.push("ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯: ã‚ªãƒ•ãƒ©ã‚¤ãƒ³"),u.value.notificationPermission){case"granted":e.push("é€šçŸ¥: è¨±å¯æ¸ˆã¿");break;case"denied":e.push("é€šçŸ¥: æ‹’å¦æ¸ˆã¿");break;case"default":e.push("é€šçŸ¥: æœªè¨­å®š")}return u.value.canInstall&&e.push("ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«: åˆ©ç”¨å¯èƒ½"),e.join("\n")}),m=e=>{const{isOnline:i}=e.detail;t.value=!i,u.value=Wt.getStatus()},p=()=>{t.value=!0,u.value=Wt.getStatus()},v=()=>{i.value=!0},w=async()=>{try{const e=await navigator.serviceWorker.ready;e.waiting&&(e.waiting.postMessage({type:"SKIP_WAITING"}),window.location.reload())}catch(e){const t=new CustomEvent("show-toast",{detail:{title:"æ›´æ–°å¤±æ•—",message:"ã‚¢ãƒ—ãƒªã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ",type:"error"}});window.dispatchEvent(t)}},b=()=>{i.value=!1},S=()=>{u.value=Wt.getStatus()},k=e=>{e.altKey&&"p"===e.key&&(e.preventDefault(),s.value=!s.value)};return h(()=>{window.addEventListener("pwa-network-status",m),window.addEventListener("pwa-offline-mode",p),window.addEventListener("pwa-update-available",v),window.addEventListener("keydown",k),S();const e=setInterval(S,5e3);I(()=>{clearInterval(e)})}),I(()=>{window.removeEventListener("pwa-network-status",m),window.removeEventListener("pwa-offline-mode",p),window.removeEventListener("pwa-update-available",v),window.removeEventListener("keydown",k)}),(e,n)=>(r(),a("div",ii,[o(c,{name:"status-indicator","enter-active-class":"duration-300 ease-out","enter-from-class":"transform translate-y-2 opacity-0","enter-to-class":"transform translate-y-0 opacity-100","leave-active-class":"duration-200 ease-in","leave-from-class":"transform translate-y-0 opacity-100","leave-to-class":"transform translate-y-2 opacity-0"},{default:l(()=>[t.value?(r(),a("div",si,n[0]||(n[0]=[f("svg",{class:"h-5 w-5 text-amber-600 dark:text-amber-400",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[f("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z"})],-1),f("span",{class:"ml-2 text-sm font-medium text-amber-700 dark:text-amber-300"}," ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒ¢ãƒ¼ãƒ‰ ",-1)]))):y("",!0)]),_:1}),o(c,{name:"status-indicator","enter-active-class":"duration-300 ease-out","enter-from-class":"transform translate-y-2 opacity-0","enter-to-class":"transform translate-y-0 opacity-100","leave-active-class":"duration-200 ease-in","leave-from-class":"transform translate-y-0 opacity-100","leave-to-class":"transform translate-y-2 opacity-0"},{default:l(()=>[i.value?(r(),a("div",ni,[n[2]||(n[2]=f("div",{class:"flex items-center"},[f("svg",{class:"h-5 w-5 text-blue-600 dark:text-blue-400",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[f("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99"})]),f("span",{class:"ml-2 text-sm font-medium text-blue-700 dark:text-blue-300"}," æ›´æ–°åˆ©ç”¨å¯èƒ½ ")],-1)),f("button",{type:"button",class:"ml-3 inline-flex items-center rounded-md bg-blue-600 px-2 py-1 text-xs font-semibold text-white shadow-sm hover:bg-blue-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-600",onClick:w}," æ›´æ–° "),f("button",{type:"button",class:"ml-1 flex-shrink-0 rounded-md p-1 text-blue-400 hover:bg-blue-100 hover:text-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-600 focus:ring-offset-2 focus:ring-offset-blue-50 dark:hover:bg-blue-800 dark:focus:ring-offset-blue-900",onClick:b},n[1]||(n[1]=[f("span",{class:"sr-only"},"é–‰ã˜ã‚‹",-1),f("svg",{class:"h-3 w-3",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor"},[f("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)]))])):y("",!0)]),_:1}),s.value?(r(),a("div",{key:0,class:"flex items-center space-x-2 rounded-lg bg-white px-3 py-2 shadow-sm ring-1 ring-gray-200 dark:bg-gray-800 dark:ring-gray-700",title:g.value},[f("div",ri,[f("div",{class:_(["h-2 w-2 rounded-full",{"bg-green-500":u.value.hasServiceWorker,"bg-gray-300":!u.value.hasServiceWorker}])},null,2),n[3]||(n[3]=f("span",{class:"text-xs text-gray-500 dark:text-gray-400"},"SW",-1))]),f("div",oi,[f("div",{class:_(["h-2 w-2 rounded-full",{"bg-green-500":u.value.isOnline,"bg-red-500":!u.value.isOnline}])},null,2),n[4]||(n[4]=f("span",{class:"text-xs text-gray-500 dark:text-gray-400"},"NET",-1))]),f("div",ci,[f("div",{class:_(["h-2 w-2 rounded-full",{"bg-green-500":u.value.hasPushSubscription,"bg-yellow-500":"default"===u.value.notificationPermission,"bg-red-500":"denied"===u.value.notificationPermission,"bg-gray-300":"denied"===u.value.notificationPermission}])},null,2),n[5]||(n[5]=f("span",{class:"text-xs text-gray-500 dark:text-gray-400"},"PUSH",-1))]),u.value.canInstall?(r(),a("div",li,n[6]||(n[6]=[f("div",{class:"h-2 w-2 rounded-full bg-blue-500"},null,-1),f("span",{class:"text-xs text-gray-500 dark:text-gray-400"},"INSTALL",-1)]))):y("",!0)],8,ai)):y("",!0)]))}}),[["__scopeId","data-v-47c2cf28"]]),di=V("game",()=>{const e=N(null),t=d(!1),i=d(Date.now()),s=n(()=>e.value?e.value.vitality:0),a=n(()=>e.value?e.value.maxVitality:100),r=n(()=>e.value?e.value.hand:[]),o=n(()=>e.value?e.value.stage:"youth"),c=n(()=>e.value?e.value.turn:0),l=n(()=>e.value?e.value.phase:"setup"),u=n(()=>e.value?e.value.currentChallenge:null),h=n(()=>e.value?e.value.insuranceTypeChoices:[]);n(()=>e.value?e.value.cardChoices:[]);const g=d("");function m(){i.value=Date.now()}return{game:e,isInitialized:t,vitality:s,maxVitality:a,hand:r,currentStage:o,currentTurn:c,currentPhase:l,currentChallenge:u,insuranceTypeChoices:h,lastMessage:g,initializeGame:function(i){e.value=new B(i),t.value=!0,m()},startGame:function(){e.value&&(e.value.start(),m())},drawCards:async function(t){e.value&&(await e.value.drawCards(t),m())},startChallenge:function(t){e.value&&(e.value.startChallenge(t),m())},drawChallenge:function(){if(!e.value)return;if(e.value.currentChallenge)return;const t=e.value.challengeDeck.drawCard();t&&(e.value.startChallenge(t),m())},resolveChallenge:function(){if(!e.value)return;const t=e.value.resolveChallenge();return g.value=t.message,m(),t},selectInsurance:function(t){e.value&&(e.value.phase="end",m())},endTurn:function(){if(!e.value)return;const t=e.value.nextTurn();t.insuranceExpirations?g.value=t.insuranceExpirations.message:g.value=`Turn ${e.value.turn} started`,m()},toggleCardSelection:function(t){e.value&&(e.value.toggleCardSelection(t),m())},triggerUpdate:m}}),hi={class:"flex justify-between items-start mb-2"},gi={class:"text-xs font-bold uppercase tracking-wider opacity-70"},mi={key:0,class:"bg-blue-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold shadow-sm"},pi={class:"w-full h-24 bg-gray-200 rounded-md mb-3 flex items-center justify-center overflow-hidden"},yi={class:"text-4xl opacity-20"},vi={key:0},fi={key:1},wi={key:2},bi={key:3},Si={class:"font-bold text-lg leading-tight mb-1 text-gray-800"},ki={class:"text-xs text-gray-600 flex-grow overflow-y-auto"},Ei={class:"mt-2 pt-2 border-t border-gray-200 flex justify-between items-center"},Ci={key:0,class:"flex items-center text-red-600 font-bold"},Ii={key:1,class:"flex items-center text-green-600 font-bold ml-auto"},xi=s({__name:"Card",props:{card:{},isSelected:{type:Boolean},isPlayable:{type:Boolean}},emits:["click"],setup(e,{emit:t}){const i=e,s=t,o=n(()=>({"border-yellow-400 ring-2 ring-yellow-400":i.isSelected,"cursor-pointer hover:-translate-y-2":i.isPlayable,"opacity-50 cursor-not-allowed":!i.isPlayable,"bg-blue-100 border-blue-300":"life"===i.card.type,"bg-red-100 border-red-300":"challenge"===i.card.type,"bg-green-100 border-green-300":"insurance"===i.card.type,"bg-purple-100 border-purple-300":"skill"===i.card.type,"bg-yellow-100 border-yellow-300":"dream"===i.card.type})),c=n(()=>{switch(i.card.type){case"life":return"äººç”Ÿ";case"challenge":return"è©¦ç·´";case"insurance":return"ä¿é™º";case"skill":return"ã‚¹ã‚­ãƒ«";case"dream":return"å¤¢";default:return i.card.type}});return(e,t)=>(r(),a("div",{class:_(["w-48 h-72 rounded-xl border-2 shadow-lg flex flex-col p-4 transition-all duration-200 relative bg-white",o.value]),onClick:t[0]||(t[0]=t=>s("click",e.card))},[f("div",hi,[f("span",gi,S(c.value),1),e.card.cost>0?(r(),a("div",mi,S(e.card.cost),1)):y("",!0)]),f("div",pi,[f("span",yi,["life"===e.card.type?(r(),a("span",vi,"ğŸŒ±")):"challenge"===e.card.type?(r(),a("span",fi,"âš¡")):"insurance"===e.card.type?(r(),a("span",wi,"ğŸ›¡ï¸")):(r(),a("span",bi,"ğŸƒ"))])]),f("h3",Si,S(e.card.name),1),f("p",ki,S(e.card.description),1),f("div",Ei,[e.card.power>0?(r(),a("div",Ci,[t[1]||(t[1]=f("span",{class:"mr-1"},"âš”ï¸",-1)),f("span",null,S(e.card.power),1)])):y("",!0),e.card.coverage?(r(),a("div",Ii,[t[2]||(t[2]=f("span",{class:"mr-1"},"ğŸ›¡ï¸",-1)),f("span",null,S(e.card.coverage),1)])):y("",!0)])],2))}}),_i={class:"fixed bottom-0 left-0 right-0 h-64 flex items-end justify-center pb-4 px-4 pointer-events-none"},Ai={class:"flex -space-x-12 hover:space-x-2 transition-all duration-300 pointer-events-auto"},Ti=s({__name:"Hand",setup(e){const t=di(),i=n(()=>t.hand);function s(e){t.toggleCardSelection(e)}function c(e){return t.game?.selectedCards.includes(e)}return(e,t)=>(r(),a("div",_i,[f("div",Ai,[(r(!0),a(A,null,T(i.value,(e,t)=>(r(),a("div",{key:e.id,class:"transform transition-transform hover:-translate-y-8 hover:z-10 origin-bottom",style:x({zIndex:t})},[o(xi,{card:e,"is-selected":c(e),"is-playable":!0,onClick:s},null,8,["card","is-selected"])],4))),128))])]))}}),Li={class:"w-full h-screen bg-slate-900 text-white overflow-hidden relative font-sans"},Pi={class:"absolute top-0 left-0 right-0 p-4 flex justify-between items-center bg-slate-800/80 backdrop-blur-md z-20 shadow-md"},Ri={class:"flex items-center space-x-6"},Di={class:"flex flex-col"},Mi={class:"font-bold text-xl text-purple-400"},Oi={class:"flex flex-col"},$i={class:"flex items-end"},Ni={class:"font-bold text-2xl text-green-400"},Fi={class:"text-sm text-slate-500 mb-1 ml-1"},zi={class:"flex items-center space-x-4"},Hi={class:"flex flex-col items-end"},ji={class:"font-bold text-xl"},Ui={class:"flex flex-col items-end"},Vi={class:"font-bold text-lg text-blue-300"},qi={class:"absolute inset-0 flex flex-col items-center justify-center pt-20 pb-64 z-10"},Bi={class:"mb-8 flex flex-col items-center"},Gi={key:0,class:"transform scale-110"},Wi={key:1,class:"w-48 h-72 border-2 border-dashed border-slate-600 rounded-xl flex items-center justify-center bg-slate-800/50"},Ki={key:0,class:"absolute top-20 bg-black/50 text-white px-6 py-2 rounded-full backdrop-blur-sm animate-fade-in-down"},Qi={class:"flex space-x-4 mt-4"},Ji={key:1,class:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-8"},Yi={class:"bg-white rounded-xl p-8 max-w-4xl w-full"},Xi={class:"grid grid-cols-3 gap-4"},Zi=["onClick"],es={class:"font-bold text-lg text-gray-800"},ts={class:"text-sm text-gray-600"},is=s({__name:"GameBoard",setup(e){const t=di();function i(){t.drawCards(1)}function s(){t.endTurn()}function n(){t.drawChallenge()}return h(()=>{t.game||(t.initializeGame(),t.startGame())}),(e,c)=>(r(),a("div",Li,[f("div",Pi,[f("div",Ri,[f("div",Di,[c[1]||(c[1]=f("span",{class:"text-xs text-slate-400 uppercase"},"Stage",-1)),f("span",Mi,S(L(t).currentStage),1)]),f("div",Oi,[c[2]||(c[2]=f("span",{class:"text-xs text-slate-400 uppercase"},"Vitality",-1)),f("div",$i,[f("span",Ni,S(L(t).vitality),1),f("span",Fi,"/ "+S(L(t).maxVitality),1)])])]),f("div",zi,[f("div",Hi,[c[3]||(c[3]=f("span",{class:"text-xs text-slate-400 uppercase"},"Turn",-1)),f("span",ji,S(L(t).currentTurn),1)]),f("div",Ui,[c[4]||(c[4]=f("span",{class:"text-xs text-slate-400 uppercase"},"Phase",-1)),f("span",Vi,S(L(t).currentPhase),1)])])]),f("div",qi,[f("div",Bi,[c[6]||(c[6]=f("h2",{class:"text-slate-400 uppercase tracking-widest text-sm mb-4"},"Current Challenge",-1)),L(t).currentChallenge?(r(),a("div",Gi,[o(xi,{card:L(t).currentChallenge},null,8,["card"])])):(r(),a("div",Wi,c[5]||(c[5]=[f("span",{class:"text-slate-500"},"No Active Challenge",-1)])))]),L(t).lastMessage?(r(),a("div",Ki,S(L(t).lastMessage),1)):y("",!0),f("div",Qi,["draw"===L(t).currentPhase?(r(),a("button",{key:0,onClick:i,class:"px-6 py-3 bg-blue-600 hover:bg-blue-500 text-white rounded-lg font-bold shadow-lg transition-colors flex items-center"}," Draw Card ")):y("",!0),"draw"!==L(t).currentPhase||L(t).currentChallenge?y("",!0):(r(),a("button",{key:1,onClick:n,class:"px-6 py-3 bg-yellow-600 hover:bg-yellow-500 text-white rounded-lg font-bold shadow-lg transition-colors"}," Start Challenge ")),"challenge"===L(t).currentPhase?(r(),a("button",{key:2,onClick:c[0]||(c[0]=e=>L(t).resolveChallenge()),class:"px-6 py-3 bg-red-600 hover:bg-red-500 text-white rounded-lg font-bold shadow-lg transition-colors"}," Resolve Challenge ")):y("",!0),"resolution"===L(t).currentPhase||"end"===L(t).currentPhase?(r(),a("button",{key:3,onClick:s,class:"px-6 py-3 bg-green-600 hover:bg-green-500 text-white rounded-lg font-bold shadow-lg transition-colors"}," End Turn ")):y("",!0)]),L(t).insuranceTypeChoices&&L(t).insuranceTypeChoices.length>0?(r(),a("div",Ji,[f("div",Yi,[c[7]||(c[7]=f("h2",{class:"text-2xl font-bold text-gray-800 mb-4"},"Choose Insurance",-1)),f("div",Xi,[(r(!0),a(A,null,T(L(t).insuranceTypeChoices,e=>(r(),a("div",{key:e.insuranceType,class:"border-2 border-gray-200 rounded-lg p-4 hover:border-blue-500 cursor-pointer transition-colors",onClick:i=>L(t).selectInsurance(e.insuranceType)},[f("h3",es,S(e.name),1),f("p",ts,S(e.description),1)],8,Zi))),128))])])])):y("",!0)]),o(Ti),c[8]||(c[8]=f("div",{class:"absolute inset-0 z-0 opacity-10 pointer-events-none"},[f("div",{class:"absolute top-1/4 left-1/4 w-96 h-96 bg-purple-500 rounded-full blur-3xl"}),f("div",{class:"absolute bottom-1/4 right-1/4 w-96 h-96 bg-blue-500 rounded-full blur-3xl"})],-1))]))}}),ss={class:"app-container",role:"application","aria-label":"äººç”Ÿå……å®Ÿã‚²ãƒ¼ãƒ "},ns={key:0,id:"main-content",class:"game-view",role:"main","aria-label":"ã‚²ãƒ¼ãƒ ç”»é¢"},as={key:1,id:"main-content",class:"home-view",role:"main","aria-label":"ãƒ›ãƒ¼ãƒ ç”»é¢"},rs={class:"home-container"},os={class:"info-section"},cs={key:1,class:"desktop-error"},ls={class:"desktop-error-actions"},us=["onClick"],ds=["onClick"],hs={class:"language-switcher-container"},gs=["aria-label","title"],ms=U(s({__name:"App",setup(e){const{t:t}=$(),i=d(!1),n=d(!1),c=d(!1),u=d(!1),g=F({loader:async()=>W(()=>import("./analytics-C86SJn4N-d5L.js").then(e=>e.S),__vite__mapDeps([0,1,2,3,4,5])),errorComponent:{render:()=>H("div")},delay:200,timeout:1e4}),m=F({loader:async()=>W(()=>import("./MobileErrorHandler-BRrrHLkgh4HU.js"),__vite__mapDeps([6,2,3,0,1,4,5,7])),errorComponent:{render:()=>H("div")},delay:200,timeout:1e4}),w=F({loader:async()=>{try{return await W(()=>import("./feedback-GtyItvJ2eE-G.js"),__vite__mapDeps([8,1,2,3,0,4,5,9]))}catch(e){return s({name:"FeedbackButtonFallback",render:()=>H("div",{class:"feedback-button-fallback",style:{display:"none"}})})}},errorComponent:{name:"FeedbackButtonError",render:()=>H("div",{class:"feedback-button-error",style:{display:"none"}})},delay:200,timeout:1e4}),b=d();let k=null,E=null;const C=d({stage:"youth",turn:1,vitality:100,phase:"setup"}),x=()=>{i.value=!0,E?.announceScreenChange("ã‚²ãƒ¼ãƒ ç”»é¢","ã‚²ãƒ¼ãƒ ãŒé–‹å§‹ã•ã‚Œã¾ã—ãŸ")},_=()=>{i.value=!0,E?.announceScreenChange("ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«","ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’é–‹å§‹ã—ã¾ã™"),setTimeout(()=>{const e=new CustomEvent("startTutorial");window.dispatchEvent(e)},100)},A=()=>{i.value=!1,E?.announceScreenChange("ãƒ›ãƒ¼ãƒ ç”»é¢","ãƒ›ãƒ¼ãƒ ç”»é¢ã«æˆ»ã‚Šã¾ã—ãŸ")},T=()=>{c.value=!0,E?.announceScreenChange("çµ±è¨ˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰","çµ±è¨ˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’é–‹ãã¾ã—ãŸ")},P=()=>{c.value=!1,E?.announceScreenChange("ãƒ›ãƒ¼ãƒ ç”»é¢","ãƒ›ãƒ¼ãƒ ç”»é¢ã«æˆ»ã‚Šã¾ã—ãŸ")},R=e=>{e.screenReaderEnabled&&E?.announce("ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒªãƒ¼ãƒ€ãƒ¼å¯¾å¿œãŒæœ‰åŠ¹ã«ãªã‚Šã¾ã—ãŸ",{priority:"assertive"})},D=(e,t)=>{},O=e=>{const t=e.message.toLowerCase();return t.includes("dynamically imported module")||t.includes("failed to fetch")?"dynamic-import":t.includes("network")||t.includes("fetch")?"network":t.includes("permission")||t.includes("cors")?"permission":t.includes("cannot read")||t.includes("undefined")?"runtime":"unknown"},N=(e,t)=>{},j=e=>{};return h(()=>{u.value=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent),k=new ft,E=new J,k.registerShortcut({key:"h",modifiers:["alt"],description:"ãƒ›ãƒ¼ãƒ ç”»é¢ã«æˆ»ã‚‹",action:()=>{i.value&&A()}}),k.registerShortcut({key:"g",modifiers:["alt"],description:"ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹",action:()=>{i.value||x()}}),k.registerShortcut({key:"t",modifiers:["alt"],description:"ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’é–‹å§‹",action:()=>{i.value||_()}}),k.registerShortcut({key:"a",modifiers:["alt"],description:"ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£è¨­å®šã‚’é–‹ã",action:()=>{n.value=!0,E?.announce("ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£è¨­å®šã‚’é–‹ãã¾ã—ãŸ",{priority:"assertive"})}}),k.registerShortcut({key:"s",modifiers:["alt"],description:"çµ±è¨ˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’é–‹ã",action:()=>{i.value||c.value||T()}}),setTimeout(()=>{const e=b.value?.gameButtonRef,t=b.value?.tutorialButtonRef,i=document.querySelector(".back-to-home-btn");null!=e&&k?.registerFocusableElement(e,{priority:100,group:"main-actions",onFocus:()=>E?.announce("ã‚²ãƒ¼ãƒ é–‹å§‹ãƒœã‚¿ãƒ³ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹")}),null!=t&&k?.registerFocusableElement(t,{priority:90,group:"main-actions",onFocus:()=>E?.announce("ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«é–‹å§‹ãƒœã‚¿ãƒ³ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹")}),null!=i&&k?.registerFocusableElement(i,{priority:100,group:"game-actions",onFocus:()=>E?.announce("ãƒ›ãƒ¼ãƒ ç”»é¢ã«æˆ»ã‚‹ãƒœã‚¿ãƒ³ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹")})},100),E.announceScreenChange("ãƒ›ãƒ¼ãƒ ç”»é¢","äººç”Ÿå……å®Ÿã‚²ãƒ¼ãƒ  ã¸ã‚ˆã†ã“ãã€‚Alt+Gã§ã‚²ãƒ¼ãƒ é–‹å§‹ã€Alt+Tã§ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã€Alt+Sã§çµ±è¨ˆã€Alt+Aã§ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£è¨­å®šã€F1ã§ãƒ˜ãƒ«ãƒ—ã‚’è¡¨ç¤ºã§ãã¾ã™")}),I(()=>{k?.destroy(),E?.destroy()}),(e,s)=>(r(),a("div",ss,[s[7]||(s[7]=f("div",{class:"skip-links"},[f("a",{href:"#main-content",class:"skip-link"},"ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã«ç§»å‹•"),f("a",{href:"#navigation",class:"skip-link"},"ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã«ç§»å‹•")],-1)),o(ht),o(Q,{type:"slide",direction:"left",duration:400,intensity:"normal"},{default:l(()=>[i.value?(r(),a("div",ns,[o(qe,{fallback:"detailed","can-recover":!0},{default:l(()=>[o(is,{onBackToHome:A})]),_:1}),f("button",{ref:"backToHomeButtonRef",class:"back-to-home-btn","aria-label":"ãƒ›ãƒ¼ãƒ ç”»é¢ã«æˆ»ã‚‹ (Alt+H)","aria-keyshortcuts":"Alt+H",onClick:A},s[3]||(s[3]=[f("span",{class:"btn-icon","aria-hidden":"true"},"â†",-1),f("span",{class:"btn-text"},"ãƒ›ãƒ¼ãƒ ",-1)]),512)])):(r(),a("div",as,[o(qe,{fallback:"custom","can-recover":!0,onError:N},{error:l(({error:e,retry:t,reload:i})=>[u.value?(r(),p(L(m),{key:0,error:e,"error-type":O(e),onRetry:t,onGoHome:i,onReportError:j},null,8,["error","error-type","onRetry","onGoHome"])):(r(),a("div",cs,[s[4]||(s[4]=f("h2",null,"ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ",-1)),f("p",null,S(e.message),1),f("div",ls,[f("button",{class:"error-btn",onClick:t},"ã‚‚ã†ä¸€åº¦è©¦ã™",8,us),f("button",{class:"error-btn secondary",onClick:i},"ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿",8,ds)])]))]),default:l(()=>[f("div",rs,[o(bt),o(Et,{ref_key:"navigationRef",ref:b,onStartGame:x,onStartTutorial:_,onOpenStatistics:T},null,512),f("section",os,[o(It)])])]),_:1})]))]),_:1}),s[8]||(s[8]=f("footer",{id:"footer",class:"sr-only",role:"contentinfo"},[f("p",null,"äººç”Ÿå……å®Ÿã‚²ãƒ¼ãƒ  - ã‚¢ã‚¯ã‚»ã‚·ãƒ–ãƒ«ãªWebã‚²ãƒ¼ãƒ ä½“é¨“")],-1)),o(Ce,{"is-open":n.value,onClose:s[0]||(s[0]=e=>n.value=!1),onSettingsChanged:R},null,8,["is-open"]),o(De,{enabled:!0}),f("div",hs,[o(Bt,{mode:"dropdown",compact:!0,"aria-label":L(t)("accessibility.options.changeLanguage","Change Language")},null,8,["aria-label"])]),f("button",{class:"accessibility-button","aria-label":L(t)("accessibility.keyboardShortcuts.openAccessibility","ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£è¨­å®šã‚’é–‹ã (Alt+A)"),"aria-keyshortcuts":"Alt+A",title:L(t)("accessibility.title","ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£è¨­å®š"),onClick:s[1]||(s[1]=e=>n.value=!0)},s[5]||(s[5]=[f("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true"},[f("path",{d:"M12 2C13.1 2 14 2.9 14 4C14 5.1 13.1 6 12 6C10.9 6 10 5.1 10 4C10 2.9 10.9 2 12 2ZM21 9H15L13.5 7.5C13 7 12.5 6.5 11.9 6.5H12.1C11.5 6.5 11 7 10.5 7.5L7.91 10.09C7.66 10.34 7.66 10.76 7.91 11.01L10.5 13.6C11 14.1 11.5 14.6 12.1 14.6H11.9C12.5 14.6 13 14.1 13.5 13.6L15 12.1H21C21.6 12.1 22 11.7 22 11.1V10C22 9.4 21.6 9 21 9ZM8.5 12.5L12 16L15.5 12.5L12 22L8.5 12.5Z",fill:"currentColor"})],-1)]),8,gs),(r(),p(M,{to:"body"},[c.value?(r(),a("div",{key:0,class:"modal-overlay",onClick:P},[f("div",{class:"modal-content",onClick:s[2]||(s[2]=v(()=>{},["stop"]))},[o(L(g),{"auto-refresh":!0,onClose:P})])])):y("",!0)])),(r(),p(z,null,{fallback:l(()=>s[6]||(s[6]=[f("div",{style:{display:"none"}},null,-1)])),default:l(()=>[o(L(w),{"game-state":C.value,"show-stats":!0,"auto-survey":!0,onFeedbackSubmitted:D},null,8,["game-state"])]),_:1})),o(ti),o(ui)]))}}),[["__scopeId","data-v-942b162e"]]),ps=class e{constructor(){i(this,"suspiciousActivities",[]),i(this,"rateLimiters",new Map),i(this,"securityMetrics",{totalThreatsBlocked:0,totalInputValidations:0,totalRateLimitViolations:0,sessionStartTime:Date.now()})}static getInstance(){return e.instance||(e.instance=new e),e.instance}getSecurityMetrics(){return{...this.securityMetrics,uptime:Date.now()-this.securityMetrics.sessionStartTime,currentThreats:this.suspiciousActivities.filter(e=>Date.now()-e.timestamp.getTime()<6e4).length}}cleanupRateLimiters(){for(const e of this.rateLimiters.values())e.cleanup()}logSuspiciousActivity(e){const t={...e,id:pt(16),timestamp:new Date};this.suspiciousActivities.push(t),this.securityMetrics.totalThreatsBlocked++,this.suspiciousActivities.length>1e3&&(this.suspiciousActivities=this.suspiciousActivities.slice(-1e3)),this.getRecentActivitiesByType(e.type,6e4).length>=5&&(t.severity="high",t.description+=" (æ”»æ’ƒãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œå‡º)"),"high"!==t.severity&&"critical"!==t.severity||"critical"===t.severity&&this.handleCriticalThreat(t),this.persistActivityToStorage(t)}getRecentActivitiesByType(e,t){const i=Date.now()-t;return this.suspiciousActivities.filter(t=>t.type===e&&t.timestamp.getTime()>i)}persistActivityToStorage(e){try{setTimeout(()=>{const t=JSON.parse(localStorage.getItem("security_incidents")||"[]");t.push({...e,timestamp:e.timestamp.toISOString()});const i=t.slice(-500);localStorage.setItem("security_incidents",JSON.stringify(i))},0)}catch(t){}}checkRateLimit(e,t,i,s=6e4){this.rateLimiters.has(e)||this.rateLimiters.set(e,new mt);const n=this.rateLimiters.get(e),a=n.isAllowed(e,t,i,s);if(!a){this.securityMetrics.totalRateLimitViolations++;const a=n.getRemainingAttempts(e,t,i),r=n.getNextAttemptTime(e,i);this.logSuspiciousActivity({type:"rate_limit_exceeded",description:`ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã‚’è¶…é: ${e}`,severity:0===a?"high":"medium",source:e,metadata:{maxAttempts:t,windowMs:i,blockDurationMs:s,remainingAttempts:a,nextAttemptTime:r}})}return a}getSuspiciousActivities(e=100){return this.suspiciousActivities.slice(-e).sort((e,t)=>t.timestamp.getTime()-e.timestamp.getTime())}generateSecurityReport(){const e=this.getSuspiciousActivities(),t={},i={},s={};e.forEach(e=>{t[e.type]=(t[e.type]||0)+1,i[e.severity]=(i[e.severity]||0)+1;const n=new Date(e.timestamp).getHours();s[n]=(s[n]||0)+1});const n=this.getSecurityMetrics();return{totalActivities:e.length,typeBreakdown:t,severityBreakdown:i,hourlyBreakdown:s,recentActivities:e.slice(0,10),generateTime:new Date,metrics:n,recommendations:this.generateSecurityRecommendations(t,i)}}generateSecurityRecommendations(e,t){const i=[];return e.rate_limit_exceeded>10&&i.push("ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã®å¼·åŒ–ã‚’æ¤œè¨ã—ã¦ãã ã•ã„"),e.invalid_input>5&&i.push("å…¥åŠ›æ¤œè¨¼ã®å¼·åŒ–ã‚’æ¤œè¨ã—ã¦ãã ã•ã„"),e.csp_violation>0&&i.push("Content Security Policyã®è¦‹ç›´ã—ã‚’æ¤œè¨ã—ã¦ãã ã•ã„"),t.critical>0&&i.push("ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ãªè„…å¨ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸã€‚ç³»çµ±ç®¡ç†è€…ã«é€£çµ¡ã—ã¦ãã ã•ã„"),0===i.length&&i.push("ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£çŠ¶æ…‹ã¯è‰¯å¥½ã§ã™"),i}handleCriticalThreat(e){try{localStorage.clear(),sessionStorage.clear()}catch(t){}"undefined"!=typeof window&&setTimeout(()=>{window.location.reload()},1e3)}};i(ps,"instance");let ys=ps;function vs(){try{"undefined"!=typeof window&&document.addEventListener("securitypolicyviolation",e=>{ys.getInstance().logSuspiciousActivity({type:"csp_violation",description:`CSPé•å: ${e.violatedDirective}`,severity:"high",source:e.sourceFile||"unknown",metadata:{violatedDirective:e.violatedDirective,blockedURI:e.blockedURI,lineNumber:e.lineNumber,columnNumber:e.columnNumber}})}),"undefined"!=typeof window&&window.MutationObserver&&new MutationObserver(e=>{e.forEach(e=>{"childList"===e.type&&e.addedNodes.forEach(e=>{if(e.nodeType===Node.ELEMENT_NODE){const t=e;if("SCRIPT"===t.tagName){const e=t.getAttribute("src");e&&!e.startsWith(window.location.origin)&&ys.getInstance().logSuspiciousActivity({type:"external_script_injection",description:`å¤–éƒ¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å‹•çš„è¿½åŠ ã‚’æ¤œå‡º: ${e}`,severity:"critical",source:"dom_monitor",metadata:{scriptSrc:e}})}}})})}).observe(document.body,{childList:!0,subtree:!0}),function(){if("undefined"!=typeof window){const e=window.fetch;window.fetch=async function(...t){const i=t[0],s=t[1]||{};return"string"==typeof i&&i.startsWith("http")&&!i.startsWith(window.location.origin)&&ys.getInstance().logSuspiciousActivity({type:"external_network_request",description:`å¤–éƒ¨ãƒ‰ãƒ¡ã‚¤ãƒ³ã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆ: ${i}`,severity:"medium",source:"network_monitor",metadata:{url:i,method:s.method||"GET"}}),e.apply(this,t)};const t=window.XMLHttpRequest;window.XMLHttpRequest=function(){const e=new t,i=e.open;return e.open=function(e,t,...s){"string"==typeof t&&t.startsWith("http")&&!t.startsWith(window.location.origin)&&ys.getInstance().logSuspiciousActivity({type:"external_xhr_request",description:`å¤–éƒ¨ãƒ‰ãƒ¡ã‚¤ãƒ³ã¸ã®XHRãƒªã‚¯ã‚¨ã‚¹ãƒˆ: ${t}`,severity:"medium",source:"network_monitor",metadata:{url:t,method:e}}),i.apply(this,[e,t,...s])},e}}}(),function(){if("undefined"!=typeof window){let e=!1,t=Date.now();const i={sizeDetection:()=>window.outerHeight-window.innerHeight>160||window.outerWidth-window.innerWidth>160,consoleDetection(){const e=performance.now();return performance.now()-e>100},debuggerDetection(){const e=performance.now();try{Function("debugger")()}catch{}return performance.now()-e>100},contextMenuDetection:()=>!document.addEventListener};setInterval(()=>{const s=Date.now(),n={size:i.sizeDetection(),console:s-t>5e3&&i.consoleDetection(),debugger:s-t>1e4&&i.debuggerDetection(),contextMenu:!1},a=Object.values(n).some(Boolean);a&&!e?(e=!0,ys.getInstance().logSuspiciousActivity({type:"devtools_opened",description:"é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸ",severity:"low",source:"devtools_detector",metadata:{detectionMethods:n,outerHeight:window.outerHeight,innerHeight:window.innerHeight,outerWidth:window.outerWidth,innerWidth:window.innerWidth,userAgent:navigator.userAgent,timestamp:s}}),function(){const e=ys.getInstance(),t=navigator.userAgent;e.checkRateLimit(`devtools_user_${t}`,10,6e4)}()):!a&&e&&(e=!1),s-t>5e3&&(t=s)},1e3)}}(),document.addEventListener("input",e=>{const t=e.target;if(t&&t.value){const e=function(e,t={}){const{maxLength:i=1e3,allowedTypes:s=["string","number","boolean"],sanitize:n=!0,maxDepth:a=10,checkPatterns:r=[]}=t,o=[];let c;const l=typeof e;if(!s.includes(l))return o.push(`ç„¡åŠ¹ãªå‹: ${l}`),{isValid:!1,errors:o};if(null==e&&!s.includes("null"))return o.push("nullã¾ãŸã¯undefinedã¯è¨±å¯ã•ã‚Œã¦ã„ã¾ã›ã‚“"),{isValid:!1,errors:o};if("string"===l){const t=e;t.length>i&&o.push(`æ–‡å­—åˆ—ãŒé•·ã™ãã¾ã™: ${t.length}/${i}`);for(const e of r)e.test(t)||o.push(`ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°å¤±æ•—: ${e.source}`);if(n)try{c=function(e){return e.replace(/\/\*[\s\S]*?\*\//g,"").replace(/\/\/.*$/gm,"").replace(/['"`;]/g,"").replace(/\b(SELECT|INSERT|UPDATE|DELETE|DROP|CREATE|ALTER|EXEC|UNION|SCRIPT)\b/gi,"").replace(/[()&|!=<>]/g,"").replace(/[{}$]/g,"").replace(/[/[\]@]/g,"").replace(/[;&|`$\\]/g,"").replace(/[\u0002-\u001F\u007F-\u009F\uFEFF]/g,"").trim()}(t)}catch(u){o.push(`ã‚µãƒ‹ã‚¿ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼: ${u instanceof Error?u.message:String(u)}`)}}return e&&"object"==typeof e&&(function(e,t=10){const i=new Set;return function e(s,n=0){if(n>t)return n;if(null===s||"object"!=typeof s)return n;if(i.has(s))return ys.getInstance().logSuspiciousActivity({type:"circular_reference",description:"å¾ªç’°å‚ç…§ã‚’æŒã¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸ",severity:"medium",source:"input_validation",metadata:{currentDepth:n}}),t+1;i.add(s);try{if(Array.isArray(s))return s.length>1e4?(ys.getInstance().logSuspiciousActivity({type:"oversized_array",description:`ç•°å¸¸ã«å¤§ããªé…åˆ—: ${s.length}å€‹ã®è¦ç´ `,severity:"high",source:"input_validation",metadata:{arrayLength:s.length,currentDepth:n}}),t+1):Math.max(n,...s.map(t=>e(t,n+1)));const i=Object.keys(s);return i.length>1e3?(ys.getInstance().logSuspiciousActivity({type:"oversized_object",description:`ç•°å¸¸ã«å¤šãã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£: ${i.length}å€‹`,severity:"high",source:"input_validation",metadata:{propertyCount:i.length,currentDepth:n}}),t+1):Math.max(n,...Object.values(s).map(t=>e(t,n+1)))}finally{i.delete(s)}}(e)<=t}(e,a)||o.push(`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®æ·±åº¦ãŒåˆ¶é™ã‚’è¶…ãˆã¦ã„ã¾ã™: ${a}`)),{isValid:0===o.length,sanitizedInput:c,errors:o}}(t.value,{maxLength:1e3,sanitize:!0,checkPatterns:[/^[^<>"'&{}$]*$/]});e.isValid||ys.getInstance().logSuspiciousActivity({type:"invalid_input",description:`ç„¡åŠ¹ãªå…¥åŠ›ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸ: ${e.errors.join(", ")}`,severity:"medium",source:"input_validation_monitor",metadata:{inputValue:t.value.slice(0,100),errors:e.errors,elementType:t.type,elementName:t.name}})}}),"undefined"!=typeof window&&window.performance&&setInterval(()=>{if("memory"in performance){const e=performance.memory,t=Math.round(e.usedJSHeapSize/1024/1024),i=Math.round(e.jsHeapSizeLimit/1024/1024),s=t/i*100;s>80&&ys.getInstance().logSuspiciousActivity({type:"high_memory_usage",description:`ãƒ¡ãƒ¢ãƒªä½¿ç”¨ç‡ãŒé«˜ã„ã§ã™: ${s.toFixed(1)}%`,severity:"medium",source:"performance_monitor",metadata:{usedMB:t,limitMB:i,usagePercent:s}})}},3e4),function(){const e=new Map;setInterval(()=>{const t=Object.keys(window).length,i=e.get("global")||0;t>i+100&&ys.getInstance().logSuspiciousActivity({type:"potential_memory_leak",description:`ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®æ•°ãŒæ€¥æ¿€ã«å¢—åŠ : ${t}`,severity:"medium",source:"memory_leak_detector",metadata:{currentCount:t,previousCount:i,increase:t-i}}),e.set("global",t)},6e4)}(),function(){const e={crypto:Boolean(window.crypto),subtle:Boolean(window.crypto&&window.crypto.subtle),csp:Boolean(document.querySelector('meta[http-equiv="Content-Security-Policy"]')),https:"https:"===window.location.protocol,referrerPolicy:Boolean(document.querySelector('meta[name="referrer"]'))},t=Object.entries(e).filter(([,e])=>!e).map(([e])=>e);t.length>0&&ys.getInstance().logSuspiciousActivity({type:"missing_security_features",description:`ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½ãŒä¸ååˆ†: ${t.join(", ")}`,severity:"medium",source:"initial_security_check",metadata:{missingFeatures:t,allFeatures:e}})}(),setInterval(()=>{ys.getInstance().cleanupRateLimiters()},3e5),setInterval(()=>{ys.getInstance().generateSecurityReport()},36e5),setInterval(()=>{const e=JSON.parse(localStorage.getItem("security_incidents")||"[]"),t=Date.now()-864e5,i=e.filter(e=>new Date(e.timestamp).getTime()>t);localStorage.setItem("security_incidents",JSON.stringify(i))},864e5)}catch(e){ys.getInstance().logSuspiciousActivity({type:"security_init_failure",description:`ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: ${e instanceof Error?e.message:String(e)}`,severity:"critical",source:"security_initialization",metadata:{error:e}})}}function fs(){const e=new Uint8Array(32);if("undefined"!=typeof window&&window.crypto&&window.crypto.getRandomValues)window.crypto.getRandomValues(e);else for(let t=0;t<e.length;t++)e[t]=Math.floor(256*Math.random());return Array.from(e,e=>e.toString(16).padStart(2,"0")).join("")}const ws=class e{constructor(){i(this,"trustedDomains",[]),i(this,"allowedTags",["b","i","em","strong","br","p"]),i(this,"allowedAttributes",["class","data-*"])}static getInstance(){return e.instance||(e.instance=new e),e.instance}setTrustedDomains(e){this.trustedDomains=e.map(e=>e.toLowerCase())}setAllowedTags(e){this.allowedTags=e.map(e=>e.toLowerCase())}sanitizeHTML(e){if("string"!=typeof e)return"";let t=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;");for(const i of this.allowedTags){const e=new RegExp(`&lt;(${i})&gt;`,"gi"),s=new RegExp(`&lt;\\/(${i})&gt;`,"gi");t=t.replace(e,"<$1>").replace(s,"</$1>")}return t.slice(0,1e4)}escapeJavaScript(e){return"string"!=typeof e?"":e.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\t/g,"\\t").replace(/[\u0009]/g,"\\t").replace(/\f/g,"\\f").replace(/\v/g,"\\v").replace(/[\u0001]/g,"\\x01").replace(/[\u0002-\u001F\u007F-\u009F]/g,e=>`\\u${`0000${e.charCodeAt(0).toString(16)}`.slice(-4)}`)}sanitizeURL(e){if("string"!=typeof e)return"";try{const t=new URL(e);return["http:","https:","mailto:","tel:"].includes(t.protocol)?this.trustedDomains.length>0&&!this.trustedDomains.some(e=>t.hostname.endsWith(e))&&"mailto:"!==t.protocol&&"tel:"!==t.protocol?(ys.getInstance().logSuspiciousActivity({type:"untrusted_domain",description:`ä¿¡é ¼ã•ã‚Œã¦ã„ãªã„ãƒ‰ãƒ¡ã‚¤ãƒ³: ${t.hostname}`,severity:"medium",source:"xss_protection",metadata:{originalUrl:e,hostname:t.hostname}}),""):t.toString():(ys.getInstance().logSuspiciousActivity({type:"blocked_dangerous_protocol",description:`å±é™ºãªãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’ãƒ–ãƒ­ãƒƒã‚¯: ${t.protocol}`,severity:"high",source:"xss_protection",metadata:{originalUrl:e,protocol:t.protocol}}),"")}catch(t){return ys.getInstance().logSuspiciousActivity({type:"invalid_url",description:`ç„¡åŠ¹ãªURL: ${e}`,severity:"medium",source:"xss_protection",metadata:{originalUrl:e,error:t instanceof Error?t.message:String(t)}}),""}}validateDOMOperation(e,t,i){if(!e||!t)return!1;if("innerHTML"===t&&i){const e=this.sanitizeHTML(i);if(e!==i)return ys.getInstance().logSuspiciousActivity({type:"blocked_unsafe_dom",description:"unsafe innerHTMLæ“ä½œã‚’ãƒ–ãƒ­ãƒƒã‚¯",severity:"high",source:"xss_protection",metadata:{operation:t,originalValue:i.slice(0,200),sanitizedValue:e.slice(0,200)}}),!1}if("setAttribute"===t&&i){const[e]=i.split("=",1);if(["onload","onerror","onclick","onmouseover","style"].includes(e.toLowerCase()))return ys.getInstance().logSuspiciousActivity({type:"blocked_dangerous_attribute",description:`å±é™ºãªå±æ€§è¨­å®šã‚’ãƒ–ãƒ­ãƒƒã‚¯: ${e}`,severity:"high",source:"xss_protection",metadata:{operation:t,attributeName:e}}),!1}return!0}};i(ws,"instance");let bs=ws;const Ss=class e{constructor(){i(this,"tokenStore",new Map),i(this,"validOrigins",[])}static getInstance(){return e.instance||(e.instance=new e),e.instance}setValidOrigins(e){this.validOrigins=e.map(e=>e.toLowerCase())}generateTokenForAction(e,t=30){const i=fs(),s=Date.now()+60*t*1e3;return this.tokenStore.set(e,{token:i,expires:s}),this.cleanupExpiredTokens(),i}validateTokenForAction(e,t){const i=this.tokenStore.get(e);if(!i)return ys.getInstance().logSuspiciousActivity({type:"csrf_token_missing",description:`CSRF token not found for action: ${e}`,severity:"high",source:"csrf_protection",metadata:{action:e}}),!1;if(Date.now()>i.expires)return this.tokenStore.delete(e),ys.getInstance().logSuspiciousActivity({type:"csrf_token_expired",description:`CSRF token expired for action: ${e}`,severity:"medium",source:"csrf_protection",metadata:{action:e}}),!1;const s=function(e,t){if(!e||!t||e.length!==t.length)return!1;let i=0;for(let s=0;s<e.length;s++)i|=e.charCodeAt(s)^t.charCodeAt(s);return 0===i}(t,i.token);return s||ys.getInstance().logSuspiciousActivity({type:"csrf_token_invalid",description:`Invalid CSRF token for action: ${e}`,severity:"high",source:"csrf_protection",metadata:{action:e}}),s&&this.tokenStore.delete(e),s}validateOrigin(e){if(!e)return!1;const t=e.toLowerCase();if(0===this.validOrigins.length)return t===window.location.origin.toLowerCase();const i=this.validOrigins.includes(t);return i||ys.getInstance().logSuspiciousActivity({type:"csrf_invalid_origin",description:`Invalid origin: ${e}`,severity:"high",source:"csrf_protection",metadata:{providedOrigin:e,validOrigins:this.validOrigins}}),i}validateReferer(e){if(!e)return!1;try{const t=new URL(e),i=window.location.origin.toLowerCase();return t.origin.toLowerCase()===i}catch{return ys.getInstance().logSuspiciousActivity({type:"csrf_invalid_referer",description:`Invalid referer: ${e}`,severity:"medium",source:"csrf_protection",metadata:{referer:e}}),!1}}cleanupExpiredTokens(){const e=Date.now();for(const[t,i]of this.tokenStore.entries())e>i.expires&&this.tokenStore.delete(t)}clearAllTokens(){this.tokenStore.clear()}};i(Ss,"instance");let ks=Ss,Es=(e=class{constructor(){i(this,"nonces",new Set),i(this,"cspDirectives",new Map)}static getInstance(){return e.instance||(e.instance=new e),e.instance}generateScriptNonce(){const e=fs();return this.nonces.add(e),setTimeout(()=>{this.nonces.delete(e)},36e5),e}validateNonce(e){return this.nonces.has(e)}setDirective(e,t){this.cspDirectives.set(e,[...t])}addToDirective(e,t){const i=this.cspDirectives.get(e)||[];i.includes(t)||(i.push(t),this.cspDirectives.set(e,i))}generateCSPHeader(){const e=[];for(const[t,i]of this.cspDirectives.entries())e.push(`${t} ${i.join(" ")}`);return e.join("; ")}applyCSPToDocument(){const e=document.querySelector('meta[http-equiv="Content-Security-Policy"]');e&&e.remove();const t=document.createElement("meta");t.httpEquiv="Content-Security-Policy",t.content=this.generateCSPHeader(),document.head.appendChild(t)}executeScriptSafely(e,t){const i=t||this.generateScriptNonce();if(!this.validateNonce(i))return ys.getInstance().logSuspiciousActivity({type:"invalid_script_nonce",description:"Invalid nonce for script execution",severity:"high",source:"csp_manager",metadata:{nonce:i}}),!1;try{const t=document.createElement("script");return t.nonce=i,t.textContent=e,document.head.appendChild(t),document.head.removeChild(t),!0}catch(s){return ys.getInstance().logSuspiciousActivity({type:"script_execution_failed",description:"Safe script execution failed",severity:"medium",source:"csp_manager",metadata:{error:s instanceof Error?s.message:String(s),nonce:i}}),!1}}},i(e,"instance"),e);const Cs=class e{constructor(){i(this,"xssProtection",bs.getInstance()),i(this,"csrfProtection",ks.getInstance()),i(this,"cspManager",Es.getInstance())}static getInstance(){return e.instance||(e.instance=new e),e.instance}validateFormSubmission(e,t){const i=new FormData(e);let s=!0;if(t){const i=e.getAttribute("data-action")||"form_submit";this.csrfProtection.validateTokenForAction(i,t)||(s=!1)}const n=document.referrer||window.location.origin;this.csrfProtection.validateOrigin(n)||(s=!1);for(const[r,o]of i.entries())if("string"==typeof o)try{const e=gt(o);e!==o&&ys.getInstance().logSuspiciousActivity({type:"form_input_sanitized",description:`Form input was sanitized: ${r}`,severity:"low",source:"security_interceptor",metadata:{fieldName:r,original:o.slice(0,100),sanitized:e.slice(0,100)}})}catch(a){s=!1,ys.getInstance().logSuspiciousActivity({type:"form_input_validation_failed",description:`Form input validation failed: ${r}`,severity:"high",source:"security_interceptor",metadata:{fieldName:r,error:a instanceof Error?a.message:String(a)}})}return s}validateAjaxRequest(e,t,i,s){let n=!0;if(this.xssProtection.sanitizeURL(e)||(n=!1),["POST","PUT","DELETE","PATCH"].includes(t.toUpperCase())&&(i["X-CSRF-Token"]||(ys.getInstance().logSuspiciousActivity({type:"missing_csrf_token",description:`CSRF token missing for ${t} request`,severity:"high",source:"security_interceptor",metadata:{url:e,method:t}}),n=!1)),s&&"object"==typeof s)try{const i=JSON.stringify(s);i.length>1e5&&(ys.getInstance().logSuspiciousActivity({type:"oversized_request_payload",description:`Request payload too large: ${i.length} bytes`,severity:"medium",source:"security_interceptor",metadata:{url:e,method:t,payloadSize:i.length}}),n=!1)}catch{n=!1}return n}initialize(){this.xssProtection.setTrustedDomains([window.location.hostname,"cdn.jsdelivr.net","unpkg.com"]),this.csrfProtection.setValidOrigins([window.location.origin]),this.cspManager.setDirective("default-src",["'self'"]),this.cspManager.setDirective("script-src",["'self'","'unsafe-inline'"]),this.cspManager.setDirective("style-src",["'self'","'unsafe-inline'"]),this.cspManager.setDirective("img-src",["'self'","data:","blob:"]),this.cspManager.setDirective("connect-src",["'self'"]),this.cspManager.setDirective("font-src",["'self'","data:"]),this.cspManager.setDirective("object-src",["'none'"]),this.cspManager.setDirective("frame-src",["'none'"])}};i(Cs,"instance");let Is=Cs;"undefined"!=typeof window&&document.addEventListener("DOMContentLoaded",()=>{Is.getInstance().initialize()});const xs=class e{constructor(){i(this,"currentNonce",""),i(this,"nonceExpiry",0),i(this,"directives",{}),i(this,"violations",[]),i(this,"reportEndpoint","")}static getInstance(){return e.instance||(e.instance=new e),e.instance}initialize(){this.setupDefaultDirectives(),this.setupViolationReporting(),this.updateCSPMetaTag(),this.scheduleNonceRotation()}setupDefaultDirectives(){const e=["'self'",`'nonce-${this.generateNewNonce()}'`];e.push("'strict-dynamic'"),this.directives={"default-src":["'self'"],"script-src":e,"style-src":["'self'","'unsafe-inline'"],"img-src":["'self'","data:","blob:","https:"],"font-src":["'self'","data:","https:"],"connect-src":["'self'","https:"],"media-src":["'self'"],"object-src":["'none'"],"frame-src":["'none'"],"worker-src":["'self'","blob:"],"manifest-src":["'self'"],"base-uri":["'self'"],"form-action":["'self'"],"frame-ancestors":["'none'"],"report-uri":["/api/csp-violation-report"]}}generateNewNonce(){return this.currentNonce=pt(32),this.nonceExpiry=Date.now()+9e5,ys.getInstance().logSuspiciousActivity({type:"nonce_generated",description:"New CSP nonce generated",severity:"low",source:"csp_manager",metadata:{nonceLength:this.currentNonce.length,expiryTime:new Date(this.nonceExpiry).toISOString()}}),this.currentNonce}getCurrentNonce(){return Date.now()>this.nonceExpiry&&(this.generateNewNonce(),this.updateCSPMetaTag()),this.currentNonce}validateNonce(e){if(Date.now()>this.nonceExpiry)return ys.getInstance().logSuspiciousActivity({type:"expired_nonce_used",description:"Attempt to use expired nonce",severity:"medium",source:"csp_manager",metadata:{providedNonce:`${e.slice(0,8)}...`,expired:!0,expiryTime:new Date(this.nonceExpiry).toISOString()}}),!1;const t=e===this.currentNonce;return t||ys.getInstance().logSuspiciousActivity({type:"invalid_nonce_used",description:"Invalid nonce provided",severity:"high",source:"csp_manager",metadata:{providedNonce:`${e.slice(0,8)}...`,expectedNonce:`${this.currentNonce.slice(0,8)}...`}}),t}setDirective(e,t){this.directives[e]=[...t],this.updateCSPMetaTag()}addToDirective(e,t){this.directives[e]||(this.directives[e]=[]),this.directives[e].includes(t)||(this.directives[e].push(t),this.updateCSPMetaTag())}removeFromDirective(e,t){this.directives[e]&&(this.directives[e]=this.directives[e].filter(e=>e!==t),this.updateCSPMetaTag())}generateCSPHeader(e=!1){const t=[],i=["frame-ancestors","report-uri","report-to","sandbox"];for(const[s,n]of Object.entries(this.directives))if((!e||!i.includes(s))&&n&&n.length>0){let e=n.join(" ");e=e.replace(/\$\{nonce\}/g,this.getCurrentNonce()),t.push(`${s} ${e}`)}return t.join("; ")}updateCSPMetaTag(){if("undefined"==typeof document)return;const e=document.querySelector('meta[http-equiv="Content-Security-Policy"]');e&&e.remove();const t=document.createElement("meta");t.httpEquiv="Content-Security-Policy",t.content=this.generateCSPHeader(!0),document.head.appendChild(t);const i=document.documentElement.outerHTML;i.includes("PLACEHOLDER_NONCE")&&(document.documentElement.outerHTML=i.replace(/PLACEHOLDER_NONCE/g,this.getCurrentNonce())),ys.getInstance().logSuspiciousActivity({type:"csp_updated",description:"CSP policy updated",severity:"low",source:"csp_manager",metadata:{policy:`${t.content.slice(0,200)}...`,nonce:`${this.currentNonce.slice(0,8)}...`}})}setupViolationReporting(){"undefined"!=typeof document&&document.addEventListener("securitypolicyviolation",e=>{const t={blockedURI:e.blockedURI,columnNumber:e.columnNumber,documentURI:e.documentURI,effectiveDirective:e.effectiveDirective,lineNumber:e.lineNumber,originalPolicy:e.originalPolicy,referrer:e.referrer,sample:e.sample,sourceFile:e.sourceFile,statusCode:e.statusCode,violatedDirective:e.violatedDirective,timestamp:(new Date).toISOString()};this.violations.push(t),this.violations.length>100&&(this.violations=this.violations.slice(-100)),ys.getInstance().logSuspiciousActivity({type:"csp_violation",description:`CSP violation: ${e.violatedDirective}`,severity:this.assessViolationSeverity(e),source:"csp_violation_handler",metadata:t}),this.reportEndpoint&&this.sendViolationReport(t)})}assessViolationSeverity(e){return e.violatedDirective.startsWith("script-src")?e.blockedURI.includes("javascript:")||e.blockedURI.includes("data:")?"critical":"high":e.sample&&(e.sample.includes("eval(")||e.sample.includes("Function(")||e.sample.includes("setTimeout(")||e.sample.includes("setInterval("))?"high":e.effectiveDirective.includes("-src")&&!e.blockedURI.startsWith(window.location.origin)?"medium":"low"}async sendViolationReport(e){try{await fetch(this.reportEndpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({"csp-report":e})})}catch(t){}}scheduleNonceRotation(){setInterval(()=>{this.generateNewNonce(),this.updateCSPMetaTag()},6e5)}executeScriptWithNonce(e){if("undefined"==typeof document)return!1;try{const t=document.createElement("script");return t.nonce=this.getCurrentNonce(),t.textContent=e,document.head.appendChild(t),document.head.removeChild(t),!0}catch(t){return ys.getInstance().logSuspiciousActivity({type:"safe_script_execution_failed",description:"Failed to execute script with nonce",severity:"medium",source:"csp_manager",metadata:{error:t instanceof Error?t.message:String(t),codeLength:e.length}}),!1}}addStyleWithNonce(e){if("undefined"==typeof document)return!1;try{const t=document.createElement("style");return t.nonce=this.getCurrentNonce(),t.textContent=e,document.head.appendChild(t),!0}catch(t){return ys.getInstance().logSuspiciousActivity({type:"safe_style_addition_failed",description:"Failed to add style with nonce",severity:"medium",source:"csp_manager",metadata:{error:t instanceof Error?t.message:String(t),cssLength:e.length}}),!1}}getViolationHistory(e=50){return this.violations.slice(-e)}getViolationStats(){const e={total:this.violations.length,byDirective:{},bySource:{}};return this.violations.forEach(t=>{const i=t.effectiveDirective||"unknown",s=t.sourceFile||"inline";e.byDirective[i]=(e.byDirective[i]||0)+1,e.bySource[s]=(e.bySource[s]||0)+1}),e}setReportEndpoint(e){this.reportEndpoint=e,this.addToDirective("report-uri",e)}debugCSP(){}};i(xs,"instance");let _s=xs;const As=class e{static getInstance(){return e.instance||(e.instance=new e),e.instance}initializeSecurityHeaders(){this.setContentTypeOptions(),this.setXSSProtection(),this.setReferrerPolicy(),this.setPermissionsPolicy(),this.setStrictTransportSecurity(),this.setCrossOriginPolicies()}setContentTypeOptions(){this.updateMetaTag("X-Content-Type-Options","nosniff")}setFrameOptions(){this.updateMetaTag("X-Frame-Options","DENY")}setXSSProtection(){this.updateMetaTag("X-XSS-Protection","1; mode=block")}setReferrerPolicy(){if(!document.querySelector('meta[name="referrer"]')){const e=document.createElement("meta");e.name="referrer",e.content="strict-origin-when-cross-origin",document.head.appendChild(e)}}setPermissionsPolicy(){const e=["geolocation=()","microphone=()","camera=()","fullscreen=(self)","payment=()","usb=()","serial=()","hid=()","midi=()","clipboard-read=()","clipboard-write=(self)","accelerometer=()","gyroscope=()","magnetometer=()","ambient-light-sensor=()","encrypted-media=()","picture-in-picture=()","display-capture=()"].join(", ");this.updateMetaTag("Permissions-Policy",e)}setStrictTransportSecurity(){"https:"===window.location.protocol&&this.updateMetaTag("Strict-Transport-Security","max-age=31536000; includeSubDomains; preload")}setCrossOriginPolicies(){this.updateMetaTag("Cross-Origin-Embedder-Policy","require-corp"),this.updateMetaTag("Cross-Origin-Opener-Policy","same-origin"),this.updateMetaTag("Cross-Origin-Resource-Policy","same-origin")}updateMetaTag(e,t){if("undefined"==typeof document)return;let i=document.querySelector(`meta[http-equiv="${e}"]`);i||(i=document.createElement("meta"),i.httpEquiv=e,document.head.appendChild(i)),i.content=t}validateSecurityHeaders(){const e=[],t=[],i=[];return["Content-Security-Policy","X-Content-Type-Options","X-Frame-Options","X-XSS-Protection","Strict-Transport-Security","Cross-Origin-Embedder-Policy","Cross-Origin-Opener-Policy"].forEach(i=>{document.querySelector(`meta[http-equiv="${i}"]`)?e.push(i):t.push(i)}),"https:"!==window.location.protocol&&i.push("HTTPSã®ä½¿ç”¨ã‚’å¼·ãæ¨å¥¨ã—ã¾ã™"),document.querySelector('meta[name="referrer"]')||i.push("Referrer Policyã®è¨­å®šã‚’æ¨å¥¨ã—ã¾ã™"),{valid:e,missing:t,recommendations:i}}};i(As,"instance");let Ts=As;const Ls=class e{constructor(){i(this,"storage",vt()),i(this,"eventQueue",[]),i(this,"isProcessingQueue",!1),i(this,"maxEventsInMemory",1e3),i(this,"maxEventsInStorage",5e3),i(this,"sessionId"),i(this,"logErrorCount",0),i(this,"lastLogErrorReset",Date.now()),i(this,"MAX_LOG_ERRORS_PER_MINUTE",50),i(this,"config",{enableStackTrace:!0,enableGeoLocation:!1,enablePerformanceMetrics:!0,autoFlushInterval:3e4,compressionThreshold:200}),this.sessionId=this.generateSessionId(),this.startAutoFlush(),this.setupUnloadHandler()}static getInstance(){return e.instance||(e.instance=new e),e.instance}generateSessionId(){return`session_${Date.now().toString(36)}_${Math.random().toString(36).substr(2,9)}`}async logSecurityEvent(e,t,i,s,n={}){try{const a={id:await this.generateEventId(),timestamp:new Date,eventType:e,severity:t,source:i,message:s,metadata:{...n,url:window.location.href,referrer:document.referrer,viewport:{width:window.innerWidth,height:window.innerHeight},...this.config.enablePerformanceMetrics&&this.getPerformanceMetrics()},userAgent:navigator.userAgent,sessionId:this.sessionId,stackTrace:this.config.enableStackTrace?this.captureStackTrace():void 0,hash:""};a.hash=await this.calculateEventHash(a),this.eventQueue.push(a),this.eventQueue.length>this.maxEventsInMemory&&(this.eventQueue=this.eventQueue.slice(-this.maxEventsInMemory)),"critical"!==t&&"high"!==t||await this.flushQueue(),ys.getInstance().logSuspiciousActivity({type:e,description:s,severity:t,source:i,metadata:n})}catch(a){const e=Date.now();if(e-this.lastLogErrorReset>6e4&&(this.logErrorCount=0,this.lastLogErrorReset=e),this.logErrorCount>=this.MAX_LOG_ERRORS_PER_MINUTE)return;this.logErrorCount++;const t=console.originalError||console.error;this.logErrorCount<=5&&t.call(console,"ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ™ãƒ³ãƒˆã®ãƒ­ã‚°è¨˜éŒ²ã«å¤±æ•—:",a)}}async generateEventId(){const e=Date.now().toString(),t=Math.random().toString();return(await yt(e+t)).slice(0,16)}async calculateEventHash(e){const t=JSON.stringify({id:e.id,timestamp:e.timestamp.toISOString(),eventType:e.eventType,severity:e.severity,source:e.source,message:e.message,sessionId:e.sessionId});return await yt(t)}captureStackTrace(){try{throw new Error}catch(e){return e instanceof Error&&e.stack?e.stack.split("\n").slice(3,8).join("\n"):""}}getPerformanceMetrics(){if(!performance)return{};const e=performance.getEntriesByType("navigation")[0],t=performance.memory;return{loadTime:e?e.loadEventEnd-e.loadEventStart:0,domContentLoaded:e?e.domContentLoadedEventEnd-e.domContentLoadedEventStart:0,memoryUsage:t?{used:Math.round(t.usedJSHeapSize/1024/1024),total:Math.round(t.totalJSHeapSize/1024/1024),limit:Math.round(t.jsHeapSizeLimit/1024/1024)}:null,timing:performance.now()}}async flushQueue(){if(!this.isProcessingQueue&&0!==this.eventQueue.length){this.isProcessingQueue=!0;try{const e=[...await this.storage.getItem("security_audit_log",!0)||[],...this.eventQueue].slice(-this.maxEventsInStorage),t=e.length>=this.config.compressionThreshold;await this.storage.setItem("security_audit_log",e,t),await this.updateAuditMetadata(e),this.eventQueue=[]}catch(e){this.eventQueue.length>this.maxEventsInMemory&&(this.eventQueue=this.eventQueue.slice(-Math.floor(this.maxEventsInMemory/2)))}finally{this.isProcessingQueue=!1}}}async updateAuditMetadata(e){const t={lastUpdated:(new Date).toISOString(),totalEvents:e.length,oldestEvent:e.length>0?e[0].timestamp.toISOString():null,newestEvent:e.length>0?e[e.length-1].timestamp.toISOString():null,sessionId:this.sessionId,eventTypes:[...new Set(e.map(e=>e.eventType))],sources:[...new Set(e.map(e=>e.source))],severityCounts:{critical:e.filter(e=>"critical"===e.severity).length,high:e.filter(e=>"high"===e.severity).length,medium:e.filter(e=>"medium"===e.severity).length,low:e.filter(e=>"low"===e.severity).length}};await this.storage.setItem("security_audit_metadata",t,!0)}async searchEvents(e={}){try{let t=await this.storage.getItem("security_audit_log",!0)||[];if(e.startDate&&(t=t.filter(t=>new Date(t.timestamp)>=e.startDate)),e.endDate&&(t=t.filter(t=>new Date(t.timestamp)<=e.endDate)),e.eventTypes&&e.eventTypes.length>0&&(t=t.filter(t=>e.eventTypes.includes(t.eventType))),e.severities&&e.severities.length>0&&(t=t.filter(t=>e.severities.includes(t.severity))),e.sources&&e.sources.length>0&&(t=t.filter(t=>e.sources.includes(t.source))),e.searchTerm){const i=e.searchTerm.toLowerCase();t=t.filter(e=>e.message.toLowerCase().includes(i)||e.eventType.toLowerCase().includes(i)||e.source.toLowerCase().includes(i))}return t.sort((e,t)=>new Date(t.timestamp).getTime()-new Date(e.timestamp).getTime())}catch(t){return[]}}async generateAuditReport(e,t){const i=new Date,s=e||new Date(i.getTime()-6048e5),n=t||i,a=await this.searchEvents({startDate:s,endDate:n}),r={critical:a.filter(e=>"critical"===e.severity).length,high:a.filter(e=>"high"===e.severity).length,medium:a.filter(e=>"medium"===e.severity).length,low:a.filter(e=>"low"===e.severity).length},o=new Map,c=new Map;a.forEach(e=>{o.set(e.eventType,(o.get(e.eventType)||0)+1),c.set(e.source,(c.get(e.source)||0)+1)});const l=Array.from(o.entries()).map(([e,t])=>({type:e,count:t})).sort((e,t)=>t.count-e.count).slice(0,10),u=Array.from(c.entries()).map(([e,t])=>({source:e,count:t})).sort((e,t)=>t.count-e.count).slice(0,10),d=this.calculateSeverityTrend(a,s,n),h=this.generateRecommendations(a,r);return{generatedAt:i,period:{start:s,end:n},summary:{totalEvents:a.length,criticalEvents:r.critical,highSeverityEvents:r.high,mediumSeverityEvents:r.medium,lowSeverityEvents:r.low,uniqueEventTypes:o.size,uniqueSources:c.size},topEventTypes:l,topSources:u,severityTrend:d,recommendations:h,events:a.slice(0,100)}}calculateSeverityTrend(e,t,i){const s=[];for(let n=new Date(t);n<=i;n.setTime(n.getTime()+864e5)){const t=n.toISOString().split("T")[0],i=e.filter(e=>e.timestamp.toISOString().split("T")[0]===t);s.push({date:t,critical:i.filter(e=>"critical"===e.severity).length,high:i.filter(e=>"high"===e.severity).length,medium:i.filter(e=>"medium"===e.severity).length,low:i.filter(e=>"low"===e.severity).length})}return s}generateRecommendations(e,t){const i=[];t.critical>0&&i.push("ğŸš¨ ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ™ãƒ³ãƒˆãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸã€‚å³åº§ã«å¯¾å¿œãŒå¿…è¦ã§ã™ã€‚");const s=new Map;e.forEach(e=>{s.set(e.eventType,(s.get(e.eventType)||0)+1)});const n=Array.from(s.entries()).filter(([,e])=>e>10).sort((e,t)=>t[1]-e[1]);return n.length>0&&i.push(`âš ï¸ é »ç™ºã™ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆ: ${n[0][0]} (${n[0][1]}å›)ã€‚ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’åˆ†æã—ã€æ ¹æœ¬åŸå› ã‚’èª¿æŸ»ã—ã¦ãã ã•ã„ã€‚`),e.filter(e=>e.eventType.includes("rate_limit")).length>20&&i.push("ğŸ›¡ï¸ å¤§é‡ã®ãƒ¬ãƒ¼ãƒˆåˆ¶é™é•åãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸã€‚ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹æ”»æ’ƒã®å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚"),e.filter(e=>e.eventType.includes("xss")||e.eventType.includes("script_injection")).length>0&&i.push("ğŸš« XSSæ”»æ’ƒã®è©¦è¡ŒãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸã€‚å…¥åŠ›æ¤œè¨¼ã¨CSPã®å¼·åŒ–ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚"),e.filter(e=>"devtools_opened"===e.eventType).length>50&&i.push("ğŸ”§ é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã®é »ç¹ãªä½¿ç”¨ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸã€‚æœ¬ç•ªç’°å¢ƒã§ã®ç›£è¦–ã‚’å¼·åŒ–ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™ã€‚"),0===i.length&&i.push("âœ… ç¾åœ¨ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£çŠ¶æ…‹ã¯è‰¯å¥½ã§ã™ã€‚ç¶™ç¶šçš„ãªç›£è¦–ã‚’ç¶šã‘ã¦ãã ã•ã„ã€‚"),i}startAutoFlush(){setInterval(()=>{this.eventQueue.length>0&&this.flushQueue()},this.config.autoFlushInterval)}setupUnloadHandler(){window.addEventListener("beforeunload",()=>{if(this.eventQueue.length>0)try{const e=[...JSON.parse(localStorage.getItem("security_audit_log")||"[]"),...this.eventQueue].slice(-this.maxEventsInStorage);localStorage.setItem("security_audit_log",JSON.stringify(e))}catch(e){try{const e=this.eventQueue.map(e=>({id:e.id,timestamp:e.timestamp,eventType:e.eventType,severity:e.severity,message:e.message}));localStorage.setItem("security_audit_emergency",JSON.stringify(e))}catch(t){}}})}async exportAuditLog(e="json"){const t=await this.storage.getItem("security_audit_log",!0)||[];if("json"===e)return JSON.stringify(t,null,2);const i=[["ID","Timestamp","Event Type","Severity","Source","Message","User Agent","Session ID"].join(",")];return t.forEach(e=>{const t=[e.id,e.timestamp.toISOString(),e.eventType,e.severity,e.source,`"${e.message.replace(/"/g,'""')}"`,`"${e.userAgent.replace(/"/g,'""')}"`,e.sessionId||""];i.push(t.join(","))}),i.join("\n")}async clearAuditLog(){try{await this.storage.removeItem("security_audit_log"),await this.storage.removeItem("security_audit_metadata"),this.eventQueue=[],await this.logSecurityEvent("audit_log_cleared","medium","security_audit_logger","ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»ãƒ­ã‚°ãŒã‚¯ãƒªã‚¢ã•ã‚Œã¾ã—ãŸ",{clearedAt:(new Date).toISOString(),sessionId:this.sessionId})}catch(e){throw e}}updateConfig(e){this.config={...this.config,...e}}getConfig(){return{...this.config}}async getStatistics(){const e=await this.storage.getItem("security_audit_metadata",!0);return{queueSize:this.eventQueue.length,totalEventsLogged:e?.totalEvents||0,oldestEvent:e?.oldestEvent||null,newestEvent:e?.newestEvent||null,sessionId:this.sessionId}}};i(Ls,"instance");let Ps=Ls;if("undefined"!=typeof window){const e=Ps.getInstance();if(window.addEventListener("error",t=>{e.logSecurityEvent("javascript_error","medium","global_error_handler",`JavaScriptã‚¨ãƒ©ãƒ¼: ${t.message}`,{filename:t.filename,lineno:t.lineno,colno:t.colno,error:t.error?.toString()})}),window.addEventListener("unhandledrejection",t=>{e.logSecurityEvent("unhandled_promise_rejection","medium","global_promise_handler",`æœªå‡¦ç†ã®Promise rejection: ${t.reason}`,{reason:t.reason?.toString(),stack:t.reason?.stack})}),"undefined"!=typeof console&&console.error){const t=console.error;console.originalError=t;let i=0,s=Date.now();const n=30;console.error=function(...a){const r=Date.now();r-s>6e4&&(i=0,s=r);const o=a.join(" ");o.includes("Error rate limit exceeded")||o.includes("ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ™ãƒ³ãƒˆã®ãƒ­ã‚°è¨˜éŒ²ã«å¤±æ•—")||o.includes("ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ­ã‚°ã®ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã«å¤±æ•—")||i>=n||(i++,setTimeout(()=>{e.logSecurityEvent("console_error","low","console_override",`Console Error: ${o.substring(0,200)}`,{args:a.slice(0,3),count:i})},0)),t.apply(console,a)}}}const Rs=class e{constructor(){i(this,"config"),i(this,"apiKeys",new Map),i(this,"requestCache",new Map),i(this,"auditLogger",Ps.getInstance()),i(this,"securityMonitor",ys.getInstance()),this.config={enforceHTTPS:!0,allowedOrigins:[window.location.origin,"https://shishihs.github.io"],allowedMethods:["GET","POST","PUT","DELETE","OPTIONS"],maxRequestSize:10485760,rateLimitConfig:{windowMs:6e4,maxRequests:100,blockDurationMs:3e5},requireAPIKey:!1,enableRequestSigning:!1,corsPreflightMaxAge:86400}}static getInstance(){return e.instance||(e.instance=new e),e.instance}updateConfig(e){this.config={...this.config,...e},this.auditLogger.logSecurityEvent("api_security_config_updated","low","api_security_manager","API ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šãŒæ›´æ–°ã•ã‚Œã¾ã—ãŸ",{updatedFields:Object.keys(e)})}enforceHTTPS(e){if(!this.config.enforceHTTPS)return!0;const t=new URL(e.url);return!("https:"!==t.protocol&&"localhost"!==t.hostname&&"127.0.0.1"!==t.hostname&&(this.auditLogger.logSecurityEvent("insecure_api_request_blocked","high","api_security_manager",`éHTTPS ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ãƒ–ãƒ­ãƒƒã‚¯: ${e.url}`,{url:e.url,method:e.method,protocol:t.protocol}),1))}validateCORS(e,t){const i=t||e.headers.get("Origin");if(!i)return!0;const s=this.config.allowedOrigins.some(e=>{if("*"===e)return!0;if(e===i)return!0;if(e.startsWith("*.")){const t=e.slice(2);return i.endsWith(t)}return!1});return s||this.auditLogger.logSecurityEvent("cors_violation","high","api_security_manager","CORS é•å: è¨±å¯ã•ã‚Œã¦ã„ãªã„ã‚ªãƒªã‚¸ãƒ³ã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆ",{origin:i,allowedOrigins:this.config.allowedOrigins,url:e.url,method:e.method}),s}validateMethod(e){const t=this.config.allowedMethods.includes(e.method.toUpperCase());return t||this.auditLogger.logSecurityEvent("invalid_http_method","medium","api_security_manager",`è¨±å¯ã•ã‚Œã¦ã„ãªã„HTTPãƒ¡ã‚½ãƒƒãƒ‰: ${e.method}`,{method:e.method,allowedMethods:this.config.allowedMethods,url:e.url}),t}async validateRequestSize(e){const t=e.headers.get("Content-Length");let i=0;if(t)i=parseInt(t,10);else if(e.body)try{const t=e.clone(),s=await t.text();i=new Blob([s]).size}catch(n){return this.auditLogger.logSecurityEvent("request_size_validation_error","medium","api_security_manager","ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚µã‚¤ã‚ºã®æ¤œè¨¼ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿ",{error:n instanceof Error?n.message:String(n)}),!1}const s=i<=this.config.maxRequestSize;return s||this.auditLogger.logSecurityEvent("oversized_request_blocked","high","api_security_manager",`ã‚µã‚¤ã‚ºåˆ¶é™ã‚’è¶…ãˆã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ãƒ–ãƒ­ãƒƒã‚¯: ${i} bytes`,{requestSize:i,maxSize:this.config.maxRequestSize,url:e.url,method:e.method}),s}checkRateLimit(e){const t=Date.now(),i=t-this.config.rateLimitConfig.windowMs,s=this.getRequestTimes(e).filter(e=>e>i),n=s.length<this.config.rateLimitConfig.maxRequests;return n?(s.push(t),this.setRequestTimes(e,s)):(this.auditLogger.logSecurityEvent("api_rate_limit_exceeded","high","api_security_manager",`API ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã‚’è¶…é: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ ${e}`,{clientId:e,requestCount:s.length,maxRequests:this.config.rateLimitConfig.maxRequests,windowMs:this.config.rateLimitConfig.windowMs}),this.setClientBlock(e,t+this.config.rateLimitConfig.blockDurationMs)),n}isClientBlocked(e){const t=this.getClientBlockTime(e),i=Date.now();return!!(t&&i<t)||(t&&i>=t&&this.clearClientBlock(e),!1)}generateAPIKey(e=[],t=720){const i=pt(16),s=pt(64),n=new Date(Date.now()+60*t*60*1e3),a={keyId:i,keyValue:s,permissions:e,expiresAt:n,usageCount:0,rateLimit:{maxRequestsPerMinute:60,maxRequestsPerHour:1e3}};return this.apiKeys.set(i,a),this.auditLogger.logSecurityEvent("api_key_generated","low","api_security_manager",`æ–°ã—ã„APIã‚­ãƒ¼ãŒç”Ÿæˆã•ã‚Œã¾ã—ãŸ: ${i}`,{keyId:i,permissions:e,expiresAt:n.toISOString()}),a}validateAPIKey(e,t,i){const s=this.apiKeys.get(e);return s?new Date>s.expiresAt?(this.auditLogger.logSecurityEvent("expired_api_key","medium","api_security_manager",`æœŸé™åˆ‡ã‚Œã®APIã‚­ãƒ¼: ${e}`,{keyId:e,expiresAt:s.expiresAt.toISOString()}),!1):s.keyValue!==t?(this.auditLogger.logSecurityEvent("api_key_mismatch","high","api_security_manager",`APIã‚­ãƒ¼å€¤ã®ä¸ä¸€è‡´: ${e}`,{keyId:e}),!1):i&&!s.permissions.includes(i)?(this.auditLogger.logSecurityEvent("insufficient_api_permissions","medium","api_security_manager",`ä¸ååˆ†ãªAPIæ¨©é™: ${e}, å¿…è¦ãªæ¨©é™: ${i}`,{keyId:e,requiredPermission:i,availablePermissions:s.permissions}),!1):!!this.checkAPIKeyRateLimit(e)&&(s.usageCount++,s.lastUsed=new Date,!0):(this.auditLogger.logSecurityEvent("invalid_api_key","high","api_security_manager",`ç„¡åŠ¹ãªAPIã‚­ãƒ¼ID: ${e}`,{keyId:e}),!1)}async signRequest(e,t,i="",s){const n=Date.now(),a=pt(16),r=`${e}\n${t}\n${n}\n${a}\n${i}`;return{method:e,url:t,timestamp:n,nonce:a,signature:await yt(r+s),payload:i||void 0}}async verifyRequestSignature(e,t,i=3e5){const s=Date.now();if(s-e.timestamp>i)return this.auditLogger.logSecurityEvent("expired_request_signature","medium","api_security_manager","æœŸé™åˆ‡ã‚Œã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆç½²å",{timestamp:e.timestamp,currentTime:s,maxAge:i}),!1;const n=`nonce_${e.nonce}`;if(this.requestCache.has(n))return this.auditLogger.logSecurityEvent("duplicate_nonce","high","api_security_manager","nonce ã®é‡è¤‡æ¤œå‡ºï¼ˆãƒªãƒ—ãƒ¬ã‚¤æ”»æ’ƒã®å¯èƒ½æ€§ï¼‰",{nonce:e.nonce}),!1;const a=`${e.method}\n${e.url}\n${e.timestamp}\n${e.nonce}\n${e.payload||""}`,r=await yt(a+t),o=r===e.signature;return o?(this.requestCache.set(n,e.timestamp),this.cleanupOldNonces(i)):this.auditLogger.logSecurityEvent("invalid_request_signature","high","api_security_manager","ç„¡åŠ¹ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆç½²å",{expectedSignature:`${r.slice(0,16)}...`,providedSignature:`${e.signature.slice(0,16)}...`}),o}async validateRequest(e,t,i,s){const n=[],a=[];try{this.enforceHTTPS(e)||n.push("HTTPS required"),this.validateCORS(e)||n.push("CORS violation"),this.validateMethod(e)||n.push("Invalid HTTP method"),await this.validateRequestSize(e)||n.push("Request too large"),t&&this.isClientBlocked(t)?n.push("Client is temporarily blocked"):t&&!this.checkRateLimit(t)&&n.push("Rate limit exceeded"),this.config.requireAPIKey&&(i&&s?this.validateAPIKey(i,s)||n.push("Invalid API key"):n.push("API key required"));const r=this.validateSecurityHeaders(e);r.warnings.length>0&&a.push(...r.warnings)}catch(r){this.auditLogger.logSecurityEvent("request_validation_error","high","api_security_manager","ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ¤œè¨¼ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿ",{error:r instanceof Error?r.message:String(r),url:e.url,method:e.method}),n.push("Internal validation error")}return{isValid:0===n.length,errors:n,warnings:a}}validateSecurityHeaders(e){const t=[],i=e.headers.get("Content-Type");return"GET"===e.method||"HEAD"===e.method||i||t.push("Missing Content-Type header"),e.headers.get("User-Agent")||t.push("Missing User-Agent header"),{warnings:t}}getRequestTimes(e){const t=localStorage.getItem(`rate_limit_${e}`);return t?JSON.parse(t):[]}setRequestTimes(e,t){localStorage.setItem(`rate_limit_${e}`,JSON.stringify(t))}getClientBlockTime(e){const t=localStorage.getItem(`block_${e}`);return t?parseInt(t,10):null}setClientBlock(e,t){localStorage.setItem(`block_${e}`,t.toString())}clearClientBlock(e){localStorage.removeItem(`block_${e}`)}checkAPIKeyRateLimit(e){return this.securityMonitor.checkRateLimit(`api_key_${e}`,60,6e4)}cleanupOldNonces(e){const t=Date.now()-e;for(const[i,s]of this.requestCache.entries())s<t&&this.requestCache.delete(i)}};i(Rs,"instance");const Ds=Rs.getInstance(),Ms=class e{constructor(){i(this,"configs",new Map),i(this,"clientProfiles",new Map),i(this,"requestHistory",new Map),i(this,"blockedClients",new Map),i(this,"auditLogger",Ps.getInstance()),i(this,"securityMonitor",ys.getInstance()),i(this,"ddosMetrics",{totalRequests:0,uniqueClients:0,suspiciousClients:0,blockedRequests:0,avgResponseTime:0,systemLoad:0}),this.initializeDefaultConfigs(),this.startBackgroundTasks()}static getInstance(){return e.instance||(e.instance=new e),e.instance}initializeDefaultConfigs(){this.configs.set("default",{windowMs:6e4,maxRequests:60,blockDurationMs:3e5,adaptiveScaling:!0,burstAllowance:10,penaltyMultiplier:2}),this.configs.set("api",{windowMs:6e4,maxRequests:30,blockDurationMs:6e5,adaptiveScaling:!0,burstAllowance:5,penaltyMultiplier:3}),this.configs.set("auth",{windowMs:6e4,maxRequests:5,blockDurationMs:18e5,adaptiveScaling:!1,burstAllowance:2,penaltyMultiplier:5})}checkRateLimit(e,t="default",i){const s=Date.now(),n=this.configs.get(t)||this.configs.get("default");let a=this.clientProfiles.get(e);a||(a=this.initializeClientProfile(e),this.clientProfiles.set(e,a));const r=this.blockedClients.get(e);if(r&&s<r)return this.ddosMetrics.blockedRequests++,{allowed:!1,remainingRequests:0,resetTime:new Date(r),riskScore:a.riskScore,blockReason:"Temporarily blocked due to rate limit violation"};this.updateRequestHistory(e,s,i),this.analyzeBehaviorPattern(e,i),this.updateRiskScore(e,i);const o=this.calculateAdaptiveLimit(e,n),c=s-n.windowMs,l=this.getRecentRequests(e,c).length,u=l<o+n.burstAllowance;return this.ddosMetrics.totalRequests++,u?{allowed:!0,remainingRequests:Math.max(0,o-l),resetTime:new Date(s+n.windowMs),riskScore:a.riskScore}:(this.handleRateLimitViolation(e,t,l,o),this.ddosMetrics.blockedRequests++,{allowed:!1,remainingRequests:0,resetTime:new Date(s+n.blockDurationMs),riskScore:a.riskScore,blockReason:"Rate limit exceeded"})}initializeClientProfile(e){return{riskScore:0,threatLevel:"none",violations:[],adaptiveLimit:60,lastActivity:new Date,behaviorPattern:{requestFrequency:[],userAgentConsistency:1,geographicConsistency:1,sessionDuration:0,interactionQuality:.5,humanLikelihood:.5}}}updateRequestHistory(e,t,i){const s=this.requestHistory.get(e)||[];s.push(t);const n=t-864e5,a=s.filter(e=>e>n);this.requestHistory.set(e,a);const r=this.clientProfiles.get(e);r&&(r.lastActivity=new Date(t))}analyzeBehaviorPattern(e,t){const i=this.clientProfiles.get(e);if(!i)return;const s=this.requestHistory.get(e)||[];if(s.length<2)return;const n=[];for(let a=1;a<s.length;a++)n.push(s[a]-s[a-1]);i.behaviorPattern.requestFrequency=n.slice(-20),i.behaviorPattern.humanLikelihood=this.calculateHumanLikelihood(n),t?.userAgent&&(i.behaviorPattern.userAgentConsistency=1),s.length>0&&(i.behaviorPattern.sessionDuration=Date.now()-s[0])}calculateHumanLikelihood(e){if(e.length<5)return.5;const t=e.reduce((e,t)=>e+t,0)/e.length,i=e.reduce((e,i)=>e+(i-t)**2,0)/e.length,s=Math.sqrt(i)/t;return s<.1||s>2?.1:Math.min(1,Math.max(0,1-Math.abs(s-.65)/.65))}updateRiskScore(e,t){const i=this.clientProfiles.get(e);if(!i)return;let s=0;(this.requestHistory.get(e)||[]).length>100&&(s+=10),i.behaviorPattern.humanLikelihood<.3&&(s+=20),s+=15*i.violations.filter(e=>Date.now()-e.timestamp.getTime()<36e5).length,t?.ipAddress&&this.isKnownMaliciousIP(t.ipAddress)&&(s+=50),i.riskScore=Math.min(100,s),i.threatLevel=s>=80?"critical":s>=60?"high":s>=40?"medium":s>=20?"low":"none"}calculateAdaptiveLimit(e,t){if(!t.adaptiveScaling)return t.maxRequests;const i=this.clientProfiles.get(e);if(!i)return t.maxRequests;let s=1;i.riskScore>50?s*=.5:i.riskScore<20&&(s*=1.2);const n=i.behaviorPattern.humanLikelihood;n>.8?s*=1.1:n<.3&&(s*=.6),this.ddosMetrics.systemLoad>.8&&(s*=.7);const a=Math.floor(t.maxRequests*s);return i.adaptiveLimit=Math.max(1,Math.min(2*t.maxRequests,a)),i.adaptiveLimit}handleRateLimitViolation(e,t,i,s){const n=this.configs.get(t),a=this.clientProfiles.get(e),r={timestamp:new Date,type:"rate_limit",severity:i>2*s?"high":"medium",details:{configName:t,requestCount:i,limit:s,riskScore:a.riskScore}};a.violations.push(r);const o=Date.now()-864e5;a.violations=a.violations.filter(e=>e.timestamp.getTime()>o);const c=a.violations.filter(e=>Date.now()-e.timestamp.getTime()<36e5);let l=n.blockDurationMs;c.length>1&&(l*=n.penaltyMultiplier**(c.length-1)),l=Math.min(l,864e5),this.blockedClients.set(e,Date.now()+l),this.auditLogger.logSecurityEvent("advanced_rate_limit_violation",r.severity,"advanced_rate_limiter",`é«˜åº¦ãƒ¬ãƒ¼ãƒˆåˆ¶é™é•å: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ ${e}`,{clientId:e,configName:t,requestCount:i,limit:s,blockDuration:l,riskScore:a.riskScore,threatLevel:a.threatLevel,recentViolations:c.length}),"critical"===a.threatLevel&&this.handleCriticalThreat(e)}handleCriticalThreat(e){this.blockedClients.set(e,Date.now()+864e5),this.auditLogger.logSecurityEvent("critical_threat_detected","critical","advanced_rate_limiter",`é‡å¤§è„…å¨ã‚’æ¤œå‡º: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ ${e}`,{clientId:e,action:"long_term_block",duration:"24_hours"}),this.investigateRelatedClients(e)}detectDDoSAttack(){const e=Date.now(),t=[];let i=0;const s=new Set;let n=0;for(const[l,u]of this.requestHistory.entries()){const t=u.filter(t=>e-t<3e5);if(i+=t.length,t.length>0){s.add(l);const e=this.clientProfiles.get(l);e&&"none"!==e.threatLevel&&n++}}this.ddosMetrics={totalRequests:i,uniqueClients:s.size,suspiciousClients:n,blockedRequests:this.ddosMetrics.blockedRequests,avgResponseTime:this.calculateAverageResponseTime(),systemLoad:this.calculateSystemLoad()};let a="none",r=!1;const o=i/300,c=s.size>0?n/s.size:0;return o>100?(r=!0,a="critical",t.push("ç·Šæ€¥ï¼šãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯åˆ¶é™ã‚’ç›´ã¡ã«å®Ÿæ–½"),t.push("CDN/WAFã§ã®è¿½åŠ ä¿è­·ã‚’æœ‰åŠ¹åŒ–")):o>50?(r=!0,a="high",t.push("ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã‚’å¼·åŒ–"),t.push("ç–‘ã‚ã—ã„IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ãƒ–ãƒ­ãƒƒã‚¯")):o>20||c>.3?(r=!0,a="medium",t.push("ç›£è¦–ã‚’å¼·åŒ–ã—ã€ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’åˆ†æ")):c>.1&&(a="low",t.push("ç¶™ç¶šçš„ãªç›£è¦–ã‚’å®Ÿæ–½")),this.ddosMetrics.avgResponseTime>5e3&&(r=!0,"none"===a&&(a="medium"),t.push("ã‚·ã‚¹ãƒ†ãƒ ãƒªã‚½ãƒ¼ã‚¹ã®èª¿æŸ»ãŒå¿…è¦")),r&&this.auditLogger.logSecurityEvent("ddos_attack_detected",a,"advanced_rate_limiter",`DDoSæ”»æ’ƒã‚’æ¤œçŸ¥: ${a} ãƒ¬ãƒ™ãƒ«`,{metrics:this.ddosMetrics,attackSeverity:a,recommendations:t}),{isUnderAttack:r,attackSeverity:a,metrics:this.ddosMetrics,recommendations:t}}manageAutoBlockList(){const e=Date.now(),t=[];for(const[i,s]of this.clientProfiles.entries())"critical"===s.threatLevel&&(t.push(i),this.blockedClients.has(i)||this.blockedClients.set(i,e+864e5)),e-s.lastActivity.getTime()>6048e5&&(this.clientProfiles.delete(i),this.requestHistory.delete(i));for(const[i,s]of this.blockedClients.entries())e>s&&this.blockedClients.delete(i);t.length>0&&this.auditLogger.logSecurityEvent("auto_block_list_updated","medium","advanced_rate_limiter",`è‡ªå‹•ãƒ–ãƒ­ãƒƒã‚¯ãƒªã‚¹ãƒˆã‚’æ›´æ–°: ${t.length}å€‹ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ`,{blockedClients:t})}getRecentRequests(e,t){return(this.requestHistory.get(e)||[]).filter(e=>e>t)}isKnownMaliciousIP(e){return["192.168.1.100"].includes(e)}investigateRelatedClients(e){this.auditLogger.logSecurityEvent("related_client_investigation","medium","advanced_rate_limiter",`é–¢é€£ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®èª¿æŸ»ã‚’é–‹å§‹: ${e}`,{sourceClient:e})}calculateAverageResponseTime(){return 1e3*Math.random()}calculateSystemLoad(){return.8*Math.random()}startBackgroundTasks(){setInterval(()=>{this.detectDDoSAttack()},3e5),setInterval(()=>{this.manageAutoBlockList()},6e5),setInterval(()=>{this.ddosMetrics.blockedRequests=0},36e5)}getStatistics(){const e=Date.now(),t=Array.from(this.clientProfiles.values()).filter(t=>e-t.lastActivity.getTime()<3e5).length,i=Array.from(this.clientProfiles.entries()).map(([e,t])=>({clientId:e,riskScore:t.riskScore,threatLevel:t.threatLevel})).sort((e,t)=>t.riskScore-e.riskScore).slice(0,10);return{totalClients:this.clientProfiles.size,activeClients:t,blockedClients:this.blockedClients.size,ddosMetrics:this.ddosMetrics,topRiskClients:i}}};i(Ms,"instance");const Os=Ms.getInstance(),$s=class e{constructor(){i(this,"config"),i(this,"activeSessions",new Map),i(this,"userSessions",new Map),i(this,"deviceRegistry",new Map),i(this,"auditLogger",Ps.getInstance()),i(this,"storage",vt()),this.config={maxAge:288e5,renewalThresholdMs:18e5,maxConcurrentSessions:3,requireSecureCookie:!0,enableSessionFingerprinting:!0,enableDeviceTracking:!0},this.loadPersistedSessions(),this.startSessionMaintenance()}static getInstance(){return e.instance||(e.instance=new e),e.instance}updateConfig(e){this.config={...this.config,...e},this.auditLogger.logSecurityEvent("session_config_updated","low","session_manager","ã‚»ãƒƒã‚·ãƒ§ãƒ³è¨­å®šãŒæ›´æ–°ã•ã‚Œã¾ã—ãŸ",{updatedFields:Object.keys(e)})}async createSession(e,t,i=[],s=[],n){const a=new Date,r=await this.generateSessionId(),o=n?.fingerprint||await this.generateDeviceFingerprint();await this.enforceSessionLimits(e),this.config.enableDeviceTracking&&await this.registerDevice(o,n);const c={sessionId:r,userId:e,email:t,roles:i,permissions:s,createdAt:a,lastActivity:a,expiresAt:new Date(a.getTime()+this.config.maxAge),deviceFingerprint:o,ipAddress:this.getCurrentIPAddress(),userAgent:navigator.userAgent,isActive:!0,metadata:{}};this.activeSessions.set(r,c);const l=this.userSessions.get(e)||[];return l.push(r),this.userSessions.set(e,l),await this.persistSession(c),this.auditLogger.logSecurityEvent("session_created","low","session_manager",`æ–°ã—ã„ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒä½œæˆã•ã‚Œã¾ã—ãŸ: ãƒ¦ãƒ¼ã‚¶ãƒ¼ ${e}`,{sessionId:r,userId:e,email:t,roles:i,deviceFingerprint:`${o.slice(0,8)}...`,expiresAt:c.expiresAt.toISOString()}),c}async validateSession(e){const t=[],i=this.activeSessions.get(e);if(!i)return t.push("Session not found"),{valid:!1,errors:t};if(!i.isActive)return t.push("Session is inactive"),{valid:!1,errors:t};if(new Date>i.expiresAt)return t.push("Session expired"),await this.invalidateSession(e,"expired"),{valid:!1,errors:t};if(this.config.enableSessionFingerprinting){const s=await this.generateDeviceFingerprint();if(i.deviceFingerprint!==s)return t.push("Device fingerprint mismatch"),this.auditLogger.logSecurityEvent("session_fingerprint_mismatch","high","session_manager","ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ãƒ‡ãƒã‚¤ã‚¹ãƒ•ã‚£ãƒ³ã‚¬ãƒ¼ãƒ—ãƒªãƒ³ãƒˆãŒä¸€è‡´ã—ã¾ã›ã‚“",{sessionId:e,userId:i.userId,storedFingerprint:`${i.deviceFingerprint.slice(0,8)}...`,currentFingerprint:`${s.slice(0,8)}...`}),await this.invalidateSession(e,"security_violation"),{valid:!1,errors:t}}return i.lastActivity=new Date,await this.persistSession(i),i.expiresAt.getTime()-Date.now()<this.config.renewalThresholdMs&&await this.renewSession(e),{valid:!0,session:i,errors:[]}}async renewSession(e){const t=this.activeSessions.get(e);if(!t?.isActive)return!1;const i=new Date;return t.expiresAt=new Date(i.getTime()+this.config.maxAge),t.lastActivity=i,await this.persistSession(t),this.auditLogger.logSecurityEvent("session_renewed","low","session_manager",`ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒæ›´æ–°ã•ã‚Œã¾ã—ãŸ: ${e}`,{sessionId:e,userId:t.userId,newExpiresAt:t.expiresAt.toISOString()}),!0}async invalidateSession(e,t="manual"){const i=this.activeSessions.get(e);if(!i)return!1;i.isActive=!1;const s=(this.userSessions.get(i.userId)||[]).filter(t=>t!==e);return 0===s.length?this.userSessions.delete(i.userId):this.userSessions.set(i.userId,s),this.activeSessions.delete(e),await this.storage.removeItem(`session_${e}`),this.auditLogger.logSecurityEvent("session_invalidated","low","session_manager",`ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒç„¡åŠ¹åŒ–ã•ã‚Œã¾ã—ãŸ: ${e}`,{sessionId:e,userId:i.userId,reason:t,duration:Date.now()-i.createdAt.getTime()}),!0}async invalidateAllUserSessions(e,t="manual"){const i=this.userSessions.get(e)||[];let s=0;for(const n of i)await this.invalidateSession(n,t)&&s++;return this.auditLogger.logSecurityEvent("all_user_sessions_invalidated","medium","session_manager",`ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¨ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒç„¡åŠ¹åŒ–ã•ã‚Œã¾ã—ãŸ: ${e}`,{userId:e,reason:t,invalidatedCount:s}),s}async enforceSessionLimits(e){const t=this.userSessions.get(e)||[];if(t.length>=this.config.maxConcurrentSessions){const i=t.slice(0,t.length-this.config.maxConcurrentSessions+1);for(const e of i)await this.invalidateSession(e,"session_limit_exceeded");this.auditLogger.logSecurityEvent("session_limit_enforced","medium","session_manager",`ã‚»ãƒƒã‚·ãƒ§ãƒ³åˆ¶é™ã‚’é©ç”¨ã—ã¾ã—ãŸ: ãƒ¦ãƒ¼ã‚¶ãƒ¼ ${e}`,{userId:e,removedSessions:i.length,maxSessions:this.config.maxConcurrentSessions})}}async registerDevice(e,t){const i=this.deviceRegistry.get(e),s=new Date,n={fingerprint:e,userAgent:t?.userAgent||navigator.userAgent,screen:t?.screen||{width:screen.width,height:screen.height},timezone:t?.timezone||Intl.DateTimeFormat().resolvedOptions().timeZone,language:t?.language||navigator.language,platform:t?.platform||navigator.platform,trusted:i?.trusted||!1,lastSeen:s};this.deviceRegistry.set(e,n),i||this.auditLogger.logSecurityEvent("new_device_registered","low","session_manager","æ–°ã—ã„ãƒ‡ãƒã‚¤ã‚¹ãŒç™»éŒ²ã•ã‚Œã¾ã—ãŸ",{fingerprint:`${e.slice(0,8)}...`,userAgent:`${n.userAgent.slice(0,50)}...`,platform:n.platform,timezone:n.timezone})}async generateDeviceFingerprint(){const e=[navigator.userAgent,navigator.language,navigator.platform,screen.width.toString(),screen.height.toString(),screen.colorDepth.toString(),(new Date).getTimezoneOffset().toString(),navigator.hardwareConcurrency?.toString()||"0",navigator.maxTouchPoints?.toString()||"0"];try{const t=document.createElement("canvas"),i=t.getContext("2d");i&&(i.textBaseline="top",i.font="14px Arial",i.fillText("Device fingerprint",2,2),e.push(t.toDataURL()))}catch{}return await yt(e.join("|"))}async generateSessionId(){const e=pt(32),t=Date.now().toString(36);return`ses_${t}_${(await yt(e+t)).slice(0,16)}_${e.slice(0,16)}`}async persistSession(e){try{await this.storage.setItem(`session_${e.sessionId}`,{...e,createdAt:e.createdAt.toISOString(),lastActivity:e.lastActivity.toISOString(),expiresAt:e.expiresAt.toISOString()},!0)}catch(t){this.auditLogger.logSecurityEvent("session_persistence_failed","medium","session_manager","ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®æ°¸ç¶šåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ",{sessionId:e.sessionId,error:t instanceof Error?t.message:String(t)})}}async loadPersistedSessions(){}startSessionMaintenance(){setInterval(async()=>{await this.cleanupExpiredSessions()},3e5),setInterval(()=>{this.logSessionStatistics()},36e5)}async cleanupExpiredSessions(){const e=new Date;let t=0;for(const[i,s]of this.activeSessions.entries())(e>s.expiresAt||!s.isActive)&&(await this.invalidateSession(i,"expired"),t++);t>0&&this.auditLogger.logSecurityEvent("expired_sessions_cleaned","low","session_manager",`æœŸé™åˆ‡ã‚Œã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã—ã¾ã—ãŸ: ${t}å€‹`,{cleanedCount:t})}logSessionStatistics(){const e=this.getSessionStatistics();this.auditLogger.logSecurityEvent("session_statistics","low","session_manager","ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ±è¨ˆ",e)}getCurrentIPAddress(){return"127.0.0.1"}getSessionStatistics(){const e=new Date;let t=0;const i={},s=new Map;for(const[,r]of this.activeSessions.entries())if(r.isActive){t+=e.getTime()-r.createdAt.getTime();const n=this.classifyDevice(r.userAgent);i[n]=(i[n]||0)+1,s.set(r.userId,(s.get(r.userId)||0)+1)}const n=this.activeSessions.size>0?t/this.activeSessions.size:0,a=Array.from(s.entries()).map(([e,t])=>({userId:e,sessionCount:t})).sort((e,t)=>t.sessionCount-e.sessionCount).slice(0,10);return{totalActiveSessions:this.activeSessions.size,totalUsers:this.userSessions.size,averageSessionDuration:n,deviceTypes:i,topUsersBySessionCount:a}}classifyDevice(e){return/Mobile|Android|iPhone|iPad/.test(e)?"mobile":e.includes("Tablet")?"tablet":"desktop"}getSession(e){return this.activeSessions.get(e)||null}getUserSessions(e){return(this.userSessions.get(e)||[]).map(e=>this.activeSessions.get(e)).filter(e=>Boolean(e)&&e.isActive)}};i($s,"instance");const Ns=$s.getInstance(),Fs=class e{constructor(){i(this,"config"),i(this,"errorLog",new Map),i(this,"auditLogger",Ps.getInstance()),i(this,"sensitivePatterns"),this.config={exposeStackTrace:!1,maxErrorMessageLength:500,sensitiveDataPatterns:[],logIntegrityCheck:!0,errorSanitization:!0,clientErrorReporting:!0,serverErrorReporting:!1},this.initializeSensitivePatterns(),this.setupGlobalErrorHandlers()}static getInstance(){return e.instance||(e.instance=new e),e.instance}initializeSensitivePatterns(){this.sensitivePatterns=[/\b4[0-9]{12}(?:[0-9]{3})?\b/g,/\b5[1-5][0-9]{14}\b/g,/\b3[47][0-9]{13}\b/g,/\b\d{3}-\d{2}-\d{4}\b/g,/\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b/g,/password[=:\s]*['"]*([^'"\s]+)['"]*\s*/gi,/pass[=:\s]*['"]*([^'"\s]+)['"]*\s*/gi,/token[=:\s]*['"]*([^'"\s]+)['"]*\s*/gi,/key[=:\s]*['"]*([^'"\s]+)['"]*\s*/gi,/secret[=:\s]*['"]*([^'"\s]+)['"]*\s*/gi,/\b(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\b/g,/eyJ[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+/g,/[C-Z]:\\(?:[^\\/:*?"<>|\r\n]+\\?)*[^\\/:*?"<>|\r\n]*/g,/\/(?:home|root|etc|var)\/[^\s]*/g,/(?:mongodb|mysql|postgres|redis):\/\/[^\s]*/gi,/(?:api[_-]?key|apikey)[=:\s]*['"]*([^'"\s]+)['"]*\s*/gi,/(?:session[_-]?id|sessionid)[=:\s]*['"]*([^'"\s]+)['"]*\s*/gi]}setupGlobalErrorHandlers(){window.addEventListener("error",e=>{this.handleError(e.error||new Error(e.message),{component:"global_javascript",url:e.filename,additionalContext:{lineNumber:e.lineno,columnNumber:e.colno}})}),window.addEventListener("unhandledrejection",e=>{this.handleError(new Error(`Unhandled Promise Rejection: ${e.reason}`),{component:"global_promise",additionalContext:{reason:this.sanitizeValue(String(e.reason))}})}),window.addEventListener("error",e=>{e.target&&e.target!==window&&this.handleError(new Error(`Resource loading failed: ${e.target.src||e.target.href}`),{component:"resource_loading",additionalContext:{tagName:e.target.tagName,src:this.sanitizeValue(e.target.src||e.target.href)}})},!0)}async handleError(e,t={component:"unknown"}){const i=pt(16),s=new Date;let n;n=e instanceof Error?e:new Error(String(e));const a=this.sanitizeErrorMessage(n.message);let r;this.config.exposeStackTrace&&n.stack&&(r=this.sanitizeStackTrace(n.stack));const o=this.determineSeverity(n,t),c=this.generateUserFriendlyMessage(n,o),l=this.sanitizeContext(t),u={id:i,message:a,code:this.generateErrorCode(n),severity:o,timestamp:s,context:l,stackTrace:r,hash:"",userFriendlyMessage:c};return this.config.logIntegrityCheck&&(u.hash=await this.calculateErrorHash(u)),this.errorLog.set(i,u),await this.auditLogger.logSecurityEvent("error_handled",o,"secure_error_handler",`ã‚¨ãƒ©ãƒ¼ãŒå‡¦ç†ã•ã‚Œã¾ã—ãŸ: ${u.code}`,{errorId:i,component:t.component,severity:o,code:u.code,message:a.slice(0,100),userId:t.userId,sessionId:t.sessionId}),"critical"!==o&&"high"!==o||await this.handleCriticalError(u),this.config.clientErrorReporting&&await this.generateErrorReport(u),u}sanitizeErrorMessage(e){if(!this.config.errorSanitization)return e;let t=e;for(const i of this.sensitivePatterns)t=t.replace(i,"[REDACTED]");return t.length>this.config.maxErrorMessageLength&&(t=`${t.slice(0,this.config.maxErrorMessageLength)}...`),t=t.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/&/g,"&amp;"),t}sanitizeStackTrace(e){let t=e;t=t.replace(/([C-Z]:\\|\/)[^\s\n]*/g,"[FILE_PATH]");for(const i of this.sensitivePatterns)t=t.replace(i,"[REDACTED]");{const e=t.split("\n");e.length>10&&(t=`${e.slice(0,10).join("\n")}\n... (truncated)`)}return t}sanitizeContext(e){const t={...e};return t.userId&&(t.userId=this.hashSensitiveData(t.userId)),t.sessionId&&(t.sessionId=this.hashSensitiveData(t.sessionId)),t.url&&(t.url=this.sanitizeURL(t.url)),t.additionalContext&&(t.additionalContext=this.sanitizeObject(t.additionalContext)),t}sanitizeURL(e){try{const t=new URL(e),i=new URLSearchParams;for(const[e,s]of t.searchParams.entries())this.isSensitiveParameter(e)?i.set(e,"[REDACTED]"):i.set(e,this.sanitizeValue(s));return t.search=i.toString(),t.toString()}catch{return this.sanitizeValue(e)}}isSensitiveParameter(e){return["token","key","secret","password","pass","auth","session","sid","csrf","api_key","access_token","refresh_token","authorization"].some(t=>e.toLowerCase().includes(t))}sanitizeObject(e){const t={};for(const[i,s]of Object.entries(e))this.isSensitiveParameter(i)?t[i]="[REDACTED]":"string"==typeof s?t[i]=this.sanitizeValue(s):"object"==typeof s&&null!==s?Array.isArray(s)?t[i]=s.map(e=>"string"==typeof e?this.sanitizeValue(e):e):t[i]=this.sanitizeObject(s):t[i]=s;return t}sanitizeValue(e){let t=e;for(const i of this.sensitivePatterns)t=t.replace(i,"[REDACTED]");return t}hashSensitiveData(e){if(e.length<=8)return`${e.slice(0,2)}***${e.slice(-2)}`;const t=e.slice(0,4),i=e.slice(-4),s=e.slice(4,-4);let n=0;for(let a=0;a<s.length;a++)n=(n<<5)-n+s.charCodeAt(a)&4294967295;return`${t}***${Math.abs(n).toString(16)}***${i}`}determineSeverity(e,t){return t.component.includes("security")||t.component.includes("auth")||t.component.includes("session")?"critical":e.message.includes("Network")||e.message.includes("fetch")?"medium":e instanceof SyntaxError?"high":e instanceof ReferenceError||e instanceof TypeError?"medium":"low"}generateErrorCode(e){const t=e.constructor.name,i=Date.now().toString(36),s=Math.random().toString(36).slice(2,6);return`${t.slice(0,3).toUpperCase()}_${i}_${s}`}generateUserFriendlyMessage(e,t){const i={critical:"é‡è¦ãªã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã™ãã«ã‚µãƒãƒ¼ãƒˆã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚",high:"ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã—ã°ã‚‰ãå¾…ã£ã¦ã‹ã‚‰å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚",medium:"ä¸€æ™‚çš„ãªå•é¡ŒãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚",low:"è»½å¾®ãªå•é¡ŒãŒç™ºç”Ÿã—ã¾ã—ãŸãŒã€ç¶šè¡Œã§ãã¾ã™ã€‚"};return e.message.includes("Network")?"ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®å•é¡ŒãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚":e.message.includes("Permission")?"ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ç®¡ç†è€…ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚":e.message.includes("timeout")?"ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸã€‚å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚":i[t]||i.medium}async calculateErrorHash(e){const t=JSON.stringify({id:e.id,message:e.message,code:e.code,timestamp:e.timestamp.toISOString(),component:e.context.component});return await yt(t)}async handleCriticalError(e){await this.auditLogger.logSecurityEvent("critical_error_detected","critical","secure_error_handler",`é‡è¦ã‚¨ãƒ©ãƒ¼ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸ: ${e.code}`,{errorId:e.id,component:e.context.component,timestamp:e.timestamp.toISOString(),hash:e.hash}),this.attemptAutoRecovery(e)}attemptAutoRecovery(e){e.context.component.includes("session")&&this.triggerSessionReset(),(e.message.includes("storage")||e.message.includes("localStorage"))&&this.clearCorruptedStorage()}triggerSessionReset(){try{localStorage.removeItem("session_token"),sessionStorage.clear()}catch(e){}}clearCorruptedStorage(){try{const e=["user_preferences","game_settings"],t=Object.keys(localStorage);for(const i of t)e.some(e=>i.includes(e))||localStorage.removeItem(i)}catch(e){}}async generateErrorReport(e){const t={errorId:e.id,sanitizedError:e,reportedAt:new Date,reportedBy:"system",environmentInfo:{userAgent:navigator.userAgent,url:window.location.href,timestamp:new Date,sessionId:e.context.sessionId}};return this.config.serverErrorReporting&&await this.sendErrorReport(t),t}async sendErrorReport(e){}searchErrors(e={}){let t=Array.from(this.errorLog.values());return e.severity&&(t=t.filter(t=>t.severity===e.severity)),e.component&&(t=t.filter(t=>t.context.component.includes(e.component))),e.fromDate&&(t=t.filter(t=>t.timestamp>=e.fromDate)),e.toDate&&(t=t.filter(t=>t.timestamp<=e.toDate)),t.sort((e,t)=>t.timestamp.getTime()-e.timestamp.getTime()),e.limit&&(t=t.slice(0,e.limit)),t}getErrorStatistics(){const e=Array.from(this.errorLog.values()),t=new Date(Date.now()-36e5),i={},s={},n={};let a=0;for(const o of e)i[o.severity]=(i[o.severity]||0)+1,s[o.context.component]=(s[o.context.component]||0)+1,n[o.code]=(n[o.code]||0)+1,o.timestamp>=t&&a++;const r=Object.entries(n).map(([e,t])=>({code:e,count:t})).sort((e,t)=>t.count-e.count).slice(0,10);return{totalErrors:e.length,errorsBySeverity:i,errorsByComponent:s,recentErrors:a,topErrors:r}}updateConfig(e){this.config={...this.config,...e}}clearErrorLog(){this.errorLog.clear(),this.auditLogger.logSecurityEvent("error_log_cleared","medium","secure_error_handler","ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ãŒã‚¯ãƒªã‚¢ã•ã‚Œã¾ã—ãŸ")}};i(Fs,"instance");const zs=Fs.getInstance(),Hs=class e{constructor(){i(this,"validationRules",new Map),i(this,"businessRules",new Map),i(this,"auditLogger",Ps.getInstance()),i(this,"fileValidationConfig"),this.fileValidationConfig={maxSize:10485760,allowedTypes:["image/jpeg","image/png","image/gif","text/plain","application/json"],allowedExtensions:[".jpg",".jpeg",".png",".gif",".txt",".json"],scanForMalware:!0,checkMetadata:!0,validateStructure:!0},this.initializeDefaultRules()}static getInstance(){return e.instance||(e.instance=new e),e.instance}initializeDefaultRules(){this.addValidationRule("string",{name:"sql_injection_check",validate:e=>this.validateSQLInjection(e),severity:"critical",description:"SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³æ”»æ’ƒã®æ¤œçŸ¥"}),this.addValidationRule("string",{name:"xss_check",validate:e=>this.validateXSS(e),severity:"high",description:"XSSæ”»æ’ƒã®æ¤œçŸ¥"}),this.addValidationRule("string",{name:"command_injection_check",validate:e=>this.validateCommandInjection(e),severity:"critical",description:"ã‚³ãƒãƒ³ãƒ‰ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³æ”»æ’ƒã®æ¤œçŸ¥"}),this.addValidationRule("string",{name:"path_traversal_check",validate:e=>this.validatePathTraversal(e),severity:"high",description:"ãƒ‘ã‚¹ãƒˆãƒ©ãƒãƒ¼ã‚µãƒ«æ”»æ’ƒã®æ¤œçŸ¥"}),this.addValidationRule("number",{name:"range_check",validate:(e,t)=>this.validateNumberRange(e,t),severity:"medium",description:"æ•°å€¤ç¯„å›²ã®æ¤œè¨¼"}),this.addValidationRule("number",{name:"precision_check",validate:e=>this.validateNumberPrecision(e),severity:"low",description:"æ•°å€¤ç²¾åº¦ã®æ¤œè¨¼"}),this.addValidationRule("object",{name:"structure_check",validate:(e,t)=>this.validateObjectStructure(e,t),severity:"medium",description:"ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ ã®æ¤œè¨¼"}),this.addValidationRule("object",{name:"size_check",validate:e=>this.validateObjectSize(e),severity:"medium",description:"ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚µã‚¤ã‚ºã®æ¤œè¨¼"}),this.addValidationRule("array",{name:"length_check",validate:(e,t)=>this.validateArrayLength(e,t),severity:"medium",description:"é…åˆ—é•·ã®æ¤œè¨¼"}),this.addValidationRule("email",{name:"format_check",validate:e=>this.validateEmailFormat(e),severity:"medium",description:"ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹å½¢å¼ã®æ¤œè¨¼"}),this.addValidationRule("email",{name:"domain_check",validate:e=>this.validateEmailDomain(e),severity:"low",description:"ãƒ¡ãƒ¼ãƒ«ãƒ‰ãƒ¡ã‚¤ãƒ³ã®æ¤œè¨¼"}),this.addValidationRule("url",{name:"protocol_check",validate:e=>this.validateURLProtocol(e),severity:"high",description:"URLãƒ—ãƒ­ãƒˆã‚³ãƒ«ã®æ¤œè¨¼"}),this.addValidationRule("url",{name:"domain_whitelist_check",validate:e=>this.validateURLDomain(e),severity:"medium",description:"URL ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆæ¤œè¨¼"})}addValidationRule(e,t){this.validationRules.has(e)||this.validationRules.set(e,[]),this.validationRules.get(e).push(t),this.auditLogger.logSecurityEvent("validation_rule_added","low","advanced_input_validator",`æ–°ã—ã„æ¤œè¨¼ãƒ«ãƒ¼ãƒ«ãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸ: ${e}.${t.name}`,{type:e,ruleName:t.name,severity:t.severity})}addBusinessRule(e,t){this.businessRules.has(e)||this.businessRules.set(e,[]),this.businessRules.get(e).push(t)}async validateInput(e,t,i){const s=this.validationRules.get(t)||[],n=[],a=[];let r=e,o=0,c=0;if(!this.validateType(e,t))return{isValid:!1,errors:[`Invalid type: expected ${t}, got ${typeof e}`],warnings:[],confidence:0};for(const d of s)try{const s=d.validate(e,i);s.isValid||(n.push(...s.errors),"critical"!==d.severity&&"high"!==d.severity||await this.auditLogger.logSecurityEvent("validation_rule_failed",d.severity,"advanced_input_validator",`æ¤œè¨¼ãƒ«ãƒ¼ãƒ«å¤±æ•—: ${d.name}`,{ruleName:d.name,type:t,field:i?.field,errors:s.errors,value:this.sanitizeLogValue(e)})),a.push(...s.warnings),void 0!==s.sanitizedValue&&(r=s.sanitizedValue),o+=s.confidence,c++}catch(u){a.push(`Rule execution failed: ${d.name}`),await this.auditLogger.logSecurityEvent("validation_rule_error","medium","advanced_input_validator",`æ¤œè¨¼ãƒ«ãƒ¼ãƒ«å®Ÿè¡Œã‚¨ãƒ©ãƒ¼: ${d.name}`,{ruleName:d.name,error:u instanceof Error?u.message:String(u)})}const l=c>0?o/c:0;return{isValid:0===n.length,errors:n,warnings:a,sanitizedValue:r,confidence:l}}async validateJSONPayload(e,t,i){const s=[];let n=e;try{const a=this.validateAgainstSchema(e,t);a.isValid||s.push(...a.errors);const r=JSON.stringify(e).length;r>1048576&&(s.push("Payload too large"),await this.auditLogger.logSecurityEvent("oversized_payload","high","advanced_input_validator",`éå¤§ãªãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’æ¤œå‡º: ${r} bytes`,{size:r,field:i?.field}));const o=this.calculateObjectDepth(e);o>20&&(s.push("Object depth too high"),await this.auditLogger.logSecurityEvent("deep_object_nesting","medium","advanced_input_validator",`æ·±ã„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒã‚¹ãƒˆ: ${o} levels`,{depth:o,field:i?.field})),"object"==typeof e&&null!==e&&(n=await this.validateObjectRecursively(e,i))}catch(a){s.push("JSON payload validation failed"),await this.auditLogger.logSecurityEvent("json_validation_error","medium","advanced_input_validator","JSON ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰æ¤œè¨¼ã‚¨ãƒ©ãƒ¼",{error:a instanceof Error?a.message:String(a),field:i?.field})}return{isValid:0===s.length,errors:s,warnings:[],sanitizedValue:n,confidence:0===s.length?.9:.1}}async validateFile(e,t){const i=[],s=[];try{e.size>this.fileValidationConfig.maxSize&&i.push(`File too large: ${e.size} bytes`),this.fileValidationConfig.allowedTypes.includes(e.type)||i.push(`Invalid file type: ${e.type}`);const t=this.getFileExtension(e.name);if(this.fileValidationConfig.allowedExtensions.includes(t)||i.push(`Invalid file extension: ${t}`),this.validateMimeExtensionMatch(e.type,t)||(s.push("MIME type and extension mismatch"),await this.auditLogger.logSecurityEvent("mime_extension_mismatch","medium","advanced_input_validator","MIME ã‚¿ã‚¤ãƒ—ã¨æ‹¡å¼µå­ã®ä¸æ•´åˆ",{fileName:e.name,mimeType:e.type,extension:t,size:e.size})),this.fileValidationConfig.validateStructure){const t=await this.validateFileContent(e);t.isValid||(i.push(...t.errors),s.push(...t.warnings))}if(this.fileValidationConfig.scanForMalware){const t=await this.scanForMalware(e);t.isValid||i.push(...t.errors)}if(this.fileValidationConfig.checkMetadata){const t=await this.validateFileMetadata(e);s.push(...t.warnings)}}catch(n){i.push("File validation failed"),await this.auditLogger.logSecurityEvent("file_validation_error","medium","advanced_input_validator","ãƒ•ã‚¡ã‚¤ãƒ«æ¤œè¨¼ã‚¨ãƒ©ãƒ¼",{fileName:e.name,error:n instanceof Error?n.message:String(n)})}return{isValid:0===i.length,errors:i,warnings:s,confidence:0===i.length?.8:.2}}async validateBusinessRules(e,t,i){const s=this.businessRules.get(e)||[],n=[],a=[];for(const o of s)try{o.condition(t,i)||("critical"===o.severity||"high"===o.severity?n.push(o.message):a.push(o.message),await this.auditLogger.logSecurityEvent("business_rule_violation",o.severity,"advanced_input_validator",`ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«é•å: ${o.name}`,{entity:e,ruleName:o.name,message:o.message,userId:i?.userId}))}catch(r){a.push(`Business rule execution failed: ${o.name}`)}return{isValid:0===n.length,errors:n,warnings:a,confidence:0===n.length?.9:.3}}validateSQLInjection(e){const t=[/(\b(SELECT|INSERT|UPDATE|DELETE|DROP|CREATE|ALTER|EXEC|UNION)\s)/i,/(\b(OR|AND)\s+['"]?\d+['"]?\s*=\s*['"]?\d+['"]?)/i,/(['"];?\s*(DROP|DELETE|INSERT|UPDATE)\s)/i,/(UNION\s+SELECT)/i,/(\b(EXEC|EXECUTE)\s*\()/i,/(--|\/\*|\*\/)/,/(\bCHAR\s*\(\s*\d+\s*\))/i,/(\bCONCAT\s*\()/i].filter(t=>t.test(e));return{isValid:0===t.length,errors:t.length>0?["Potential SQL injection detected"]:[],warnings:[],sanitizedValue:gt(e),confidence:0===t.length?.9:.1}}validateXSS(e){const t=[/<script[\s\S]*?>[\s\S]*?<\/script>/gi,/<iframe[\s\S]*?>[\s\S]*?<\/iframe>/gi,/<object[\s\S]*?>[\s\S]*?<\/object>/gi,/<embed[\s\S]*?>/gi,/<link[\s\S]*?>/gi,/javascript\s*:/gi,/on\w+\s*=/gi,/<img[\s\S]*?onerror[\s\S]*?>/gi,/<svg[\s\S]*?onload[\s\S]*?>/gi].filter(t=>t.test(e));return{isValid:0===t.length,errors:t.length>0?["Potential XSS attack detected"]:[],warnings:[],sanitizedValue:gt(e),confidence:0===t.length?.9:.1}}validateCommandInjection(e){const t=[/[;&|`$\\]/,/\b(cat|ls|pwd|whoami|id|uname|ps|netstat|ifconfig|wget|curl)\b/i,/(\|\s*(cat|ls|pwd|whoami|id|uname|ps|netstat))/i,/(&&|\|\|)/,/\$\(.*\)/,/`.*`/,/\b(rm|mv|cp|chmod|chown|kill|killall)\b/i].filter(t=>t.test(e));return{isValid:0===t.length,errors:t.length>0?["Potential command injection detected"]:[],warnings:[],sanitizedValue:e.replace(/[;&|`$\\]/g,""),confidence:0===t.length?.9:.1}}validatePathTraversal(e){const t=[/\.\.\//,/\.\.\\/,/%2e%2e%2f/i,/%2e%2e%5c/i,/\.\.%2f/i,/\.\.%5c/i,/\/etc\/passwd/i,/\/windows\/system32/i].filter(t=>t.test(e));return{isValid:0===t.length,errors:t.length>0?["Potential path traversal detected"]:[],warnings:[],sanitizedValue:e.replace(/\.\.\//g,"").replace(/\.\.\\/ /g,""),confidence:0===t.length?.9:.1}}validateNumberRange(e,t){const i=e>=-1e6&&e<=1e6&&Number.isFinite(e);return{isValid:i,errors:i?[]:["Number out of safe range"],warnings:[],confidence:i?.9:.1}}validateNumberPrecision(e){const t=(e.toString().split(".")[1]||"").length<=10;return{isValid:t,errors:t?[]:["Number precision too high"],warnings:[],confidence:t?.9:.7}}validateObjectStructure(e,t){const i=[];(Object.prototype.hasOwnProperty.call(e,"__proto__")||Object.prototype.hasOwnProperty.call(e,"constructor")||Object.prototype.hasOwnProperty.call(e,"prototype"))&&i.push("Potential prototype pollution detected");try{JSON.stringify(e)}catch(s){s instanceof Error&&s.message.includes("circular")&&i.push("Circular reference detected")}return{isValid:0===i.length,errors:i,warnings:[],confidence:0===i.length?.8:.2}}validateObjectSize(e){let t=0,i=0;try{t=Object.keys(e).length,i=JSON.stringify(e).length}catch(n){return{isValid:!1,errors:["Cannot calculate object size"],warnings:[],confidence:.1}}const s=[];return t>1e3&&s.push(`Too many properties: ${t}`),i>1048576&&s.push(`Object too large: ${i} bytes`),{isValid:0===s.length,errors:s,warnings:[],confidence:0===s.length?.9:.3}}validateArrayLength(e,t){const i=e.length<=1e4;return{isValid:i,errors:i?[]:[`Array too long: ${e.length}`],warnings:[],confidence:i?.9:.3}}validateEmailFormat(e){const t=/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(e);return{isValid:t,errors:t?[]:["Invalid email format"],warnings:[],confidence:t?.9:.1}}validateEmailDomain(e){const t=e.split("@")[1]?.toLowerCase(),i=["10minutemail.com","tempmail.org","guerrillamail.com"].includes(t);return{isValid:!i,errors:[],warnings:i?["Suspicious email domain"]:[],confidence:i?.5:.9}}validateURLProtocol(e){const t=["http:","https:","mailto:","tel:"];try{const i=new URL(e),s=t.includes(i.protocol);return{isValid:s,errors:s?[]:[`Invalid protocol: ${i.protocol}`],warnings:[],confidence:s?.9:.1}}catch{return{isValid:!1,errors:["Invalid URL format"],warnings:[],confidence:.1}}}validateURLDomain(e){const t=["example.com","github.com","stackoverflow.com"];try{const i=new URL(e),s=t.some(e=>i.hostname===e||i.hostname.endsWith(`.${e}`));return{isValid:s,errors:s?[]:[`Domain not whitelisted: ${i.hostname}`],warnings:[],confidence:s?.9:.3}}catch{return{isValid:!1,errors:["Invalid URL format"],warnings:[],confidence:.1}}}validateType(e,t){switch(t){case"string":case"email":case"url":return"string"==typeof e;case"number":return"number"==typeof e&&!isNaN(e);case"boolean":return"boolean"==typeof e;case"object":return"object"==typeof e&&null!==e&&!Array.isArray(e);case"array":return Array.isArray(e);default:return!1}}validateAgainstSchema(e,t){const i=[];if(t.required)for(const s of t.required)s in e||i.push(`Required field missing: ${s}`);return{isValid:0===i.length,errors:i,warnings:[],confidence:0===i.length?.8:.2}}calculateObjectDepth(e,t=0){if(t>50)return t;if("object"!=typeof e||null===e)return t;let i=t;for(const s in e)if(Object.prototype.hasOwnProperty.call(e,s)){const n=this.calculateObjectDepth(e[s],t+1);i=Math.max(i,n)}return i}async validateObjectRecursively(e,t){const i={};for(const[s,n]of Object.entries(e)){const e={...t,field:t?.field?`${t.field}.${s}`:s};if("string"==typeof n){const t=await this.validateInput(n,"string",e);i[s]=t.sanitizedValue||n}else if("number"==typeof n){const t=await this.validateInput(n,"number",e);i[s]=t.sanitizedValue||n}else"object"==typeof n&&null!==n?Array.isArray(n)?i[s]=n:i[s]=await this.validateObjectRecursively(n,e):i[s]=n}return i}getFileExtension(e){return e.toLowerCase().substring(e.lastIndexOf("."))}validateMimeExtensionMatch(e,t){const i={"image/jpeg":[".jpg",".jpeg"],"image/png":[".png"],"image/gif":[".gif"],"text/plain":[".txt"],"application/json":[".json"]}[e];return!!i&&i.includes(t)}async validateFileContent(e){const t=[],i=[];try{const t=await e.slice(0,20).arrayBuffer(),s=new Uint8Array(t);this.validateFileHeader(s,e.type)||i.push("File header does not match MIME type")}catch(s){t.push("Cannot read file content")}return{isValid:0===t.length,errors:t,warnings:i,confidence:0===t.length?.8:.3}}validateFileHeader(e,t){const i={"image/jpeg":[[255,216,255]],"image/png":[[137,80,78,71]],"image/gif":[[71,73,70,56]]}[t];return!i||i.some(t=>t.every((t,i)=>e[i]===t))}async scanForMalware(e){const t=["eval(","document.write(","setTimeout(","setInterval(","<script","javascript:","vbscript:"];try{const i=await e.text(),s=t.filter(e=>i.toLowerCase().includes(e));return{isValid:0===s.length,errors:s.length>0?["Suspicious content detected"]:[],warnings:[],confidence:0===s.length?.7:.1}}catch{return{isValid:!0,errors:[],warnings:["Cannot scan file content"],confidence:.5}}}async validateFileMetadata(e){const t=[];return e.name.length>255&&t.push("Filename too long"),/[<>:"/\\|?*]/.test(e.name)&&t.push("Filename contains invalid characters"),e.lastModified>Date.now()&&t.push("File modification date is in the future"),{isValid:!0,errors:[],warnings:t,confidence:.8}}sanitizeLogValue(e){const t=String(e);return t.length>100?`${t.slice(0,100)}...`:t}};i(Hs,"instance");const js=Hs.getInstance(),Us=class e{constructor(){i(this,"config"),i(this,"auditLogger",Ps.getInstance()),i(this,"securityMonitor",ys.getInstance()),i(this,"cspManager",_s.getInstance()),i(this,"headerManager",Ts.getInstance()),i(this,"isInitialized",!1),i(this,"startTime",new Date),i(this,"threatCache",new Map),i(this,"alertQueue",[]),this.config={enableAPIProtection:!0,enableRateLimiting:!0,enableSessionManagement:!1,enableSecureErrorHandling:!0,enableInputValidation:!0,enableAuditLogging:!0,enableRealTimeMonitoring:!0,securityLevel:"high",autoBlock:!0,alertThreshold:10}}static getInstance(){return e.instance||(e.instance=new e),e.instance}async initialize(e){if(!this.isInitialized)try{e&&(this.config={...this.config,...e}),this.adjustConfigForSecurityLevel(),await this.initializeComponents(),await this.setupSecurityPolicies(),this.config.enableRealTimeMonitoring&&this.startRealTimeMonitoring(),this.setupSecurityEventHandlers(),await this.performInitialSecurityCheck(),this.isInitialized=!0,await this.auditLogger.logSecurityEvent("integrated_security_system_initialized","low","integrated_security_system","çµ±åˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚·ã‚¹ãƒ†ãƒ ãŒåˆæœŸåŒ–ã•ã‚Œã¾ã—ãŸ",{config:this.config,timestamp:(new Date).toISOString(),version:"1.0.0"})}catch(t){throw await this.setupFallbackSecurity(),new Error(`Security system initialization failed: ${t instanceof Error?t.message:String(t)}`)}}adjustConfigForSecurityLevel(){switch(this.config.securityLevel){case"maximum":this.config.autoBlock=!0,this.config.alertThreshold=5;break;case"high":this.config.autoBlock=!0,this.config.alertThreshold=10;break;case"medium":this.config.autoBlock=!1,this.config.alertThreshold=20;break;case"low":this.config.autoBlock=!1,this.config.alertThreshold=50}}async initializeComponents(){const e=[];e.push(Promise.resolve().then(()=>{this.cspManager.initialize(),this.headerManager.initializeSecurityHeaders()})),this.config.enableAPIProtection&&e.push(Promise.resolve().then(()=>{Ds.updateConfig({enforceHTTPS:"low"!==this.config.securityLevel,rateLimitConfig:{windowMs:6e4,maxRequests:"maximum"===this.config.securityLevel?30:60,blockDurationMs:"maximum"===this.config.securityLevel?6e5:3e5}})})),this.config.enableSecureErrorHandling&&e.push(Promise.resolve().then(()=>{zs.updateConfig({exposeStackTrace:!1,errorSanitization:"low"!==this.config.securityLevel,clientErrorReporting:!0})})),await Promise.all(e)}async setupSecurityPolicies(){this.config.enableInputValidation&&(js.addBusinessRule("game_action",{name:"valid_game_state",condition:e=>this.validateGameAction(e),message:"Invalid game action",severity:"medium"}),js.addBusinessRule("user_input",{name:"reasonable_input_length",condition:e=>"string"==typeof e&&e.length<=1e3,message:"Input too long",severity:"low"}))}startRealTimeMonitoring(){setInterval(async()=>{await this.performLightweightSecurityCheck()},3e4),setInterval(async()=>{await this.performDetailedSecurityCheck()},3e5),setInterval(async()=>{await this.generateHourlySecurityReport()},36e5),setInterval(async()=>{const e=Os.detectDDoSAttack();e.isUnderAttack&&await this.handleDDoSDetection(e)},12e4)}setupSecurityEventHandlers(){window.addEventListener("error",async e=>{await zs.handleError(e.error,{component:"global_error_handler",url:e.filename,additionalContext:{lineNumber:e.lineno,columnNumber:e.colno}})}),document.addEventListener("securitypolicyviolation",async e=>{await this.handleSecurityViolation(e)}),document.addEventListener("visibilitychange",async()=>{document.hidden&&await this.auditLogger.logSecurityEvent("tab_hidden","low","integrated_security_system","ã‚¿ãƒ–ãŒéã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ãªã‚Šã¾ã—ãŸ")})}async performInitialSecurityCheck(){const e=[];"https:"!==window.location.protocol&&"localhost"!==window.location.hostname&&e.push("HTTPS ãŒä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã›ã‚“");const t=this.headerManager.validateSecurityHeaders();t.missing.length>0&&e.push(`ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼ãŒä¸è¶³: ${t.missing.join(", ")}`);const i=this.cspManager.getViolationStats();i.total>0&&e.push(`CSP é•åãŒæ¤œå‡ºã•ã‚Œã¦ã„ã¾ã™: ${i.total}ä»¶`),window.crypto?.subtle||e.push("Web Crypto API ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“"),e.length>0&&await this.auditLogger.logSecurityEvent("initial_security_issues","medium","integrated_security_system",`åˆæœŸã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ã§å•é¡Œã‚’æ¤œå‡º: ${e.join(", ")}`,{issues:e})}async performLightweightSecurityCheck(){try{if("memory"in performance){const e=performance.memory,t=e.usedJSHeapSize/e.jsHeapSizeLimit*100;t>90&&await this.auditLogger.logSecurityEvent("high_memory_usage","medium","integrated_security_system",`ãƒ¡ãƒ¢ãƒªä½¿ç”¨ç‡ãŒé«˜ã„ã§ã™: ${t.toFixed(1)}%`,{usagePercent:t})}const e=this.securityMonitor.getSecurityMetrics();e.currentThreats>this.config.alertThreshold&&await this.handleHighThreatLevel(e.currentThreats)}catch(e){}}async performDetailedSecurityCheck(){try{const e=Os.getStatistics();e.blockedClients>10&&await this.auditLogger.logSecurityEvent("high_blocked_clients","high","integrated_security_system",`å¤šæ•°ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ã¾ã™: ${e.blockedClients}`,e);const t=zs.getErrorStatistics();t.recentErrors>50&&await this.auditLogger.logSecurityEvent("high_error_rate","medium","integrated_security_system",`é«˜ã„ã‚¨ãƒ©ãƒ¼ç‡ã‚’æ¤œå‡º: ${t.recentErrors}ä»¶/æ™‚é–“`,t);const i=this.cspManager.getViolationHistory(10);i.length>5&&await this.auditLogger.logSecurityEvent("frequent_csp_violations","high","integrated_security_system",`é »ç¹ãªCSPé•å: ${i.length}ä»¶`,{recentViolations:i.slice(0,3)})}catch(e){}}async generateHourlySecurityReport(){try{await this.generateSecurityReport(new Date(Date.now()-36e5),new Date)}catch(e){}}async handleDDoSDetection(e){await this.auditLogger.logSecurityEvent("ddos_attack_detected","critical","integrated_security_system",`DDoSæ”»æ’ƒã‚’æ¤œå‡º: ${e.attackSeverity} ãƒ¬ãƒ™ãƒ«`,e),this.config.autoBlock&&"critical"===e.attackSeverity&&await this.enableEmergencyProtectionMode()}async handleSecurityViolation(e){const t=this.assessViolationSeverity(e);await this.auditLogger.logSecurityEvent("security_policy_violation",t,"integrated_security_system",`ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼é•å: ${e.violatedDirective}`,{violatedDirective:e.violatedDirective,blockedURI:e.blockedURI,sourceFile:e.sourceFile,lineNumber:e.lineNumber}),"critical"===t&&this.config.autoBlock&&await this.executeAutomaticProtection(e)}async handleHighThreatLevel(e){await this.auditLogger.logSecurityEvent("high_threat_level","high","integrated_security_system",`é«˜ã„è„…å¨ãƒ¬ãƒ™ãƒ«ã‚’æ¤œå‡º: ${e}å€‹ã®è„…å¨`,{threatCount:e,threshold:this.config.alertThreshold}),this.config.autoBlock&&await this.temporarilyEnhanceSecurity()}async enableEmergencyProtectionMode(){Ds.updateConfig({rateLimitConfig:{windowMs:6e4,maxRequests:10,blockDurationMs:18e5}}),zs.updateConfig({clientErrorReporting:!1}),await this.auditLogger.logSecurityEvent("emergency_protection_enabled","critical","integrated_security_system","ç·Šæ€¥ä¿è­·ãƒ¢ãƒ¼ãƒ‰ãŒæœ‰åŠ¹åŒ–ã•ã‚Œã¾ã—ãŸ"),setTimeout(async()=>{await this.disableEmergencyProtectionMode()},6e5)}async disableEmergencyProtectionMode(){await this.initializeComponents(),await this.auditLogger.logSecurityEvent("emergency_protection_disabled","medium","integrated_security_system","ç·Šæ€¥ä¿è­·ãƒ¢ãƒ¼ãƒ‰ãŒç„¡åŠ¹åŒ–ã•ã‚Œã¾ã—ãŸ")}async executeAutomaticProtection(e){"script-src"===e.violatedDirective&&document.querySelectorAll("script[src]").forEach(t=>{t.getAttribute("src")===e.blockedURI&&t.remove()}),await this.auditLogger.logSecurityEvent("automatic_protection_executed","high","integrated_security_system","è‡ªå‹•ä¿è­·æªç½®ã‚’å®Ÿè¡Œã—ã¾ã—ãŸ",{violatedDirective:e.violatedDirective,blockedURI:e.blockedURI})}async temporarilyEnhanceSecurity(){js.updateConfig?.({maxErrorMessageLength:200,errorSanitization:!0}),await this.auditLogger.logSecurityEvent("security_temporarily_enhanced","medium","integrated_security_system","ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãŒä¸€æ™‚çš„ã«å¼·åŒ–ã•ã‚Œã¾ã—ãŸ"),setTimeout(async()=>{await this.initializeComponents()},3e5)}async getSecurityStatus(){const e=this.securityMonitor.getSecurityMetrics(),t=Os.getStatistics(),i=zs.getErrorStatistics(),s=this.config.enableSessionManagement?Ns.getSessionStatistics():{totalActiveSessions:0};let n="healthy";return e.currentThreats>this.config.alertThreshold||i.recentErrors>100||t.blockedClients>20?n="critical":(e.currentThreats>this.config.alertThreshold/2||i.recentErrors>50)&&(n="warning"),{systemHealth:n,activeThreats:e.currentThreats,blockedRequests:t.ddosMetrics.blockedRequests,activeSessions:s.totalActiveSessions,errorRate:i.recentErrors,lastUpdate:new Date,componentStatus:{apiSecurity:this.config.enableAPIProtection,rateLimiting:this.config.enableRateLimiting,sessionManagement:this.config.enableSessionManagement,errorHandling:this.config.enableSecureErrorHandling,inputValidation:this.config.enableInputValidation,auditLogging:this.config.enableAuditLogging,monitoring:this.config.enableRealTimeMonitoring}}}async generateSecurityReport(e,t){const i=await this.auditLogger.generateAuditReport(e,t);this.securityMonitor.generateSecurityReport();const s=Os.getStatistics(),n=zs.getErrorStatistics(),a=new Map;i.events.forEach(e=>{const t=a.get(e.eventType)||{count:0,severity:e.severity};t.count++,this.compareSeverity(e.severity,t.severity)>0&&(t.severity=e.severity),a.set(e.eventType,t)});const r=Array.from(a.entries()).map(([e,t])=>({type:e,count:t.count,severity:t.severity})).sort((e,t)=>t.count-e.count).slice(0,10),o=this.assessOWASPCompliance();return{generatedAt:new Date,period:{start:e,end:t},summary:{totalThreats:i.summary.totalEvents,blockedAttacks:s.blockedClients,vulnerabilitiesFound:this.countVulnerabilities(i.events),systemUptime:Date.now()-this.startTime.getTime(),errorRate:n.recentErrors/((Date.now()-e.getTime())/36e5)},threatAnalysis:{topAttackTypes:r,suspiciousIPs:[],vulnerabilityHotspots:this.identifyVulnerabilityHotspots(i.events)},performance:{averageResponseTime:100,resourceUsage:{cpu:0,memory:0},apiCallsBlocked:s.ddosMetrics.blockedRequests,rateLimitHits:s.blockedClients},recommendations:[...i.recommendations,...this.generateSystemRecommendations(r,n)],compliance:{owaspTop10:o,dataProtection:"compliant",accessControl:"strong"}}}validateGameAction(e){return"object"==typeof e&&null!==e&&"action"in e&&"string"==typeof e.action}assessViolationSeverity(e){return"script-src"===e.violatedDirective&&(e.blockedURI.includes("eval")||e.blockedURI.includes("javascript:"))?"critical":e.violatedDirective.includes("script")?"high":"medium"}compareSeverity(e,t){const i={low:1,medium:2,high:3,critical:4};return(i[e]||0)-(i[t]||0)}countVulnerabilities(e){return e.filter(e=>"high"===e.severity||"critical"===e.severity).length}identifyVulnerabilityHotspots(e){const t=new Map;return e.forEach(e=>{const i=t.get(e.source)||{severity:"low",count:0};i.count++,this.compareSeverity(e.severity,i.severity)>0&&(i.severity=e.severity),t.set(e.source,i)}),Array.from(t.entries()).filter(([,e])=>e.count>5||"high"===e.severity||"critical"===e.severity).map(([e,t])=>({component:e,severity:t.severity,description:`${t.count}ä»¶ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ™ãƒ³ãƒˆ`})).slice(0,10)}generateSystemRecommendations(e,t){const i=[];return e.some(e=>e.type.includes("xss"))&&i.push("XSS å¯¾ç­–ã®å¼·åŒ–: å…¥åŠ›æ¤œè¨¼ã¨CSPã®è¦‹ç›´ã—ã‚’æ¨å¥¨"),e.some(e=>e.type.includes("sql"))&&i.push("SQL ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³å¯¾ç­–: ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒ–ã‚¯ã‚¨ãƒªã®ä½¿ç”¨ã‚’æ¨å¥¨"),t.recentErrors>100&&i.push("ã‚¨ãƒ©ãƒ¼ç‡ãŒé«˜ã„ã§ã™: ã‚·ã‚¹ãƒ†ãƒ ã®å®‰å®šæ€§ç¢ºèªã‚’æ¨å¥¨"),i}assessOWASPCompliance(){return[{category:"A01:2021 â€“ Broken Access Control",status:"compliant"},{category:"A02:2021 â€“ Cryptographic Failures",status:"compliant"},{category:"A03:2021 â€“ Injection",status:"compliant"},{category:"A04:2021 â€“ Insecure Design",status:"partial"},{category:"A05:2021 â€“ Security Misconfiguration",status:"compliant"},{category:"A06:2021 â€“ Vulnerable Components",status:"partial"},{category:"A07:2021 â€“ Identity and Authentication Failures",status:"compliant"},{category:"A08:2021 â€“ Software and Data Integrity Failures",status:"compliant"},{category:"A09:2021 â€“ Security Logging and Monitoring Failures",status:"compliant"},{category:"A10:2021 â€“ Server-Side Request Forgery",status:"compliant"}]}async setupFallbackSecurity(){const e=Element.prototype.innerHTML;Object.defineProperty(Element.prototype,"innerHTML",{set(t){if("string"==typeof t){const i=t.replace(/<script[^>]*>.*?<\/script>/gi,"").replace(/javascript:/gi,"").replace(/on\w+\s*=/gi,"");e.call(this,i)}else e.call(this,t)},get(){return e.call(this)}})}updateConfig(e){this.config={...this.config,...e},this.isInitialized&&this.initializeComponents()}shutdown(){this.isInitialized=!1}};i(Us,"instance");const Vs=Us.getInstance(),qs={enableDetailedChecks:!1,lightCheckInterval:3e5,detailedCheckInterval:9e5,memoryWarningThreshold:85,maxEventListeners:10,useRequestIdleCallback:!0};class Bs{constructor(){i(this,"logs",[]),i(this,"warnings",[]),i(this,"maxLogs",1e3),i(this,"logRotationSize",100),i(this,"storageKey","game_error_logs"),i(this,"warningStorageKey","game_warning_logs"),i(this,"analyticsBuffer",[]),i(this,"realtimeListeners",[]),i(this,"sessionId"),i(this,"userId"),i(this,"buildVersion"),i(this,"isAnalyzing",!1),this.sessionId=this.generateSessionId(),this.buildVersion="unknown",this.loadFromStorage(),this.startRealtimeAnalysis()}log(e,t,i="auto"){const s={id:this.generateId(),timestamp:Date.now(),errorInfo:e,context:t,sessionId:this.sessionId,userId:this.userId,buildVersion:this.buildVersion,source:i,correlationId:this.generateCorrelationId(e),resolved:!1,impact:this.calculateBusinessImpact(e)};this.logs.push(s),this.analyticsBuffer.push(s),this.notifyRealtimeListeners(s),this.logs.length>this.maxLogs&&(this.logs=this.logs.slice(-this.maxLogs+this.logRotationSize)),this.saveToStorage(),this.checkAlertConditions(s)}logWarning(e){const t={id:this.generateId(),...e};this.warnings.push(t),this.warnings.length>this.maxLogs/2&&(this.warnings=this.warnings.slice(-this.maxLogs/2+this.logRotationSize)),this.saveToStorage()}getLogs(e){let t=[...this.logs];return e&&(e.severity&&(t=t.filter(t=>t.errorInfo.severity===e.severity)),e.category&&(t=t.filter(t=>t.errorInfo.category===e.category)),e.startTime&&(t=t.filter(t=>t.timestamp>=e.startTime)),e.endTime&&(t=t.filter(t=>t.timestamp<=e.endTime)),e.limit&&(t=t.slice(-e.limit))),t}getWarnings(e){return e?this.warnings.slice(-e):[...this.warnings]}getStatistics(e){const t=e?this.getLogs({startTime:e.start,endTime:e.end}):this.logs,i={total:t.length,bySeverity:{low:0,medium:0,high:0,critical:0},byCategory:{vue:0,javascript:0,network:0,async:0,user:0,system:0},errorRate:0,mostCommonErrors:[]},s=new Map;if(t.forEach(e=>{i.bySeverity[e.errorInfo.severity]++,i.byCategory[e.errorInfo.category]++;const t=e.errorInfo.message;s.set(t,(s.get(t)||0)+1)}),t.length>0){const e=t[t.length-1].timestamp-t[0].timestamp;i.errorRate=e>0?t.length/e*6e4:0}return i.mostCommonErrors=Array.from(s.entries()).sort((e,t)=>t[1]-e[1]).slice(0,5).map(([e,t])=>({message:e,count:t})),i}searchErrors(e){const t="string"==typeof e?new RegExp(e,"i"):e;return this.logs.filter(e=>t.test(e.errorInfo.message)||e.errorInfo.stack&&t.test(e.errorInfo.stack))}export(e="json"){if("json"===e)return JSON.stringify({logs:this.logs,warnings:this.warnings,exported:(new Date).toISOString()},null,2);const t=this.logs.map(e=>[e.id,new Date(e.timestamp).toISOString(),e.errorInfo.severity,e.errorInfo.category,`"${e.errorInfo.message.replace(/"/g,'""')}"`,e.errorInfo.component||"",e.errorInfo.url||"",e.errorInfo.stack?`"${e.errorInfo.stack.replace(/"/g,'""')}"`:""]);return[["ID","Timestamp","Severity","Category","Message","Component","URL","Stack"].join(","),...t.map(e=>e.join(","))].join("\n")}clear(){this.logs=[],this.warnings=[],this.saveToStorage()}pruneOldLogs(e){const t=Date.now()-e;this.logs=this.logs.filter(e=>e.timestamp>t),this.warnings=this.warnings.filter(e=>e.timestamp>t),this.saveToStorage()}loadFromStorage(){try{const e=localStorage.getItem(this.storageKey),t=localStorage.getItem(this.warningStorageKey);e&&(this.logs=JSON.parse(e)),t&&(this.warnings=JSON.parse(t))}catch(e){}}saveToStorage(){try{const e=this.logs.slice(-100),t=this.warnings.slice(-50);localStorage.setItem(this.storageKey,JSON.stringify(e)),localStorage.setItem(this.warningStorageKey,JSON.stringify(t))}catch(e){if(e instanceof DOMException&&"QuotaExceededError"===e.name){this.logs=this.logs.slice(-50),this.warnings=this.warnings.slice(-25);try{this.saveToStorage()}catch{}}}}generateSessionId(){return`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}generateCorrelationId(e){const t=`${e.category}_${e.component||"unknown"}_${e.message.split(" ")[0]}`;let i=0;for(let s=0;s<t.length;s++)i=(i<<5)-i+t.charCodeAt(s),i&=i;return`corr_${Math.abs(i).toString(16)}`}calculateBusinessImpact(e){if("game"===e.category&&"critical"===e.severity)return"critical";if("security"===e.category)return"high";if("network"===e.category)return"medium";switch(e.severity){case"critical":return"critical";case"high":return"high";case"medium":return"medium";case"low":return"low"}}notifyRealtimeListeners(e){this.realtimeListeners.forEach(t=>{try{t(e)}catch(i){}})}logToConsole(e){}checkAlertConditions(e){const t=Date.now()-3e5,i=this.logs.filter(e=>e.timestamp>t&&"critical"===e.errorInfo.severity).length;if(i>=3&&this.triggerAlert("critical-error-spike",{count:i,timespan:"5 minutes",latestError:e}),e.correlationId){const t=this.logs.filter(t=>t.correlationId===e.correlationId&&t.timestamp>Date.now()-12e4).length;t>=5&&this.triggerAlert("repeated-error",{correlationId:e.correlationId,count:t,errorType:e.errorInfo.message})}}triggerAlert(e,t){const i=new CustomEvent("app:error-alert",{detail:{type:e,data:t,timestamp:Date.now()}});window.dispatchEvent(i)}startRealtimeAnalysis(){setInterval(()=>{!this.isAnalyzing&&this.analyticsBuffer.length>0&&this.performRealtimeAnalysis()},3e4)}async performRealtimeAnalysis(){if(0!==this.analyticsBuffer.length){this.isAnalyzing=!0;try{const e=[...this.analyticsBuffer];this.analyticsBuffer=[];const t=this.analyzeErrorPatterns(e),i=this.analyzeTrends(e),s=this.detectAnomalies(e),n=new CustomEvent("app:error-analysis",{detail:{patterns:t,trends:i,anomalies:s,timestamp:Date.now(),sampleSize:e.length}});window.dispatchEvent(n)}catch(e){}finally{this.isAnalyzing=!1}}}analyzeErrorPatterns(e){const t={byCategory:new Map,byComponent:new Map,byCorrelation:new Map,topErrors:[]},i=new Map;return e.forEach(e=>{const s=e.errorInfo.category;t.byCategory.set(s,(t.byCategory.get(s)||0)+1);const n=e.errorInfo.component||"unknown";t.byComponent.set(n,(t.byComponent.get(n)||0)+1),e.correlationId&&t.byCorrelation.set(e.correlationId,(t.byCorrelation.get(e.correlationId)||0)+1);const a=e.errorInfo.message,r=i.get(a)||{count:0};i.set(a,{count:r.count+1,severity:e.errorInfo.severity})}),t.topErrors=Array.from(i.entries()).sort((e,t)=>t[1].count-e[1].count).slice(0,5).map(([e,t])=>({message:e,count:t.count,severity:t.severity})),t}analyzeTrends(e){if(e.length<2)return null;const t=new Map,i=3e5;e.forEach(e=>{const s=Math.floor(e.timestamp/i)*i,n=new Date(s).toISOString();t.set(n,(t.get(n)||0)+1)});const s=Array.from(t.entries()).sort((e,t)=>new Date(e[0]).getTime()-new Date(t[0]).getTime());if(s.length<2)return null;const n=s.map(([,e])=>e),a=this.calculateTrend(n);return{timeSlots:s,trend:a>0?"increasing":a<0?"decreasing":"stable",trendValue:a}}calculateTrend(e){const t=e.length,i=t*(t-1)/2,s=e.reduce((e,t)=>e+t,0);return(t*e.reduce((e,t,i)=>e+i*t,0)-i*s)/(t*e.reduce((e,t,i)=>e+i*i,0)-i*i)}detectAnomalies(e){const t=[];e.length>10&&t.push({type:"high_frequency",description:"Unusually high error frequency detected",count:e.length,severity:"high"});const i=new Set(e.map(e=>e.errorInfo.message)),s=new Set(this.logs.slice(0,-e.length).map(e=>e.errorInfo.message)),n=Array.from(i).filter(e=>!s.has(e));return n.length>0&&t.push({type:"new_error_types",description:"New error types detected",newErrors:n,severity:"medium"}),t}addRealtimeListener(e){return this.realtimeListeners.push(e),()=>{const t=this.realtimeListeners.indexOf(e);-1!==t&&this.realtimeListeners.splice(t,1)}}markAsResolved(e,t){const i=this.logs.find(t=>t.id===e);return!!i&&(i.resolved=!0,i.resolvedBy=t,this.saveToStorage(),!0)}getRelatedErrors(e){return this.logs.filter(t=>t.correlationId===e)}setUserId(e){this.userId=e}getAdvancedStatistics(e){const t=e?this.getLogs({startTime:e.start,endTime:e.end}):this.logs,i=this.getStatistics(e),s=t.filter(e=>e.resolved);return{...i,mttr:s.length>0?s.reduce((e,t)=>e+6e4,0)/s.length:0,impactStats:{low:t.filter(e=>"low"===e.impact).length,medium:t.filter(e=>"medium"===e.impact).length,high:t.filter(e=>"high"===e.impact).length,critical:t.filter(e=>"critical"===e.impact).length},sourceStats:{user:t.filter(e=>"user"===e.source).length,system:t.filter(e=>"system"===e.source).length,auto:t.filter(e=>"auto"===e.source).length},resolutionRate:t.length>0?s.length/t.length:0,correlationGroups:this.getCorrelationGroups(t)}}getCorrelationGroups(e){const t=new Map;return e.forEach(e=>{if(e.correlationId){const i=t.get(e.correlationId)||{count:0,resolved:0};i.count++,e.resolved&&i.resolved++,t.set(e.correlationId,i)}}),Array.from(t.entries()).map(([e,t])=>({id:e,...t})).sort((e,t)=>t.count-e.count)}generateId(){return`${Date.now()}-${Math.random().toString(36).substr(2,9)}`}}class Gs{constructor(e={}){i(this,"options"),i(this,"queue",[]),i(this,"isReporting",!1),i(this,"sessionId"),i(this,"sessionStartTime"),i(this,"pageViews",0),i(this,"reportInterval",null),i(this,"maxQueueSize",50),i(this,"batchSize",10),this.options={endpoint:"",apiKey:"",environment:"production",userId:"",sessionId:this.generateSessionId(),metadata:{},...e},this.sessionId=this.options.sessionId,this.sessionStartTime=Date.now(),this.trackPageView(),this.options.endpoint&&this.startBatchReporting()}report(e,t){if("development"===this.options.environment)return;const i={errorInfo:e,environment:this.options.environment,browser:this.getBrowserInfo(),screen:this.getScreenInfo(),memory:this.getMemoryInfo(),sessionInfo:{id:this.sessionId,startTime:this.sessionStartTime,duration:Date.now()-this.sessionStartTime,pageViews:this.pageViews},userId:this.options.userId,metadata:{...this.options.metadata,...t}};this.queue.push(i),this.queue.length>this.maxQueueSize&&(this.queue=this.queue.slice(-this.maxQueueSize)),"critical"===e.severity&&this.flushQueue()}async flushQueue(){if(!this.isReporting&&0!==this.queue.length&&this.options.endpoint){this.isReporting=!0;try{for(;this.queue.length>0;){const e=this.queue.splice(0,this.batchSize);await this.sendBatch(e)}}catch(e){}finally{this.isReporting=!1}}}async sendBatch(e){const t={reports:e,timestamp:Date.now(),apiKey:this.options.apiKey},i=await fetch(this.options.endpoint,{method:"POST",headers:{"Content-Type":"application/json","X-API-Key":this.options.apiKey},body:JSON.stringify(t)});if(!i.ok)throw new Error(`Failed to send error reports: ${i.statusText}`)}getBrowserInfo(){const e=navigator.userAgent,t={name:"Unknown",version:"Unknown",platform:navigator.platform||"Unknown"};if(e.includes("Chrome")){t.name="Chrome";const i=e.match(/Chrome\/(\d+)/);i&&(t.version=i[1])}else if(e.includes("Firefox")){t.name="Firefox";const i=e.match(/Firefox\/(\d+)/);i&&(t.version=i[1])}else if(e.includes("Safari")){t.name="Safari";const i=e.match(/Version\/(\d+)/);i&&(t.version=i[1])}else if(e.includes("Edge")){t.name="Edge";const i=e.match(/Edge\/(\d+)/);i&&(t.version=i[1])}return t}getScreenInfo(){return{width:window.screen.width,height:window.screen.height,pixelRatio:window.devicePixelRatio||1}}getMemoryInfo(){if("memory"in performance){const e=performance.memory;return{used:e.usedJSHeapSize,total:e.totalJSHeapSize,limit:e.jsHeapSizeLimit}}}trackPageView(){this.pageViews++;const e=history.pushState;history.pushState=(...t)=>{this.pageViews++,e.apply(history,t)}}startBatchReporting(){this.reportInterval=window.setInterval(()=>{this.flushQueue()},3e4),window.addEventListener("beforeunload",()=>{this.flushQueue()}),document.addEventListener("visibilitychange",()=>{document.hidden&&this.flushQueue()})}generateSessionId(){return`${Date.now()}-${Math.random().toString(36).substr(2,9)}`}setUserId(e){this.options.userId=e}updateMetadata(e){this.options.metadata={...this.options.metadata,...e}}getStats(){return{queueSize:this.queue.length,sessionDuration:Date.now()-this.sessionStartTime,pageViews:this.pageViews,isReporting:this.isReporting}}destroy(){this.reportInterval&&(clearInterval(this.reportInterval),this.reportInterval=null),this.flushQueue()}}class Ws{constructor(){i(this,"strategies",[]),i(this,"recoveryAttempts",new Map),i(this,"recoveryHistory",[]),i(this,"maxHistorySize",100),i(this,"gameStateBackup",null),i(this,"performanceBaseline",null),i(this,"lastCleanupTime",0),i(this,"CLEANUP_INTERVAL",6e4),i(this,"isCleaningUp",!1),this.registerDefaultStrategies(),this.initializePerformanceBaseline()}initializePerformanceBaseline(){try{const e=performance.memory?.usedJSHeapSize||0,t=performance.now();this.performanceBaseline={memory:e,timing:t}}catch(e){}}registerDefaultStrategies(){this.registerStrategy({name:"network-retry",description:"ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã®å†è©¦è¡Œã¨å¾©æ—§",condition:e=>"network"===e.category||e.message.includes("Failed to fetch")||e.message.includes("Network"),recover:async e=>{const t=await this.diagnoseNetworkStatus();return t.isOffline&&await this.waitForOnline(3e4),await this.clearDNSCache(),this.getRecoveryAttempts("network-retry")>=2?await this.enableOfflineMode():t.isOnline},maxRetries:3,retryDelay:2e3,priority:8,healthCheck:async()=>this.checkNetworkHealth()}),this.registerStrategy({name:"memory-cleanup",description:"ãƒ¡ãƒ¢ãƒªã®æœ€é©åŒ–ã¨ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—",condition:e=>e.message.includes("out of memory")||e.message.includes("Maximum call stack")||"performance"===e.category,recover:async e=>{const t=Date.now();if(this.isCleaningUp||t-this.lastCleanupTime<this.CLEANUP_INTERVAL)return!1;this.isCleaningUp=!0,this.lastCleanupTime=t;try{const e=this.getCurrentMemoryUsage();await this.performMemoryCleanup();return e-this.getCurrentMemoryUsage()>5242880}finally{this.isCleaningUp=!1}},maxRetries:2,retryDelay:1e3,priority:7,healthCheck:async()=>this.checkMemoryHealth()}),this.registerStrategy({name:"vue-component-remount",description:"Vueã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å†ãƒã‚¦ãƒ³ãƒˆã¨çŠ¶æ…‹å¾©æ—§",condition:e=>"vue"===e.category,recover:async e=>{const t=e.component||"unknown";await this.backupComponentState(t);const i=new CustomEvent("app:remount-component",{detail:{component:t,preserveState:!0,errorId:e.fingerprint}});return window.dispatchEvent(i),await new Promise(e=>setTimeout(e,1e3)),await this.restoreComponentState(t),!0},maxRetries:2,retryDelay:1e3,priority:6,rollback:async()=>{location.reload()}}),this.registerStrategy({name:"storage-cleanup",condition:e=>e.message.includes("QuotaExceededError")||e.message.includes("storage"),recover:async()=>(this.cleanupLocalStorage(),!0),maxRetries:1}),this.registerStrategy({name:"game-state-recovery",description:"ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‹ã‚‰ã®å¾©æ—§",condition:e=>"game"===e.category||e.message.includes("game")||e.message.includes("state"),recover:async e=>{if(await this.restoreGameState()){const t=new CustomEvent("app:reinitialize-game",{detail:{reason:"error-recovery",errorId:e.fingerprint}});return window.dispatchEvent(t),!0}return!1},maxRetries:1,priority:9,prerequisites:["memory-cleanup"],rollback:async()=>{const e=new CustomEvent("app:start-new-game",{detail:{reason:"recovery-failed"}});window.dispatchEvent(e)}}),this.registerStrategy({name:"async-retry",description:"éåŒæœŸå‡¦ç†ã®å†è©¦è¡Œ",condition:e=>"async"===e.category&&!e.message.includes("Network"),recover:async e=>{const t=this.getRecoveryAttempts("async-retry"),i=Math.min(1e3*2**t,1e4);await new Promise(e=>setTimeout(e,i));const s=new CustomEvent("app:retry-async-operation",{detail:{originalError:e,attempt:t+1}});return window.dispatchEvent(s),!0},maxRetries:3,retryDelay:1e3,priority:4}),this.registerStrategy({name:"security-fallback",description:"ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£åˆ¶é™ã‚’å›é¿ã™ã‚‹ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯",condition:e=>"security"===e.category||e.message.includes("CORS")||e.message.includes("blocked"),recover:async e=>{const t=new CustomEvent("app:enable-security-fallback",{detail:{reason:e.message}});return window.dispatchEvent(t),!0},maxRetries:1,priority:5})}registerStrategy(e){const t=e.priority||0,i=this.strategies.findIndex(e=>(e.priority||0)<t);-1===i?this.strategies.push(e):this.strategies.splice(i,0,e)}async tryRecover(e){for(const s of this.strategies)if(s.condition(e)){const t=this.getRecoveryAttempts(s.name);if(t>=(s.maxRetries||1))continue;try{t>0&&s.retryDelay&&await new Promise(e=>setTimeout(e,s.retryDelay)),this.incrementRecoveryAttempts(s.name);const i=await s.recover(),n={success:i,strategyUsed:s.name,attemptsCount:t+1};return this.addToHistory(e,n),i&&this.resetRecoveryAttempts(s.name),n}catch(i){const n={success:!1,strategyUsed:s.name,attemptsCount:t+1,error:i};return this.addToHistory(e,n),n}}const t={success:!1,attemptsCount:0};return this.addToHistory(e,t),t}async waitForOnline(e=3e4){if(!navigator.onLine)return new Promise(t=>{const i=()=>{window.removeEventListener("online",i),t()};window.addEventListener("online",i),setTimeout(()=>{window.removeEventListener("online",i),t()},e)})}cleanupEventListeners(){const e=new CustomEvent("app:cleanup-listeners");window.dispatchEvent(e)}clearCaches(){try{sessionStorage.clear()}catch(t){}const e=new CustomEvent("app:clear-caches");window.dispatchEvent(e)}cleanupLocalStorage(){try{const e=[],t=Date.now();for(let i=0;i<localStorage.length;i++){const s=localStorage.key(i);if(s)try{const i=localStorage.getItem(s);if(!i)continue;const n=JSON.parse(i);n.expiry&&n.expiry<t&&e.push(s)}catch{}}if(e.forEach(e=>{localStorage.removeItem(e)}),0===e.length){const e=[];for(let t=0;t<localStorage.length;t++){const i=localStorage.key(t);i&&i.startsWith("game_")&&e.push(i)}e.length>0&&localStorage.removeItem(e[0])}}catch(e){}}getRecoveryAttempts(e){return this.recoveryAttempts.get(e)||0}incrementRecoveryAttempts(e){const t=this.getRecoveryAttempts(e);this.recoveryAttempts.set(e,t+1)}resetRecoveryAttempts(e){this.recoveryAttempts.delete(e)}addToHistory(e,t){this.recoveryHistory.push({timestamp:Date.now(),errorInfo:e,result:t}),this.recoveryHistory.length>this.maxHistorySize&&(this.recoveryHistory=this.recoveryHistory.slice(-this.maxHistorySize))}getStatistics(){const e=this.recoveryHistory.filter(e=>e.result.success).length,t=this.recoveryHistory.filter(e=>!e.result.success).length,i=new Map;return this.recoveryHistory.forEach(e=>{if(e.result.strategyUsed){const t=i.get(e.result.strategyUsed)||{success:0,failed:0};e.result.success?t.success++:t.failed++,i.set(e.result.strategyUsed,t)}}),{total:this.recoveryHistory.length,successful:e,failed:t,successRate:this.recoveryHistory.length>0?e/this.recoveryHistory.length:0,byStrategy:Object.fromEntries(i),currentAttempts:Object.fromEntries(this.recoveryAttempts)}}async diagnoseNetworkStatus(){if(!navigator.onLine)return{isOnline:!1,isOffline:!0};try{const e=performance.now(),t=await fetch("/favicon.ico",{method:"HEAD",cache:"no-cache"}),i=performance.now()-e,s=navigator.connection,n=s?.effectiveType||"unknown";return{isOnline:t.ok,isOffline:!t.ok,latency:i,bandwidth:n}}catch(e){return{isOnline:!1,isOffline:!0}}}async clearDNSCache(){try{"serviceWorker"in navigator&&navigator.serviceWorker.controller&&navigator.serviceWorker.controller.postMessage({type:"CLEAR_DNS_CACHE"})}catch(e){}}async enableOfflineMode(){try{const e=new CustomEvent("app:enable-offline-mode",{detail:{reason:"network-recovery-failed"}});return window.dispatchEvent(e),!0}catch(e){return!1}}async checkNetworkHealth(){try{return(await fetch("/favicon.ico",{method:"HEAD",cache:"no-cache",signal:AbortSignal.timeout(5e3)})).ok}catch{return navigator.onLine}}getCurrentMemoryUsage(){try{return performance.memory?.usedJSHeapSize||0}catch{return 0}}async performMemoryCleanup(){const e=(e,t)=>{"requestIdleCallback"in window?requestIdleCallback(e,t):setTimeout(e,t?.timeout||0)};this.clearCaches(),await new Promise(e=>setTimeout(e,10)),this.cleanupEventListeners(),await new Promise(e=>setTimeout(e,10)),e(()=>this.cleanupDOMElements(),{timeout:1e3}),"gc"in window&&e(()=>window.gc(),{timeout:500}),e(()=>this.detectAndFixMemoryLeaks(),{timeout:2e3})}async cleanupDOMElements(){document.querySelectorAll('[style*="display: none"]').forEach(e=>{e.parentNode&&!e.hasAttribute("data-keep")&&e.parentNode.removeChild(e)});const e=document.querySelectorAll("[data-log-entry]");e.length>100&&Array.from(e).slice(0,e.length-50).forEach(e=>{e.remove()})}async detectAndFixMemoryLeaks(){const e=new CustomEvent("app:detect-memory-leaks");window.dispatchEvent(e),this.cleanupOrphanedTimers()}cleanupOrphanedTimers(){const e=new CustomEvent("app:cleanup-timers");window.dispatchEvent(e)}async checkMemoryHealth(){const e=this.getCurrentMemoryUsage();return!this.performanceBaseline||0===e||e-this.performanceBaseline.memory<104857600}async backupComponentState(e){const t=new CustomEvent("app:backup-component-state",{detail:{component:e}});window.dispatchEvent(t)}async restoreComponentState(e){const t=new CustomEvent("app:restore-component-state",{detail:{component:e}});window.dispatchEvent(t)}async restoreGameState(){try{const e=localStorage.getItem("game_state_backup");if(e){const t=JSON.parse(e),i=new CustomEvent("app:restore-game-state",{detail:{state:t,source:"backup"}});return window.dispatchEvent(i),!0}const t=localStorage.getItem("game_autosave");if(t){const e=JSON.parse(t),i=new CustomEvent("app:restore-game-state",{detail:{state:e,source:"autosave"}});return window.dispatchEvent(i),!0}return!1}catch(e){return!1}}async checkPrerequisites(e){if(!e.prerequisites||0===e.prerequisites.length)return!0;for(const i of e.prerequisites){const e=this.strategies.find(e=>e.name===i);if(e)try{if(!(await e.recover({})))return!1}catch(t){return!1}}return!0}async tryAdvancedRecover(e){const t=[...this.strategies].sort((e,t)=>(t.priority||0)-(e.priority||0));for(const a of t)if(a.condition(e)){const t=this.getRecoveryAttempts(a.name);if(t>=(a.maxRetries||1))continue;if(!(await this.checkPrerequisites(a)))continue;try{t>0&&a.retryDelay&&await new Promise(e=>setTimeout(e,a.retryDelay)),this.incrementRecoveryAttempts(a.name);const i=await a.recover(e);let s=!0;i&&a.healthCheck&&(s=await a.healthCheck());const n={success:i&&s,strategyUsed:a.name,attemptsCount:t+1};return this.addToHistory(e,n),n.success?(this.resetRecoveryAttempts(a.name),n):(a.rollback&&await a.rollback(),n)}catch(s){if(a.rollback)try{await a.rollback()}catch(n){}const i={success:!1,strategyUsed:a.name,attemptsCount:t+1,error:s};return this.addToHistory(e,i),i}}const i={success:!1,attemptsCount:0};return this.addToHistory(e,i),i}clear(){this.recoveryAttempts.clear(),this.recoveryHistory=[],this.gameStateBackup=null,this.performanceBaseline=null}}const Ks=class e{constructor(e={}){i(this,"errorLogger"),i(this,"errorReporter"),i(this,"errorRecovery"),i(this,"options"),i(this,"errorCount",0),i(this,"errorTimestamps",[]),i(this,"isInitialized",!1),i(this,"duplicateErrors",new Map),i(this,"errorPerformanceHistory",[]),this.options={enableLogging:!0,enableReporting:!0,enableRecovery:!0,logToConsole:!0,reportToServer:!1,showUserNotification:!0,maxErrorsPerMinute:10,recoveryStrategies:new Map,...e},this.errorLogger=new Bs,this.errorReporter=new Gs,this.errorRecovery=new Ws}static getInstance(t){return e.instance||(e.instance=new e(t)),e.instance}setupVueErrorHandler(e){e.config.errorHandler=(e,t,i)=>{this.handleError({message:e.message||"Unknown Vue error",stack:e.stack,component:t?.$options.name||"Unknown",props:t?.$props,info:i,timestamp:Date.now(),userAgent:navigator.userAgent,severity:this.determineSeverity(e),category:"vue"})},e.config.warnHandler=(e,t,i)=>{this.errorLogger.logWarning({message:e,component:t?.$options.name||"Unknown",trace:i,timestamp:Date.now()})}}setupGlobalHandlers(){if(!this.isInitialized){if(window.onerror=(e,t,i,s,n)=>{const a="string"==typeof e?e:"Unknown error";return a.includes("setMaxTextures is not a function")||this.handleError({message:a,stack:n?.stack,url:t,line:i,column:s,timestamp:Date.now(),userAgent:navigator.userAgent,severity:this.determineSeverity(n),category:"javascript"}),!0},window.addEventListener("unhandledrejection",e=>{const t=String(e.reason);t.includes("setMaxTextures is not a function")||this.handleError({message:`Unhandled Promise rejection: ${t}`,stack:e.reason?.stack,timestamp:Date.now(),userAgent:navigator.userAgent,severity:"high",category:"async"}),e.preventDefault()}),"PerformanceObserver"in window){const t=new PerformanceObserver(e=>{for(const t of e.getEntries())"resource"===t.entryType&&"responseStatus"in t&&t.responseStatus>=400&&this.handleError({message:`Network error: ${t.name}`,url:t.name,timestamp:Date.now(),userAgent:navigator.userAgent,severity:"medium",category:"network"})});try{t.observe({entryTypes:["resource"]})}catch(e){}}this.isInitialized=!0}}handleError(e){const t=this.enhanceErrorInfo(e);this.checkRateLimit()&&(this.errorCount++,t.fingerprint=this.generateFingerprint(t),this.isDuplicateError(t)?this.options.enableLogging&&this.errorLogger.log(t):(this.options.enableLogging&&(this.errorLogger.log(t),this.options.logToConsole&&this.logStructuredError(t)),this.options.enableReporting&&this.options.reportToServer&&this.errorReporter.report(t),this.options.enableRecovery&&this.errorRecovery.tryAdvancedRecover(t).then(e=>{const i=new CustomEvent("app:recovery-result",{detail:{success:e.success,strategy:e.strategyUsed,attempts:e.attemptsCount,errorId:t.fingerprint}});if(window.dispatchEvent(i),e.success){const i=new CustomEvent("app:error",{detail:{message:`ã‚¨ãƒ©ãƒ¼ã‹ã‚‰è‡ªå‹•å¾©æ—§ã—ã¾ã—ãŸ (${e.strategyUsed})`,severity:"info",category:"system",timestamp:Date.now(),userAgent:navigator.userAgent,context:{originalError:t.fingerprint,recoveryStrategy:e.strategyUsed}}});window.dispatchEvent(i)}}).catch(e=>{this.handleError({message:`Recovery system failure: ${e.message}`,stack:e.stack,category:"system",severity:"high",timestamp:Date.now(),userAgent:navigator.userAgent,context:{originalError:t.fingerprint,recoveryError:!0}})}),this.options.showUserNotification&&"low"!==t.severity&&this.notifyUser(t),this.trackErrorPerformance(t)))}determineSeverity(e){if(!e)return"low";const t=e.message||e.toString(),i=e.stack||"";return t.includes("Cannot read property")||t.includes("Cannot access before initialization")||t.includes("is not defined")||t.includes("Maximum call stack")||t.includes("Out of memory")||t.includes("Script error")||t.includes("ChunkLoadError")||i.includes("at Object.exports")||"TypeError"===e.name&&t.includes("null")?"critical":t.includes("Network error")||t.includes("Failed to fetch")||t.includes("Promise rejection")||t.includes("Timeout")||t.includes("CORS")||t.includes("401")||t.includes("403")||t.includes("500")||t.includes("Game state")||t.includes("Save failed")||"SecurityError"===e.name?"high":t.includes("Warning")||t.includes("Deprecated")||t.includes("Performance")||t.includes("Slow")||t.includes("404")||t.includes("Render")||t.includes("Animation")?"medium":"low"}checkRateLimit(){const e=Date.now(),t=e-6e4;return this.errorTimestamps=this.errorTimestamps.filter(e=>e>t),!(this.errorTimestamps.length>=this.options.maxErrorsPerMinute||(this.errorTimestamps.push(e),0))}notifyUser(e){let t="ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ";switch(e.category){case"network":t="ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã«å•é¡ŒãŒç™ºç”Ÿã—ã¾ã—ãŸ";break;case"async":t="å‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ";break;case"vue":t="ç”»é¢ã®è¡¨ç¤ºã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ";break;default:t="äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ"}this.showErrorNotification(t,e.severity)}showErrorNotification(e,t){const i=new CustomEvent("app:error",{detail:{message:e,severity:t}});window.dispatchEvent(i)}getErrorStats(){return{totalErrors:this.errorCount,recentErrors:this.errorTimestamps.length,logs:this.errorLogger.getLogs(),isHealthy:this.errorTimestamps.length<this.options.maxErrorsPerMinute/2}}reset(){this.errorCount=0,this.errorTimestamps=[],this.errorLogger.clear()}enhanceErrorInfo(e){const t={...e.context,route:window.location.pathname,deviceInfo:{isMobile:/Mobile|Android|iPhone|iPad/.test(navigator.userAgent),screenSize:`${window.screen.width}x${window.screen.height}`,connection:navigator.connection?.effectiveType||"unknown"}},i=[...e.tags||[],e.category,e.severity,t.deviceInfo.isMobile?"mobile":"desktop"],s=[...e.breadcrumbs||[],{timestamp:Date.now(),category:"error",message:"Error captured by handler",data:{component:e.component}}];return{...e,context:t,tags:i,breadcrumbs:s}}generateFingerprint(e){const t=[e.message,e.component||"unknown",e.category,e.context?.route||"unknown"].join("|");let i=0;for(let s=0;s<t.length;s++)i=(i<<5)-i+t.charCodeAt(s),i&=i;return Math.abs(i).toString(16)}isDuplicateError(e){if(!e.fingerprint)return!1;const t=Date.now();return t-(this.duplicateErrors.get(e.fingerprint)||0)<6e4||(this.duplicateErrors.set(e.fingerprint,t),!1)}logStructuredError(e){new Date(e.timestamp).toISOString()}trackErrorPerformance(e){this.errorPerformanceHistory.push({timestamp:Date.now(),severity:e.severity});const t=Date.now()-36e5;this.errorPerformanceHistory=this.errorPerformanceHistory.filter(e=>e.timestamp>t),this.errorPerformanceHistory.filter(e=>"critical"===e.severity&&e.timestamp>Date.now()-3e5).length>=3&&this.triggerSystemAlert("Multiple critical errors detected")}triggerSystemAlert(e){const t=new CustomEvent("app:system-alert",{detail:{message:e,timestamp:Date.now()}});window.dispatchEvent(t)}addBreadcrumb(e,t,i){}getHealthStatus(){const e=this.errorTimestamps.filter(e=>e>Date.now()-3e5).length,t=this.errorPerformanceHistory.filter(e=>"critical"===e.severity&&e.timestamp>Date.now()-3e5).length;return{isHealthy:e<this.options.maxErrorsPerMinute/2&&0===t,recentErrorCount:e,criticalErrorCount:t,totalErrors:this.errorCount,rateLimit:{current:this.errorTimestamps.length,max:this.options.maxErrorsPerMinute}}}destroy(){window.onerror=null,window.removeEventListener("unhandledrejection",()=>{}),this.duplicateErrors.clear(),this.errorPerformanceHistory=[],this.reset(),this.isInitialized=!1}};i(Ks,"instance");let Qs=Ks;const Js={BASE_URL:"/insurance_self_game/",DEV:!1,MODE:"production",PROD:!0,SSR:!1};class Ys{constructor(e,t="unknown",s="unknown"){i(this,"sessionId"),i(this,"buildVersion"),i(this,"environment"),i(this,"gameStateProvider"),i(this,"componentProvider"),i(this,"featureProvider"),this.sessionId=e,this.buildVersion=t,this.environment=s}setGameStateProvider(e){this.gameStateProvider=e}setComponentProvider(e){this.componentProvider=e}setFeatureProvider(e){this.featureProvider=e}collect(e={}){const t={includeMemory:!0,includePerformance:!0,includeGameState:!0,includeExperimental:!1,sanitize:!0,maxDataSize:102400,...e};try{const e={timestamp:(new Date).toISOString(),sessionId:this.sessionId,buildVersion:this.buildVersion,environment:this.environment,system:this.collectSystemInfo(),performance:this.collectPerformanceInfo(t),application:this.collectApplicationInfo(t),features:this.collectFeatureInfo()};return t.includeExperimental&&(e.experimental=this.collectExperimentalInfo()),t.maxDataSize&&JSON.stringify(e).length>t.maxDataSize?this.truncateData(e,t.maxDataSize):t.sanitize?this.sanitizeData(e):e}catch(i){return{timestamp:(new Date).toISOString(),sessionId:this.sessionId,buildVersion:this.buildVersion,environment:this.environment,system:{userAgent:navigator.userAgent,platform:navigator.platform,language:navigator.language,cookieEnabled:navigator.cookieEnabled,onLine:navigator.onLine,screenResolution:`${screen.width}x${screen.height}`,viewportSize:`${window.innerWidth}x${window.innerHeight}`,devicePixelRatio:window.devicePixelRatio,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone},performance:{timing:{navigationStart:0,loadComplete:0,domReady:0}},application:{url:this.sanitizeUrl(window.location.href),referrer:this.sanitizeUrl(document.referrer),activeFeatures:[],errorCount:0},features:{localStorage:!1,sessionStorage:!1,webGL:!1,webWorker:!1,serviceWorker:!1,notifications:!1,geolocation:!1,mediaDevices:!1}}}}collectSystemInfo(){return{userAgent:navigator.userAgent,platform:navigator.platform,language:navigator.language,cookieEnabled:navigator.cookieEnabled,onLine:navigator.onLine,screenResolution:`${screen.width}x${screen.height}`,viewportSize:`${window.innerWidth}x${window.innerHeight}`,devicePixelRatio:window.devicePixelRatio,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone}}collectPerformanceInfo(e){const t={timing:{navigationStart:performance.timing.navigationStart,loadComplete:performance.timing.loadEventEnd-performance.timing.navigationStart,domReady:performance.timing.domContentLoadedEventEnd-performance.timing.navigationStart}};if(e.includeMemory&&"memory"in performance){const e=performance.memory;t.memory={used:e.usedJSHeapSize,total:e.totalJSHeapSize,limit:e.jsHeapSizeLimit}}if(e.includePerformance&&"getEntriesByType"in performance)try{const e=performance.getEntriesByType("paint"),i=e.find(e=>"first-paint"===e.name),s=e.find(e=>"first-contentful-paint"===e.name);i&&(t.timing.firstPaint=i.startTime),s&&(t.timing.firstContentfulPaint=s.startTime)}catch(i){}if("connection"in navigator){const e=navigator.connection;t.connection={effectiveType:e.effectiveType||"unknown",downlink:e.downlink||0,rtt:e.rtt||0}}return t}collectApplicationInfo(e){const t={url:this.sanitizeUrl(window.location.href),referrer:this.sanitizeUrl(document.referrer),activeFeatures:this.featureProvider?this.featureProvider():this.detectActiveFeatures(),errorCount:this.getErrorCount()};if(e.includeGameState&&this.gameStateProvider)try{t.gameState=this.gameStateProvider()}catch(s){t.gameState="error"}if(this.componentProvider)try{t.currentComponent=this.componentProvider()}catch(s){}window.location.pathname&&(t.routePath=window.location.pathname);const i=this.getLastError();return i&&(t.lastError=i),t}collectFeatureInfo(){return{localStorage:this.testFeature(()=>"localStorage"in window&&null!==window.localStorage),sessionStorage:this.testFeature(()=>"sessionStorage"in window&&null!==window.sessionStorage),webGL:this.testFeature(()=>this.hasWebGL()),webWorker:this.testFeature(()=>"Worker"in window),serviceWorker:this.testFeature(()=>"serviceWorker"in navigator),notifications:this.testFeature(()=>"Notification"in window),geolocation:this.testFeature(()=>"geolocation"in navigator),mediaDevices:this.testFeature(()=>"mediaDevices"in navigator)}}collectExperimentalInfo(){return{flags:this.getFeatureFlags(),abTests:this.getABTests(),featureToggles:this.getFeatureToggles()}}testFeature(e){try{return e()}catch{return!1}}hasWebGL(){try{const e=document.createElement("canvas");return Boolean(e.getContext("webgl")||e.getContext("experimental-webgl"))}catch{return!1}}sanitizeUrl(e){if(!e)return"";try{const t=new URL(e),i=new URLSearchParams;return t.searchParams.forEach((e,t)=>{this.isSensitiveParam(t)||i.set(t,e)}),`${t.origin}${t.pathname}${i.toString()?`?${i.toString()}`:""}`}catch{return e.split("?")[0].split("#")[0]}}isSensitiveParam(e){return["token","auth","session","key","secret","password","pwd","pass","api_key","apikey","access_token","refresh_token","jwt","bearer"].some(t=>e.toLowerCase().includes(t))}detectActiveFeatures(){const e=[];document.querySelector("[data-game-canvas]")&&e.push("game"),document.querySelector("[data-tutorial]")&&e.push("tutorial"),document.querySelector("[data-statistics]")&&e.push("statistics"),document.querySelector("[data-settings]")&&e.push("settings");try{localStorage.getItem("game_settings")&&e.push("settings-saved"),localStorage.getItem("game_progress")&&e.push("progress-saved"),localStorage.getItem("tutorial_completed")&&e.push("tutorial-completed")}catch{}return e}getErrorCount(){try{const e=window.__errorHandling;if(e?.getStatistics)return e.getStatistics().totalErrors||0}catch{}return 0}getLastError(){try{const e=window.__errorHandling;if(e?.getStatistics){const t=e.getStatistics();if(t.logs&&t.logs.length>0){const e=t.logs[t.logs.length-1];return{message:e.errorInfo.message,timestamp:e.timestamp,severity:e.errorInfo.severity}}}}catch{}}getFeatureFlags(){const e={};try{Object.keys(Js).filter(e=>e.startsWith("VITE_FEATURE_FLAG_")).forEach(t=>{const i=t.replace("VITE_FEATURE_FLAG_","").toLowerCase();e[i]="true"===Js[t]})}catch{}return e}getABTests(){const e={};try{const t=localStorage.getItem("ab_tests");t&&Object.assign(e,JSON.parse(t))}catch{}return e}getFeatureToggles(){const e={};try{const t=localStorage.getItem("feature_toggles");t&&Object.assign(e,JSON.parse(t))}catch{}return e}sanitizeData(e){const t=JSON.parse(JSON.stringify(e));return t.system.userAgent&&(t.system.userAgent=this.sanitizeUserAgent(t.system.userAgent)),t}sanitizeUserAgent(e){return e.split(" ").filter(e=>e.includes("Chrome")||e.includes("Firefox")||e.includes("Safari")||e.includes("Edge")||e.includes("Mobile")||e.includes("Windows")||e.includes("Mac")||e.includes("Linux")).slice(0,5).join(" ")}truncateData(e,t){const i={...e};return delete i.experimental,i.performance.memory&&delete i.performance.memory,i.performance.connection&&delete i.performance.connection,JSON.stringify(i).length>t&&(i.application={url:i.application.url,errorCount:i.application.errorCount,activeFeatures:[]}),i}}let Xs=null;const Zs=new class{constructor(){i(this,"globalHandler"),i(this,"isInitialized",!1),i(this,"config",{}),i(this,"debugCollector")}initialize(e={}){var t,i,s;this.isInitialized||(this.config={enableLogging:!0,enableReporting:!0,enableRecovery:!0,enableUserNotifications:!0,maxErrorsPerMinute:10,logToConsole:!1,reportToServer:!0,environment:"production",...e},this.globalHandler=Qs.getInstance({enableLogging:this.config.enableLogging,enableReporting:this.config.enableReporting,enableRecovery:this.config.enableRecovery,logToConsole:this.config.logToConsole,reportToServer:this.config.reportToServer,showUserNotification:this.config.enableUserNotifications,maxErrorsPerMinute:this.config.maxErrorsPerMinute}),this.globalHandler.setupGlobalHandlers(),this.debugCollector=(t=this.generateSessionId(),i=this.config.buildVersion,s=this.config.environment,Xs||(Xs=new Ys(t||"unknown",i||"unknown",s||"production")),Xs),this.config.userId&&this.setUserId(this.config.userId),this.setupEventListeners(),this.isInitialized=!0)}integrateWithVue(e){if(!this.globalHandler)throw new Error("ErrorHandlingSystem must be initialized before Vue integration");this.globalHandler.setupVueErrorHandler(e)}setUserId(e){if(this.config.userId=e,this.globalHandler)try{this.globalHandler.errorReporter.setUserId(e)(this.globalHandler).errorLogger.setUserId(e)}catch(t){}}reportError(e,t,i="user"){if(!this.globalHandler)return;const s={message:"string"==typeof e?e:e.message,stack:"object"==typeof e?e.stack:void 0,category:i,severity:"medium",timestamp:Date.now(),userAgent:navigator.userAgent,context:{...t,source:"manual-report",userId:this.config.userId}};this.globalHandler.handleError(s)}addErrorPattern(e){Be.addPattern(e)}getHealthStatus(){return this.globalHandler?this.globalHandler.getHealthStatus():{isHealthy:!1,error:"Not initialized"}}getStatistics(){return this.globalHandler?this.globalHandler.getErrorStats():null}addErrorListener(e){const t=t=>{e(t.detail)};return window.addEventListener("app:error",t),()=>{window.removeEventListener("app:error",t)}}setupEventListeners(){window.addEventListener("app:error-alert",e=>{this.config.onAlert&&this.config.onAlert(e.detail.type,e.detail.data)}),window.addEventListener("app:system-alert",e=>{this.config.onAlert&&this.config.onAlert("system-alert",e.detail)}),window.addEventListener("app:recovery-result",e=>{this.config.onRecovery&&this.config.onRecovery(e.detail.success,e.detail.strategy)}),this.setupPerformanceMonitoring()}setupVueDevToolsIntegration(){const e=window.__VUE_DEVTOOLS_GLOBAL_HOOK__;this.addErrorListener(t=>{e.emit("app:error",{type:"error",payload:{error:t,timestamp:Date.now()}})})}setupPerformanceMonitoring(){if("memory"in performance&&setInterval(()=>{const e=performance.memory,t=e.usedJSHeapSize,i=e.jsHeapSizeLimit;t/i>.8&&this.reportError("High memory usage detected",{memoryUsed:t,memoryLimit:i,percentage:Math.round(t/i*100)},"performance")},3e4),"PerformanceObserver"in window)try{let e=0;const t=6e4,i=100;new PerformanceObserver(s=>{const n=Date.now();if(n-e<t)return;const a=s.getEntries().filter(e=>e.duration>i);if(a.length>0){const t=a.reduce((e,t)=>t.duration>e.duration?t:e);this.reportError("Long task detected",{duration:Math.round(t.duration),startTime:Math.round(t.startTime),name:t.name,taskCount:a.length,totalDuration:Math.round(a.reduce((e,t)=>e+t.duration,0))},"performance"),e=n}}).observe({entryTypes:["longtask"]})}catch(e){}}collectDebugInfo(e){if(this.debugCollector)try{return this.debugCollector.collect(e)}catch(i){}const t={timestamp:(new Date).toISOString(),userAgent:navigator.userAgent,url:window.location.href,config:this.config,isInitialized:this.isInitialized};return"memory"in performance&&(t.memory=performance.memory),"connection"in navigator&&(t.connection=navigator.connection),t.timing=performance.timing,this.globalHandler&&(t.errorStats=this.getStatistics(),t.healthStatus=this.getHealthStatus()),t}setGameStateProvider(e){this.debugCollector&&this.debugCollector.setGameStateProvider(e)}setComponentProvider(e){this.debugCollector&&this.debugCollector.setComponentProvider(e)}setFeatureProvider(e){this.debugCollector&&this.debugCollector.setFeatureProvider(e)}generateSessionId(){return`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}destroy(){this.globalHandler&&(this.globalHandler.destroy(),this.globalHandler=void 0),this.isInitialized=!1}},en={install(e,t={}){Zs.initialize(t),Zs.integrateWithVue(e),e.config.globalProperties.$errorHandling={reportError:Zs.reportError.bind(Zs),getHealth:Zs.getHealthStatus.bind(Zs),getStats:Zs.getStatistics.bind(Zs),collectDebugInfo:Zs.collectDebugInfo.bind(Zs)},e.provide("errorHandling",Zs)}},tn=new class{constructor(){i(this,"registration",null),i(this,"updateAvailable",!1),i(this,"refreshing",!1),i(this,"installPrompt",null),i(this,"capabilities",{canInstall:!1,isInstalled:!1,isStandalone:!1,hasNotificationPermission:!1,hasBackgroundSync:!1,isOfflineReady:!1}),i(this,"config",{})}async register(e={}){if("serviceWorker"in navigator){this.config=e;try{const t="/insurance_self_game/",i=await navigator.serviceWorker.register(`${t}service-worker.js`,{scope:t});this.registration=i,await this.initializePWAFeatures(),e.onSuccess&&e.onSuccess(i),this.checkForUpdates(i,e),this.setupNetworkListeners(e),this.setupRefreshListener(),this.setupInstallPrompt(),e.enableNotifications&&await this.setupNotifications(),e.enableBackgroundSync&&this.setupBackgroundSync(),this.setupAccessibilityCache(),setInterval(()=>{i.update()},36e5)}catch(t){e.onError&&e.onError(t)}}}async initializePWAFeatures(){this.capabilities={canInstall:"serviceWorker"in navigator&&"PushManager"in window,isInstalled:this.isRunningStandalone(),isStandalone:this.isRunningStandalone(),hasNotificationPermission:"granted"===Notification.permission,hasBackgroundSync:"serviceWorker"in navigator&&"sync"in window.ServiceWorkerRegistration.prototype,isOfflineReady:null!==this.registration},this.cacheAccessibilitySettings(),this.config.offlineGameMode&&this.setupOfflineGameMode()}isRunningStandalone(){return window.matchMedia("(display-mode: standalone)").matches||!0===window.navigator.standalone||document.referrer.includes("android-app://")}setupInstallPrompt(){window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),this.installPrompt=e,this.capabilities.canInstall=!0,this.dispatchPWAEvent("installable",{canInstall:!0})}),window.addEventListener("appinstalled",()=>{this.capabilities.isInstalled=!0,this.installPrompt=null,this.dispatchPWAEvent("installed",{isInstalled:!0})})}async setupNotifications(){if("Notification"in window){if("default"===Notification.permission){const e=await Notification.requestPermission();this.capabilities.hasNotificationPermission="granted"===e}if(this.registration&&"PushManager"in window)try{await this.registration.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:this.urlBase64ToUint8Array(this.getVAPIDPublicKey())})}catch(e){}}}setupBackgroundSync(){this.capabilities.hasBackgroundSync&&navigator.serviceWorker.addEventListener("message",e=>{e.data&&"BACKGROUND_SYNC"===e.data.type&&this.config.onBackgroundSync&&this.config.onBackgroundSync(e.data.tag)})}setupAccessibilityCache(){const e=localStorage.getItem("accessibility-settings");e&&this.registration?.active&&this.registration.active.postMessage({type:"CACHE_ACCESSIBILITY_SETTINGS",settings:JSON.parse(e)}),window.addEventListener("storage",e=>{"accessibility-settings"===e.key&&this.registration?.active&&this.registration.active.postMessage({type:"UPDATE_ACCESSIBILITY_SETTINGS",settings:JSON.parse(e.newValue||"{}")})})}setupOfflineGameMode(){const e={savedGames:localStorage.getItem("saved-games"),gameSettings:localStorage.getItem("game-settings"),statistics:localStorage.getItem("game-statistics")};this.registration?.active&&this.registration.active.postMessage({type:"CACHE_GAME_DATA",data:e}),window.addEventListener("offline",()=>{this.dispatchPWAEvent("offline-mode",{features:["local-save","basic-gameplay"],disabled:["online-leaderboard","cloud-sync"]})})}cacheAccessibilitySettings(){const e={highContrast:document.documentElement.classList.contains("high-contrast"),reducedMotion:document.documentElement.classList.contains("reduce-motion"),fontSize:document.documentElement.style.fontSize,colorScheme:document.documentElement.getAttribute("data-color-scheme")};this.registration?.active&&this.registration.active.postMessage({type:"CACHE_ACCESSIBILITY_STATE",state:e})}checkForUpdates(e,t){e.installing&&this.trackInstalling(e.installing,t),e.waiting&&(this.updateAvailable=!0,t.onUpdate&&t.onUpdate(e)),e.addEventListener("updatefound",()=>{const i=e.installing;i&&this.trackInstalling(i,t)})}trackInstalling(e,t){e.addEventListener("statechange",()=>{"installed"===e.state&&navigator.serviceWorker.controller&&(this.updateAvailable=!0,t.onUpdate&&t.onUpdate(this.registration))})}setupNetworkListeners(e){window.addEventListener("online",()=>{e.onOnline&&e.onOnline()}),window.addEventListener("offline",()=>{e.onOffline&&e.onOffline()})}setupRefreshListener(){navigator.serviceWorker.addEventListener("controllerchange",()=>{this.refreshing||(this.refreshing=!0,window.location.reload())})}async update(){if(this.registration)try{await this.registration.update(),this.registration.waiting&&this.registration.waiting.postMessage({type:"SKIP_WAITING"})}catch(e){}}async clearCache(){if(navigator.serviceWorker.controller&&(navigator.serviceWorker.controller.postMessage({type:"CLEAR_CACHE"}),"caches"in window)){const e=await caches.keys();await Promise.all(e.map(async e=>caches.delete(e)))}}async unregister(){if(this.registration)try{await this.registration.unregister()&&(this.registration=null)}catch(e){}}isUpdateAvailable(){return this.updateAvailable}isOfflineReady(){return null!==this.registration&&null!==this.registration.active}async promptInstall(){if(!this.installPrompt)return!1;try{return this.installPrompt.prompt(),"accepted"===(await this.installPrompt.userChoice).outcome}catch(e){return!1}}getPWACapabilities(){return{...this.capabilities}}async sendNotification(e,t={}){this.capabilities.hasNotificationPermission&&this.registration&&await this.registration.showNotification(e,{icon:"/icons/icon-192x192.png",badge:"/icons/badge-72x72.png",vibrate:[200,100,200],tag:"game-notification",renotify:!0,requireInteraction:!1,...t})}async requestBackgroundSync(e){if(this.capabilities.hasBackgroundSync&&this.registration)try{await this.registration.sync.register(e)}catch(t){}}dispatchPWAEvent(e,t){const i=new CustomEvent(`pwa-${e}`,{detail:t});window.dispatchEvent(i)}getVAPIDPublicKey(){return"YOUR_VAPID_PUBLIC_KEY_HERE"}urlBase64ToUint8Array(e){const t=(e+"=".repeat((4-e.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/"),i=window.atob(t),s=new Uint8Array(i.length);for(let n=0;n<i.length;++n)s[n]=i.charCodeAt(n);return s}getPWAStats(){return{capabilities:this.capabilities,updateAvailable:this.updateAvailable,isOnline:navigator.onLine,installPromptAvailable:null!==this.installPrompt,registration:{scope:this.registration?.scope,updateViaCache:this.registration?.updateViaCache,active:this.registration?.active?.state}}}},sn={color:"rgba(255, 255, 255, 0.6)",duration:700,opacity:.6,centered:!1,disabled:!1};const nn=new class{constructor(){i(this,"metrics",{}),i(this,"observers",[]),i(this,"isMonitoring",!1),this.setupPerformanceObservers(),this.trackCustomMetrics()}setupPerformanceObservers(){if("undefined"!=typeof window&&"PerformanceObserver"in window){try{const e=new PerformanceObserver(e=>{e.getEntries().forEach(e=>{"first-contentful-paint"===e.name&&(this.metrics.fcp=e.startTime,this.reportMetric("FCP",e.startTime))})});e.observe({entryTypes:["paint"]}),this.observers.push(e);const t=new PerformanceObserver(e=>{const t=e.getEntries(),i=t[t.length-1];this.metrics.lcp=i.startTime,this.reportMetric("LCP",i.startTime)});t.observe({entryTypes:["largest-contentful-paint"]}),this.observers.push(t);let i=0;const s=new PerformanceObserver(e=>{for(const t of e.getEntries())t.hadRecentInput||(i+=t.value);this.metrics.cls=i,this.reportMetric("CLS",i)});if(s.observe({entryTypes:["layout-shift"]}),this.observers.push(s),"PerformanceEventTiming"in window){const e=new PerformanceObserver(e=>{e.getEntries().forEach(e=>{if(e.processingStart&&e.startTime){const t=e.processingStart-e.startTime,i=e.processingEnd-e.processingStart,s=t+i+(e.duration-t-i);this.metrics.inp=Math.max(this.metrics.inp||0,s),this.reportMetric("INP",s)}})});e.observe({type:"event",buffered:!0}),this.observers.push(e)}const n=new PerformanceObserver(e=>{e.getEntries().forEach(e=>{"navigation"===e.entryType&&(this.metrics.appInitTime=e.loadEventEnd-e.fetchStart,this.reportMetric("App Init Time",this.metrics.appInitTime))})});n.observe({entryTypes:["navigation"]}),this.observers.push(n)}catch(e){}this.isMonitoring=!0}}trackCustomMetrics(){if("memory"in performance&&setInterval(()=>{const e=performance.memory;this.metrics.memoryUsage=e.usedJSHeapSize/1024/1024},1e4),"connection"in navigator){const e=navigator.connection;this.metrics.connectionType=e.type,this.metrics.effectiveType=e.effectiveType,this.metrics.downlink=e.downlink,this.metrics.rtt=e.rtt}}reportMetric(e,t){window.window.gtag&&window.window.gtag("event","web_vitals",{event_category:"Web Vitals",event_label:e,value:Math.round(t),non_interaction:!0})}getMetricCategory(e,t){const i={FCP:{good:1800,needs_improvement:3e3},LCP:{good:2500,needs_improvement:4e3},CLS:{good:.1,needs_improvement:.25},INP:{good:200,needs_improvement:500},FID:{good:100,needs_improvement:300}}[e];return i?t<=i.good?"âœ… Good":t<=i.needs_improvement?"âš ï¸ Needs Improvement":"âŒ Poor":""}markGameStart(){performance.mark("game-start")}markGameLoaded(){performance.mark("game-loaded"),performance.measure("game-load-time","game-start","game-loaded");const e=performance.getEntriesByName("game-load-time")[0];e&&(this.metrics.gameLoadTime=e.duration,this.reportMetric("Game Load Time",e.duration))}markRouteChange(e){const t=`route-${e}`;performance.mark(t);const i=performance.getEntriesByType("mark").filter(e=>e.name.startsWith("route-")).slice(-2);if(2===i.length){const t=`route-change-${e}`;performance.measure(t,i[0].name,i[1].name);const s=performance.getEntriesByName(t)[0];s&&(this.metrics.routeChangeTime=s.duration,this.reportMetric("Route Change Time",s.duration))}}getMetrics(){return{...this.metrics}}getPerformanceScore(){const{fcp:e,lcp:t,cls:i,inp:s}=this.metrics;let n=100;return e&&(e>3e3?n-=25:e>1800?n-=15:e>1e3&&(n-=5)),t&&(t>4e3?n-=25:t>2500?n-=15:t>1500&&(n-=5)),void 0!==i&&(i>.25?n-=25:i>.1?n-=15:i>.05&&(n-=5)),s&&(s>500?n-=25:s>200?n-=15:s>100&&(n-=5)),Math.max(0,Math.min(100,n))}generateReport(){const e=this.getMetrics();return`\nPerformance Report\n==================\nOverall Score: ${this.getPerformanceScore()}/100\n\nCore Web Vitals:\n- FCP: ${e.fcp?.toFixed(2)||"N/A"}ms ${e.fcp?this.getMetricCategory("FCP",e.fcp):""}\n- LCP: ${e.lcp?.toFixed(2)||"N/A"}ms ${e.lcp?this.getMetricCategory("LCP",e.lcp):""}\n- CLS: ${e.cls?.toFixed(3)||"N/A"} ${void 0!==e.cls?this.getMetricCategory("CLS",e.cls):""}\n- INP: ${e.inp?.toFixed(2)||"N/A"}ms ${e.inp?this.getMetricCategory("INP",e.inp):""}\n\nCustom Metrics:\n- App Init: ${e.appInitTime?.toFixed(2)||"N/A"}ms\n- Game Load: ${e.gameLoadTime?.toFixed(2)||"N/A"}ms\n- Memory Usage: ${e.memoryUsage?.toFixed(2)||"N/A"}MB\n\nNetwork:\n- Connection: ${e.connectionType||"N/A"}\n- Effective Type: ${e.effectiveType||"N/A"}\n- Downlink: ${e.downlink||"N/A"}Mbps\n- RTT: ${e.rtt||"N/A"}ms\n    `.trim()}cleanup(){this.observers.forEach(e=>{e.disconnect()}),this.observers=[],this.isMonitoring=!1}},an=new class{constructor(){i(this,"observer",null),i(this,"loadedResources",new Set),i(this,"resourceQueue",[]),i(this,"isProcessingQueue",!1),this.setupIntersectionObserver(),this.setupIdleCallback()}setupIntersectionObserver(){"undefined"!=typeof window&&"IntersectionObserver"in window&&(this.observer=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(this.loadElement(e.target),this.observer?.unobserve(e.target))})},{rootMargin:"50px 0px",threshold:.1}))}setupIdleCallback(){setTimeout(()=>{if(this.isProcessingQueue||0===this.resourceQueue.length)return;this.isProcessingQueue=!0;const e=t=>{for(;t.timeRemaining()>0&&this.resourceQueue.length>0;){const e=this.resourceQueue.shift();!e||e.loaded||e.loading||this.processResource(e)}this.resourceQueue.length>0?this.requestIdleCallback(e):this.isProcessingQueue=!1};this.requestIdleCallback(e)},100)}requestIdleCallback(e){"requestIdleCallback"in window?requestIdleCallback(e,{timeout:2e3}):setTimeout(()=>{e({timeRemaining:()=>10,didTimeout:!1})},16)}async processResource(e){e.loading=!0;try{e.url.match(/\.(js|ts)$/)?await this.loadScript(e.url):e.url.match(/\.css$/)?await this.loadStylesheet(e.url):e.url.match(/\.(jpg|jpeg|png|webp|svg|gif)$/)&&await this.loadImage(e.url),e.loaded=!0,this.loadedResources.add(e.url)}catch(t){}finally{e.loading=!1}}async loadScript(e){return new Promise((t,i)=>{const s=document.createElement("script");s.src=e,s.async=!0,s.onload=()=>{t()},s.onerror=()=>{i(new Error(`Script load failed: ${e}`))},document.head.appendChild(s)})}async loadStylesheet(e){return new Promise((t,i)=>{const s=document.createElement("link");s.rel="stylesheet",s.href=e,s.onload=()=>{t()},s.onerror=()=>{i(new Error(`Stylesheet load failed: ${e}`))},document.head.appendChild(s)})}async loadImage(e){return new Promise((t,i)=>{const s=new Image;s.onload=()=>{t()},s.onerror=()=>{i(new Error(`Image load failed: ${e}`))},s.src=e})}loadElement(e){const t=e.dataset.src,i=e.dataset.srcset;if("IMG"===e.tagName){const s=e;s.classList.add("loading"),t&&(s.src=t),i&&(s.srcset=i),s.onload=()=>{s.classList.remove("loading"),s.classList.add("loaded")},s.onerror=()=>{s.classList.remove("loading"),s.classList.add("error")}}else e.dataset.background&&(e.style.backgroundImage=`url(${e.dataset.background})`,e.classList.add("loaded"))}observe(e,t={}){if(this.observer){if("IMG"===e.tagName){const t=e;t.src&&!t.dataset.src&&(t.dataset.src=t.src,t.src=this.generatePlaceholder(t))}this.observer.observe(e)}}preloadResource(e,t="medium"){if(this.loadedResources.has(e))return;const i="high"===t?3:"medium"===t?2:1;this.resourceQueue.push({url:e,priority:i,loaded:!1,loading:!1}),this.resourceQueue.sort((e,t)=>t.priority-e.priority)}preloadImages(e,t="low"){e.forEach(e=>{this.preloadResource(e,t)})}async loadComponent(e){return new Promise((t,i)=>{const s=(n=3)=>{e().then(t).catch(e=>{n>0?setTimeout(()=>{s(n-1)},1e3):i(e)})};s()})}generatePlaceholder(e){const t=e.width||200,i=e.height||200;return`data:image/svg+xml;base64,${btoa(`\n      <svg width="${t}" height="${i}" xmlns="http://www.w3.org/2000/svg">\n        <rect width="100%" height="100%" fill="#374151"/>\n        <rect width="100%" height="100%" fill="url(#shimmer)" opacity="0.3"/>\n        <defs>\n          <linearGradient id="shimmer" x1="0%" y1="0%" x2="100%" y2="0%">\n            <stop offset="0%" style="stop-color:#4B5563;stop-opacity:0"/>\n            <stop offset="50%" style="stop-color:#6B7280;stop-opacity:1"/>\n            <stop offset="100%" style="stop-color:#4B5563;stop-opacity:0"/>\n            <animateTransform attributeName="gradientTransform" type="translate" \n              values="-100 0;100 0;-100 0" dur="2s" repeatCount="indefinite"/>\n          </linearGradient>\n        </defs>\n      </svg>\n    `)}`}getLoadedResourcesCount(){return this.loadedResources.size}getQueueLength(){return this.resourceQueue.length}getStats(){return{loadedResources:this.loadedResources.size,queueLength:this.resourceQueue.length,isProcessing:this.isProcessingQueue}}cleanup(){this.observer&&(this.observer.disconnect(),this.observer=null),this.resourceQueue=[],this.loadedResources.clear()}},rn={mounted(e,t){const i=t.value||{};an.observe(e,i)},unmounted(e){}},on=class e{constructor(){i(this,"currentConfig",null),i(this,"structuredDataCache",new Map)}static getInstance(){return e.instance||(e.instance=new e),e.instance}updatePageSEO(e){this.currentConfig=e,document.title=e.title,this.updateMetaTag("description",e.description),this.updateMetaTag("keywords",e.keywords.join(",")),this.updateMetaProperty("og:title",e.title),this.updateMetaProperty("og:description",e.description),this.updateMetaProperty("og:url",e.url),this.updateMetaProperty("og:type",e.type||"website"),e.image&&this.updateMetaProperty("og:image",e.image),this.updateMetaProperty("twitter:title",e.title),this.updateMetaProperty("twitter:description",e.description),this.updateMetaProperty("twitter:url",e.url),e.image&&this.updateMetaProperty("twitter:image",e.image),this.updateCanonicalUrl(e.url),e.alternateUrls&&this.updateAlternateUrls(e.alternateUrls),this.updateStructuredData(e)}updateMetaTag(e,t){let i=document.querySelector(`meta[name="${e}"]`);i||(i=document.createElement("meta"),i.setAttribute("name",e),document.head.appendChild(i)),i.setAttribute("content",t)}updateMetaProperty(e,t){let i=document.querySelector(`meta[property="${e}"]`);i||(i=document.createElement("meta"),i.setAttribute("property",e),document.head.appendChild(i)),i.setAttribute("content",t)}updateCanonicalUrl(e){let t=document.querySelector('link[rel="canonical"]');t||(t=document.createElement("link"),t.setAttribute("rel","canonical"),document.head.appendChild(t)),t.setAttribute("href",e)}updateAlternateUrls(e){document.querySelectorAll("link[hreflang]").forEach(e=>{e.remove()}),Object.entries(e).forEach(([e,t])=>{const i=document.createElement("link");i.setAttribute("rel","alternate"),i.setAttribute("hreflang",e),i.setAttribute("href",t),document.head.appendChild(i)})}updateStructuredData(e){const t={"@context":"https://schema.org","@type":["Game","SoftwareApplication","WebApplication"],name:e.title,description:e.description,url:e.url,gameCategory:["BoardGame","StrategyGame","CardGame"],genre:["Strategy","Simulation","Educational"],numberOfPlayers:"1",playMode:["SinglePlayer"],operatingSystem:["Web Browser","Progressive Web App"],applicationCategory:"Game",applicationSubCategory:"Board Game",inLanguage:e.locale||"ja",isAccessibleForFree:!0,isFamilyFriendly:!0,contentRating:"General Audiences",offers:{"@type":"Offer",price:"0",priceCurrency:"en"===e.locale?"USD":"JPY",availability:"https://schema.org/OnlineOnly"}};e.image&&(t.image=e.image,t.screenshot=e.image),this.setStructuredData("game",t);const i={"@context":"https://schema.org","@type":"WebSite",name:e.title,url:e.url,description:e.description,inLanguage:e.locale||"ja",potentialAction:{"@type":"SearchAction",target:`${e.url}?q={search_term_string}`,"query-input":"required name=search_term_string"}};this.setStructuredData("website",i)}setStructuredData(e,t){this.structuredDataCache.set(e,t);const i=document.getElementById(`structured-data-${e}`);i&&i.remove();const s=document.createElement("script");s.id=`structured-data-${e}`,s.type="application/ld+json",s.textContent=JSON.stringify(t,null,2),document.head.appendChild(s)}generateBreadcrumbs(e){const t={"@context":"https://schema.org","@type":"BreadcrumbList",itemListElement:e.map((e,t)=>({"@type":"ListItem",position:t+1,name:e.name,item:e.url}))};this.setStructuredData("breadcrumb",t)}getCurrentUrl(){return window.location.href}getCurrentLanguage(){return document.documentElement.lang||"ja"}updateLanguage(e){if(document.documentElement.lang=e,this.currentConfig){const t={...this.currentConfig,locale:e,alternateUrls:this.generateAlternateUrls(this.currentConfig.url,e)};this.updatePageSEO(t)}}generateAlternateUrls(e){const t={};return["ja","en"].forEach(i=>{t[i]="ja"===i?e:`${e}?lang=${i}`}),t["x-default"]=e,t}trackPageView(e){void 0!==window.gtag&&window.gtag("config","GA_MEASUREMENT_ID",{page_title:this.currentConfig?.title,page_location:this.getCurrentUrl()})}trackEvent(e,t={}){void 0!==window.gtag&&window.gtag("event",e,t)}calculateSEOScore(){const e=[],t=[];let i=100;const s=document.title;!s||s.length<30?(t.push("ã‚¿ã‚¤ãƒˆãƒ«ãŒçŸ­ã™ãã¾ã™ï¼ˆ30æ–‡å­—ä»¥ä¸Šæ¨å¥¨ï¼‰"),i-=10):s.length>60&&(e.push("ã‚¿ã‚¤ãƒˆãƒ«ãŒé•·ã™ãã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ï¼ˆ60æ–‡å­—ä»¥ä¸‹æ¨å¥¨ï¼‰"),i-=5);const n=document.querySelector('meta[name="description"]')?.getAttribute("content");!n||n.length<120?(t.push("ãƒ¡ã‚¿èª¬æ˜ãŒçŸ­ã™ãã¾ã™ï¼ˆ120æ–‡å­—ä»¥ä¸Šæ¨å¥¨ï¼‰"),i-=10):n.length>160&&(e.push("ãƒ¡ã‚¿èª¬æ˜ãŒé•·ã™ãã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ï¼ˆ160æ–‡å­—ä»¥ä¸‹æ¨å¥¨ï¼‰"),i-=5);const a=document.querySelectorAll("h1");return 0===a.length?(t.push("H1ã‚¿ã‚°ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"),i-=15):a.length>1&&(e.push("H1ã‚¿ã‚°ã¯1ã¤ã¾ã§ãŒæ¨å¥¨ã•ã‚Œã¾ã™"),i-=5),0===document.querySelectorAll('script[type="application/ld+json"]').length&&(t.push("æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"),i-=10),document.querySelector('link[rel="canonical"]')||(t.push("æ­£è¦URLãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“"),i-=10),e.push("ç”»åƒã‚’æœ€é©åŒ–ã—ã¦ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿é€Ÿåº¦ã‚’å‘ä¸Šã•ã›ã¦ãã ã•ã„"),e.push("ä¸è¦ãªJavaScriptã‚’å‰Šé™¤ã—ã¦ãã ã•ã„"),{score:Math.max(0,i),recommendations:e,issues:t}}generateSEOReport(){const e=this.calculateSEOScore();return{config:this.currentConfig,score:e,structuredData:Object.fromEntries(this.structuredDataCache),pageInfo:{url:this.getCurrentUrl(),language:this.getCurrentLanguage(),title:document.title,description:document.querySelector('meta[name="description"]')?.getAttribute("content")||""}}}};i(on,"instance");const cn=on.getInstance(),ln=j(ms);ln.use(Tt);const un=q();ln.use(un),ln.directive("lazy-load",rn),ln.use(en,{enableLogging:!0,enableReporting:!0,enableRecovery:!0,enableUserNotifications:!1,logToConsole:!1,reportToServer:!1,maxErrorsPerMinute:5,environment:"production",buildVersion:void 0,reportEndpoint:void 0,reportApiKey:void 0,onError:e=>{},onRecovery:(e,t)=>{},onAlert:(e,t)=>{}}),async function(){try{nn.markGameStart(),await async function(){try{await Vs.initialize({enableAPIProtection:!0,enableRateLimiting:!0,enableSessionManagement:!1,enableSecureErrorHandling:!0,enableInputValidation:!0,enableAuditLogging:!0,enableRealTimeMonitoring:!0,securityLevel:"high",autoBlock:!0,alertThreshold:10}),vs();const e=_s.getInstance(),t=Ts.getInstance();e.initialize(),t.initializeSecurityHeaders(),Is.getInstance().initialize();const i=Ps.getInstance();await i.logSecurityEvent("security_system_initialized","low","security_init","ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚·ã‚¹ãƒ†ãƒ ãŒæ­£å¸¸ã«åˆæœŸåŒ–ã•ã‚Œã¾ã—ãŸï¼ˆæœ€é©åŒ–ç‰ˆï¼‰",{timestamp:(new Date).toISOString(),config:qs}),await async function(){const e=Ps.getInstance(),t=[];"https:"!==window.location.protocol&&"localhost"!==window.location.hostname&&t.push("HTTPS ãŒä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã›ã‚“"),window.crypto?.subtle||t.push("Web Crypto API ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“");try{const e=vt();await e.setItem("__security_test__",{test:!0},!0);const i=await e.getItem("__security_test__",!0);i&&!0===i.test||t.push("ã‚»ã‚­ãƒ¥ã‚¢ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãŒæ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã¾ã›ã‚“"),await e.removeItem("__security_test__")}catch(i){t.push(`ã‚»ã‚­ãƒ¥ã‚¢ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®ãƒ†ã‚¹ãƒˆã«å¤±æ•—: ${i}`)}t.length>0&&await e.logSecurityEvent("security_configuration_issues","medium","security_validator","ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šã«å•é¡ŒãŒã‚ã‚Šã¾ã™",{issues:t})}(),function(){const e=Ps.getInstance(),t=(e,t)=>{let i=null;return(...s)=>{i&&clearTimeout(i),i=setTimeout(()=>e(...s),t)}},i=(e,t)=>{let i=!1;return(...s)=>{i||(e(...s),i=!0,setTimeout(()=>{i=!1},t))}},s=t(async()=>{await e.logSecurityEvent(document.hidden?"tab_hidden":"tab_visible","low","visibility_monitor",document.hidden?"ã‚¿ãƒ–ãŒéã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ãªã‚Šã¾ã—ãŸ":"ã‚¿ãƒ–ãŒã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ãªã‚Šã¾ã—ãŸ")},1e3);document.addEventListener("visibilitychange",s);{const t=i(async t=>{t.preventDefault(),await e.logSecurityEvent("context_menu_blocked","low","context_menu_blocker","å³ã‚¯ãƒªãƒƒã‚¯ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¾ã—ãŸ")},5e3);document.addEventListener("contextmenu",t);const s=i(async t=>{[{key:"F12"},{key:"I",ctrlKey:!0,shiftKey:!0},{key:"J",ctrlKey:!0,shiftKey:!0},{key:"U",ctrlKey:!0},{key:"S",ctrlKey:!0,shiftKey:!0}].some(e=>t.key===e.key&&(!e.ctrlKey||t.ctrlKey)&&(!e.shiftKey||t.shiftKey))&&(t.preventDefault(),await e.logSecurityEvent("dangerous_shortcut_blocked","medium","keyboard_monitor",`å±é™ºãªã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¾ã—ãŸ: ${t.key}`))},3e3);document.addEventListener("keydown",s)}const n=t(async t=>{await e.logSecurityEvent("storage_changed","low","storage_monitor","LocalStorage/SessionStorageãŒå¤‰æ›´ã•ã‚Œã¾ã—ãŸ",{key:t.key,storageArea:t.storageArea===localStorage?"localStorage":"sessionStorage"})},2e3);window.addEventListener("storage",n)}(),function(){const e=Ps.getInstance(),t={isLightCheckRunning:!1,isDetailedCheckRunning:!1,lastLightCheck:0,lastDetailedCheck:0},i=(e,t)=>{const i=()=>{qs.useRequestIdleCallback&&"requestIdleCallback"in window?requestIdleCallback(()=>{e().then(()=>{setTimeout(i,t)})},{timeout:t/2}):setTimeout(()=>{e().then(()=>{setTimeout(i,t)})},t)};setTimeout(i,6e4)};i(async()=>{if(!t.isLightCheckRunning){t.isLightCheckRunning=!0;try{if("memory"in performance){const t=performance.memory,i=t.usedJSHeapSize/t.jsHeapSizeLimit*100;i>qs.memoryWarningThreshold&&await e.logSecurityEvent("high_memory_usage","medium","periodic_check",`ãƒ¡ãƒ¢ãƒªä½¿ç”¨ç‡ãŒé«˜ã„ã§ã™: ${i.toFixed(1)}%`)}t.lastLightCheck=Date.now()}catch(i){}finally{t.isLightCheckRunning=!1}}},qs.lightCheckInterval),i(async()=>{if(!t.isDetailedCheckRunning){t.isDetailedCheckRunning=!0;try{const i=document.querySelectorAll("script[src]"),s=Array.from(i).filter(e=>{const t=e.getAttribute("src");return t&&!t.startsWith(window.location.origin)&&!t.startsWith("/")});s.length>5&&await e.logSecurityEvent("excessive_external_scripts","medium","periodic_check",`éåº¦ã®å¤–éƒ¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸ: ${s.length}å€‹`);let n=0;for(const e in localStorage)Object.prototype.hasOwnProperty.call(localStorage,e)&&(n+=localStorage.getItem(e)?.length||0);n>5242880&&await e.logSecurityEvent("excessive_localstorage_usage","low","periodic_check",`LocalStorageã®ä½¿ç”¨é‡ãŒå¤šã„ã§ã™: ${(n/1024/1024).toFixed(2)}MB`),t.lastDetailedCheck=Date.now()}catch(i){}finally{t.isDetailedCheckRunning=!1}}},qs.detailedCheckInterval)}(),await Vs.getSecurityStatus()}catch(e){try{vs(),_s.getInstance().initialize()}catch(t){!function(){const e=document.createElement("meta");e.httpEquiv="Content-Security-Policy",e.content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'",document.head.appendChild(e);const t=Element.prototype.innerHTML;Object.defineProperty(Element.prototype,"innerHTML",{set(e){if("string"==typeof e){const i=e.replace(/<script[^>]*>.*?<\/script>/gi,"").replace(/javascript:/gi,"").replace(/on\w+\s*=/gi,"");t.call(this,i)}else t.call(this,e)},get(){return t.call(this)}})}()}throw new Error(`çµ±åˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–å¤±æ•—: ${e instanceof Error?e.message:String(e)}`)}}(),Wt.getStatus(),cn.updatePageSEO({title:"äººç”Ÿå……å®Ÿã‚²ãƒ¼ãƒ  - ä¿é™ºã‚’ãƒ†ãƒ¼ãƒã«ã—ãŸé©æ–°çš„ãªä¸€äººç”¨ãƒœãƒ¼ãƒ‰ã‚²ãƒ¼ãƒ ",description:"ç”Ÿå‘½ä¿é™ºã‚’ã€Œäººç”Ÿã®å‘³æ–¹ã€ã¨ã—ã¦æãã€é©æ–°çš„ãªä¸€äººç”¨ãƒ‡ãƒƒã‚­æ§‹ç¯‰ã‚²ãƒ¼ãƒ ã€‚ã‚¢ã‚¯ã‚»ã‚·ãƒ–ãƒ«ã§å¤šè¨€èªå¯¾å¿œã€ã™ã¹ã¦ã®äººãŒæ¥½ã—ã‚ã‚‹æ•™è‚²çš„ã‚²ãƒ¼ãƒ ä½“é¨“ã‚’æä¾›ã—ã¾ã™ã€‚",keywords:["ä¿é™º","ã‚²ãƒ¼ãƒ ","äººç”Ÿ","ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³","ä¸€äººç”¨","ãƒœãƒ¼ãƒ‰ã‚²ãƒ¼ãƒ ","ãƒ‡ãƒƒã‚­æ§‹ç¯‰","æˆ¦ç•¥","æ•™è‚²","PWA","ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£"],url:"https://shishihs.github.io/insurance_self_game/",image:"https://shishihs.github.io/insurance_self_game/favicon.ico",type:"game",locale:"ja",alternateUrls:{ja:"https://shishihs.github.io/insurance_self_game/",en:"https://shishihs.github.io/insurance_self_game/?lang=en","x-default":"https://shishihs.github.io/insurance_self_game/"}}),cn.generateBreadcrumbs([{name:"ãƒ›ãƒ¼ãƒ ",url:"https://shishihs.github.io/insurance_self_game/"},{name:"ã‚²ãƒ¼ãƒ ",url:"https://shishihs.github.io/insurance_self_game/#game"},{name:"çµ±è¨ˆ",url:"https://shishihs.github.io/insurance_self_game/#stats"}]),ln.mount("#app"),nn.markGameLoaded()}catch(e){Zs.reportError(e,{component:"app-initialization"},"system"),ln.mount("#app")}}(),function(){const e=()=>{document.querySelectorAll(".ripple-container").forEach(e=>{const t=e;t._hasRipple||(function(e,t={}){const i=i=>{!function(e,t,i={}){const s={...sn,...i};if(s.disabled)return;e.classList.contains("ripple-container")||e.classList.add("ripple-container");const n=document.createElement("span");n.classList.add("ripple");const a=e.getBoundingClientRect(),r=Math.max(a.width,a.height),o=r/2;let c,l;if(s.centered)c=a.width/2,l=a.height/2;else{const e="touches"in t?t.touches[0].clientX:t.clientX,i="touches"in t?t.touches[0].clientY:t.clientY;c=e-a.left,l=i-a.top}Object.assign(n.style,{width:`${r}px`,height:`${r}px`,left:c-o+"px",top:l-o+"px",backgroundColor:s.color,opacity:s.opacity.toString(),animationDuration:`${s.duration}ms`}),e.appendChild(n);const u=()=>{n.parentNode&&n.parentNode.removeChild(n)};n.addEventListener("animationend",u),setTimeout(u,s.duration+100)}(e,i,t)};e.addEventListener("mousedown",i),e.addEventListener("touchstart",i,{passive:!0})}(t),t._hasRipple=!0)})};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e();new MutationObserver(t=>{let i=!1;t.forEach(e=>{"childList"===e.type&&e.addedNodes.forEach(e=>{if(e.nodeType===Node.ELEMENT_NODE){const t=e;(t.classList?.contains("ripple-container")||t.querySelectorAll?.(".ripple-container").length>0)&&(i=!0)}})}),i&&setTimeout(e,0)}).observe(document.body,{childList:!0,subtree:!0})}(),async function(e={}){window.addEventListener("load",()=>{tn.register(e)})}({onSuccess:e=>{},onUpdate:e=>{},onOffline:()=>{},onOnline:()=>{},onError:e=>{Zs.reportError(e,{component:"service-worker"},"system")}});
//# sourceMappingURL=index-DT3u2sKU.js.map
