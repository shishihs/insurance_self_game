const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/analytics-ImNIcNXw.js","js/vue-vendor-Dh8Oc06C.js","js/vendor-CLepEF8l.js","js/game-logic-DYTtuDyT.js","js/chart-vendor-Xt8I3p8E.js","css/analytics-Zo70LLDG.css","js/feedback-Bk8qjEas.js","css/feedback-BYlN7yR3.css","js/GameCanvas-BZ9_4VV0.js","js/game-engine-BEWVGSCW.js","js/phaser-core-DawqAqIN.js","js/game-scenes-gl4Q2JUG.js","css/GameCanvas-CD2PfjGS.css","css/css-vendor-B7VT8aW2.css"])))=>i.map(i=>d[i]);
var Be=Object.defineProperty,je=Object.defineProperties;var qe=Object.getOwnPropertyDescriptors;var _e=Object.getOwnPropertySymbols;var Ke=Object.prototype.hasOwnProperty,Ge=Object.prototype.propertyIsEnumerable;var me=(o,e,t)=>e in o?Be(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,C=(o,e)=>{for(var t in e||(e={}))Ke.call(e,t)&&me(o,t,e[t]);if(_e)for(var t of _e(e))Ge.call(e,t)&&me(o,t,e[t]);return o},R=(o,e)=>je(o,qe(e));var p=(o,e,t)=>me(o,typeof e!="symbol"?e+"":e,t);var f=(o,e,t)=>new Promise((s,i)=>{var n=u=>{try{d(t.next(u))}catch(m){i(m)}},r=u=>{try{d(t.throw(u))}catch(m){i(m)}},d=u=>u.done?s(u.value):Promise.resolve(u.value).then(n,r);d((t=t.apply(o,e)).next())});import{d as N,g as V,c as w,l as D,T as le,z as U,A as ve,o as v,f as _,h as ie,w as We,y as ke,b as T,a as c,j as O,v as ge,k as F,s as X,u as Le,t as x,p as Me,i as ue,e as we,n as Z,B as M,F as te,r as se,C as Qe,q as Ce,D as Je,E as Fe,G as Ye,H as Oe,I as pe,J as Xe}from"./vue-vendor-Dh8Oc06C.js";/* empty css                   */import{_ as z}from"./analytics-ImNIcNXw.js";import"./vendor-CLepEF8l.js";import"./game-logic-DYTtuDyT.js";import"./chart-vendor-Xt8I3p8E.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function t(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=t(i);fetch(i.href,n)}})();const Ze="modulepreload",et=function(o){return"/insurance_self_game/"+o},De={},he=function(e,t,s){let i=Promise.resolve();if(t&&t.length>0){let u=function(m){return Promise.all(m.map(h=>Promise.resolve(h).then(E=>({status:"fulfilled",value:E}),E=>({status:"rejected",reason:E}))))};document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),d=(r==null?void 0:r.nonce)||(r==null?void 0:r.getAttribute("nonce"));i=u(t.map(m=>{if(m=et(m),m in De)return;De[m]=!0;const h=m.endsWith(".css"),E=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${m}"]${E}`))return;const S=document.createElement("link");if(S.rel=h?"stylesheet":Ze,h||(S.as="script"),S.crossOrigin="",S.href=m,d&&S.setAttribute("nonce",d),document.head.appendChild(S),h)return new Promise((y,g)=>{S.addEventListener("load",y),S.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${m}`)))})}))}function n(r){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=r,window.dispatchEvent(d),!d.defaultPrevented)throw r}return i.then(r=>{for(const d of r||[])d.status==="rejected"&&n(d.reason);return e().catch(n)})},tt={class:"transition-animations"},st=N({__name:"TransitionAnimations",props:{type:{default:"fade"},direction:{default:"right"},duration:{default:300},easing:{default:"cubic-bezier(0.4, 0, 0.2, 1)"},intensity:{default:"normal"}},setup(o){const e=o,t=V(()=>`${e.type}-${e.direction}-${e.intensity}`),s=r=>{const d=r;d.style.transitionDuration=`${e.duration}ms`,d.style.transitionTimingFunction=e.easing},i=(r,d)=>{setTimeout(d,e.duration)},n=(r,d)=>{setTimeout(d,e.duration)};return(r,d)=>(v(),w("div",tt,[D(le,{name:t.value,mode:"out-in",onBeforeEnter:s,onEnter:i,onLeave:n},{default:U(()=>[ve(r.$slots,"default",{},void 0,!0)]),_:3},8,["name"])]))}}),it=z(st,[["__scopeId","data-v-c53a8e8b"]]);class He{constructor(){p(this,"liveRegions",new Map);p(this,"gameStatusElement");p(this,"cardDetailsElement");p(this,"announcementQueue",[]);p(this,"isProcessingQueue",!1);this.createLiveRegions(),this.createGameStatusElements(),this.setupAriaDescriptions()}announce(e,t={priority:"polite"}){t.interrupt&&this.clearQueue(),this.announcementQueue.push({message:e,options:t}),this.processQueue()}announceGameState(e){const{type:t,message:s,context:i}=e;this.updateGameStatus(t,s,i);const n=this.getPriorityForGameState(t);this.announce(s,{priority:n,persist:!0})}announceCardDetails(e){const t=this.createCardDescription(e);this.cardDetailsElement.textContent=t,this.announce(`カード選択: ${t}`,{priority:"polite"})}announceError(e){this.announce(`エラー: ${e}`,{priority:"assertive",interrupt:!0})}announceSuccess(e){this.announce(`成功: ${e}`,{priority:"polite"})}announceProgress(e,t,s){const i=Math.round(e/t*100),n=`${s}: ${e}/${t} (${i}%)`;this.announce(n,{priority:"polite"})}announceOptions(e,t){const s=e.length,i=e[t],n=`選択肢 ${t+1}/${s}: ${i}`;this.announce(n,{priority:"polite"})}announceTimer(e,t="seconds"){const s=t==="seconds"?"秒":"分";let i;e<=0?i="時間切れです":e<=10&&t==="seconds"?i=`残り${e}${s}`:e<=60&&t==="seconds"?i=`残り${e}${s}`:i=`残り時間: ${e}${s}`;const n=e<=10?"assertive":"polite";this.announce(i,{priority:n})}announceScreenChange(e,t){let s=`画面が変更されました: ${e}`;t&&(s+=`. ${t}`),this.announce(s,{priority:"assertive",persist:!0})}announceKeyboardHelp(){const t=`キーボードショートカット: ${["Tabキーで次の要素に移動","Shift+Tabで前の要素に移動","Enterキーまたはスペースキーで選択","F1キーでヘルプを表示"].join(", ")}`;this.announce(t,{priority:"polite",persist:!0})}announceGameStats(e){const s=`ゲーム統計. ${Object.entries(e).map(([i,n])=>`${this.translateStatKey(i)}: ${n}`).join(", ")}`;this.announce(s,{priority:"polite",persist:!0})}announceRegionStatus(e,t){const s=t.length,i=this.getItemType(t);let n;s===0?n=`${e}は空です`:s===1?n=`${e}に${i}が1つあります`:n=`${e}に${i}が${s}個あります`,this.announce(n,{priority:"polite"})}announceDragDrop(e,t){let s;switch(e){case"start":s=`${t.itemName}のドラッグを開始しました`;break;case"move":s=`${t.targetName}の上に移動中`;break;case"drop":s=t.success?`${t.targetName}に${t.itemName}をドロップしました`:`ドロップに失敗しました: ${t.reason}`;break;case"cancel":s="ドラッグ操作をキャンセルしました";break}const i=e==="drop"&&!t.success?"assertive":"polite";this.announce(s,{priority:i})}createLiveRegions(){const e=document.createElement("div");e.setAttribute("aria-live","polite"),e.setAttribute("aria-relevant","additions text"),e.setAttribute("aria-atomic","false"),e.className="sr-only",e.id="live-region-polite",document.body.appendChild(e),this.liveRegions.set("polite",e);const t=document.createElement("div");t.setAttribute("aria-live","assertive"),t.setAttribute("aria-relevant","additions text"),t.setAttribute("aria-atomic","true"),t.className="sr-only",t.id="live-region-assertive",document.body.appendChild(t),this.liveRegions.set("assertive",t)}createGameStatusElements(){this.gameStatusElement=document.createElement("div"),this.gameStatusElement.id="game-status",this.gameStatusElement.className="sr-only",this.gameStatusElement.setAttribute("aria-label","ゲーム状態"),document.body.appendChild(this.gameStatusElement),this.cardDetailsElement=document.createElement("div"),this.cardDetailsElement.id="card-details",this.cardDetailsElement.className="sr-only",this.cardDetailsElement.setAttribute("aria-label","カード詳細"),document.body.appendChild(this.cardDetailsElement)}setupAriaDescriptions(){const e=document.createElement("style");e.textContent=`
      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }
      
      .sr-only-focusable:focus {
        position: static;
        width: auto;
        height: auto;
        padding: inherit;
        margin: inherit;
        overflow: visible;
        clip: auto;
        white-space: normal;
      }
    `,document.head.appendChild(e)}processQueue(){return f(this,null,function*(){if(!(this.isProcessingQueue||this.announcementQueue.length===0)){for(this.isProcessingQueue=!0;this.announcementQueue.length>0;){const{message:e,options:t}=this.announcementQueue.shift();t.delay&&(yield this.delay(t.delay)),yield this.performAnnouncement(e,t),yield this.delay(100)}this.isProcessingQueue=!1}})}performAnnouncement(e,t){return f(this,null,function*(){const s=this.liveRegions.get(t.priority);if(s)if(t.persist||(s.textContent="",yield this.delay(10)),t.persist){const i=document.createElement("div");i.textContent=e,s.appendChild(i),setTimeout(()=>{i.parentNode&&i.parentNode.removeChild(i)},5e3)}else s.textContent=e})}updateGameStatus(e,t,s){const i=C({type:e,message:t,timestamp:new Date().toISOString()},s);this.gameStatusElement.setAttribute("data-game-state",JSON.stringify(i)),this.gameStatusElement.textContent=t}createCardDescription(e){const t=[e.name];return e.type&&t.push(`種類: ${this.translateCardType(e.type)}`),e.power!==void 0&&t.push(`パワー: ${e.power}`),e.cost!==void 0&&t.push(`コスト: ${e.cost}`),e.description&&t.push(`説明: ${e.description}`),t.join(", ")}getPriorityForGameState(e){return["challenge_result","game_end","error"].includes(e)?"assertive":"polite"}translateStatKey(e){return{vitality:"活力",turn:"ターン",cardsInHand:"手札枚数",challengesCompleted:"完了チャレンジ数",insuranceCards:"保険カード数"}[e]||e}translateCardType(e){return{life:"ライフカード",insurance:"保険カード",challenge:"チャレンジカード",dream:"ドリームカード"}[e]||e}getItemType(e){if(e.length===0)return"アイテム";const t=e[0];return t.type?this.translateCardType(t.type):"アイテム"}clearQueue(){this.announcementQueue=[],this.liveRegions.forEach(e=>{e.textContent=""})}delay(e){return new Promise(t=>setTimeout(t,e))}destroy(){var e,t;this.liveRegions.forEach(s=>{s.parentNode&&s.parentNode.removeChild(s)}),(e=this.gameStatusElement)!=null&&e.parentNode&&this.gameStatusElement.parentNode.removeChild(this.gameStatusElement),(t=this.cardDetailsElement)!=null&&t.parentNode&&this.cardDetailsElement.parentNode.removeChild(this.cardDetailsElement),this.clearQueue()}}const nt={class:"modal-content",role:"dialog","aria-labelledby":"accessibility-title","aria-describedby":"accessibility-description"},rt={style:{position:"absolute",width:"0",height:"0"}},ot=["innerHTML"],at={class:"modal-header"},ct={class:"modal-body"},lt={class:"settings-section"},ut={class:"setting-item"},dt={class:"setting-item"},mt={for:"high-contrast"},gt={class:"setting-item"},pt={class:"settings-section"},ht={class:"setting-item"},ft={for:"reduce-motion"},yt={key:0,class:"setting-item"},vt={class:"range-value"},wt={class:"settings-section"},bt={class:"setting-item"},St={for:"screen-reader"},Et={class:"setting-item"},kt={for:"audio-descriptions"},Ct={class:"setting-item"},At={class:"range-value"},xt={class:"settings-section"},It={class:"setting-item"},Tt={for:"sticky-keys"},_t={class:"setting-item"},Lt={class:"modal-footer"},Dt=N({__name:"AccessibilitySettings",props:{isOpen:{type:Boolean}},emits:["close","settingsChanged"],setup(o,{emit:e}){const t=o,s=e,i={colorScheme:"default",highContrast:!1,fontSize:"medium",reduceMotion:!1,animationSpeed:1,screenReaderEnabled:!1,audioDescriptions:!1,soundEffectsVolume:70,stickyKeys:!1,keyRepeatDelay:500,touchTargetSize:"default"},n=_(C({},i)),r=_(null),d={default:"",protanopia:`
    <filter id="protanopia">
      <feColorMatrix type="matrix" values="
        0.567, 0.433, 0,     0, 0
        0.558, 0.442, 0,     0, 0
        0,     0.242, 0.758, 0, 0
        0,     0,     0,     1, 0
      "/>
    </filter>
  `,deuteranopia:`
    <filter id="deuteranopia">
      <feColorMatrix type="matrix" values="
        0.625, 0.375, 0,   0, 0
        0.7,   0.3,   0,   0, 0
        0,     0.3,   0.7, 0, 0
        0,     0,     0,   1, 0
      "/>
    </filter>
  `,tritanopia:`
    <filter id="tritanopia">
      <feColorMatrix type="matrix" values="
        0.95, 0.05,  0,     0, 0
        0,    0.433, 0.567, 0, 0
        0,    0.475, 0.525, 0, 0
        0,    0,     0,     1, 0
      "/>
    </filter>
  `,achromatopsia:`
    <filter id="achromatopsia">
      <feColorMatrix type="matrix" values="
        0.299, 0.587, 0.114, 0, 0
        0.299, 0.587, 0.114, 0, 0
        0.299, 0.587, 0.114, 0, 0
        0,     0,     0,     1, 0
      "/>
    </filter>
  `},u=()=>{localStorage.setItem("accessibility-settings",JSON.stringify(n.value)),s("settingsChanged",n.value),h()},m=()=>{const g=localStorage.getItem("accessibility-settings");if(g)try{n.value=C(C({},i),JSON.parse(g))}catch(a){console.error("Failed to load accessibility settings:",a)}},h=()=>{const g=document.documentElement;n.value.colorScheme!=="default"?g.style.filter=`url(#${n.value.colorScheme})`:g.style.filter="",g.classList.toggle("high-contrast",n.value.highContrast);const a={small:"14px",medium:"16px",large:"20px","extra-large":"24px"};g.style.setProperty("--base-font-size",a[n.value.fontSize]),g.classList.toggle("reduce-motion",n.value.reduceMotion),g.style.setProperty("--animation-speed-multiplier",String(n.value.animationSpeed));const l={default:"44px",large:"56px","extra-large":"72px"};g.style.setProperty("--touch-target-size",l[n.value.touchTargetSize]),r.value&&r.value.announce("アクセシビリティ設定が更新されました",{priority:"polite"})},E=(g,a)=>{const l=n.value[g];n.value[g]=a,h(),setTimeout(()=>{n.value[g]===a&&(n.value[g]=l,h())},3e3)},S=()=>{n.value=C({},i),u(),r.value&&r.value.announce("アクセシビリティ設定をリセットしました",{priority:"assertive"})},y=()=>{const g=a=>{if(t.isOpen&&a.ctrlKey&&a.altKey)switch(a.key){case"c":const l=["default","protanopia","deuteranopia","tritanopia","achromatopsia"],A=l.indexOf(n.value.colorScheme);n.value.colorScheme=l[(A+1)%l.length],u();break;case"h":n.value.highContrast=!n.value.highContrast,u();break;case"m":n.value.reduceMotion=!n.value.reduceMotion,u();break}};return window.addEventListener("keydown",g),()=>window.removeEventListener("keydown",g)};return ie(()=>{m(),h(),r.value=new He;const g=y();return()=>{var a;g(),(a=r.value)==null||a.destroy()}}),We(()=>n.value,()=>{u()},{deep:!0}),(g,a)=>(v(),ke(le,{name:"modal"},{default:U(()=>[g.isOpen?(v(),w("div",{key:0,class:"accessibility-modal",onClick:a[13]||(a[13]=Me(l=>s("close"),["self"]))},[c("div",nt,[(v(),w("svg",rt,[c("defs",{innerHTML:Object.values(d).join("")},null,8,ot)])),c("div",at,[a[15]||(a[15]=c("h2",{id:"accessibility-title"},"アクセシビリティ設定",-1)),c("button",{onClick:a[0]||(a[0]=l=>s("close")),class:"close-button","aria-label":"設定を閉じる"},a[14]||(a[14]=[c("span",{"aria-hidden":"true"},"×",-1)]))]),a[36]||(a[36]=c("div",{id:"accessibility-description",class:"sr-only"}," ゲームのアクセシビリティオプションを設定できます。 Ctrl+Alt+Cで色覚設定、Ctrl+Alt+Hでハイコントラスト、Ctrl+Alt+Mでモーション削減を切り替えられます。 ",-1)),c("div",ct,[c("section",lt,[a[22]||(a[22]=c("h3",null,"視覚設定",-1)),c("div",ut,[a[17]||(a[17]=c("label",{for:"color-scheme"},"色覚サポート",-1)),O(c("select",{id:"color-scheme","onUpdate:modelValue":a[1]||(a[1]=l=>n.value.colorScheme=l),onChange:u},a[16]||(a[16]=[c("option",{value:"default"},"標準",-1),c("option",{value:"protanopia"},"赤色覚異常（1型）",-1),c("option",{value:"deuteranopia"},"緑色覚異常（2型）",-1),c("option",{value:"tritanopia"},"青色覚異常（3型）",-1),c("option",{value:"achromatopsia"},"全色覚異常",-1)]),544),[[ge,n.value.colorScheme]]),c("button",{onClick:a[2]||(a[2]=l=>E("colorScheme",n.value.colorScheme)),class:"preview-button","aria-label":"色覚設定をプレビュー"}," プレビュー ")]),c("div",dt,[c("label",mt,[O(c("input",{id:"high-contrast",type:"checkbox","onUpdate:modelValue":a[3]||(a[3]=l=>n.value.highContrast=l),onChange:u},null,544),[[X,n.value.highContrast]]),a[18]||(a[18]=F(" ハイコントラストモード ",-1))]),a[19]||(a[19]=c("span",{class:"setting-description"}," コントラストを高めて視認性を向上させます ",-1))]),c("div",gt,[a[21]||(a[21]=c("label",{for:"font-size"},"文字サイズ",-1)),O(c("select",{id:"font-size","onUpdate:modelValue":a[4]||(a[4]=l=>n.value.fontSize=l),onChange:u},a[20]||(a[20]=[c("option",{value:"small"},"小（14px）",-1),c("option",{value:"medium"},"中（16px）",-1),c("option",{value:"large"},"大（20px）",-1),c("option",{value:"extra-large"},"特大（24px）",-1)]),544),[[ge,n.value.fontSize]])])]),c("section",pt,[a[26]||(a[26]=c("h3",null,"モーション設定",-1)),c("div",ht,[c("label",ft,[O(c("input",{id:"reduce-motion",type:"checkbox","onUpdate:modelValue":a[5]||(a[5]=l=>n.value.reduceMotion=l),onChange:u},null,544),[[X,n.value.reduceMotion]]),a[23]||(a[23]=F(" モーションを削減 ",-1))]),a[24]||(a[24]=c("span",{class:"setting-description"}," アニメーションを最小限に抑えます ",-1))]),n.value.reduceMotion?T("",!0):(v(),w("div",yt,[a[25]||(a[25]=c("label",{for:"animation-speed"},"アニメーション速度",-1)),O(c("input",{id:"animation-speed",type:"range",min:"0.1",max:"2.0",step:"0.1","onUpdate:modelValue":a[6]||(a[6]=l=>n.value.animationSpeed=l),onChange:u},null,544),[[Le,n.value.animationSpeed,void 0,{number:!0}]]),c("span",vt,x(n.value.animationSpeed)+"x",1)]))]),c("section",wt,[a[30]||(a[30]=c("h3",null,"オーディオ設定",-1)),c("div",bt,[c("label",St,[O(c("input",{id:"screen-reader",type:"checkbox","onUpdate:modelValue":a[7]||(a[7]=l=>n.value.screenReaderEnabled=l),onChange:u},null,544),[[X,n.value.screenReaderEnabled]]),a[27]||(a[27]=F(" スクリーンリーダー対応を有効化 ",-1))])]),c("div",Et,[c("label",kt,[O(c("input",{id:"audio-descriptions",type:"checkbox","onUpdate:modelValue":a[8]||(a[8]=l=>n.value.audioDescriptions=l),onChange:u},null,544),[[X,n.value.audioDescriptions]]),a[28]||(a[28]=F(" 音声説明を有効化 ",-1))])]),c("div",Ct,[a[29]||(a[29]=c("label",{for:"sound-volume"},"効果音の音量",-1)),O(c("input",{id:"sound-volume",type:"range",min:"0",max:"100",step:"5","onUpdate:modelValue":a[9]||(a[9]=l=>n.value.soundEffectsVolume=l),onChange:u},null,544),[[Le,n.value.soundEffectsVolume,void 0,{number:!0}]]),c("span",At,x(n.value.soundEffectsVolume)+"%",1)])]),c("section",xt,[a[35]||(a[35]=c("h3",null,"インタラクション設定",-1)),c("div",It,[c("label",Tt,[O(c("input",{id:"sticky-keys",type:"checkbox","onUpdate:modelValue":a[10]||(a[10]=l=>n.value.stickyKeys=l),onChange:u},null,544),[[X,n.value.stickyKeys]]),a[31]||(a[31]=F(" スティッキーキー ",-1))]),a[32]||(a[32]=c("span",{class:"setting-description"}," 修飾キーを一度に押す必要がありません ",-1))]),c("div",_t,[a[34]||(a[34]=c("label",{for:"touch-target-size"},"タッチターゲットサイズ",-1)),O(c("select",{id:"touch-target-size","onUpdate:modelValue":a[11]||(a[11]=l=>n.value.touchTargetSize=l),onChange:u},a[33]||(a[33]=[c("option",{value:"default"},"標準（44px）",-1),c("option",{value:"large"},"大（56px）",-1),c("option",{value:"extra-large"},"特大（72px）",-1)]),544),[[ge,n.value.touchTargetSize]])])])]),c("div",Lt,[c("button",{onClick:S,class:"reset-button","aria-label":"すべての設定をリセット"}," 設定をリセット "),c("button",{onClick:a[12]||(a[12]=l=>s("close")),class:"save-button","aria-label":"設定を保存して閉じる"}," 保存して閉じる ")])])])):T("",!0)]),_:1}))}}),$t=z(Dt,[["__scopeId","data-v-edce860d"]]);class Rt{constructor(e={}){p(this,"focusedElement",null);p(this,"indicator");p(this,"options");this.options={color:e.color||"#818CF8",width:e.width||3,style:e.style||"solid",offset:e.offset||4,borderRadius:e.borderRadius||8},this.indicator=this.createIndicator(),document.body.appendChild(this.indicator),this.setupEventListeners()}createIndicator(){const e=document.createElement("div");return e.className="focus-indicator",e.style.cssText=`
      position: fixed;
      pointer-events: none;
      z-index: 10000;
      transition: all 200ms cubic-bezier(0.25, 0.46, 0.45, 0.94);
      opacity: 0;
      border: ${this.options.width}px ${this.options.style} ${this.options.color};
      border-radius: ${this.options.borderRadius}px;
      box-shadow: 0 0 20px rgba(129, 140, 248, 0.4);
    `,e}setupEventListeners(){document.addEventListener("focusin",this.handleFocusIn.bind(this)),document.addEventListener("focusout",this.handleFocusOut.bind(this)),window.addEventListener("scroll",this.updatePosition.bind(this),!0),window.addEventListener("resize",this.updatePosition.bind(this)),new MutationObserver(()=>{this.focusedElement&&this.updatePosition()}).observe(document.body,{attributes:!0,childList:!0,subtree:!0,attributeFilter:["style","class"]})}handleFocusIn(e){const t=e.target;this.isFocusableElement(t)&&(this.focusedElement=t,this.showIndicator(t))}handleFocusOut(){this.focusedElement=null,this.hideIndicator()}isFocusableElement(e){return["button","input","select","textarea","a[href]",'[tabindex]:not([tabindex="-1"])',"[contenteditable]"].some(s=>e.matches(s)||e.closest(s))}showIndicator(e){const t=e.getBoundingClientRect(),s=this.options.offset;this.indicator.style.left=`${t.left-s}px`,this.indicator.style.top=`${t.top-s}px`,this.indicator.style.width=`${t.width+s*2}px`,this.indicator.style.height=`${t.height+s*2}px`,this.indicator.style.opacity="1";const n=window.getComputedStyle(e).borderRadius;n&&n!=="0px"&&(this.indicator.style.borderRadius=n)}hideIndicator(){this.indicator.style.opacity="0"}updatePosition(){this.focusedElement&&this.focusedElement===document.activeElement&&this.showIndicator(this.focusedElement)}setOptions(e){Object.assign(this.options,e),this.indicator.style.border=`${this.options.width}px ${this.options.style} ${this.options.color}`,this.indicator.style.borderRadius=`${this.options.borderRadius}px`,this.focusedElement&&this.updatePosition()}destroy(){this.indicator.remove(),document.removeEventListener("focusin",this.handleFocusIn.bind(this)),document.removeEventListener("focusout",this.handleFocusOut.bind(this)),window.removeEventListener("scroll",this.updatePosition.bind(this),!0),window.removeEventListener("resize",this.updatePosition.bind(this))}}const Pt={key:0,class:"keyboard-hints",role:"tooltip","aria-live":"polite"},Mt={class:"hints-list"},Ft={class:"hint-key"},Ot={class:"hint-description"},Ht={key:0,class:"settings-panel"},Nt=["value"],zt=["value"],Ut=N({__name:"VisualIndicators",props:{enabled:{type:Boolean,default:!0},color:{default:"#818CF8"},width:{default:3},style:{default:"solid"},offset:{default:4},borderRadius:{default:8},showKeyboardHints:{type:Boolean,default:!0},reducedMotion:{type:Boolean,default:!1}},setup(o,{expose:e}){const s=o,i=_(s.enabled),n=_({color:s.color,width:s.width,style:s.style,offset:s.offset,borderRadius:s.borderRadius});let r=null;const d=_(!1),u=_(null),m=V(()=>({"--focus-color":n.value.color,"--focus-width":`${n.value.width}px`,"--focus-offset":`${n.value.offset}px`,"--focus-radius":`${n.value.borderRadius}px`})),h=V(()=>[{key:"Tab",description:"次の要素にフォーカス"},{key:"Shift + Tab",description:"前の要素にフォーカス"},{key:"Enter",description:"選択した要素を実行"},{key:"Space",description:"ボタンやチェックボックスを操作"},{key:"Arrow Keys",description:"メニューや選択肢を移動"},{key:"Escape",description:"モーダルやメニューを閉じる"}]),E=()=>{i.value&&!r&&(r=new Rt(n.value))},S=()=>{r&&(r.destroy(),r=null)},y=()=>{r&&r.setOptions(n.value)},g=()=>{s.showKeyboardHints&&(d.value=!0,u.value&&clearTimeout(u.value),u.value=window.setTimeout(()=>{d.value=!1},5e3))},a=()=>{d.value=!1,u.value&&(clearTimeout(u.value),u.value=null)},l=I=>{I.key==="Tab"&&g()},A=I=>{Object.assign(n.value,I),y()},L=()=>{i.value=!i.value,i.value?E():S()};return ie(()=>{E(),document.addEventListener("keydown",l),window.matchMedia("(prefers-reduced-motion: reduce)").matches&&(n.value=R(C({},n.value),{offset:2}),y())}),ue(()=>{S(),document.removeEventListener("keydown",l),u.value&&clearTimeout(u.value)}),e({updateSettings:A,toggleEnabled:L,showKeyboardHints:g,hideKeyboardHints:a}),(I,k)=>(v(),w("div",{class:Z(["visual-indicators",{"reduced-motion":I.reducedMotion,"hints-visible":d.value}]),style:we(m.value)},[D(le,{name:"hints-fade"},{default:U(()=>[d.value&&g?(v(),w("div",Pt,[c("div",{class:"hints-header"},[k[3]||(k[3]=c("h3",{class:"hints-title"},"キーボードショートカット",-1)),c("button",{onClick:a,class:"hints-close","aria-label":"ヒントを閉じる"}," × ")]),c("ul",Mt,[(v(!0),w(te,null,se(h.value,$=>(v(),w("li",{key:$.key,class:"hint-item"},[c("kbd",Ft,x($.key),1),c("span",Ot,x($.description),1)]))),128))])])):T("",!0)]),_:1}),M(!1)?(v(),w("div",Ht,[k[7]||(k[7]=c("h4",null,"フォーカスインジケーター設定",-1)),c("label",null,[O(c("input",{"onUpdate:modelValue":k[0]||(k[0]=$=>i.value=$),type:"checkbox",onChange:L},null,544),[[X,i.value]]),k[4]||(k[4]=F(" 有効 ",-1))]),c("label",null,[k[5]||(k[5]=F(" 色: ",-1)),c("input",{value:n.value.color,type:"color",onInput:k[1]||(k[1]=$=>A({color:$.target.value}))},null,40,Nt)]),c("label",null,[k[6]||(k[6]=F(" 幅: ",-1)),c("input",{value:n.value.width,type:"range",min:"1",max:"10",onInput:k[2]||(k[2]=$=>A({width:parseInt($.target.value)}))},null,40,zt)])])):T("",!0)],6))}}),Vt=z(Ut,[["__scopeId","data-v-4853097c"]]),Bt=["data-severity"],jt={key:0,class:"error-minimal"},qt={key:1,class:"error-detailed"},Kt={class:"error-user-message"},Gt={class:"error-actions"},Wt=["disabled"],Qt={key:0,class:"error-details"},Jt={class:"error-technical"},Yt={key:0,class:"error-stack"},Xt={key:2,class:"error-custom"},Zt=N({__name:"ErrorBoundary",props:{fallback:{default:"detailed"},onError:{},canRecover:{type:Boolean,default:!0},recoveryMessage:{default:"エラーから回復するには、ページを再読み込みしてください"}},emits:["error","recover"],setup(o,{emit:e}){const t=o,s=!1,i=e,n=_(!1),r=_(null),d=_(""),u=_(0),m=_(!1),h=V(()=>{if(!r.value)return"low";const l=r.value.message.toLowerCase();return l.includes("cannot read")||l.includes("undefined")?"high":l.includes("network")||l.includes("fetch")?"medium":"low"}),E=V(()=>{if(!r.value)return"";const l=r.value.message;return l.includes("Network")?"ネットワーク接続に問題が発生しました":l.includes("Cannot read")?"画面の表示中にエラーが発生しました":l.includes("undefined")||l.includes("null")?"データの読み込みに失敗しました":l.includes("timeout")?"処理がタイムアウトしました":"予期しないエラーが発生しました"});Qe((l,A,L)=>(console.error("[ErrorBoundary] Caught error:",l),console.error("[ErrorBoundary] Error info:",L),console.error("[ErrorBoundary] Component instance:",A),n.value=!0,r.value=l,d.value=L,u.value++,t.onError&&t.onError(l,A,L),i("error",l,L),!1));const S=()=>f(null,null,function*(){m.value=!0;try{n.value=!1,r.value=null,d.value="",i("recover"),yield new Promise(l=>setTimeout(l,100))}catch(l){console.error("[ErrorBoundary] Recovery failed:",l),n.value=!0}finally{m.value=!1}}),y=()=>{window.location.reload()},g=()=>f(null,null,function*(){if(!r.value)return;const l=`
エラー: ${r.value.message}
スタック: ${r.value.stack||"N/A"}
情報: ${d.value}
時刻: ${new Date().toISOString()}
ユーザーエージェント: ${navigator.userAgent}
  `.trim();try{yield navigator.clipboard.writeText(l),alert("エラー詳細をクリップボードにコピーしました")}catch(A){console.error("Failed to copy error details:",A)}}),a=()=>{if(!r.value)return;const l=new CustomEvent("app:send-error-report",{detail:{error:r.value,info:d.value,component:"ErrorBoundary"}});window.dispatchEvent(l),alert("エラーレポートを送信しました")};return(l,A)=>{var L,I;return n.value?(v(),w("div",{key:0,class:"error-boundary","data-severity":h.value},[l.fallback==="minimal"?(v(),w("div",jt,[A[0]||(A[0]=c("p",{class:"error-message"},"エラーが発生しました",-1)),c("button",{onClick:y,class:"error-action-btn"}," ページを再読み込み ")])):l.fallback==="detailed"?(v(),w("div",qt,[A[5]||(A[5]=Ce('<div class="error-icon" aria-hidden="true" data-v-bddb116a><svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" data-v-bddb116a><circle cx="12" cy="12" r="10" stroke-width="2" data-v-bddb116a></circle><line x1="12" y1="8" x2="12" y2="12" stroke-width="2" data-v-bddb116a></line><line x1="12" y1="16" x2="12.01" y2="16" stroke-width="2" data-v-bddb116a></line></svg></div><h2 class="error-title" data-v-bddb116a>エラーが発生しました</h2>',2)),c("p",Kt,x(E.value),1),c("div",Gt,[l.canRecover&&!m.value?(v(),w("button",{key:0,onClick:S,class:"error-action-btn primary",disabled:u.value>3},x(u.value>3?"回復できません":"回復を試みる"),9,Wt)):T("",!0),c("button",{onClick:y,class:"error-action-btn secondary"}," ページを再読み込み ")]),M(s)?(v(),w("details",Qt,[A[4]||(A[4]=c("summary",null,"エラー詳細（開発者向け）",-1)),c("div",Jt,[c("p",null,[A[1]||(A[1]=c("strong",null,"エラーメッセージ:",-1)),F(" "+x((L=r.value)==null?void 0:L.message),1)]),c("p",null,[A[2]||(A[2]=c("strong",null,"エラー情報:",-1)),F(" "+x(d.value),1)]),c("p",null,[A[3]||(A[3]=c("strong",null,"エラー回数:",-1)),F(" "+x(u.value),1)]),(I=r.value)!=null&&I.stack?(v(),w("pre",Yt,x(r.value.stack),1)):T("",!0),c("div",{class:"error-dev-actions"},[c("button",{onClick:g,class:"error-action-btn small"}," 詳細をコピー "),c("button",{onClick:a,class:"error-action-btn small"}," レポート送信 ")])])])):T("",!0)])):l.fallback==="custom"?(v(),w("div",Xt,[ve(l.$slots,"error",{error:r.value,retry:S,reload:y},void 0)])):T("",!0)],8,Bt)):ve(l.$slots,"default",{key:1},void 0)}}}),$e=z(Zt,[["__scopeId","data-v-bddb116a"]]);class es{constructor(){p(this,"patterns",[]);p(this,"fallbackMessages",new Map);this.initializeDefaultPatterns(),this.initializeFallbackMessages()}initializeDefaultPatterns(){this.patterns.push({id:"network-offline",pattern:/network|offline|connection/i,message:{title:"インターネット接続が切断されています",description:"インターネット接続を確認して、もう一度お試しください。",actionLabel:"再試行",actionType:"retry",icon:"📡",severity:"error",helpUrl:"/help/network-issues"},conditions:{category:["network"]}}),this.patterns.push({id:"network-timeout",pattern:/timeout|slow/i,message:{title:"接続が遅くなっています",description:"サーバーへの接続に時間がかかっています。しばらく待ってから再試行してください。",actionLabel:"もう一度試す",actionType:"retry",icon:"⏰",severity:"warning"},conditions:{category:["network","async"]}}),this.patterns.push({id:"game-save-failed",pattern:/save|storage|quota/i,message:{title:"ゲームの保存に失敗しました",description:"ゲームデータの保存に失敗しました。ストレージ容量を確認してください。",actionLabel:"ストレージを確認",actionType:"navigate",actionData:{url:"/settings/storage"},icon:"💾",severity:"error",showDetails:!0},conditions:{category:["game","system"]}}),this.patterns.push({id:"game-state-corrupted",pattern:/corrupted|invalid.*state|cannot.*read.*game/i,message:{title:"ゲームデータに問題があります",description:"ゲームデータが破損している可能性があります。新しいゲームを開始することをお勧めします。",actionLabel:"新しいゲーム",actionType:"navigate",actionData:{url:"/new-game"},icon:"🎮",severity:"critical",showDetails:!0},conditions:{category:["game"],severity:["high","critical"]}}),this.patterns.push({id:"ui-component-error",pattern:/component|render|mount/i,message:{title:"画面の表示エラー",description:"画面の一部が正しく表示されていません。ページを再読み込みすると解決する場合があります。",actionLabel:"ページを再読み込み",actionType:"reload",icon:"🖥️",severity:"warning"},conditions:{category:["vue"]}}),this.patterns.push({id:"performance-memory",pattern:/memory|heap|stack.*overflow/i,message:{title:"メモリ不足の可能性があります",description:"他のアプリケーションを閉じて、メモリを解放してください。",actionLabel:"ページを再読み込み",actionType:"reload",icon:"⚡",severity:"error",helpUrl:"/help/performance"},conditions:{category:["performance","system"]}}),this.patterns.push({id:"security-cors",pattern:/cors|cross.*origin|blocked/i,message:{title:"セキュリティ制限が発生しました",description:"ブラウザのセキュリティ設定により、一部の機能が制限されています。",actionLabel:"サポートに連絡",actionType:"contact",icon:"🔒",severity:"error",helpUrl:"/help/security-issues"},conditions:{category:["security"]}}),this.patterns.push({id:"js-undefined",pattern:/undefined|null.*property|cannot.*read/i,message:{title:"予期しないエラーが発生しました",description:"アプリケーションで予期しない問題が発生しました。開発チームに報告されます。",actionLabel:"ページを再読み込み",actionType:"reload",icon:"⚠️",severity:"error",showDetails:!0},conditions:{category:["javascript"],severity:["high","critical"]}}),this.patterns.push({id:"resource-load-failed",pattern:/loading|chunk.*error|failed.*fetch.*resource/i,message:{title:"リソースの読み込みに失敗しました",description:"ページの一部のリソースが読み込まれませんでした。ページを再読み込みしてください。",actionLabel:"ページを再読み込み",actionType:"reload",icon:"📦",severity:"warning"},conditions:{category:["network","system"]}})}initializeFallbackMessages(){this.fallbackMessages.set("network",{title:"ネットワークエラー",description:"ネットワーク接続に問題が発生しました。",actionLabel:"再試行",actionType:"retry",icon:"🌐",severity:"error"}),this.fallbackMessages.set("vue",{title:"UI エラー",description:"画面の表示に問題が発生しました。",actionLabel:"ページを再読み込み",actionType:"reload",icon:"🖼️",severity:"warning"}),this.fallbackMessages.set("javascript",{title:"アプリケーションエラー",description:"アプリケーションで問題が発生しました。",actionLabel:"ページを再読み込み",actionType:"reload",icon:"⚙️",severity:"error"}),this.fallbackMessages.set("game",{title:"ゲームエラー",description:"ゲーム中に問題が発生しました。",actionLabel:"ゲームを再開",actionType:"retry",icon:"🎮",severity:"error"}),this.fallbackMessages.set("async",{title:"処理エラー",description:"非同期処理でエラーが発生しました。",actionLabel:"再試行",actionType:"retry",icon:"⏳",severity:"warning"}),this.fallbackMessages.set("performance",{title:"パフォーマンスの問題",description:"アプリケーションの動作が重くなっています。",actionLabel:"ページを再読み込み",actionType:"reload",icon:"🚀",severity:"warning"}),this.fallbackMessages.set("security",{title:"セキュリティエラー",description:"セキュリティ制限により操作が制限されました。",actionLabel:"サポートに連絡",actionType:"contact",icon:"🔐",severity:"error"}),this.fallbackMessages.set("user",{title:"ユーザー操作エラー",description:"操作に問題が発生しました。",actionLabel:"もう一度試す",actionType:"retry",icon:"👤",severity:"info"}),this.fallbackMessages.set("system",{title:"システムエラー",description:"システムで問題が発生しました。",actionLabel:"ページを再読み込み",actionType:"reload",icon:"🖥️",severity:"error"})}generateUserMessage(e){for(const s of this.patterns)if(this.matchesPattern(e,s))return this.enrichMessage(s.message,e);const t=this.fallbackMessages.get(e.category);return t?this.enrichMessage(t,e):this.enrichMessage({title:"エラーが発生しました",description:"アプリケーションで問題が発生しました。しばらく時間をおいてから再試行してください。",actionLabel:"ページを再読み込み",actionType:"reload",icon:"❗",severity:"error"},e)}matchesPattern(e,t){if(!(t.pattern instanceof RegExp?t.pattern.test(e.message):e.message.toLowerCase().includes(t.pattern.toLowerCase())))return!1;if(t.conditions){const{category:i,severity:n,context:r}=t.conditions;if(i&&!i.includes(e.category)||n&&!n.includes(e.severity)||r&&!r(e))return!1}return!0}enrichMessage(e,t){var s,i;return new Date(t.timestamp).toLocaleTimeString(),R(C({},e),{description:`${e.description}${(i=(s=t.context)==null?void 0:s.deviceInfo)!=null&&i.isMobile?" (モバイル)":""}`,actionData:R(C({},e.actionData),{timestamp:t.timestamp,errorId:t.fingerprint,component:t.component})})}addPattern(e){if(this.patterns.some(s=>s.id===e.id)){console.warn(`Pattern with id "${e.id}" already exists`);return}this.patterns.unshift(e)}removePattern(e){const t=this.patterns.findIndex(s=>s.id===e);return t!==-1?(this.patterns.splice(t,1),!0):!1}getPatterns(){return[...this.patterns]}previewMessage(e,t,s="medium"){const i={message:e,category:t,severity:s,timestamp:Date.now(),userAgent:navigator.userAgent};return this.generateUserMessage(i)}getStats(){return{patternsCount:this.patterns.length,categoriesCount:this.fallbackMessages.size,patterns:this.patterns.map(e=>({id:e.id,hasConditions:!!e.conditions}))}}}const Ne=new es,ts={class:"error-notification-container",role:"alert","aria-live":"polite"},ss=["aria-label"],is={class:"notification-content"},ns={class:"notification-icon","aria-hidden":"true"},rs={class:"notification-body"},os={class:"notification-title"},as={class:"notification-description"},cs={key:0,class:"notification-actions"},ls=["onClick"],us=["onClick"],ds=["onClick"],ms={key:1,class:"notification-details"},gs={class:"detail-section"},ps={key:0,class:"detail-section"},hs={class:"detail-section"},fs={class:"detail-tag"},ys={class:"detail-tag"},vs={key:1,class:"detail-section"},ws={class:"detail-section"},bs=["onClick","aria-label"],Re=3,Ss=5e3,Es=N({__name:"ErrorNotification",setup(o,{expose:e}){const t=_([]),s=g=>{var A,L;const a=`${Date.now()}-${Math.random()}`,l=R(C({},g),{id:a,timestamp:Date.now(),autoHide:(A=g.autoHide)!=null?A:g.userMessage.severity!=="critical",hideDelay:(L=g.hideDelay)!=null?L:Ss,isExpanded:!1});t.value.unshift(l),t.value.length>Re&&(t.value=t.value.slice(0,Re)),l.autoHide&&setTimeout(()=>{i(a)},l.hideDelay)},i=g=>{const a=t.value.findIndex(l=>l.id===g);a!==-1&&t.value.splice(a,1)},n=()=>{t.value=[]},r=g=>{const a=g.detail;if(t.value.some(A=>A.originalError.fingerprint===a.fingerprint))return;const l=Ne.generateUserMessage(a);s({userMessage:l,originalError:a})},d=g=>g.icon||u(g.severity),u=g=>{switch(g){case"critical":return"🚨";case"error":return"⚠️";case"warning":return"ℹ️";case"info":return"💡"}},m=g=>{switch(g){case"critical":return"notification-critical";case"error":return"notification-error";case"warning":return"notification-warning";case"info":return"notification-info"}},h=g=>{const{actionType:a,actionData:l}=g.userMessage;switch(a){case"reload":window.location.reload();break;case"retry":const A=new CustomEvent("app:retry-action",{detail:{errorId:l==null?void 0:l.errorId,component:l==null?void 0:l.component}});window.dispatchEvent(A),i(g.id);break;case"navigate":l!=null&&l.url&&(window.location.href=l.url);break;case"contact":const L=new CustomEvent("app:open-support",{detail:{errorInfo:g.originalError}});window.dispatchEvent(L);break;case"close":default:i(g.id);break}},E=g=>{const a=t.value.find(l=>l.id===g);a&&(a.isExpanded=!a.isExpanded)},S=g=>{window.open(g,"_blank","noopener,noreferrer")},y=V(()=>t.value.map((g,a)=>R(C({},g),{offset:a*(g.isExpanded?120:80),opacity:a<3?1:.5})));return ie(()=>{window.addEventListener("app:error",r),window.addEventListener("app:system-alert",g=>{const{message:a}=g.detail;s({userMessage:{title:"システムアラート",description:a,actionLabel:"ページを再読み込み",actionType:"reload",icon:"🚀",severity:"critical",showDetails:!1},originalError:{message:a,category:"system",severity:"critical",timestamp:Date.now(),userAgent:navigator.userAgent},autoHide:!1})})}),ue(()=>{window.removeEventListener("app:error",r),window.removeEventListener("app:system-alert",()=>{})}),e({addNotification:s,removeNotification:i,clearAll:n,executeAction:h,toggleDetails:E}),(g,a)=>(v(),ke(Fe,{to:"body"},[c("div",ts,[D(Je,{name:"notification",tag:"div"},{default:U(()=>[(v(!0),w(te,null,se(y.value,(l,A)=>{var L;return v(),w("div",{key:l.id,class:Z(["error-notification",m(l.userMessage.severity),{expanded:l.isExpanded}]),style:we({transform:`translateY(${l.offset}px)`,opacity:l.opacity,zIndex:1e3-A}),role:"alertdialog","aria-label":`${l.userMessage.severity}エラー: ${l.userMessage.title}`},[c("div",is,[c("span",ns,x(d(l.userMessage)),1),c("div",rs,[c("h4",os,x(l.userMessage.title),1),c("p",as,x(l.userMessage.description),1),l.userMessage.actionLabel?(v(),w("div",cs,[c("button",{onClick:I=>h(l),class:"notification-action-btn primary"},x(l.userMessage.actionLabel),9,ls),l.userMessage.helpUrl?(v(),w("button",{key:0,onClick:I=>S(l.userMessage.helpUrl),class:"notification-action-btn secondary small"}," ヘルプ ",8,us)):T("",!0),l.userMessage.showDetails?(v(),w("button",{key:1,onClick:I=>E(l.id),class:"notification-action-btn secondary small"},x(l.isExpanded?"詳細を隠す":"詳細を表示"),9,ds)):T("",!0)])):T("",!0),l.isExpanded&&l.userMessage.showDetails?(v(),w("div",ms,[c("div",gs,[a[0]||(a[0]=c("strong",null,"エラーメッセージ:",-1)),c("code",null,x(l.originalError.message),1)]),l.originalError.component?(v(),w("div",ps,[a[1]||(a[1]=c("strong",null,"コンポーネント:",-1)),c("code",null,x(l.originalError.component),1)])):T("",!0),c("div",hs,[a[2]||(a[2]=c("strong",null,"カテゴリ:",-1)),c("span",fs,x(l.originalError.category),1),a[3]||(a[3]=c("strong",null,"深刻度:",-1)),c("span",ys,x(l.originalError.severity),1)]),(L=l.originalError.context)!=null&&L.route?(v(),w("div",vs,[a[4]||(a[4]=c("strong",null,"ページ:",-1)),c("code",null,x(l.originalError.context.route),1)])):T("",!0),c("div",ws,[a[5]||(a[5]=c("strong",null,"時刻:",-1)),F(" "+x(new Date(l.originalError.timestamp).toLocaleString()),1)])])):T("",!0)]),c("button",{onClick:I=>i(l.id),class:"notification-close","aria-label":`通知を閉じる: ${l.userMessage.title}`},a[6]||(a[6]=[c("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[c("line",{x1:"18",y1:"6",x2:"6",y2:"18","stroke-width":"2"}),c("line",{x1:"6",y1:"6",x2:"18",y2:"18","stroke-width":"2"})],-1)]),8,bs)]),l.autoHide?(v(),w("div",{key:0,class:"notification-progress",style:we({animationDuration:`${l.hideDelay}ms`})},null,4)):T("",!0)],14,ss)}),128))]),_:1})])]))}}),ks=z(Es,[["__scopeId","data-v-d3cf7348"]]);function ee(o){if(typeof o!="string")throw new Error("入力は文字列である必要があります");return o.replace(/<[^>]*>/g,"").replace(/javascript:/gi,"").replace(/on\w+\s*=/gi,"").replace(/[<>"'&]/g,e=>({"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","&":"&amp;"})[e]||e).replace(/\x00-\x1f\x7f-\x9f/g,"").trim().slice(0,1e3)}class Cs{constructor(){p(this,"attempts",new Map)}isAllowed(e,t,s){const i=Date.now(),r=(this.attempts.get(e)||[]).filter(d=>i-d<s);return r.length>=t?!1:(r.push(i),this.attempts.set(e,r),!0)}reset(e){this.attempts.delete(e)}clear(){this.attempts.clear()}}function Ae(o){if(o<=0||o>256)throw new Error("長さは1から256の間である必要があります");const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=new Uint8Array(o);if(typeof window!="undefined"&&window.crypto&&window.crypto.getRandomValues)window.crypto.getRandomValues(t);else{console.warn("⚠️ セキュリティ警告: crypto.getRandomValues が利用できません。フォールバック実装を使用します。");for(let s=0;s<o;s++)t[s]=Math.floor(Math.random()*256)}return Array.from(t,s=>e[s%e.length]).join("")}function ne(o){return f(this,null,function*(){if(typeof window!="undefined"&&window.crypto&&window.crypto.subtle){const t=new TextEncoder().encode(o),s=yield window.crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(s)).map(n=>n.toString(16).padStart(2,"0")).join("")}else{console.warn("⚠️ セキュリティ警告: crypto.subtle が利用できません。簡易ハッシュを使用します。");let e=0;for(let t=0;t<o.length;t++){const s=o.charCodeAt(t);e=(e<<5)-e+s,e=e&e}return Math.abs(e).toString(16)}})}function ze(){const o="game_enc_",e="_integrity";return{setItem(s,i,n=!1){return f(this,null,function*(){try{const r=ee(s);let d=JSON.stringify(i);if(n){const m=yield this.getOrCreateEncryptionKey();d=yield this.simpleEncrypt(d,m)}const u=yield ne(d);localStorage.setItem(r,d),localStorage.setItem(r+e,u)}catch(r){throw console.error("❌ セキュアストレージ保存失敗:",r),new Error(`ストレージ保存に失敗: ${r instanceof Error?r.message:String(r)}`)}})},getItem(s,i=!1){return f(this,null,function*(){try{const n=ee(s),r=localStorage.getItem(n),d=localStorage.getItem(n+e);if(!r)return null;if(d&&(yield ne(r))!==d)throw console.error("❌ データ改ざんを検出しました:",n),this.removeItem(n),new Error("データ改ざんが検出されました");let u=r;if(i){const m=yield this.getOrCreateEncryptionKey();u=yield this.simpleDecrypt(u,m)}return JSON.parse(u)}catch(n){return console.error("❌ セキュアストレージ読み込み失敗:",n),null}})},removeItem(s){try{const i=ee(s);localStorage.removeItem(i),localStorage.removeItem(i+e)}catch(i){console.error("❌ セキュアストレージ削除失敗:",i)}},getOrCreateEncryptionKey(){return f(this,null,function*(){const s=`${o}master`;let i=localStorage.getItem(s);return i||(i=Ae(32),localStorage.setItem(s,i)),i})},simpleEncrypt(s,i){return f(this,null,function*(){const n=[];for(let r=0;r<s.length;r++){const d=i.charCodeAt(r%i.length),u=s.charCodeAt(r);n.push(String.fromCharCode(u^d))}return btoa(n.join(""))})},simpleDecrypt(s,i){return f(this,null,function*(){try{const n=atob(s),r=[];for(let d=0;d<n.length;d++){const u=i.charCodeAt(d%i.length),m=n.charCodeAt(d);r.push(String.fromCharCode(m^u))}return r.join("")}catch(n){throw new Error("復号化に失敗しました")}})}}}class As{constructor(){p(this,"focusableElements",[]);p(this,"currentFocusIndex",-1);p(this,"shortcuts",new Map);p(this,"isActive",!0);p(this,"focusVisibleEnabled",!0);this.setupEventListeners(),this.setupFocusVisible()}registerFocusableElement(e,t={}){const s={element:e,priority:t.priority||0,group:t.group,onFocus:t.onFocus,onBlur:t.onBlur,onActivate:t.onActivate},i=this.focusableElements.findIndex(n=>n.element===e);i>=0?this.focusableElements[i]=s:this.focusableElements.push(s),this.focusableElements.sort((n,r)=>r.priority-n.priority),this.setupElementAccessibility(e)}unregisterFocusableElement(e){const t=this.focusableElements.findIndex(s=>s.element===e);t>=0&&(this.focusableElements.splice(t,1),this.currentFocusIndex>=t&&(this.currentFocusIndex=Math.max(0,this.currentFocusIndex-1)))}registerShortcut(e){const t=this.createShortcutKey(e.key,e.modifiers||[]);this.shortcuts.set(t,e)}unregisterShortcut(e,t=[]){const s=this.createShortcutKey(e,t);this.shortcuts.delete(s)}focusNext(){this.focusableElements.length!==0&&(this.currentFocusIndex=(this.currentFocusIndex+1)%this.focusableElements.length,this.setFocus(this.currentFocusIndex))}focusPrevious(){this.focusableElements.length!==0&&(this.currentFocusIndex=this.currentFocusIndex<=0?this.focusableElements.length-1:this.currentFocusIndex-1,this.setFocus(this.currentFocusIndex))}focusGroup(e){const t=this.focusableElements.filter(s=>s.group===e);if(t.length>0){const s=this.focusableElements.indexOf(t[0]);s>=0&&(this.currentFocusIndex=s,this.setFocus(s))}}focusElement(e){const t=this.focusableElements.findIndex(s=>s.element===e);t>=0&&(this.currentFocusIndex=t,this.setFocus(t))}getCurrentFocusedElement(){return this.currentFocusIndex>=0&&this.currentFocusIndex<this.focusableElements.length?this.focusableElements[this.currentFocusIndex].element:null}startFocusTrap(e){const t=this.focusableElements.filter(s=>e.contains(s.element));t.length>0&&(this.focusableElements.forEach(s=>{e.contains(s.element)||(s.element.setAttribute("tabindex","-1"),s.element.setAttribute("aria-hidden","true"))}),this.focusElement(t[0].element))}endFocusTrap(){this.focusableElements.forEach(e=>{e.element.removeAttribute("tabindex"),e.element.removeAttribute("aria-hidden")})}toggleHelp(){const e=this.createHelpPanel();document.body.appendChild(e);const t=i=>{i.key==="Escape"&&(e.remove(),document.removeEventListener("keydown",t))};document.addEventListener("keydown",t);const s=e.querySelector("button");s&&s.focus()}createSkipLinks(){const e=document.createElement("div");e.className="skip-links",e.setAttribute("aria-label","スキップリンク");const t=this.createSkipLink("メインコンテンツに移動","#main-content"),s=this.createSkipLink("ナビゲーションに移動","#navigation"),i=this.createSkipLink("フッターに移動","#footer");return e.appendChild(t),e.appendChild(s),e.appendChild(i),e}setActive(e){if(this.isActive=e,!e){const t=this.getCurrentFocusedElement();t&&t.blur()}}setFocusVisible(e){this.focusVisibleEnabled=e,document.documentElement.classList.toggle("keyboard-navigation",e)}setupEventListeners(){document.addEventListener("keydown",this.handleKeyDown.bind(this)),document.addEventListener("focusin",this.handleFocusIn.bind(this)),document.addEventListener("focusout",this.handleFocusOut.bind(this)),document.addEventListener("mousedown",()=>{document.documentElement.classList.remove("keyboard-navigation")})}handleKeyDown(e){if(!this.isActive)return;const t=this.createShortcutKey(e.key,this.getActiveModifiers(e)),s=this.shortcuts.get(t);if(s){e.preventDefault(),s.action();return}switch(e.key){case"Tab":e.preventDefault(),e.shiftKey?this.focusPrevious():this.focusNext();break;case"ArrowDown":case"ArrowRight":e.preventDefault(),this.focusNext();break;case"ArrowUp":case"ArrowLeft":e.preventDefault(),this.focusPrevious();break;case"Home":e.preventDefault(),this.currentFocusIndex=0,this.setFocus(0);break;case"End":e.preventDefault(),this.currentFocusIndex=this.focusableElements.length-1,this.setFocus(this.currentFocusIndex);break;case"Enter":case" ":const i=this.getCurrentFocusedElement();if(i){e.preventDefault();const n=this.focusableElements[this.currentFocusIndex];n.onActivate?n.onActivate():i.click()}break;case"F1":e.preventDefault(),this.toggleHelp();break}}handleFocusIn(e){if(!this.focusVisibleEnabled)return;const t=e.target,s=this.focusableElements.findIndex(i=>i.element===t);if(s>=0){this.currentFocusIndex=s;const i=this.focusableElements[s];i.onFocus&&i.onFocus(),document.documentElement.classList.add("keyboard-navigation")}}handleFocusOut(e){const t=e.target,s=this.focusableElements.findIndex(i=>i.element===t);if(s>=0){const i=this.focusableElements[s];i.onBlur&&i.onBlur()}}setFocus(e){if(e<0||e>=this.focusableElements.length)return;const s=this.focusableElements[e].element;if(s.offsetParent===null){this.focusNext();return}s.focus(),s.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})}setupElementAccessibility(e){var t;if(e.hasAttribute("tabindex")||e.setAttribute("tabindex","0"),!e.hasAttribute("role")){const s=e.tagName.toLowerCase();(s==="div"||s==="span")&&e.setAttribute("role","button")}if(!e.hasAttribute("aria-label")&&!e.hasAttribute("aria-labelledby")){const s=(t=e.textContent)==null?void 0:t.trim();s&&e.setAttribute("aria-label",s)}}createShortcutKey(e,t){return`${t.sort().join("+")}+${e.toLowerCase()}`}getActiveModifiers(e){const t=[];return e.ctrlKey&&t.push("ctrl"),e.altKey&&t.push("alt"),e.shiftKey&&t.push("shift"),e.metaKey&&t.push("meta"),t}createSkipLink(e,t){const s=document.createElement("a");return s.href=t,s.textContent=e,s.className="skip-link",s.addEventListener("click",i=>{i.preventDefault();const n=document.querySelector(t);n&&n.focus()}),s}createHelpPanel(){const e=document.createElement("div");e.className="keyboard-help-panel",e.setAttribute("role","dialog"),e.setAttribute("aria-labelledby","help-title"),e.setAttribute("aria-modal","true");const t=Array.from(this.shortcuts.values()),s=document.createElement("div");s.className="help-content";const i=document.createElement("h2");i.id="help-title",i.textContent="キーボードショートカット";const n=document.createElement("div");n.className="shortcuts-list";const r=document.createElement("div");r.className="shortcut-group";const d=document.createElement("h3");d.textContent="基本ナビゲーション";const u=document.createElement("dl");if([{key:"Tab / Shift+Tab",desc:"次/前の要素に移動"},{key:"矢印キー",desc:"方向に応じて移動"},{key:"Enter / Space",desc:"要素を選択/実行"},{key:"Home / End",desc:"最初/最後の要素に移動"}].forEach(({key:E,desc:S})=>{const y=document.createElement("dt");y.textContent=E;const g=document.createElement("dd");g.textContent=S,u.appendChild(y),u.appendChild(g)}),r.appendChild(d),r.appendChild(u),n.appendChild(r),t.length>0){const E=document.createElement("div");E.className="shortcut-group";const S=document.createElement("h3");S.textContent="ゲーム操作";const y=document.createElement("dl");t.forEach(g=>{const a=document.createElement("dt");a.textContent=ee(this.formatShortcut(g));const l=document.createElement("dd");l.textContent=ee(g.description),y.appendChild(a),y.appendChild(l)}),E.appendChild(S),E.appendChild(y),n.appendChild(E)}const h=document.createElement("button");return h.type="button",h.textContent="閉じる (Esc)",h.onclick=()=>e.remove(),s.appendChild(i),s.appendChild(n),s.appendChild(h),e.appendChild(s),e}formatShortcut(e){return[...(e.modifiers||[]).map(i=>i.charAt(0).toUpperCase()+i.slice(1)),e.key].join(" + ")}setupFocusVisible(){const e=document.createElement("style");e.textContent=`
      .keyboard-navigation *:focus {
        outline: 2px solid #818CF8;
        outline-offset: 2px;
        border-radius: 4px;
      }
      
      .skip-links {
        position: absolute;
        top: -40px;
        left: 6px;
        z-index: 1000;
      }
      
      .skip-link {
        position: absolute;
        left: -10000px;
        top: auto;
        width: 1px;
        height: 1px;
        overflow: hidden;
        background: #000;
        color: #fff;
        padding: 8px 16px;
        text-decoration: none;
        border-radius: 4px;
      }
      
      .skip-link:focus {
        position: static;
        width: auto;
        height: auto;
        left: auto;
        top: auto;
      }
      
      .keyboard-help-panel {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(0, 0, 0, 0.95);
        color: white;
        padding: 2rem;
        border-radius: 12px;
        max-width: 500px;
        max-height: 80vh;
        overflow-y: auto;
        z-index: 10000;
      }
      
      .help-content h2 {
        margin-top: 0;
        color: #818CF8;
      }
      
      .shortcuts-list dt {
        font-weight: bold;
        color: #FFD43B;
        margin-top: 0.5rem;
      }
      
      .shortcuts-list dd {
        margin-left: 1rem;
        margin-bottom: 0.5rem;
      }
      
      .help-content button {
        margin-top: 1rem;
        padding: 0.5rem 1rem;
        background: #818CF8;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }
    `,document.head.appendChild(e)}destroy(){this.focusableElements=[],this.shortcuts.clear(),document.removeEventListener("keydown",this.handleKeyDown.bind(this)),document.removeEventListener("focusin",this.handleFocusIn.bind(this)),document.removeEventListener("focusout",this.handleFocusOut.bind(this))}}const xs={class:"app-header"},Is=N({__name:"AppHeader",setup(o){return(e,t)=>(v(),w("header",xs,t[0]||(t[0]=[Ce('<div class="hero-section" data-v-f43720aa><div class="hero-background" data-v-f43720aa><div class="hero-orb hero-orb-1" data-v-f43720aa></div><div class="hero-orb hero-orb-2" data-v-f43720aa></div><div class="hero-orb hero-orb-3" data-v-f43720aa></div></div><div class="hero-content" data-v-f43720aa><div class="brand-logo pulse" data-v-f43720aa><div class="logo-glow" data-v-f43720aa></div><span class="logo-icon" data-v-f43720aa>🛡️</span></div><h1 class="hero-title bounce-in" style="animation-delay:0.2s;" data-v-f43720aa> 人生充実ゲーム </h1><p class="hero-subtitle bounce-in" style="animation-delay:0.4s;" data-v-f43720aa> Life Fulfillment - 生命保険を「人生の味方」として描く </p><div class="hero-accent bounce-in" style="animation-delay:0.6s;" data-v-f43720aa><span class="accent-icon" data-v-f43720aa>✨</span><span class="accent-text" data-v-f43720aa>一人の時間を、最高の冒険に</span><span class="accent-icon" data-v-f43720aa>✨</span></div><div class="hero-stats bounce-in" style="animation-delay:0.8s;" data-v-f43720aa><div class="stat-item" data-v-f43720aa><span class="stat-value" data-v-f43720aa>100+</span><span class="stat-label" data-v-f43720aa>イベントカード</span></div><div class="stat-divider" data-v-f43720aa></div><div class="stat-item" data-v-f43720aa><span class="stat-value" data-v-f43720aa>7</span><span class="stat-label" data-v-f43720aa>人生ステージ</span></div><div class="stat-divider" data-v-f43720aa></div><div class="stat-item" data-v-f43720aa><span class="stat-value" data-v-f43720aa>∞</span><span class="stat-label" data-v-f43720aa>プレイパターン</span></div></div></div></div>',1)])))}}),Ts=z(Is,[["__scopeId","data-v-f43720aa"]]),_s={class:"action-section",id:"navigation",role:"navigation","aria-label":"メインナビゲーション"},Ls={class:"button-group"},Ds=N({__name:"NavigationActions",emits:["start-game","start-tutorial","open-statistics"],setup(o,{expose:e}){const t=_(),s=_();return e({gameButtonRef:t,tutorialButtonRef:s}),(i,n)=>(v(),w("section",_s,[c("div",Ls,[c("button",{ref_key:"gameButtonRef",ref:t,onClick:n[0]||(n[0]=r=>i.$emit("start-game")),class:"btn btn-primary ripple-container glow-on-hover bounce-in","aria-label":"ゲームを開始する (Alt+G)","aria-keyshortcuts":"Alt+G","aria-describedby":"game-description"},n[3]||(n[3]=[c("span",{class:"btn-bg-effect"},null,-1),c("span",{class:"btn-icon","aria-hidden":"true"},"🎮",-1),c("span",{class:"btn-text"},"ゲームをプレイ",-1),c("span",{class:"btn-arrow","aria-hidden":"true"},"→",-1)]),512),c("button",{ref_key:"tutorialButtonRef",ref:s,onClick:n[1]||(n[1]=r=>i.$emit("start-tutorial")),class:"btn btn-secondary ripple-container","aria-label":"チュートリアルを開始する (Alt+T)","aria-keyshortcuts":"Alt+T","aria-describedby":"tutorial-description"},n[4]||(n[4]=[c("span",{class:"btn-bg-effect"},null,-1),c("span",{class:"btn-icon","aria-hidden":"true"},"📚",-1),c("span",{class:"btn-text"},"チュートリアル",-1)]),512),c("button",{onClick:n[2]||(n[2]=r=>i.$emit("open-statistics")),class:"btn btn-secondary ripple-container","aria-label":"統計ダッシュボードを開く (Alt+S)","aria-keyshortcuts":"Alt+S","aria-describedby":"statistics-description"},n[5]||(n[5]=[c("span",{class:"btn-bg-effect"},null,-1),c("span",{class:"btn-icon","aria-hidden":"true"},"📊",-1),c("span",{class:"btn-text"},"統計",-1)]))]),n[6]||(n[6]=c("div",{class:"sr-only"},[c("div",{id:"game-description"},"保険をテーマにした人生シミュレーションゲームを開始します"),c("div",{id:"tutorial-description"},"ゲームの遊び方を学習するチュートリアルを開始します"),c("div",{id:"statistics-description"},"プレイ統計とパフォーマンス分析を表示します")],-1))]))}}),$s=z(Ds,[["__scopeId","data-v-a977deb5"]]),Rs={class:"info-section"},Ps=N({__name:"FeatureShowcase",setup(o){return(e,t)=>(v(),w("section",Rs,t[0]||(t[0]=[Ce('<div class="info-grid" data-v-f24e5bd8><div class="interactive-card glow-on-hover card-latest" data-v-f24e5bd8><div class="card-badge" data-v-f24e5bd8>NEW</div><div class="card-header" data-v-f24e5bd8><div class="card-icon-wrapper" data-v-f24e5bd8><span class="card-icon" data-v-f24e5bd8>🚀</span></div><h2 class="card-title" data-v-f24e5bd8> 本番リリース v0.3.0 </h2></div><div class="text-left space-y-3" data-v-f24e5bd8><div data-v-f24e5bd8><h3 class="font-semibold text-lg mb-2" data-v-f24e5bd8>Production Release - 本番環境対応完了</h3><ul class="space-y-1 text-sm" data-v-f24e5bd8><li class="flex items-start gap-2" data-v-f24e5bd8><span class="text-success mt-1" data-v-f24e5bd8>🎯</span><span data-v-f24e5bd8><strong data-v-f24e5bd8>リリース品質100%</strong>: ビルド・テスト・型チェック全て完了</span></li><li class="flex items-start gap-2" data-v-f24e5bd8><span class="text-success mt-1" data-v-f24e5bd8>♿</span><span data-v-f24e5bd8><strong data-v-f24e5bd8>アクセシビリティ完全対応</strong>: WCAG 2.1 AA 100%準拠</span></li><li class="flex items-start gap-2" data-v-f24e5bd8><span class="text-success mt-1" data-v-f24e5bd8>📱</span><span data-v-f24e5bd8><strong data-v-f24e5bd8>モバイル最適化完了</strong>: タッチ操作・レスポンシブデザイン対応</span></li><li class="flex items-start gap-2" data-v-f24e5bd8><span class="text-success mt-1" data-v-f24e5bd8>⚡</span><span data-v-f24e5bd8><strong data-v-f24e5bd8>パフォーマンス最適化</strong>: バンドルサイズ55.8%削減達成</span></li><li class="flex items-start gap-2" data-v-f24e5bd8><span class="text-success mt-1" data-v-f24e5bd8>✅</span><span data-v-f24e5bd8><strong data-v-f24e5bd8>セキュリティ監査</strong>: 自動脆弱性検出、コード品質分析</span></li></ul></div></div></div><div class="interactive-card glow-on-hover card-roadmap" data-v-f24e5bd8><div class="card-badge badge-secondary" data-v-f24e5bd8>ROADMAP</div><div class="card-header" data-v-f24e5bd8><div class="card-icon-wrapper icon-wrapper-secondary" data-v-f24e5bd8><span class="card-icon" data-v-f24e5bd8>🗺️</span></div><h2 class="card-title" data-v-f24e5bd8> 今後のロードマップ </h2></div><div class="text-left space-y-3" data-v-f24e5bd8><div data-v-f24e5bd8><h3 class="font-semibold mb-2" data-v-f24e5bd8>短期（1-2週間）</h3><ul class="space-y-1 text-sm" data-v-f24e5bd8><li class="flex items-center gap-2" data-v-f24e5bd8><span class="text-success" data-v-f24e5bd8>✅</span> 保険更新システム </li><li class="flex items-center gap-2" data-v-f24e5bd8><span class="text-success" data-v-f24e5bd8>✅</span> チュートリアルモード </li><li class="flex items-center gap-2" data-v-f24e5bd8><span class="text-success" data-v-f24e5bd8>✅</span> サウンドエフェクト </li><li class="flex items-center gap-2" data-v-f24e5bd8><span class="text-gray-400" data-v-f24e5bd8>⭕</span> ゲームバランス微調整 </li></ul></div><div data-v-f24e5bd8><h3 class="font-semibold mb-2" data-v-f24e5bd8>中期（1ヶ月）</h3><ul class="space-y-1 text-sm" data-v-f24e5bd8><li class="flex items-center gap-2" data-v-f24e5bd8><span class="text-gray-400" data-v-f24e5bd8>⭕</span> 実績システム </li><li class="flex items-center gap-2" data-v-f24e5bd8><span class="text-gray-400" data-v-f24e5bd8>⭕</span> 追加シナリオ（結婚、出産など） </li></ul></div></div><div class="mt-4 text-sm text-gray-600 dark:text-gray-400" data-v-f24e5bd8><a href="https://github.com/shishihs/insurance_self_game/blob/master/CHANGELOG.md" target="_blank" class="hover:text-primary transition-colors" data-v-f24e5bd8> 詳細な変更履歴とロードマップ → </a></div></div></div><div class="text-center mt-8 text-sm text-gray-600 dark:text-gray-400" data-v-f24e5bd8><p data-v-f24e5bd8><a href="https://github.com/shishihs/insurance_self_game" target="_blank" class="hover:text-primary transition-colors" data-v-f24e5bd8> GitHub </a><span class="mx-2" data-v-f24e5bd8>•</span><a href="https://github.com/shishihs/insurance_self_game/issues" target="_blank" class="hover:text-primary transition-colors" data-v-f24e5bd8> バグ報告・要望 </a></p></div>',2)])))}}),Ms=z(Ps,[["__scopeId","data-v-f24e5bd8"]]),Fs={ui:{navigation:{home:"ホーム",back:"ホーム",game:"ゲーム",tutorial:"チュートリアル",statistics:"統計",settings:"設定",accessibility:"アクセシビリティ設定",feedback:"フィードバック"},buttons:{start:"開始",startGame:"ゲーム開始",startTutorial:"チュートリアル開始",close:"閉じる",cancel:"キャンセル",ok:"OK",yes:"はい",no:"いいえ",continue:"続行",skip:"スキップ",next:"次へ",previous:"前へ",finish:"完了",reset:"リセット",save:"保存",load:"読み込み"},common:{loading:"読み込み中...",error:"エラーが発生しました",success:"成功しました",warning:"警告",info:"情報",confirm:"確認",welcome:"ようこそ",congratulations:"おめでとうございます！",gameOver:"ゲーム終了",newGame:"新しいゲーム",retry:"もう一度"}},game:{title:"人生充実ゲーム",subtitle:"戦略的ライフシミュレーション",description:"人生のさまざまな段階でリスクと保険のバランスを考えながら、充実した人生を目指すゲームです。",stages:{youth:"青年期",adult:"成人期",middleAge:"中年期",elderly:"高齢期"},elements:{vitality:"生命力",turn:"ターン",phase:"フェーズ",stage:"ステージ",round:"ラウンド",score:"スコア",level:"レベル"},cards:{riskCard:"リスクカード",insuranceCard:"保険カード",eventCard:"イベントカード",actionCard:"アクションカード",powerCard:"パワーカード"},actions:{draw:"カードを引く",play:"カードを使う",discard:"カードを捨てる",buyInsurance:"保険を購入",cancelInsurance:"保険を解約",takeRisk:"リスクを取る",avoidRisk:"リスクを回避"},insurance:{types:{life:"生命保険",health:"健康保険",auto:"自動車保険",home:"火災保険",travel:"旅行保険",income:"所得保障保険",disability:"傷害保険",longTermCare:"介護保険"},terms:{premium:"保険料",coverage:"保障額",deductible:"免責金額",beneficiary:"受益者",policy:"保険証券",claim:"保険金請求",renewal:"更新",cancellation:"解約"}},risks:{categories:{health:"健康リスク",financial:"経済リスク",accident:"事故リスク",natural:"自然災害リスク",career:"キャリアリスク",family:"家族リスク"},levels:{low:"低リスク",medium:"中リスク",high:"高リスク",extreme:"極高リスク"}}},tutorial:{title:"ゲームチュートリアル",welcome:"ようこそ！人生充実ゲームの世界へ",steps:{introduction:{title:"はじめに",content:"このゲームでは、人生のさまざまな段階でリスクと保険のバランスを考えながら進めていきます。"},basicRules:{title:"基本ルール",content:"各ターンでカードを引き、リスクに対処するか保険で備えるかを決めます。"},cardTypes:{title:"カードの種類",content:"リスクカード、保険カード、イベントカードがあります。それぞれの特徴を理解しましょう。"},insuranceSystem:{title:"保険システム",content:"保険は事前に購入することでリスクに備えることができます。保険料と保障額を考慮して選択しましょう。"},strategy:{title:"戦略のポイント",content:"生命力を維持しながら、効果的な保険戦略を立てることが成功の鍵です。"}}},statistics:{title:"統計ダッシュボード",sections:{overview:"概要",performance:"パフォーマンス",trends:"トレンド",detailed:"詳細分析"},metrics:{gamesPlayed:"プレイ回数",winRate:"勝率",averageScore:"平均スコア",bestScore:"最高スコア",totalPlayTime:"総プレイ時間",averageGameTime:"平均ゲーム時間",survivalRate:"生存率",insuranceEfficiency:"保険効率"},charts:{vitalityTrend:"生命力推移",stageAnalysis:"ステージ別分析",cardUsage:"カード使用状況",decisionAnalysis:"意思決定分析",riskManagement:"リスク管理",insuranceCoverage:"保険カバレッジ"}},accessibility:{title:"アクセシビリティ設定",sections:{visual:"視覚設定",audio:"音声設定",interaction:"操作設定",display:"表示設定"},options:{highContrast:"ハイコントラスト",largeText:"大きな文字",reduceMotion:"アニメーション軽減",screenReader:"スクリーンリーダー対応",keyboardNavigation:"キーボードナビゲーション",audioCues:"音声キュー",subtitles:"字幕",slowAnimations:"ゆっくりアニメーション"},keyboardShortcuts:{title:"キーボードショートカット",homeScreen:"ホーム画面に戻る (Alt+H)",startGame:"ゲーム開始 (Alt+G)",startTutorial:"チュートリアル開始 (Alt+T)",openStatistics:"統計を開く (Alt+S)",openAccessibility:"アクセシビリティ設定 (Alt+A)",help:"ヘルプを表示 (F1)"}},feedback:{title:"フィードバック",types:{bug:"バグ報告",suggestion:"改善提案",general:"一般的な意見",rating:"評価"},form:{subject:"件名",message:"メッセージ",email:"メールアドレス（任意）",category:"カテゴリ",priority:"優先度",submit:"送信",thankYou:"フィードバックをありがとうございました！"}},errors:{general:"エラーが発生しました。",network:"ネットワークエラーが発生しました。",gameState:"ゲーム状態の読み込みに失敗しました。",save:"ゲームの保存に失敗しました。",load:"ゲームの読み込みに失敗しました。",invalidAction:"無効な操作です。",cardNotFound:"カードが見つかりません。",insufficientFunds:"資金が不足しています。",insuranceNotActive:"保険が有効ではありません。"},success:{gameSaved:"ゲームを保存しました。",gameLoaded:"ゲームを読み込みました。",insurancePurchased:"保険を購入しました。",riskAvoided:"リスクを回避しました。",levelCompleted:"レベルをクリアしました！",achievementUnlocked:"実績を獲得しました！"},region:{currency:"円",currencySymbol:"¥",dateFormat:"YYYY年MM月DD日",numberFormat:"1,234",insuranceSystem:{nationalHealth:"国民健康保険",employeeHealth:"健康保険",nationalPension:"国民年金",employeePension:"厚生年金",longTermCare:"介護保険",workersComp:"労災保険",unemployment:"雇用保険"},risks:{earthquake:"地震",typhoon:"台風",flood:"洪水",aging:"高齢化",recession:"不況",deflation:"デフレ"}},ageGroups:{young:{title:"若い世代への保険アドバイス",message:"将来に向けた基盤作りが重要です。"},middle:{title:"働き盛り世代への保険アドバイス",message:"家族を守るための保障を検討しましょう。"},senior:{title:"シニア世代への保険アドバイス",message:"医療・介護リスクへの備えが大切です。"}}},Os={ui:{navigation:{home:"Home",back:"Home",game:"Game",tutorial:"Tutorial",statistics:"Statistics",settings:"Settings",accessibility:"Accessibility Settings",feedback:"Feedback"},buttons:{start:"Start",startGame:"Start Game",startTutorial:"Start Tutorial",close:"Close",cancel:"Cancel",ok:"OK",yes:"Yes",no:"No",continue:"Continue",skip:"Skip",next:"Next",previous:"Previous",finish:"Finish",reset:"Reset",save:"Save",load:"Load"},common:{loading:"Loading...",error:"An error occurred",success:"Success",warning:"Warning",info:"Information",confirm:"Confirm",welcome:"Welcome",congratulations:"Congratulations!",gameOver:"Game Over",newGame:"New Game",retry:"Try Again"}},game:{title:"Life Enrichment Game",subtitle:"Strategic Life Simulation",description:"A game where you navigate through different life stages, balancing risks and insurance to achieve a fulfilling life.",stages:{youth:"Youth",adult:"Adulthood",middleAge:"Middle Age",elderly:"Elderly"},elements:{vitality:"Vitality",turn:"Turn",phase:"Phase",stage:"Stage",round:"Round",score:"Score",level:"Level"},cards:{riskCard:"Risk Card",insuranceCard:"Insurance Card",eventCard:"Event Card",actionCard:"Action Card",powerCard:"Power Card"},actions:{draw:"Draw Card",play:"Play Card",discard:"Discard Card",buyInsurance:"Buy Insurance",cancelInsurance:"Cancel Insurance",takeRisk:"Take Risk",avoidRisk:"Avoid Risk"},insurance:{types:{life:"Life Insurance",health:"Health Insurance",auto:"Auto Insurance",home:"Home Insurance",travel:"Travel Insurance",income:"Income Protection",disability:"Disability Insurance",longTermCare:"Long-term Care Insurance"},terms:{premium:"Premium",coverage:"Coverage",deductible:"Deductible",beneficiary:"Beneficiary",policy:"Policy",claim:"Claim",renewal:"Renewal",cancellation:"Cancellation"}},risks:{categories:{health:"Health Risk",financial:"Financial Risk",accident:"Accident Risk",natural:"Natural Disaster Risk",career:"Career Risk",family:"Family Risk"},levels:{low:"Low Risk",medium:"Medium Risk",high:"High Risk",extreme:"Extreme Risk"}}},tutorial:{title:"Game Tutorial",welcome:"Welcome to the Life Enrichment Game!",steps:{introduction:{title:"Introduction",content:"In this game, you'll navigate through different life stages while balancing risks and insurance."},basicRules:{title:"Basic Rules",content:"Each turn, draw cards and decide whether to face risks or protect yourself with insurance."},cardTypes:{title:"Card Types",content:"There are risk cards, insurance cards, and event cards. Learn their characteristics."},insuranceSystem:{title:"Insurance System",content:"Purchase insurance in advance to prepare for risks. Consider premiums and coverage amounts."},strategy:{title:"Strategy Tips",content:"Maintain your vitality while developing an effective insurance strategy for success."}}},statistics:{title:"Statistics Dashboard",sections:{overview:"Overview",performance:"Performance",trends:"Trends",detailed:"Detailed Analysis"},metrics:{gamesPlayed:"Games Played",winRate:"Win Rate",averageScore:"Average Score",bestScore:"Best Score",totalPlayTime:"Total Play Time",averageGameTime:"Average Game Time",survivalRate:"Survival Rate",insuranceEfficiency:"Insurance Efficiency"},charts:{vitalityTrend:"Vitality Trend",stageAnalysis:"Stage Analysis",cardUsage:"Card Usage",decisionAnalysis:"Decision Analysis",riskManagement:"Risk Management",insuranceCoverage:"Insurance Coverage"}},accessibility:{title:"Accessibility Settings",sections:{visual:"Visual Settings",audio:"Audio Settings",interaction:"Interaction Settings",display:"Display Settings"},options:{highContrast:"High Contrast",largeText:"Large Text",reduceMotion:"Reduce Motion",screenReader:"Screen Reader Support",keyboardNavigation:"Keyboard Navigation",audioCues:"Audio Cues",subtitles:"Subtitles",slowAnimations:"Slow Animations"},keyboardShortcuts:{title:"Keyboard Shortcuts",homeScreen:"Return to Home Screen (Alt+H)",startGame:"Start Game (Alt+G)",startTutorial:"Start Tutorial (Alt+T)",openStatistics:"Open Statistics (Alt+S)",openAccessibility:"Accessibility Settings (Alt+A)",help:"Show Help (F1)"}},feedback:{title:"Feedback",types:{bug:"Bug Report",suggestion:"Suggestion",general:"General Opinion",rating:"Rating"},form:{subject:"Subject",message:"Message",email:"Email (Optional)",category:"Category",priority:"Priority",submit:"Submit",thankYou:"Thank you for your feedback!"}},errors:{general:"An error occurred.",network:"A network error occurred.",gameState:"Failed to load game state.",save:"Failed to save game.",load:"Failed to load game.",invalidAction:"Invalid action.",cardNotFound:"Card not found.",insufficientFunds:"Insufficient funds.",insuranceNotActive:"Insurance is not active."},success:{gameSaved:"Game saved.",gameLoaded:"Game loaded.",insurancePurchased:"Insurance purchased.",riskAvoided:"Risk avoided.",levelCompleted:"Level completed!",achievementUnlocked:"Achievement unlocked!"},region:{currency:"USD",currencySymbol:"$",dateFormat:"MM/DD/YYYY",numberFormat:"1,234",insuranceSystem:{nationalHealth:"Medicare",employeeHealth:"Employer Health Insurance",nationalPension:"Social Security",employeePension:"401(k)",longTermCare:"Long-term Care Insurance",workersComp:"Workers' Compensation",unemployment:"Unemployment Insurance"},risks:{earthquake:"Earthquake",hurricane:"Hurricane",flood:"Flood",recession:"Recession",inflation:"Inflation",jobLoss:"Job Loss"}},ageGroups:{young:{title:"Insurance Advice for Young Adults",message:"Building a foundation for your future is important."},middle:{title:"Insurance Advice for Working Adults",message:"Consider protection for your family."},senior:{title:"Insurance Advice for Seniors",message:"Healthcare and long-term care preparation is essential."}}},Hs={ui:{navigation:{home:"首页",back:"首页",game:"游戏",tutorial:"教程",statistics:"统计",settings:"设置",accessibility:"无障碍设置",feedback:"反馈"},buttons:{start:"开始",startGame:"开始游戏",startTutorial:"开始教程",close:"关闭",cancel:"取消",ok:"确定",yes:"是",no:"否",continue:"继续",skip:"跳过",next:"下一步",previous:"上一步",finish:"完成",reset:"重置",save:"保存",load:"加载"},common:{loading:"加载中...",error:"发生错误",success:"成功",warning:"警告",info:"信息",confirm:"确认",welcome:"欢迎",congratulations:"恭喜！",gameOver:"游戏结束",newGame:"新游戏",retry:"重试"}},game:{title:"人生充实游戏",subtitle:"战略人生模拟",description:"在人生的不同阶段中，平衡风险与保险，追求充实人生的游戏。",stages:{youth:"青年期",adult:"成年期",middleAge:"中年期",elderly:"老年期"},elements:{vitality:"生命力",turn:"回合",phase:"阶段",stage:"关卡",round:"轮次",score:"得分",level:"等级"},cards:{riskCard:"风险卡",insuranceCard:"保险卡",eventCard:"事件卡",actionCard:"行动卡",powerCard:"力量卡"},actions:{draw:"抽卡",play:"出牌",discard:"弃牌",buyInsurance:"购买保险",cancelInsurance:"取消保险",takeRisk:"承担风险",avoidRisk:"规避风险"},insurance:{types:{life:"人寿保险",health:"健康保险",auto:"车险",home:"房屋保险",travel:"旅行保险",income:"收入保障保险",disability:"意外伤害保险",longTermCare:"长期护理保险"},terms:{premium:"保费",coverage:"保额",deductible:"免赔额",beneficiary:"受益人",policy:"保单",claim:"理赔",renewal:"续保",cancellation:"退保"}},risks:{categories:{health:"健康风险",financial:"经济风险",accident:"意外风险",natural:"自然灾害风险",career:"职业风险",family:"家庭风险"},levels:{low:"低风险",medium:"中等风险",high:"高风险",extreme:"极高风险"}}},tutorial:{title:"游戏教程",welcome:"欢迎来到人生充实游戏的世界！",steps:{introduction:{title:"介绍",content:"在这个游戏中，您将在人生的不同阶段中平衡风险与保险。"},basicRules:{title:"基本规则",content:"每回合抽取卡牌，决定是面对风险还是用保险来防范。"},cardTypes:{title:"卡牌类型",content:"有风险卡、保险卡和事件卡。了解它们各自的特点。"},insuranceSystem:{title:"保险系统",content:"提前购买保险来防范风险。要考虑保费和保额。"},strategy:{title:"策略要点",content:"在维持生命力的同时，制定有效的保险策略是成功的关键。"}}},statistics:{title:"统计仪表板",sections:{overview:"概览",performance:"表现",trends:"趋势",detailed:"详细分析"},metrics:{gamesPlayed:"游戏次数",winRate:"胜率",averageScore:"平均得分",bestScore:"最高得分",totalPlayTime:"总游戏时间",averageGameTime:"平均游戏时间",survivalRate:"生存率",insuranceEfficiency:"保险效率"},charts:{vitalityTrend:"生命力趋势",stageAnalysis:"阶段分析",cardUsage:"卡牌使用情况",decisionAnalysis:"决策分析",riskManagement:"风险管理",insuranceCoverage:"保险覆盖"}},accessibility:{title:"无障碍设置",sections:{visual:"视觉设置",audio:"音频设置",interaction:"交互设置",display:"显示设置"},options:{highContrast:"高对比度",largeText:"大字体",reduceMotion:"减少动画",screenReader:"屏幕阅读器支持",keyboardNavigation:"键盘导航",audioCues:"音频提示",subtitles:"字幕",slowAnimations:"慢速动画"},keyboardShortcuts:{title:"键盘快捷键",homeScreen:"返回首页 (Alt+H)",startGame:"开始游戏 (Alt+G)",startTutorial:"开始教程 (Alt+T)",openStatistics:"打开统计 (Alt+S)",openAccessibility:"无障碍设置 (Alt+A)",help:"显示帮助 (F1)"}},feedback:{title:"反馈",types:{bug:"错误报告",suggestion:"改进建议",general:"一般意见",rating:"评价"},form:{subject:"主题",message:"消息",email:"邮箱（可选）",category:"类别",priority:"优先级",submit:"提交",thankYou:"感谢您的反馈！"}},errors:{general:"发生错误。",network:"网络错误。",gameState:"游戏状态加载失败。",save:"游戏保存失败。",load:"游戏加载失败。",invalidAction:"无效操作。",cardNotFound:"未找到卡牌。",insufficientFunds:"资金不足。",insuranceNotActive:"保险未生效。"},success:{gameSaved:"游戏已保存。",gameLoaded:"游戏已加载。",insurancePurchased:"保险已购买。",riskAvoided:"风险已规避。",levelCompleted:"关卡完成！",achievementUnlocked:"成就解锁！"},region:{currency:"人民币",currencySymbol:"¥",dateFormat:"YYYY年MM月DD日",numberFormat:"1,234",insuranceSystem:{nationalHealth:"城镇职工基本医疗保险",employeeHealth:"职工医疗保险",nationalPension:"城镇职工基本养老保险",employeePension:"企业年金",longTermCare:"长期护理保险",workersComp:"工伤保险",unemployment:"失业保险"},risks:{earthquake:"地震",flood:"洪水",typhoon:"台风",smog:"雾霾",economicSlowdown:"经济放缓",agingPopulation:"人口老龄化"}},ageGroups:{young:{title:"年轻人保险建议",message:"为未来打好基础很重要。"},middle:{title:"中年人保险建议",message:"考虑为家庭提供保障。"},senior:{title:"老年人保险建议",message:"医疗和护理风险的准备至关重要。"}}},Ns={ui:{navigation:{home:"홈",back:"홈",game:"게임",tutorial:"튜토리얼",statistics:"통계",settings:"설정",accessibility:"접근성 설정",feedback:"피드백"},buttons:{start:"시작",startGame:"게임 시작",startTutorial:"튜토리얼 시작",close:"닫기",cancel:"취소",ok:"확인",yes:"예",no:"아니오",continue:"계속",skip:"건너뛰기",next:"다음",previous:"이전",finish:"완료",reset:"초기화",save:"저장",load:"불러오기"},common:{loading:"로딩 중...",error:"오류가 발생했습니다",success:"성공",warning:"경고",info:"정보",confirm:"확인",welcome:"환영합니다",congratulations:"축하합니다!",gameOver:"게임 종료",newGame:"새 게임",retry:"다시 시도"}},game:{title:"인생 충실 게임",subtitle:"전략적 인생 시뮬레이션",description:"인생의 다양한 단계에서 위험과 보험의 균형을 고려하며 충실한 인생을 목표로 하는 게임입니다.",stages:{youth:"청년기",adult:"성인기",middleAge:"중년기",elderly:"노년기"},elements:{vitality:"생명력",turn:"턴",phase:"페이즈",stage:"스테이지",round:"라운드",score:"점수",level:"레벨"},cards:{riskCard:"위험 카드",insuranceCard:"보험 카드",eventCard:"이벤트 카드",actionCard:"액션 카드",powerCard:"파워 카드"},actions:{draw:"카드 뽑기",play:"카드 사용",discard:"카드 버리기",buyInsurance:"보험 구매",cancelInsurance:"보험 해지",takeRisk:"위험 감수",avoidRisk:"위험 회피"},insurance:{types:{life:"생명보험",health:"건강보험",auto:"자동차보험",home:"화재보험",travel:"여행자보험",income:"소득보장보험",disability:"상해보험",longTermCare:"장기요양보험"},terms:{premium:"보험료",coverage:"보장금액",deductible:"자기부담금",beneficiary:"수익자",policy:"보험증권",claim:"보험금 청구",renewal:"갱신",cancellation:"해지"}},risks:{categories:{health:"건강 위험",financial:"경제적 위험",accident:"사고 위험",natural:"자연재해 위험",career:"직업 위험",family:"가족 위험"},levels:{low:"낮은 위험",medium:"중간 위험",high:"높은 위험",extreme:"극도로 높은 위험"}}},tutorial:{title:"게임 튜토리얼",welcome:"인생 충실 게임의 세계에 오신 것을 환영합니다!",steps:{introduction:{title:"소개",content:"이 게임에서는 인생의 다양한 단계에서 위험과 보험의 균형을 고려하며 진행합니다."},basicRules:{title:"기본 규칙",content:"각 턴에서 카드를 뽑고, 위험에 대처하거나 보험으로 대비할지 결정합니다."},cardTypes:{title:"카드 종류",content:"위험 카드, 보험 카드, 이벤트 카드가 있습니다. 각각의 특징을 이해해봅시다."},insuranceSystem:{title:"보험 시스템",content:"미리 보험을 구매하여 위험에 대비할 수 있습니다. 보험료와 보장금액을 고려하여 선택하세요."},strategy:{title:"전략 포인트",content:"생명력을 유지하면서 효과적인 보험 전략을 세우는 것이 성공의 열쇠입니다."}}},statistics:{title:"통계 대시보드",sections:{overview:"개요",performance:"성과",trends:"트렌드",detailed:"상세 분석"},metrics:{gamesPlayed:"플레이 횟수",winRate:"승률",averageScore:"평균 점수",bestScore:"최고 점수",totalPlayTime:"총 플레이 시간",averageGameTime:"평균 게임 시간",survivalRate:"생존율",insuranceEfficiency:"보험 효율성"},charts:{vitalityTrend:"생명력 추이",stageAnalysis:"스테이지별 분석",cardUsage:"카드 사용 현황",decisionAnalysis:"의사결정 분석",riskManagement:"위험 관리",insuranceCoverage:"보험 커버리지"}},accessibility:{title:"접근성 설정",sections:{visual:"시각 설정",audio:"음성 설정",interaction:"조작 설정",display:"표시 설정"},options:{highContrast:"고대비",largeText:"큰 글자",reduceMotion:"애니메이션 감소",screenReader:"스크린 리더 지원",keyboardNavigation:"키보드 내비게이션",audioCues:"음성 신호",subtitles:"자막",slowAnimations:"느린 애니메이션"},keyboardShortcuts:{title:"키보드 단축키",homeScreen:"홈 화면으로 돌아가기 (Alt+H)",startGame:"게임 시작 (Alt+G)",startTutorial:"튜토리얼 시작 (Alt+T)",openStatistics:"통계 열기 (Alt+S)",openAccessibility:"접근성 설정 (Alt+A)",help:"도움말 표시 (F1)"}},feedback:{title:"피드백",types:{bug:"버그 리포트",suggestion:"개선 제안",general:"일반 의견",rating:"평가"},form:{subject:"제목",message:"메시지",email:"이메일 (선택사항)",category:"카테고리",priority:"우선순위",submit:"제출",thankYou:"피드백을 주셔서 감사합니다!"}},errors:{general:"오류가 발생했습니다.",network:"네트워크 오류가 발생했습니다.",gameState:"게임 상태 로드에 실패했습니다.",save:"게임 저장에 실패했습니다.",load:"게임 로드에 실패했습니다.",invalidAction:"유효하지 않은 동작입니다.",cardNotFound:"카드를 찾을 수 없습니다.",insufficientFunds:"자금이 부족합니다.",insuranceNotActive:"보험이 유효하지 않습니다."},success:{gameSaved:"게임을 저장했습니다.",gameLoaded:"게임을 로드했습니다.",insurancePurchased:"보험을 구매했습니다.",riskAvoided:"위험을 회피했습니다.",levelCompleted:"레벨을 클리어했습니다!",achievementUnlocked:"업적을 달성했습니다!"},region:{currency:"원",currencySymbol:"₩",dateFormat:"YYYY년 MM월 DD일",numberFormat:"1,234",insuranceSystem:{nationalHealth:"국민건강보험",employeeHealth:"직장건강보험",nationalPension:"국민연금",employeePension:"퇴직연금",longTermCare:"장기요양보험",workersComp:"산재보험",unemployment:"고용보험"},risks:{earthquake:"지진",typhoon:"태풍",flood:"홍수",fineDust:"미세먼지",economicRecession:"경기침체",agingSociety:"고령화 사회"}},ageGroups:{young:{title:"젊은 세대를 위한 보험 조언",message:"미래를 위한 기반 마련이 중요합니다."},middle:{title:"직장인 세대를 위한 보험 조언",message:"가족을 지키기 위한 보장을 고려해보세요."},senior:{title:"시니어 세대를 위한 보험 조언",message:"의료 및 요양 위험에 대한 대비가 중요합니다."}}},de=["ja","en","zh","ko"],fe={ja:"日本語",en:"English",zh:"中文（简体）",ko:"한국어"},zs=[];function Us(){const o=navigator.language.split("-")[0];return de.includes(o)?o:"ja"}function Vs(){try{const o=localStorage.getItem("insurance-game-locale");return de.includes(o)?o:null}catch(o){return null}}function Bs(o){try{localStorage.setItem("insurance-game-locale",o)}catch(e){console.warn("Failed to save locale to localStorage:",e)}}function js(){return Vs()||Us()}const qs={legacy:!1,locale:js(),fallbackLocale:"ja",messages:{ja:Fs,en:Os,zh:Hs,ko:Ns},numberFormats:{ja:{currency:{style:"currency",currency:"JPY",currencyDisplay:"symbol"},decimal:{style:"decimal",minimumFractionDigits:0,maximumFractionDigits:2}},en:{currency:{style:"currency",currency:"USD",currencyDisplay:"symbol"},decimal:{style:"decimal",minimumFractionDigits:0,maximumFractionDigits:2}},zh:{currency:{style:"currency",currency:"CNY",currencyDisplay:"symbol"},decimal:{style:"decimal",minimumFractionDigits:0,maximumFractionDigits:2}},ko:{currency:{style:"currency",currency:"KRW",currencyDisplay:"symbol"},decimal:{style:"decimal",minimumFractionDigits:0,maximumFractionDigits:0}}},datetimeFormats:{ja:{short:{year:"numeric",month:"short",day:"numeric"},long:{year:"numeric",month:"long",day:"numeric",weekday:"long"}},en:{short:{year:"numeric",month:"short",day:"numeric"},long:{year:"numeric",month:"long",day:"numeric",weekday:"long"}},zh:{short:{year:"numeric",month:"short",day:"numeric"},long:{year:"numeric",month:"long",day:"numeric",weekday:"long"}},ko:{short:{year:"numeric",month:"short",day:"numeric"},long:{year:"numeric",month:"long",day:"numeric",weekday:"long"}}}},xe=Ye(qs);function Ks(o){if(!de.includes(o)){console.warn(`Unsupported locale: ${o}`);return}xe.global.locale.value=o,Bs(o),document.documentElement.lang=o,document.documentElement.dir=zs.includes(o)?"rtl":"ltr"}function Gs(){return xe.global.locale.value}const Ws={key:0,class:"language-dropdown"},Qs=["aria-label","aria-expanded"],Js={class:"current-flag","aria-hidden":"true"},Ys={key:0,class:"current-label"},Xs=["aria-label"],Zs=["aria-selected","tabindex","onClick","onKeydown"],ei={class:"option-flag","aria-hidden":"true"},ti={class:"option-label"},si={key:0,class:"option-check","aria-hidden":"true"},ii={key:1,class:"language-buttons"},ni=["aria-label","aria-pressed","onClick"],ri={class:"button-flag","aria-hidden":"true"},oi={key:0,class:"button-label"},ai={key:2,class:"language-flags"},ci=["aria-label","title","onClick"],li=N({__name:"LanguageSwitcher",props:{mode:{default:"dropdown"},compact:{type:Boolean,default:!1},ariaLabel:{default:""}},setup(o){const{t:e}=Oe(),t=o,s=_(!1),i=_(Gs()),n=V(()=>fe[i.value]),r=V(()=>de.map(y=>({value:y,label:fe[y],flag:d(y),isActive:y===i.value})));function d(y){return{ja:"🇯🇵",en:"🇺🇸",zh:"🇨🇳",ko:"🇰🇷"}[y]}function u(y){i.value=y,Ks(y),s.value=!1;const g=`Language changed to ${fe[y]}`;m(g)}function m(y){const g=document.createElement("div");g.setAttribute("aria-live","polite"),g.setAttribute("aria-atomic","true"),g.className="sr-only",g.textContent=y,document.body.appendChild(g),setTimeout(()=>document.body.removeChild(g),1e3)}function h(){s.value=!s.value}function E(y){y.target.closest(".language-switcher")||(s.value=!1)}function S(y,g){var a;switch(y.key){case"Enter":case" ":y.preventDefault(),g?u(g):h();break;case"Escape":if(s.value){s.value=!1;const l=document.querySelector(".language-trigger");l==null||l.focus()}break;case"ArrowDown":if(t.mode==="dropdown"&&s.value){y.preventDefault();const l=document.querySelector('.language-option:not([aria-selected="true"]) + .language-option');l==null||l.focus()}break;case"ArrowUp":if(t.mode==="dropdown"&&s.value){y.preventDefault();const l=(a=document.querySelector('.language-option[aria-selected="true"]'))==null?void 0:a.previousElementSibling;l==null||l.focus()}break}}return ie(()=>{document.addEventListener("click",E)}),ue(()=>{document.removeEventListener("click",E)}),(y,g)=>(v(),w("div",{class:Z(["language-switcher",[`language-switcher--${y.mode}`,{"language-switcher--compact":y.compact}]])},[y.mode==="dropdown"?(v(),w("div",Ws,[c("button",{class:"language-trigger","aria-label":y.ariaLabel||M(e)("accessibility.options.changeLanguage","Change Language"),"aria-expanded":s.value,"aria-haspopup":"listbox",onClick:h,onKeydown:S},[c("span",Js,x(d(i.value)),1),y.compact?T("",!0):(v(),w("span",Ys,x(n.value),1)),c("span",{class:Z(["dropdown-icon",{"dropdown-icon--open":s.value}]),"aria-hidden":"true"}," ▼ ",2)],40,Qs),D(le,{name:"dropdown"},{default:U(()=>[s.value?(v(),w("ul",{key:0,class:"language-options",role:"listbox","aria-label":M(e)("ui.navigation.selectLanguage","Select Language")},[(v(!0),w(te,null,se(r.value,a=>(v(),w("li",{key:a.value,class:"language-option",role:"option","aria-selected":a.isActive,tabindex:a.isActive?0:-1,onClick:l=>u(a.value),onKeydown:l=>S(l,a.value)},[c("span",ei,x(a.flag),1),c("span",ti,x(a.label),1),a.isActive?(v(),w("span",si,"✓")):T("",!0)],40,Zs))),128))],8,Xs)):T("",!0)]),_:1})])):y.mode==="buttons"?(v(),w("div",ii,[(v(!0),w(te,null,se(r.value,a=>(v(),w("button",{key:a.value,class:Z(["language-button",{"language-button--active":a.isActive}]),"aria-label":`${M(e)("ui.navigation.switchTo","Switch to")} ${a.label}`,"aria-pressed":a.isActive,onClick:l=>u(a.value)},[c("span",ri,x(a.flag),1),y.compact?T("",!0):(v(),w("span",oi,x(a.label),1))],10,ni))),128))])):y.mode==="flags"?(v(),w("div",ai,[(v(!0),w(te,null,se(r.value,a=>(v(),w("button",{key:a.value,class:Z(["language-flag",{"language-flag--active":a.isActive}]),"aria-label":`${M(e)("ui.navigation.switchTo","Switch to")} ${a.label}`,title:a.label,onClick:l=>u(a.value)},x(a.flag),11,ci))),128))])):T("",!0)],2))}}),ui=z(li,[["__scopeId","data-v-ee196843"]]),di={class:"app-container",role:"application","aria-label":"人生充実ゲーム"},mi={key:0,class:"game-view",id:"main-content",role:"main","aria-label":"ゲーム画面"},gi={key:1,class:"home-view",id:"main-content",role:"main","aria-label":"ホーム画面"},pi={class:"home-container"},hi={class:"info-section"},fi={class:"language-switcher-container"},yi=["aria-label","title"],vi=N({__name:"App",setup(o){const{t:e}=Oe(),t=_(!1),s=_(!1),i=_(!1),n=pe(()=>he(()=>import("./analytics-ImNIcNXw.js").then(I=>I.S),__vite__mapDeps([0,1,2,3,4,5]))),r=pe(()=>he(()=>import("./feedback-Bk8qjEas.js"),__vite__mapDeps([6,1,2,3,0,4,5,7]))),d=pe(()=>he(()=>import("./GameCanvas-BZ9_4VV0.js"),__vite__mapDeps([8,9,1,2,3,10,11,0,4,5,12,13]))),u=_();let m=null,h=null;const E=_({stage:"youth",turn:1,vitality:100,phase:"setup"}),S=()=>{t.value=!0,h==null||h.announceScreenChange("ゲーム画面","ゲームが開始されました")},y=()=>{t.value=!0,h==null||h.announceScreenChange("チュートリアル","チュートリアルを開始します"),setTimeout(()=>{const I=new CustomEvent("startTutorial");window.dispatchEvent(I)},100)},g=()=>{t.value=!1,h==null||h.announceScreenChange("ホーム画面","ホーム画面に戻りました")},a=()=>{i.value=!0,h==null||h.announceScreenChange("統計ダッシュボード","統計ダッシュボードを開きました")},l=()=>{i.value=!1,h==null||h.announceScreenChange("ホーム画面","ホーム画面に戻りました")},A=I=>{console.log("アクセシビリティ設定が更新されました:",I),I.screenReaderEnabled&&(h==null||h.announce("スクリーンリーダー対応が有効になりました",{priority:"assertive"}))},L=(I,k)=>{console.log(`フィードバック送信完了: ${k} (${I})`)};return ie(()=>{m=new As,h=new He,m.registerShortcut({key:"h",modifiers:["alt"],description:"ホーム画面に戻る",action:()=>{t.value&&g()}}),m.registerShortcut({key:"g",modifiers:["alt"],description:"ゲームを開始",action:()=>{t.value||S()}}),m.registerShortcut({key:"t",modifiers:["alt"],description:"チュートリアルを開始",action:()=>{t.value||y()}}),m.registerShortcut({key:"a",modifiers:["alt"],description:"アクセシビリティ設定を開く",action:()=>{s.value=!0,h==null||h.announce("アクセシビリティ設定を開きました",{priority:"assertive"})}}),m.registerShortcut({key:"s",modifiers:["alt"],description:"統計ダッシュボードを開く",action:()=>{!t.value&&!i.value&&a()}}),setTimeout(()=>{var Ie,Te;const I=(Ie=u.value)==null?void 0:Ie.gameButtonRef,k=(Te=u.value)==null?void 0:Te.tutorialButtonRef,$=document.querySelector(".back-to-home-btn");I!=null&&(m==null||m.registerFocusableElement(I,{priority:100,group:"main-actions",onFocus:()=>h==null?void 0:h.announce("ゲーム開始ボタンにフォーカス")})),k!=null&&(m==null||m.registerFocusableElement(k,{priority:90,group:"main-actions",onFocus:()=>h==null?void 0:h.announce("チュートリアル開始ボタンにフォーカス")})),$!=null&&(m==null||m.registerFocusableElement($,{priority:100,group:"game-actions",onFocus:()=>h==null?void 0:h.announce("ホーム画面に戻るボタンにフォーカス")}))},100),h.announceScreenChange("ホーム画面","人生充実ゲーム へようこそ。Alt+Gでゲーム開始、Alt+Tでチュートリアル、Alt+Sで統計、Alt+Aでアクセシビリティ設定、F1でヘルプを表示できます")}),ue(()=>{m==null||m.destroy(),h==null||h.destroy()}),(I,k)=>(v(),w("div",di,[k[5]||(k[5]=c("div",{class:"skip-links"},[c("a",{href:"#main-content",class:"skip-link"},"メインコンテンツに移動"),c("a",{href:"#navigation",class:"skip-link"},"ナビゲーションに移動")],-1)),D(ks),D(it,{type:"slide",direction:"left",duration:400,intensity:"normal"},{default:U(()=>[t.value?(v(),w("div",mi,[D($e,{fallback:"detailed","can-recover":!0},{default:U(()=>[D(M(d))]),_:1}),c("button",{ref:"backToHomeButtonRef",onClick:g,class:"back-to-home-btn","aria-label":"ホーム画面に戻る (Alt+H)","aria-keyshortcuts":"Alt+H"},k[3]||(k[3]=[c("span",{class:"btn-icon","aria-hidden":"true"},"←",-1),c("span",{class:"btn-text"},"ホーム",-1)]),512)])):(v(),w("div",gi,[D($e,{fallback:"minimal"},{default:U(()=>[c("div",pi,[D(Ts),D($s,{onStartGame:S,onStartTutorial:y,onOpenStatistics:a,ref_key:"navigationRef",ref:u},null,512),c("section",hi,[D(Ms)])])]),_:1})]))]),_:1}),k[6]||(k[6]=c("footer",{class:"sr-only",id:"footer",role:"contentinfo"},[c("p",null,"人生充実ゲーム - アクセシブルなWebゲーム体験")],-1)),D($t,{"is-open":s.value,onClose:k[0]||(k[0]=$=>s.value=!1),onSettingsChanged:A},null,8,["is-open"]),D(Vt,{enabled:!0}),c("div",fi,[D(ui,{mode:"dropdown",compact:!0,"aria-label":M(e)("accessibility.options.changeLanguage","Change Language")},null,8,["aria-label"])]),c("button",{onClick:k[1]||(k[1]=$=>s.value=!0),class:"accessibility-button","aria-label":M(e)("accessibility.keyboardShortcuts.openAccessibility","アクセシビリティ設定を開く (Alt+A)"),"aria-keyshortcuts":"Alt+A",title:M(e)("accessibility.title","アクセシビリティ設定")},k[4]||(k[4]=[c("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true"},[c("path",{d:"M12 2C13.1 2 14 2.9 14 4C14 5.1 13.1 6 12 6C10.9 6 10 5.1 10 4C10 2.9 10.9 2 12 2ZM21 9H15L13.5 7.5C13 7 12.5 6.5 11.9 6.5H12.1C11.5 6.5 11 7 10.5 7.5L7.91 10.09C7.66 10.34 7.66 10.76 7.91 11.01L10.5 13.6C11 14.1 11.5 14.6 12.1 14.6H11.9C12.5 14.6 13 14.1 13.5 13.6L15 12.1H21C21.6 12.1 22 11.7 22 11.1V10C22 9.4 21.6 9 21 9ZM8.5 12.5L12 16L15.5 12.5L12 22L8.5 12.5Z",fill:"currentColor"})],-1)]),8,yi),(v(),ke(Fe,{to:"body"},[i.value?(v(),w("div",{key:0,class:"modal-overlay",onClick:l},[c("div",{class:"modal-content",onClick:k[2]||(k[2]=Me(()=>{},["stop"]))},[D(M(n),{"auto-refresh":!0,onClose:l})])])):T("",!0)])),D(M(r),{"game-state":E.value,"show-stats":!0,"auto-survey":!0,onFeedbackSubmitted:L},null,8,["game-state"])]))}}),wi=z(vi,[["__scopeId","data-v-e3a45ac9"]]),B=class B{constructor(){p(this,"suspiciousActivities",[]);p(this,"rateLimiters",new Map);p(this,"securityMetrics",{totalThreatsBlocked:0,totalInputValidations:0,totalRateLimitViolations:0,sessionStartTime:Date.now()})}static getInstance(){return B.instance||(B.instance=new B),B.instance}getSecurityMetrics(){return R(C({},this.securityMetrics),{uptime:Date.now()-this.securityMetrics.sessionStartTime,currentThreats:this.suspiciousActivities.filter(e=>Date.now()-e.timestamp.getTime()<6e4).length})}cleanupRateLimiters(){for(const e of this.rateLimiters.values())e.cleanup()}logSuspiciousActivity(e){const t=R(C({},e),{id:Ae(16),timestamp:new Date});this.suspiciousActivities.push(t),this.securityMetrics.totalThreatsBlocked++,this.suspiciousActivities.length>1e3&&(this.suspiciousActivities=this.suspiciousActivities.slice(-1e3)),this.getRecentActivitiesByType(e.type,6e4).length>=5&&(t.severity="high",t.description+=" (攻撃パターン検出)"),(t.severity==="high"||t.severity==="critical")&&(console.warn(`🚨 セキュリティ警告 [${t.severity.toUpperCase()}]: ${t.description}`),t.severity==="critical"&&this.handleCriticalThreat(t)),this.persistActivityToStorage(t)}getRecentActivitiesByType(e,t){const s=Date.now()-t;return this.suspiciousActivities.filter(i=>i.type===e&&i.timestamp.getTime()>s)}persistActivityToStorage(e){try{setTimeout(()=>{const t=JSON.parse(localStorage.getItem("security_incidents")||"[]");t.push(R(C({},e),{timestamp:e.timestamp.toISOString()}));const s=t.slice(-500);localStorage.setItem("security_incidents",JSON.stringify(s))},0)}catch(t){console.error("セキュリティログの永続化に失敗:",t)}}checkRateLimit(e,t,s,i=6e4){this.rateLimiters.has(e)||this.rateLimiters.set(e,new Cs);const n=this.rateLimiters.get(e),r=n.isAllowed(e,t,s,i);if(!r){this.securityMetrics.totalRateLimitViolations++;const d=n.getRemainingAttempts(e,t,s),u=n.getNextAttemptTime(e,s);this.logSuspiciousActivity({type:"rate_limit_exceeded",description:`レート制限を超過: ${e}`,severity:d===0?"high":"medium",source:e,metadata:{maxAttempts:t,windowMs:s,blockDurationMs:i,remainingAttempts:d,nextAttemptTime:u}})}return r}getSuspiciousActivities(e=100){return this.suspiciousActivities.slice(-e).sort((t,s)=>s.timestamp.getTime()-t.timestamp.getTime())}generateSecurityReport(){const e=this.getSuspiciousActivities(),t={},s={},i={};e.forEach(r=>{t[r.type]=(t[r.type]||0)+1,s[r.severity]=(s[r.severity]||0)+1;const d=new Date(r.timestamp).getHours();i[d]=(i[d]||0)+1});const n=this.getSecurityMetrics();return{totalActivities:e.length,typeBreakdown:t,severityBreakdown:s,hourlyBreakdown:i,recentActivities:e.slice(0,10),generateTime:new Date,metrics:n,recommendations:this.generateSecurityRecommendations(t,s)}}generateSecurityRecommendations(e,t){const s=[];return e.rate_limit_exceeded>10&&s.push("レート制限の強化を検討してください"),e.invalid_input>5&&s.push("入力検証の強化を検討してください"),e.csp_violation>0&&s.push("Content Security Policyの見直しを検討してください"),t.critical>0&&s.push("クリティカルな脅威が検出されました。系統管理者に連絡してください"),s.length===0&&s.push("セキュリティ状態は良好です"),s}handleCriticalThreat(e){try{localStorage.clear(),sessionStorage.clear()}catch(t){console.error("緊急時のストレージクリアに失敗:",t)}console.error("🚨 CRITICAL SECURITY THREAT DETECTED 🚨"),console.error("Activity:",e),console.error("All storage has been cleared as a security measure."),typeof window!="undefined"&&setTimeout(()=>{window.location.reload()},1e3)}};p(B,"instance");let b=B;function bi(o,e=10){function t(i,n=0){if(n>e||i===null||typeof i!="object")return n;if(s.has(i))return b.getInstance().logSuspiciousActivity({type:"circular_reference",description:"循環参照を持つオブジェクトが検出されました",severity:"medium",source:"input_validation",metadata:{currentDepth:n}}),e+1;s.add(i);try{if(Array.isArray(i))return i.length>1e4?(b.getInstance().logSuspiciousActivity({type:"oversized_array",description:`異常に大きな配列: ${i.length}個の要素`,severity:"high",source:"input_validation",metadata:{arrayLength:i.length,currentDepth:n}}),e+1):Math.max(n,...i.map(d=>t(d,n+1)));const r=Object.keys(i);return r.length>1e3?(b.getInstance().logSuspiciousActivity({type:"oversized_object",description:`異常に多くのプロパティ: ${r.length}個`,severity:"high",source:"input_validation",metadata:{propertyCount:r.length,currentDepth:n}}),e+1):Math.max(n,...Object.values(i).map(d=>t(d,n+1)))}finally{s.delete(i)}}const s=new Set;return t(o)<=e}function Si(o,e={}){const{maxLength:t=1e3,allowedTypes:s=["string","number","boolean"],sanitize:i=!0,maxDepth:n=10,checkPatterns:r=[]}=e,d=[];let u;const m=typeof o;if(!s.includes(m))return d.push(`無効な型: ${m}`),{isValid:!1,errors:d};if(o==null&&!s.includes("null"))return d.push("nullまたはundefinedは許可されていません"),{isValid:!1,errors:d};if(m==="string"){const E=o;E.length>t&&d.push(`文字列が長すぎます: ${E.length}/${t}`);for(const S of r)S.test(E)||d.push(`パターンマッチング失敗: ${S.source}`);if(i)try{u=Ei(E)}catch(S){d.push(`サニタイゼーションエラー: ${S instanceof Error?S.message:String(S)}`)}}return o&&typeof o=="object"&&(bi(o,n)||d.push(`オブジェクトの深度が制限を超えています: ${n}`)),{isValid:d.length===0,sanitizedInput:u,errors:d}}function Ei(o){return o.replace(/\/\*[\s\S]*?\*\//g,"").replace(/\/\/.*$/gm,"").replace(/['"`;]/g,"").replace(/\b(SELECT|INSERT|UPDATE|DELETE|DROP|CREATE|ALTER|EXEC|UNION|SCRIPT)\b/gi,"").replace(/[()&|!=<>]/g,"").replace(/[{}$]/g,"").replace(/[\/\[\]@]/g,"").replace(/[;&|`$\\]/g,"").replace(/[\x00-\x1f\x7f-\x9f\ufeff]/g,"").trim()}function ki(){typeof window!="undefined"&&document.addEventListener("securitypolicyviolation",o=>{b.getInstance().logSuspiciousActivity({type:"csp_violation",description:`CSP違反: ${o.violatedDirective}`,severity:"high",source:o.sourceFile||"unknown",metadata:{violatedDirective:o.violatedDirective,blockedURI:o.blockedURI,lineNumber:o.lineNumber,columnNumber:o.columnNumber}})})}function Ci(){typeof window!="undefined"&&window.MutationObserver&&new MutationObserver(e=>{e.forEach(t=>{t.type==="childList"&&t.addedNodes.forEach(s=>{if(s.nodeType===Node.ELEMENT_NODE){const i=s;if(i.tagName==="SCRIPT"){const n=i.getAttribute("src");n&&!n.startsWith(window.location.origin)&&b.getInstance().logSuspiciousActivity({type:"external_script_injection",description:`外部スクリプトの動的追加を検出: ${n}`,severity:"critical",source:"dom_monitor",metadata:{scriptSrc:n}})}}})})}).observe(document.body,{childList:!0,subtree:!0})}function Ai(){if(typeof window!="undefined"){const o=window.fetch;window.fetch=function(...t){const s=t[0],i=t[1]||{};return typeof s=="string"&&s.startsWith("http")&&!s.startsWith(window.location.origin)&&b.getInstance().logSuspiciousActivity({type:"external_network_request",description:`外部ドメインへのリクエスト: ${s}`,severity:"medium",source:"network_monitor",metadata:{url:s,method:i.method||"GET"}}),o.apply(this,t)};const e=window.XMLHttpRequest;window.XMLHttpRequest=function(){const t=new e,s=t.open;return t.open=function(i,n,...r){return typeof n=="string"&&n.startsWith("http")&&!n.startsWith(window.location.origin)&&b.getInstance().logSuspiciousActivity({type:"external_xhr_request",description:`外部ドメインへのXHRリクエスト: ${n}`,severity:"medium",source:"network_monitor",metadata:{url:n,method:i}}),s.apply(this,[i,n,...r])},t}}}function xi(){if(typeof window!="undefined"){let o=!1,e=Date.now();const t={sizeDetection(){return window.outerHeight-window.innerHeight>160||window.outerWidth-window.innerWidth>160},consoleDetection(){const s=performance.now();return console.log("%c","color: transparent"),performance.now()-s>100},debuggerDetection(){const s=performance.now();try{Function("debugger")()}catch(n){}return performance.now()-s>100},contextMenuDetection(){return!document.addEventListener}};setInterval(()=>{const s=Date.now(),i={size:t.sizeDetection(),console:s-e>5e3?t.consoleDetection():!1,debugger:s-e>1e4?t.debuggerDetection():!1,contextMenu:!1},n=Object.values(i).some(Boolean);n&&!o?(o=!0,b.getInstance().logSuspiciousActivity({type:"devtools_opened",description:"開発者ツールが検出されました",severity:"low",source:"devtools_detector",metadata:{detectionMethods:i,outerHeight:window.outerHeight,innerHeight:window.innerHeight,outerWidth:window.outerWidth,innerWidth:window.innerWidth,userAgent:navigator.userAgent,timestamp:s}}),Ii()):!n&&o&&(o=!1),s-e>5e3&&(e=s)},1e3)}}function Ii(){console.warn("%c🚨 セキュリティ警告","color: red; font-size: 24px; font-weight: bold;"),console.warn(`%cこのサイトはセキュリティ監視下にあります。
開発者ツールの使用は記録されます。`,"color: orange; font-size: 14px;");const o=b.getInstance(),e=navigator.userAgent;o.checkRateLimit(`devtools_user_${e}`,10,6e4)||console.warn("⚠️ 開発者ツール使用によるレート制限が発動しました")}function Ti(){try{ki(),Ci(),Ai(),xi(),_i(),Li(),Di(),$i(),Ri(),console.log("🛡️ セキュリティシステムが初期化されました (強化版)")}catch(o){console.error("❌ セキュリティ初期化に失敗しました:",o),b.getInstance().logSuspiciousActivity({type:"security_init_failure",description:`セキュリティ初期化エラー: ${o instanceof Error?o.message:String(o)}`,severity:"critical",source:"security_initialization",metadata:{error:o}})}}function _i(){document.addEventListener("input",o=>{const e=o.target;if(e&&e.value){const t=Si(e.value,{maxLength:1e3,sanitize:!0,checkPatterns:[/^[^<>"'&{}$]*$/]});t.isValid||b.getInstance().logSuspiciousActivity({type:"invalid_input",description:`無効な入力が検出されました: ${t.errors.join(", ")}`,severity:"medium",source:"input_validation_monitor",metadata:{inputValue:e.value.slice(0,100),errors:t.errors,elementType:e.type,elementName:e.name}})}})}function Li(){typeof window!="undefined"&&window.performance&&setInterval(()=>{if("memory"in performance){const e=performance.memory,t=Math.round(e.usedJSHeapSize/1024/1024),s=Math.round(e.jsHeapSizeLimit/1024/1024),i=t/s*100;i>80&&b.getInstance().logSuspiciousActivity({type:"high_memory_usage",description:`メモリ使用率が高いです: ${i.toFixed(1)}%`,severity:"medium",source:"performance_monitor",metadata:{usedMB:t,limitMB:s,usagePercent:i}})}},3e4)}function Di(){const o=new Map;setInterval(()=>{const t=Object.keys(window).length,s=o.get("global")||0;t>s+100&&b.getInstance().logSuspiciousActivity({type:"potential_memory_leak",description:`グローバルオブジェクトの数が急激に増加: ${t}`,severity:"medium",source:"memory_leak_detector",metadata:{currentCount:t,previousCount:s,increase:t-s}}),o.set("global",t)},6e4)}function $i(){const o={crypto:!!window.crypto,subtle:!!(window.crypto&&window.crypto.subtle),csp:!!document.querySelector('meta[http-equiv="Content-Security-Policy"]'),https:window.location.protocol==="https:",referrerPolicy:!!document.querySelector('meta[name="referrer"]')},e=Object.entries(o).filter(([,t])=>!t).map(([t])=>t);e.length>0&&b.getInstance().logSuspiciousActivity({type:"missing_security_features",description:`セキュリティ機能が不十分: ${e.join(", ")}`,severity:"medium",source:"initial_security_check",metadata:{missingFeatures:e,allFeatures:o}})}function Ri(){setInterval(()=>{b.getInstance().cleanupRateLimiters()},300*1e3),setInterval(()=>{const o=b.getInstance().generateSecurityReport();o.totalActivities>0&&console.log("📊 セキュリティレポート:",o)},3600*1e3),setInterval(()=>{const o=JSON.parse(localStorage.getItem("security_incidents")||"[]"),e=Date.now()-1440*60*1e3,t=o.filter(s=>new Date(s.timestamp).getTime()>e);localStorage.setItem("security_incidents",JSON.stringify(t))},1440*60*1e3)}const j=class j{constructor(){p(this,"trustedDomains",[]);p(this,"allowedTags",["b","i","em","strong","br","p"]);p(this,"allowedAttributes",["class","data-*"])}static getInstance(){return j.instance||(j.instance=new j),j.instance}setTrustedDomains(e){this.trustedDomains=e.map(t=>t.toLowerCase())}setAllowedTags(e){this.allowedTags=e.map(t=>t.toLowerCase())}sanitizeHTML(e){if(typeof e!="string")return"";let t=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;");for(const s of this.allowedTags){const i=new RegExp(`&lt;(${s})&gt;`,"gi"),n=new RegExp(`&lt;\\/(${s})&gt;`,"gi");t=t.replace(i,"<$1>").replace(n,"</$1>")}return t.slice(0,1e4)}escapeJavaScript(e){return typeof e!="string"?"":e.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\t/g,"\\t").replace(/\x08/g,"\\b").replace(/\f/g,"\\f").replace(/\v/g,"\\v").replace(/\0/g,"\\0").replace(/[\x00-\x1f\x7f-\x9f]/g,t=>`\\u${`0000${t.charCodeAt(0).toString(16)}`.slice(-4)}`)}sanitizeURL(e){if(typeof e!="string")return"";try{const t=new URL(e);return["http:","https:","mailto:","tel:"].includes(t.protocol)?this.trustedDomains.length>0&&!this.trustedDomains.some(n=>t.hostname.endsWith(n))&&t.protocol!=="mailto:"&&t.protocol!=="tel:"?(b.getInstance().logSuspiciousActivity({type:"untrusted_domain",description:`信頼されていないドメイン: ${t.hostname}`,severity:"medium",source:"xss_protection",metadata:{originalUrl:e,hostname:t.hostname}}),""):t.toString():(b.getInstance().logSuspiciousActivity({type:"blocked_dangerous_protocol",description:`危険なプロトコルをブロック: ${t.protocol}`,severity:"high",source:"xss_protection",metadata:{originalUrl:e,protocol:t.protocol}}),"")}catch(t){return b.getInstance().logSuspiciousActivity({type:"invalid_url",description:`無効なURL: ${e}`,severity:"medium",source:"xss_protection",metadata:{originalUrl:e,error:t instanceof Error?t.message:String(t)}}),""}}validateDOMOperation(e,t,s){if(!e||!t)return!1;if(t==="innerHTML"&&s){const i=this.sanitizeHTML(s);if(i!==s)return b.getInstance().logSuspiciousActivity({type:"blocked_unsafe_dom",description:"unsafe innerHTML操作をブロック",severity:"high",source:"xss_protection",metadata:{operation:t,originalValue:s.slice(0,200),sanitizedValue:i.slice(0,200)}}),!1}if(t==="setAttribute"&&s){const[i]=s.split("=",1);if(["onload","onerror","onclick","onmouseover","style"].includes(i.toLowerCase()))return b.getInstance().logSuspiciousActivity({type:"blocked_dangerous_attribute",description:`危険な属性設定をブロック: ${i}`,severity:"high",source:"xss_protection",metadata:{operation:t,attributeName:i}}),!1}return!0}};p(j,"instance");let be=j;const q=class q{constructor(){p(this,"tokenStore",new Map);p(this,"validOrigins",[])}static getInstance(){return q.instance||(q.instance=new q),q.instance}setValidOrigins(e){this.validOrigins=e.map(t=>t.toLowerCase())}generateTokenForAction(e,t=30){const s=generateCSRFToken(),i=Date.now()+t*60*1e3;return this.tokenStore.set(e,{token:s,expires:i}),this.cleanupExpiredTokens(),s}validateTokenForAction(e,t){const s=this.tokenStore.get(e);if(!s)return b.getInstance().logSuspiciousActivity({type:"csrf_token_missing",description:`CSRF token not found for action: ${e}`,severity:"high",source:"csrf_protection",metadata:{action:e}}),!1;if(Date.now()>s.expires)return this.tokenStore.delete(e),b.getInstance().logSuspiciousActivity({type:"csrf_token_expired",description:`CSRF token expired for action: ${e}`,severity:"medium",source:"csrf_protection",metadata:{action:e}}),!1;const i=validateCSRFToken(t,s.token);return i||b.getInstance().logSuspiciousActivity({type:"csrf_token_invalid",description:`Invalid CSRF token for action: ${e}`,severity:"high",source:"csrf_protection",metadata:{action:e}}),i&&this.tokenStore.delete(e),i}validateOrigin(e){if(!e)return!1;const t=e.toLowerCase();if(this.validOrigins.length===0)return t===window.location.origin.toLowerCase();const s=this.validOrigins.includes(t);return s||b.getInstance().logSuspiciousActivity({type:"csrf_invalid_origin",description:`Invalid origin: ${e}`,severity:"high",source:"csrf_protection",metadata:{providedOrigin:e,validOrigins:this.validOrigins}}),s}validateReferer(e){if(!e)return!1;try{const t=new URL(e),s=window.location.origin.toLowerCase();return t.origin.toLowerCase()===s}catch(t){return b.getInstance().logSuspiciousActivity({type:"csrf_invalid_referer",description:`Invalid referer: ${e}`,severity:"medium",source:"csrf_protection",metadata:{referer:e}}),!1}}cleanupExpiredTokens(){const e=Date.now();for(const[t,s]of this.tokenStore.entries())e>s.expires&&this.tokenStore.delete(t)}clearAllTokens(){this.tokenStore.clear()}};p(q,"instance");let Se=q;var H;let Pi=(H=class{constructor(){p(this,"nonces",new Set);p(this,"cspDirectives",new Map)}static getInstance(){return H.instance||(H.instance=new H),H.instance}generateScriptNonce(){const e=generateCSRFToken();return this.nonces.add(e),setTimeout(()=>{this.nonces.delete(e)},3600*1e3),e}validateNonce(e){return this.nonces.has(e)}setDirective(e,t){this.cspDirectives.set(e,[...t])}addToDirective(e,t){const s=this.cspDirectives.get(e)||[];s.includes(t)||(s.push(t),this.cspDirectives.set(e,s))}generateCSPHeader(){const e=[];for(const[t,s]of this.cspDirectives.entries())e.push(`${t} ${s.join(" ")}`);return e.join("; ")}applyCSPToDocument(){const e=document.querySelector('meta[http-equiv="Content-Security-Policy"]');e&&e.remove();const t=document.createElement("meta");t.httpEquiv="Content-Security-Policy",t.content=this.generateCSPHeader(),document.head.appendChild(t),console.log("🛡️ CSP updated:",t.content)}executeScriptSafely(e,t){const s=t||this.generateScriptNonce();if(!this.validateNonce(s))return b.getInstance().logSuspiciousActivity({type:"invalid_script_nonce",description:"Invalid nonce for script execution",severity:"high",source:"csp_manager",metadata:{nonce:s}}),!1;try{const i=document.createElement("script");return i.nonce=s,i.textContent=e,document.head.appendChild(i),document.head.removeChild(i),!0}catch(i){return b.getInstance().logSuspiciousActivity({type:"script_execution_failed",description:"Safe script execution failed",severity:"medium",source:"csp_manager",metadata:{error:i instanceof Error?i.message:String(i),nonce:s}}),!1}}},p(H,"instance"),H);const K=class K{constructor(){p(this,"xssProtection",be.getInstance());p(this,"csrfProtection",Se.getInstance());p(this,"cspManager",Pi.getInstance())}static getInstance(){return K.instance||(K.instance=new K),K.instance}validateFormSubmission(e,t){const s=new FormData(e);let i=!0;if(t){const r=e.getAttribute("data-action")||"form_submit";this.csrfProtection.validateTokenForAction(r,t)||(i=!1)}const n=document.referrer||window.location.origin;this.csrfProtection.validateOrigin(n)||(i=!1);for(const[r,d]of s.entries())if(typeof d=="string")try{const u=ee(d);u!==d&&b.getInstance().logSuspiciousActivity({type:"form_input_sanitized",description:`Form input was sanitized: ${r}`,severity:"low",source:"security_interceptor",metadata:{fieldName:r,original:d.slice(0,100),sanitized:u.slice(0,100)}})}catch(u){i=!1,b.getInstance().logSuspiciousActivity({type:"form_input_validation_failed",description:`Form input validation failed: ${r}`,severity:"high",source:"security_interceptor",metadata:{fieldName:r,error:u instanceof Error?u.message:String(u)}})}return i}validateAjaxRequest(e,t,s,i){let n=!0;if(this.xssProtection.sanitizeURL(e)||(n=!1),["POST","PUT","DELETE","PATCH"].includes(t.toUpperCase())&&(s["X-CSRF-Token"]||(b.getInstance().logSuspiciousActivity({type:"missing_csrf_token",description:`CSRF token missing for ${t} request`,severity:"high",source:"security_interceptor",metadata:{url:e,method:t}}),n=!1)),i&&typeof i=="object")try{const u=JSON.stringify(i);u.length>1e5&&(b.getInstance().logSuspiciousActivity({type:"oversized_request_payload",description:`Request payload too large: ${u.length} bytes`,severity:"medium",source:"security_interceptor",metadata:{url:e,method:t,payloadSize:u.length}}),n=!1)}catch(u){n=!1}return n}initialize(){this.xssProtection.setTrustedDomains([window.location.hostname,"cdn.jsdelivr.net","unpkg.com"]),this.csrfProtection.setValidOrigins([window.location.origin]),this.cspManager.setDirective("default-src",["'self'"]),this.cspManager.setDirective("script-src",["'self'","'unsafe-inline'"]),this.cspManager.setDirective("style-src",["'self'","'unsafe-inline'"]),this.cspManager.setDirective("img-src",["'self'","data:","blob:"]),this.cspManager.setDirective("connect-src",["'self'"]),this.cspManager.setDirective("font-src",["'self'","data:"]),this.cspManager.setDirective("object-src",["'none'"]),this.cspManager.setDirective("frame-src",["'none'"]),console.log("🛡️ Security Interceptor initialized")}};p(K,"instance");let re=K;typeof window!="undefined"&&document.addEventListener("DOMContentLoaded",()=>{re.getInstance().initialize()});const G=class G{constructor(){p(this,"currentNonce","");p(this,"nonceExpiry",0);p(this,"directives",{});p(this,"violations",[]);p(this,"reportEndpoint","")}static getInstance(){return G.instance||(G.instance=new G),G.instance}initialize(){this.setupDefaultDirectives(),this.setupViolationReporting(),this.updateCSPMetaTag(),this.scheduleNonceRotation(),console.log("🛡️ CSP Manager initialized with dynamic nonce support")}setupDefaultDirectives(){this.directives={"default-src":["'self'"],"script-src":["'self'",`'nonce-${this.generateNewNonce()}'`,"'strict-dynamic'"],"style-src":["'self'","'unsafe-inline'","'nonce-${nonce}'"],"img-src":["'self'","data:","blob:","https:"],"font-src":["'self'","data:","https:"],"connect-src":["'self'","https:"],"media-src":["'self'"],"object-src":["'none'"],"frame-src":["'none'"],"worker-src":["'self'","blob:"],"manifest-src":["'self'"],"base-uri":["'self'"],"form-action":["'self'"],"frame-ancestors":["'none'"],"report-uri":["/api/csp-violation-report"]}}generateNewNonce(){return this.currentNonce=Ae(32),this.nonceExpiry=Date.now()+900*1e3,b.getInstance().logSuspiciousActivity({type:"nonce_generated",description:"New CSP nonce generated",severity:"low",source:"csp_manager",metadata:{nonceLength:this.currentNonce.length,expiryTime:new Date(this.nonceExpiry).toISOString()}}),this.currentNonce}getCurrentNonce(){return Date.now()>this.nonceExpiry&&(this.generateNewNonce(),this.updateCSPMetaTag()),this.currentNonce}validateNonce(e){if(Date.now()>this.nonceExpiry)return b.getInstance().logSuspiciousActivity({type:"expired_nonce_used",description:"Attempt to use expired nonce",severity:"medium",source:"csp_manager",metadata:{providedNonce:`${e.slice(0,8)}...`,expired:!0,expiryTime:new Date(this.nonceExpiry).toISOString()}}),!1;const s=e===this.currentNonce;return s||b.getInstance().logSuspiciousActivity({type:"invalid_nonce_used",description:"Invalid nonce provided",severity:"high",source:"csp_manager",metadata:{providedNonce:`${e.slice(0,8)}...`,expectedNonce:`${this.currentNonce.slice(0,8)}...`}}),s}setDirective(e,t){this.directives[e]=[...t],this.updateCSPMetaTag()}addToDirective(e,t){this.directives[e]||(this.directives[e]=[]),this.directives[e].includes(t)||(this.directives[e].push(t),this.updateCSPMetaTag())}removeFromDirective(e,t){this.directives[e]&&(this.directives[e]=this.directives[e].filter(s=>s!==t),this.updateCSPMetaTag())}generateCSPHeader(){const e=[];for(const[t,s]of Object.entries(this.directives))if(s&&s.length>0){let i=s.join(" ");i=i.replace(/\$\{nonce\}/g,this.getCurrentNonce()),e.push(`${t} ${i}`)}return e.join("; ")}updateCSPMetaTag(){if(typeof document=="undefined")return;const e=document.querySelector('meta[http-equiv="Content-Security-Policy"]');e&&e.remove();const t=document.createElement("meta");t.httpEquiv="Content-Security-Policy",t.content=this.generateCSPHeader(),document.head.appendChild(t);const s=document.documentElement.outerHTML;s.includes("PLACEHOLDER_NONCE")&&(document.documentElement.outerHTML=s.replace(/PLACEHOLDER_NONCE/g,this.getCurrentNonce())),b.getInstance().logSuspiciousActivity({type:"csp_updated",description:"CSP policy updated",severity:"low",source:"csp_manager",metadata:{policy:`${t.content.slice(0,200)}...`,nonce:`${this.currentNonce.slice(0,8)}...`}})}setupViolationReporting(){typeof document!="undefined"&&document.addEventListener("securitypolicyviolation",e=>{const t={blockedURI:e.blockedURI,columnNumber:e.columnNumber,documentURI:e.documentURI,effectiveDirective:e.effectiveDirective,lineNumber:e.lineNumber,originalPolicy:e.originalPolicy,referrer:e.referrer,sample:e.sample,sourceFile:e.sourceFile,statusCode:e.statusCode,violatedDirective:e.violatedDirective,timestamp:new Date().toISOString()};this.violations.push(t),this.violations.length>100&&(this.violations=this.violations.slice(-100)),b.getInstance().logSuspiciousActivity({type:"csp_violation",description:`CSP violation: ${e.violatedDirective}`,severity:this.assessViolationSeverity(e),source:"csp_violation_handler",metadata:t}),this.reportEndpoint&&this.sendViolationReport(t)})}assessViolationSeverity(e){return e.violatedDirective.startsWith("script-src")?e.blockedURI.includes("javascript:")||e.blockedURI.includes("data:")?"critical":"high":e.sample&&(e.sample.includes("eval(")||e.sample.includes("Function(")||e.sample.includes("setTimeout(")||e.sample.includes("setInterval("))?"high":e.effectiveDirective.includes("-src")&&!e.blockedURI.startsWith(window.location.origin)?"medium":"low"}sendViolationReport(e){return f(this,null,function*(){try{yield fetch(this.reportEndpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({"csp-report":e})})}catch(t){console.warn("CSP violation report failed:",t)}})}scheduleNonceRotation(){setInterval(()=>{this.generateNewNonce(),this.updateCSPMetaTag()},600*1e3)}executeScriptWithNonce(e){if(typeof document=="undefined")return!1;try{const t=document.createElement("script");return t.nonce=this.getCurrentNonce(),t.textContent=e,document.head.appendChild(t),document.head.removeChild(t),!0}catch(t){return b.getInstance().logSuspiciousActivity({type:"safe_script_execution_failed",description:"Failed to execute script with nonce",severity:"medium",source:"csp_manager",metadata:{error:t instanceof Error?t.message:String(t),codeLength:e.length}}),!1}}addStyleWithNonce(e){if(typeof document=="undefined")return!1;try{const t=document.createElement("style");return t.nonce=this.getCurrentNonce(),t.textContent=e,document.head.appendChild(t),!0}catch(t){return b.getInstance().logSuspiciousActivity({type:"safe_style_addition_failed",description:"Failed to add style with nonce",severity:"medium",source:"csp_manager",metadata:{error:t instanceof Error?t.message:String(t),cssLength:e.length}}),!1}}getViolationHistory(e=50){return this.violations.slice(-e)}getViolationStats(){const e={total:this.violations.length,byDirective:{},bySource:{}};return this.violations.forEach(t=>{const s=t.effectiveDirective||"unknown",i=t.sourceFile||"inline";e.byDirective[s]=(e.byDirective[s]||0)+1,e.bySource[i]=(e.bySource[i]||0)+1}),e}setReportEndpoint(e){this.reportEndpoint=e,this.addToDirective("report-uri",e)}debugCSP(){console.group("🛡️ CSP Debug Information"),console.log("Current Nonce:",this.currentNonce),console.log("Nonce Expiry:",new Date(this.nonceExpiry)),console.log("Current Policy:",this.generateCSPHeader()),console.log("Violation Count:",this.violations.length),console.log("Recent Violations:",this.violations.slice(-5)),console.groupEnd()}};p(G,"instance");let oe=G;const W=class W{static getInstance(){return W.instance||(W.instance=new W),W.instance}initializeSecurityHeaders(){this.setContentTypeOptions(),this.setFrameOptions(),this.setXSSProtection(),this.setReferrerPolicy(),this.setPermissionsPolicy(),this.setStrictTransportSecurity(),this.setCrossOriginPolicies(),console.log("🛡️ Security headers initialized")}setContentTypeOptions(){this.updateMetaTag("X-Content-Type-Options","nosniff")}setFrameOptions(){this.updateMetaTag("X-Frame-Options","DENY")}setXSSProtection(){this.updateMetaTag("X-XSS-Protection","1; mode=block")}setReferrerPolicy(){if(!document.querySelector('meta[name="referrer"]')){const t=document.createElement("meta");t.name="referrer",t.content="strict-origin-when-cross-origin",document.head.appendChild(t)}}setPermissionsPolicy(){const e=["geolocation=()","microphone=()","camera=()","fullscreen=(self)","payment=()","usb=()","serial=()","hid=()","midi=()","clipboard-read=()","clipboard-write=(self)","accelerometer=()","gyroscope=()","magnetometer=()","ambient-light-sensor=()","encrypted-media=()","picture-in-picture=()","display-capture=()"].join(", ");this.updateMetaTag("Permissions-Policy",e)}setStrictTransportSecurity(){window.location.protocol==="https:"&&this.updateMetaTag("Strict-Transport-Security","max-age=31536000; includeSubDomains; preload")}setCrossOriginPolicies(){this.updateMetaTag("Cross-Origin-Embedder-Policy","require-corp"),this.updateMetaTag("Cross-Origin-Opener-Policy","same-origin"),this.updateMetaTag("Cross-Origin-Resource-Policy","same-origin")}updateMetaTag(e,t){if(typeof document=="undefined")return;let s=document.querySelector(`meta[http-equiv="${e}"]`);s||(s=document.createElement("meta"),s.httpEquiv=e,document.head.appendChild(s)),s.content=t}validateSecurityHeaders(){const e=["Content-Security-Policy","X-Content-Type-Options","X-Frame-Options","X-XSS-Protection","Strict-Transport-Security","Cross-Origin-Embedder-Policy","Cross-Origin-Opener-Policy"],t=[],s=[],i=[];return e.forEach(r=>{document.querySelector(`meta[http-equiv="${r}"]`)?t.push(r):s.push(r)}),window.location.protocol!=="https:"&&i.push("HTTPSの使用を強く推奨します"),document.querySelector('meta[name="referrer"]')||i.push("Referrer Policyの設定を推奨します"),{valid:t,missing:s,recommendations:i}}};p(W,"instance");let ae=W;typeof window!="undefined"&&document.addEventListener("DOMContentLoaded",()=>{const o=oe.getInstance(),e=ae.getInstance();o.initialize(),e.initializeSecurityHeaders()});const Q=class Q{constructor(){p(this,"storage",ze());p(this,"eventQueue",[]);p(this,"isProcessingQueue",!1);p(this,"maxEventsInMemory",1e3);p(this,"maxEventsInStorage",5e3);p(this,"sessionId");p(this,"config",{enableStackTrace:!0,enableGeoLocation:!1,enablePerformanceMetrics:!0,autoFlushInterval:1e4,compressionThreshold:100});this.sessionId=this.generateSessionId(),this.startAutoFlush(),this.setupUnloadHandler()}static getInstance(){return Q.instance||(Q.instance=new Q),Q.instance}generateSessionId(){const e=Date.now().toString(36),t=Math.random().toString(36).substr(2,9);return`session_${e}_${t}`}logSecurityEvent(r,d,u,m){return f(this,arguments,function*(e,t,s,i,n={}){try{const h={id:yield this.generateEventId(),timestamp:new Date,eventType:e,severity:t,source:s,message:i,metadata:C(R(C({},n),{url:window.location.href,referrer:document.referrer,viewport:{width:window.innerWidth,height:window.innerHeight}}),this.config.enablePerformanceMetrics&&this.getPerformanceMetrics()),userAgent:navigator.userAgent,sessionId:this.sessionId,stackTrace:this.config.enableStackTrace?this.captureStackTrace():void 0,hash:""};h.hash=yield this.calculateEventHash(h),this.eventQueue.push(h),this.eventQueue.length>this.maxEventsInMemory&&(this.eventQueue=this.eventQueue.slice(-this.maxEventsInMemory)),(t==="critical"||t==="high")&&(yield this.flushQueue()),b.getInstance().logSuspiciousActivity({type:e,description:i,severity:t,source:s,metadata:n})}catch(h){console.error("セキュリティイベントのログ記録に失敗:",h),console.warn(`🚨 Security Event: ${e} [${t.toUpperCase()}] ${i}`)}})}generateEventId(){return f(this,null,function*(){const e=Date.now().toString(),t=Math.random().toString();return(yield ne(e+t)).slice(0,16)})}calculateEventHash(e){return f(this,null,function*(){const t=JSON.stringify({id:e.id,timestamp:e.timestamp.toISOString(),eventType:e.eventType,severity:e.severity,source:e.source,message:e.message,sessionId:e.sessionId});return yield ne(t)})}captureStackTrace(){try{throw new Error}catch(e){return e instanceof Error&&e.stack?e.stack.split(`
`).slice(3,8).join(`
`):""}}getPerformanceMetrics(){if(!performance)return{};const e=performance.getEntriesByType("navigation")[0],t=performance.memory;return{loadTime:e?e.loadEventEnd-e.loadEventStart:0,domContentLoaded:e?e.domContentLoadedEventEnd-e.domContentLoadedEventStart:0,memoryUsage:t?{used:Math.round(t.usedJSHeapSize/1024/1024),total:Math.round(t.totalJSHeapSize/1024/1024),limit:Math.round(t.jsHeapSizeLimit/1024/1024)}:null,timing:performance.now()}}flushQueue(){return f(this,null,function*(){if(!(this.isProcessingQueue||this.eventQueue.length===0)){this.isProcessingQueue=!0;try{const s=[...(yield this.storage.getItem("security_audit_log",!0))||[],...this.eventQueue].slice(-this.maxEventsInStorage),i=s.length>=this.config.compressionThreshold;yield this.storage.setItem("security_audit_log",s,i),yield this.updateAuditMetadata(s),this.eventQueue=[],console.log(`📝 ${s.length}件のセキュリティイベントがログに記録されました`)}catch(e){console.error("セキュリティログのフラッシュに失敗:",e),this.eventQueue.length>this.maxEventsInMemory&&(this.eventQueue=this.eventQueue.slice(-Math.floor(this.maxEventsInMemory/2)))}finally{this.isProcessingQueue=!1}}})}updateAuditMetadata(e){return f(this,null,function*(){const t={lastUpdated:new Date().toISOString(),totalEvents:e.length,oldestEvent:e.length>0?e[0].timestamp.toISOString():null,newestEvent:e.length>0?e[e.length-1].timestamp.toISOString():null,sessionId:this.sessionId,eventTypes:[...new Set(e.map(s=>s.eventType))],sources:[...new Set(e.map(s=>s.source))],severityCounts:{critical:e.filter(s=>s.severity==="critical").length,high:e.filter(s=>s.severity==="high").length,medium:e.filter(s=>s.severity==="medium").length,low:e.filter(s=>s.severity==="low").length}};yield this.storage.setItem("security_audit_metadata",t,!0)})}searchEvents(){return f(this,arguments,function*(e={}){try{let s=(yield this.storage.getItem("security_audit_log",!0))||[];if(e.startDate&&(s=s.filter(i=>new Date(i.timestamp)>=e.startDate)),e.endDate&&(s=s.filter(i=>new Date(i.timestamp)<=e.endDate)),e.eventTypes&&e.eventTypes.length>0&&(s=s.filter(i=>e.eventTypes.includes(i.eventType))),e.severities&&e.severities.length>0&&(s=s.filter(i=>e.severities.includes(i.severity))),e.sources&&e.sources.length>0&&(s=s.filter(i=>e.sources.includes(i.source))),e.searchTerm){const i=e.searchTerm.toLowerCase();s=s.filter(n=>n.message.toLowerCase().includes(i)||n.eventType.toLowerCase().includes(i)||n.source.toLowerCase().includes(i))}return s.sort((i,n)=>new Date(n.timestamp).getTime()-new Date(i.timestamp).getTime())}catch(t){return console.error("セキュリティイベント検索に失敗:",t),[]}})}generateAuditReport(e,t){return f(this,null,function*(){const s=new Date,i=e||new Date(s.getTime()-10080*60*1e3),n=t||s,r=yield this.searchEvents({startDate:i,endDate:n}),d={critical:r.filter(g=>g.severity==="critical").length,high:r.filter(g=>g.severity==="high").length,medium:r.filter(g=>g.severity==="medium").length,low:r.filter(g=>g.severity==="low").length},u=new Map,m=new Map;r.forEach(g=>{u.set(g.eventType,(u.get(g.eventType)||0)+1),m.set(g.source,(m.get(g.source)||0)+1)});const h=Array.from(u.entries()).map(([g,a])=>({type:g,count:a})).sort((g,a)=>a.count-g.count).slice(0,10),E=Array.from(m.entries()).map(([g,a])=>({source:g,count:a})).sort((g,a)=>a.count-g.count).slice(0,10),S=this.calculateSeverityTrend(r,i,n),y=this.generateRecommendations(r,d);return{generatedAt:s,period:{start:i,end:n},summary:{totalEvents:r.length,criticalEvents:d.critical,highSeverityEvents:d.high,mediumSeverityEvents:d.medium,lowSeverityEvents:d.low,uniqueEventTypes:u.size,uniqueSources:m.size},topEventTypes:h,topSources:E,severityTrend:S,recommendations:y,events:r.slice(0,100)}})}calculateSeverityTrend(e,t,s){const i=[];for(let r=new Date(t);r<=s;r.setTime(r.getTime()+864e5)){const d=r.toISOString().split("T")[0],u=e.filter(m=>m.timestamp.toISOString().split("T")[0]===d);i.push({date:d,critical:u.filter(m=>m.severity==="critical").length,high:u.filter(m=>m.severity==="high").length,medium:u.filter(m=>m.severity==="medium").length,low:u.filter(m=>m.severity==="low").length})}return i}generateRecommendations(e,t){const s=[];t.critical>0&&s.push("🚨 クリティカルなセキュリティイベントが検出されました。即座に対応が必要です。");const i=new Map;e.forEach(m=>{i.set(m.eventType,(i.get(m.eventType)||0)+1)});const n=Array.from(i.entries()).filter(([,m])=>m>10).sort((m,h)=>h[1]-m[1]);return n.length>0&&s.push(`⚠️ 頻発するイベント: ${n[0][0]} (${n[0][1]}回)。パターンを分析し、根本原因を調査してください。`),e.filter(m=>m.eventType.includes("rate_limit")).length>20&&s.push("🛡️ 大量のレート制限違反が検出されました。ブルートフォース攻撃の可能性があります。"),e.filter(m=>m.eventType.includes("xss")||m.eventType.includes("script_injection")).length>0&&s.push("🚫 XSS攻撃の試行が検出されました。入力検証とCSPの強化を検討してください。"),e.filter(m=>m.eventType==="devtools_opened").length>50&&s.push("🔧 開発者ツールの頻繁な使用が検出されました。本番環境での監視を強化することを推奨します。"),s.length===0&&s.push("✅ 現在のセキュリティ状態は良好です。継続的な監視を続けてください。"),s}startAutoFlush(){setInterval(()=>{this.eventQueue.length>0&&this.flushQueue()},this.config.autoFlushInterval)}setupUnloadHandler(){window.addEventListener("beforeunload",()=>{if(this.eventQueue.length>0)try{if(navigator.sendBeacon){const e=JSON.stringify(this.eventQueue);navigator.sendBeacon("/api/security-events",e)}else this.flushQueue()}catch(e){console.warn("ページアンロード時のログフラッシュに失敗:",e)}})}exportAuditLog(e="json"){return f(this,null,function*(){const t=(yield this.storage.getItem("security_audit_log",!0))||[];if(e==="json")return JSON.stringify(t,null,2);{const i=[["ID","Timestamp","Event Type","Severity","Source","Message","User Agent","Session ID"].join(",")];return t.forEach(n=>{const r=[n.id,n.timestamp.toISOString(),n.eventType,n.severity,n.source,`"${n.message.replace(/"/g,'""')}"`,`"${n.userAgent.replace(/"/g,'""')}"`,n.sessionId||""];i.push(r.join(","))}),i.join(`
`)}})}clearAuditLog(){return f(this,null,function*(){try{yield this.storage.removeItem("security_audit_log"),yield this.storage.removeItem("security_audit_metadata"),this.eventQueue=[],yield this.logSecurityEvent("audit_log_cleared","medium","security_audit_logger","セキュリティ監査ログがクリアされました",{clearedAt:new Date().toISOString(),sessionId:this.sessionId}),console.log("🗑️ セキュリティ監査ログがクリアされました")}catch(e){throw console.error("監査ログのクリアに失敗:",e),e}})}updateConfig(e){this.config=C(C({},this.config),e),console.log("⚙️ セキュリティ監査ログの設定が更新されました:",e)}getConfig(){return C({},this.config)}getStatistics(){return f(this,null,function*(){const e=yield this.storage.getItem("security_audit_metadata",!0);return{queueSize:this.eventQueue.length,totalEventsLogged:(e==null?void 0:e.totalEvents)||0,oldestEvent:(e==null?void 0:e.oldestEvent)||null,newestEvent:(e==null?void 0:e.newestEvent)||null,sessionId:this.sessionId}})}};p(Q,"instance");let Y=Q;if(typeof window!="undefined"){const o=Y.getInstance();window.addEventListener("error",t=>{var s;o.logSecurityEvent("javascript_error","medium","global_error_handler",`JavaScriptエラー: ${t.message}`,{filename:t.filename,lineno:t.lineno,colno:t.colno,error:(s=t.error)==null?void 0:s.toString()})}),window.addEventListener("unhandledrejection",t=>{var s,i;o.logSecurityEvent("unhandled_promise_rejection","medium","global_promise_handler",`未処理のPromise rejection: ${t.reason}`,{reason:(s=t.reason)==null?void 0:s.toString(),stack:(i=t.reason)==null?void 0:i.stack})});const e=console.error;console.error=function(...t){return o.logSecurityEvent("console_error","low","console_override",`Console Error: ${t.join(" ")}`,{args:t}),e.apply(console,t)}}function Ue(){return f(this,null,function*(){try{console.log("🛡️ セキュリティシステムを初期化中..."),Ti();const o=oe.getInstance(),e=ae.getInstance();o.initialize(),e.initializeSecurityHeaders(),re.getInstance().initialize(),yield Y.getInstance().logSecurityEvent("security_system_initialized","low","security_init","セキュリティシステムが正常に初期化されました",{timestamp:new Date().toISOString(),userAgent:navigator.userAgent,url:window.location.href,features:{csp:!0,xssProtection:!0,csrfProtection:!0,auditLogging:!0,secureStorage:!0}}),yield Ve(),Mi(),Fi(),console.log("✅ セキュリティシステムの初期化が完了しました")}catch(o){throw console.error("❌ セキュリティシステム初期化に失敗:",o),Oi(),new Error(`セキュリティシステム初期化失敗: ${o instanceof Error?o.message:String(o)}`)}})}function Ve(){return f(this,null,function*(){var i;const o=Y.getInstance(),e=[];window.location.protocol!=="https:"&&window.location.hostname!=="localhost"&&e.push("HTTPS が使用されていません"),(i=window.crypto)!=null&&i.subtle||e.push("Web Crypto API が利用できません");try{const n=ze();yield n.setItem("__security_test__",{test:!0},!0);const r=yield n.getItem("__security_test__",!0);(!r||r.test!==!0)&&e.push("セキュアストレージが正常に動作していません"),n.removeItem("__security_test__")}catch(n){e.push("セキュアストレージのテストに失敗しました")}document.querySelector('meta[http-equiv="Content-Security-Policy"]')||e.push("Content-Security-Policy が設定されていません"),["X-Content-Type-Options","X-Frame-Options","X-XSS-Protection"].forEach(n=>{document.querySelector(`meta[http-equiv="${n}"]`)||e.push(`${n} ヘッダーが設定されていません`)}),e.length>0?yield o.logSecurityEvent("security_configuration_issues","medium","security_validator",`セキュリティ設定に問題があります: ${e.join(", ")}`,{issues:e}):yield o.logSecurityEvent("security_configuration_valid","low","security_validator","セキュリティ設定は正常です")})}function Mi(){const o=Y.getInstance();let e=!0;document.addEventListener("visibilitychange",()=>f(null,null,function*(){document.hidden&&e?(e=!1,yield o.logSecurityEvent("tab_hidden","low","visibility_monitor","タブが非アクティブになりました")):!document.hidden&&!e&&(e=!0,yield o.logSecurityEvent("tab_visible","low","visibility_monitor","タブがアクティブになりました"))})),document.addEventListener("contextmenu",s=>f(null,null,function*(){s.preventDefault(),yield o.logSecurityEvent("context_menu_blocked","low","context_menu_blocker","右クリックメニューがブロックされました",{target:s.target instanceof Element?s.target.tagName:"unknown",coordinates:{x:s.clientX,y:s.clientY}})})),document.addEventListener("keydown",s=>f(null,null,function*(){[{key:"F12"},{key:"I",ctrlKey:!0,shiftKey:!0},{key:"J",ctrlKey:!0,shiftKey:!0},{key:"U",ctrlKey:!0},{key:"S",ctrlKey:!0,shiftKey:!0}].some(r=>s.key===r.key&&(!r.ctrlKey||s.ctrlKey)&&(!r.shiftKey||s.shiftKey))&&(s.preventDefault(),yield o.logSecurityEvent("dangerous_shortcut_blocked","medium","keyboard_monitor",`危険なキーボードショートカットがブロックされました: ${s.key}`,{key:s.key,ctrlKey:s.ctrlKey,shiftKey:s.shiftKey,altKey:s.altKey}))}));const t=window.fetch;window.fetch=function(s,i){return f(this,null,function*(){const n=typeof s=="string"?s:s.toString();return n.startsWith("http")&&!n.startsWith(window.location.origin)&&(yield o.logSecurityEvent("external_fetch_request","medium","fetch_monitor",`外部ドメインへのFetchリクエスト: ${n}`,{url:n,method:(i==null?void 0:i.method)||"GET",headers:i==null?void 0:i.headers})),(n.includes("eval")||n.includes("javascript:")||n.includes("data:"))&&(yield o.logSecurityEvent("suspicious_fetch_url","high","fetch_monitor",`不審なFetch URL: ${n}`,{url:n})),t.call(this,s,i)})},window.addEventListener("storage",s=>f(null,null,function*(){var i,n;yield o.logSecurityEvent("storage_changed","low","storage_monitor","LocalStorage/SessionStorageが変更されました",{key:s.key,oldValue:(i=s.oldValue)==null?void 0:i.substring(0,100),newValue:(n=s.newValue)==null?void 0:n.substring(0,100),storageArea:s.storageArea===localStorage?"localStorage":"sessionStorage"})})),window.addEventListener("beforeunload",()=>f(null,null,function*(){yield o.logSecurityEvent("page_unload","low","unload_monitor","ページが閉じられようとしています")}))}function Fi(){const o=Y.getInstance();setInterval(()=>f(null,null,function*(){try{if("memory"in performance){const s=performance.memory,i=Math.round(s.usedJSHeapSize/1024/1024),n=Math.round(s.jsHeapSizeLimit/1024/1024),r=i/n*100;r>90&&(yield o.logSecurityEvent("high_memory_usage","medium","periodic_check",`メモリ使用率が高いです: ${r.toFixed(1)}%`,{usedMB:i,limitMB:n,usage:r}))}const e=document.querySelectorAll("script[src]"),t=Array.from(e).filter(s=>{const i=s.getAttribute("src");return i&&!i.startsWith(window.location.origin)&&!i.startsWith("/")});t.length>5&&(yield o.logSecurityEvent("excessive_external_scripts","medium","periodic_check",`過度の外部スクリプトが検出されました: ${t.length}個`,{count:t.length,sources:t.map(s=>s.getAttribute("src")).slice(0,10)}))}catch(e){console.warn("定期セキュリティチェック中にエラー:",e)}}),3e4),setInterval(()=>f(null,null,function*(){try{let e=0;for(const s in localStorage)localStorage.hasOwnProperty(s)&&(e+=localStorage[s].length+s.length);const t=e/(1024*1024);t>5&&(yield o.logSecurityEvent("large_localstorage_usage","low","periodic_check",`LocalStorageの使用量が大きいです: ${t.toFixed(2)}MB`)),yield Ve()}catch(e){console.warn("詳細セキュリティチェック中にエラー:",e)}}),300*1e3),setInterval(()=>f(null,null,function*(){try{const e=yield o.generateAuditReport(new Date(Date.now()-36e5),new Date);e.summary.totalEvents>0&&console.log("📊 セキュリティ時間レポート:",{期間:"過去1時間",総イベント数:e.summary.totalEvents,クリティカル:e.summary.criticalEvents,高:e.summary.highSeverityEvents,中:e.summary.mediumSeverityEvents,低:e.summary.lowSeverityEvents,推奨事項:e.recommendations})}catch(e){console.warn("セキュリティレポート生成中にエラー:",e)}}),3600*1e3)}function Oi(){console.warn("⚠️ フォールバックセキュリティを設定中...");const o=Element.prototype.innerHTML;Object.defineProperty(Element.prototype,"innerHTML",{set(t){if(typeof t=="string"){const s=t.replace(/<script[^>]*>.*?<\/script>/gi,"").replace(/javascript:/gi,"").replace(/on\w+\s*=/gi,"");o.call(this,s)}else o.call(this,t)},get(){return o.call(this)}}),document.querySelectorAll("form").forEach(t=>{if(!t.querySelector('input[name="csrf_token"]')){const s=document.createElement("input");s.type="hidden",s.name="csrf_token",s.value=Math.random().toString(36).substr(2,15),t.appendChild(s)}}),console.log("✅ フォールバックセキュリティが設定されました")}typeof window!="undefined"&&document.addEventListener("DOMContentLoaded",()=>{Ue().catch(o=>{console.error("セキュリティシステム自動初期化失敗:",o)})});class Hi{constructor(){p(this,"logs",[]);p(this,"warnings",[]);p(this,"maxLogs",1e3);p(this,"logRotationSize",100);p(this,"storageKey","game_error_logs");p(this,"warningStorageKey","game_warning_logs");p(this,"analyticsBuffer",[]);p(this,"realtimeListeners",[]);p(this,"sessionId");p(this,"userId");p(this,"buildVersion");p(this,"isAnalyzing",!1);this.sessionId=this.generateSessionId(),this.buildVersion="unknown",this.loadFromStorage(),this.startRealtimeAnalysis()}log(e,t,s="auto"){const i={id:this.generateId(),timestamp:Date.now(),errorInfo:e,context:t,sessionId:this.sessionId,userId:this.userId,buildVersion:this.buildVersion,source:s,correlationId:this.generateCorrelationId(e),resolved:!1,impact:this.calculateBusinessImpact(e)};this.logs.push(i),this.analyticsBuffer.push(i),this.notifyRealtimeListeners(i),this.logs.length>this.maxLogs&&(this.logs=this.logs.slice(-this.maxLogs+this.logRotationSize)),this.saveToStorage(),this.checkAlertConditions(i)}logWarning(e){const t=C({id:this.generateId()},e);this.warnings.push(t),this.warnings.length>this.maxLogs/2&&(this.warnings=this.warnings.slice(-this.maxLogs/2+this.logRotationSize)),this.saveToStorage()}getLogs(e){let t=[...this.logs];return e&&(e.severity&&(t=t.filter(s=>s.errorInfo.severity===e.severity)),e.category&&(t=t.filter(s=>s.errorInfo.category===e.category)),e.startTime&&(t=t.filter(s=>s.timestamp>=e.startTime)),e.endTime&&(t=t.filter(s=>s.timestamp<=e.endTime)),e.limit&&(t=t.slice(-e.limit))),t}getWarnings(e){return e?this.warnings.slice(-e):[...this.warnings]}getStatistics(e){const t=e?this.getLogs({startTime:e.start,endTime:e.end}):this.logs,s={total:t.length,bySeverity:{low:0,medium:0,high:0,critical:0},byCategory:{vue:0,javascript:0,network:0,async:0,user:0,system:0},errorRate:0,mostCommonErrors:[]},i=new Map;if(t.forEach(n=>{s.bySeverity[n.errorInfo.severity]++,s.byCategory[n.errorInfo.category]++;const r=n.errorInfo.message;i.set(r,(i.get(r)||0)+1)}),t.length>0){const n=t[t.length-1].timestamp-t[0].timestamp;s.errorRate=n>0?t.length/n*6e4:0}return s.mostCommonErrors=Array.from(i.entries()).sort((n,r)=>r[1]-n[1]).slice(0,5).map(([n,r])=>({message:n,count:r})),s}searchErrors(e){const t=typeof e=="string"?new RegExp(e,"i"):e;return this.logs.filter(s=>t.test(s.errorInfo.message)||s.errorInfo.stack&&t.test(s.errorInfo.stack))}export(e="json"){if(e==="json")return JSON.stringify({logs:this.logs,warnings:this.warnings,exported:new Date().toISOString()},null,2);const t=["ID","Timestamp","Severity","Category","Message","Component","URL","Stack"],s=this.logs.map(i=>[i.id,new Date(i.timestamp).toISOString(),i.errorInfo.severity,i.errorInfo.category,`"${i.errorInfo.message.replace(/"/g,'""')}"`,i.errorInfo.component||"",i.errorInfo.url||"",i.errorInfo.stack?`"${i.errorInfo.stack.replace(/"/g,'""')}"`:""]);return[t.join(","),...s.map(i=>i.join(","))].join(`
`)}clear(){this.logs=[],this.warnings=[],this.saveToStorage()}pruneOldLogs(e){const t=Date.now()-e;this.logs=this.logs.filter(s=>s.timestamp>t),this.warnings=this.warnings.filter(s=>s.timestamp>t),this.saveToStorage()}loadFromStorage(){try{const e=localStorage.getItem(this.storageKey),t=localStorage.getItem(this.warningStorageKey);e&&(this.logs=JSON.parse(e)),t&&(this.warnings=JSON.parse(t))}catch(e){console.error("Failed to load error logs from storage:",e)}}saveToStorage(){try{const e=this.logs.slice(-100),t=this.warnings.slice(-50);localStorage.setItem(this.storageKey,JSON.stringify(e)),localStorage.setItem(this.warningStorageKey,JSON.stringify(t))}catch(e){if(e instanceof DOMException&&e.name==="QuotaExceededError"){this.logs=this.logs.slice(-50),this.warnings=this.warnings.slice(-25);try{this.saveToStorage()}catch(t){console.error("Failed to save error logs to storage")}}}}generateSessionId(){return`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}generateCorrelationId(e){const t=`${e.category}_${e.component||"unknown"}_${e.message.split(" ")[0]}`;let s=0;for(let i=0;i<t.length;i++){const n=t.charCodeAt(i);s=(s<<5)-s+n,s=s&s}return`corr_${Math.abs(s).toString(16)}`}calculateBusinessImpact(e){if(e.category==="game"&&e.severity==="critical")return"critical";if(e.category==="security")return"high";if(e.category==="network")return"medium";switch(e.severity){case"critical":return"critical";case"high":return"high";case"medium":return"medium";case"low":return"low"}}notifyRealtimeListeners(e){this.realtimeListeners.forEach(t=>{try{t(e)}catch(s){console.warn("[ErrorLogger] Realtime listener failed:",s)}})}logToConsole(e){const t={low:"🟢",medium:"🟡",high:"🟠",critical:"🔴"}[e.impact||"low"];console.group(`🚨 Error Log [${e.id}] ${t}`),console.error("Error Info:",e.errorInfo),console.log("Impact:",e.impact),console.log("Source:",e.source),e.correlationId&&console.log("Correlation ID:",e.correlationId),e.context&&console.log("Context:",e.context),console.groupEnd()}checkAlertConditions(e){const t=Date.now()-3e5,s=this.logs.filter(i=>i.timestamp>t&&i.errorInfo.severity==="critical").length;if(s>=3&&this.triggerAlert("critical-error-spike",{count:s,timespan:"5 minutes",latestError:e}),e.correlationId){const i=this.logs.filter(n=>n.correlationId===e.correlationId&&n.timestamp>Date.now()-12e4).length;i>=5&&this.triggerAlert("repeated-error",{correlationId:e.correlationId,count:i,errorType:e.errorInfo.message})}}triggerAlert(e,t){const s=new CustomEvent("app:error-alert",{detail:{type:e,data:t,timestamp:Date.now()}});window.dispatchEvent(s)}startRealtimeAnalysis(){setInterval(()=>{!this.isAnalyzing&&this.analyticsBuffer.length>0&&this.performRealtimeAnalysis()},3e4)}performRealtimeAnalysis(){return f(this,null,function*(){if(this.analyticsBuffer.length!==0){this.isAnalyzing=!0;try{const e=[...this.analyticsBuffer];this.analyticsBuffer=[];const t=this.analyzeErrorPatterns(e),s=this.analyzeTrends(e),i=this.detectAnomalies(e),n=new CustomEvent("app:error-analysis",{detail:{patterns:t,trends:s,anomalies:i,timestamp:Date.now(),sampleSize:e.length}});window.dispatchEvent(n)}catch(e){console.error("[ErrorLogger] Realtime analysis failed:",e)}finally{this.isAnalyzing=!1}}})}analyzeErrorPatterns(e){const t={byCategory:new Map,byComponent:new Map,byCorrelation:new Map,topErrors:[]},s=new Map;return e.forEach(i=>{const n=i.errorInfo.category;t.byCategory.set(n,(t.byCategory.get(n)||0)+1);const r=i.errorInfo.component||"unknown";t.byComponent.set(r,(t.byComponent.get(r)||0)+1),i.correlationId&&t.byCorrelation.set(i.correlationId,(t.byCorrelation.get(i.correlationId)||0)+1);const d=i.errorInfo.message,u=s.get(d)||{count:0,severity:i.errorInfo.severity};s.set(d,{count:u.count+1,severity:i.errorInfo.severity})}),t.topErrors=Array.from(s.entries()).sort((i,n)=>n[1].count-i[1].count).slice(0,5).map(([i,n])=>({message:i,count:n.count,severity:n.severity})),t}analyzeTrends(e){if(e.length<2)return null;const t=new Map,s=300*1e3;e.forEach(d=>{const u=Math.floor(d.timestamp/s)*s,m=new Date(u).toISOString();t.set(m,(t.get(m)||0)+1)});const i=Array.from(t.entries()).sort((d,u)=>new Date(d[0]).getTime()-new Date(u[0]).getTime());if(i.length<2)return null;const n=i.map(([,d])=>d),r=this.calculateTrend(n);return{timeSlots:i,trend:r>0?"increasing":r<0?"decreasing":"stable",trendValue:r}}calculateTrend(e){const t=e.length,s=t*(t-1)/2,i=e.reduce((d,u)=>d+u,0),n=e.reduce((d,u,m)=>d+m*u,0),r=e.reduce((d,u,m)=>d+m*m,0);return(t*n-s*i)/(t*r-s*s)}detectAnomalies(e){const t=[];e.length>10&&t.push({type:"high_frequency",description:"Unusually high error frequency detected",count:e.length,severity:"high"});const s=new Set(e.map(r=>r.errorInfo.message)),i=new Set(this.logs.slice(0,-e.length).map(r=>r.errorInfo.message)),n=Array.from(s).filter(r=>!i.has(r));return n.length>0&&t.push({type:"new_error_types",description:"New error types detected",newErrors:n,severity:"medium"}),t}addRealtimeListener(e){return this.realtimeListeners.push(e),()=>{const t=this.realtimeListeners.indexOf(e);t!==-1&&this.realtimeListeners.splice(t,1)}}markAsResolved(e,t){const s=this.logs.find(i=>i.id===e);return s?(s.resolved=!0,s.resolvedBy=t,this.saveToStorage(),!0):!1}getRelatedErrors(e){return this.logs.filter(t=>t.correlationId===e)}setUserId(e){this.userId=e}getAdvancedStatistics(e){const t=e?this.getLogs({startTime:e.start,endTime:e.end}):this.logs,s=this.getStatistics(e),i=t.filter(u=>u.resolved),n=i.length>0?i.reduce((u,m)=>u+60*1e3,0)/i.length:0,r={low:t.filter(u=>u.impact==="low").length,medium:t.filter(u=>u.impact==="medium").length,high:t.filter(u=>u.impact==="high").length,critical:t.filter(u=>u.impact==="critical").length},d={user:t.filter(u=>u.source==="user").length,system:t.filter(u=>u.source==="system").length,auto:t.filter(u=>u.source==="auto").length};return R(C({},s),{mttr:n,impactStats:r,sourceStats:d,resolutionRate:t.length>0?i.length/t.length:0,correlationGroups:this.getCorrelationGroups(t)})}getCorrelationGroups(e){const t=new Map;return e.forEach(s=>{if(s.correlationId){const i=t.get(s.correlationId)||{count:0,resolved:0};i.count++,s.resolved&&i.resolved++,t.set(s.correlationId,i)}}),Array.from(t.entries()).map(([s,i])=>C({id:s},i)).sort((s,i)=>i.count-s.count)}generateId(){return`${Date.now()}-${Math.random().toString(36).substr(2,9)}`}}class Ni{constructor(e={}){p(this,"options");p(this,"queue",[]);p(this,"isReporting",!1);p(this,"sessionId");p(this,"sessionStartTime");p(this,"pageViews",0);p(this,"reportInterval",null);p(this,"maxQueueSize",50);p(this,"batchSize",10);this.options=C({endpoint:"",apiKey:"",environment:"production",userId:"",sessionId:this.generateSessionId(),metadata:{}},e),this.sessionId=this.options.sessionId,this.sessionStartTime=Date.now(),this.trackPageView(),this.options.endpoint&&this.startBatchReporting()}report(e,t){if(this.options.environment==="development"){console.log("[ErrorReporter] Skipping report in development environment");return}const s={errorInfo:e,environment:this.options.environment,browser:this.getBrowserInfo(),screen:this.getScreenInfo(),memory:this.getMemoryInfo(),sessionInfo:{id:this.sessionId,startTime:this.sessionStartTime,duration:Date.now()-this.sessionStartTime,pageViews:this.pageViews},userId:this.options.userId,metadata:C(C({},this.options.metadata),t)};this.queue.push(s),this.queue.length>this.maxQueueSize&&(this.queue=this.queue.slice(-this.maxQueueSize)),e.severity==="critical"&&this.flushQueue()}flushQueue(){return f(this,null,function*(){if(!(this.isReporting||this.queue.length===0||!this.options.endpoint)){this.isReporting=!0;try{for(;this.queue.length>0;){const e=this.queue.splice(0,this.batchSize);yield this.sendBatch(e)}}catch(e){console.error("[ErrorReporter] Failed to send error reports:",e)}finally{this.isReporting=!1}}})}sendBatch(e){return f(this,null,function*(){const t={reports:e,timestamp:Date.now(),apiKey:this.options.apiKey},s=yield fetch(this.options.endpoint,{method:"POST",headers:{"Content-Type":"application/json","X-API-Key":this.options.apiKey},body:JSON.stringify(t)});if(!s.ok)throw new Error(`Failed to send error reports: ${s.statusText}`)})}getBrowserInfo(){const e=navigator.userAgent,t={name:"Unknown",version:"Unknown",platform:navigator.platform||"Unknown"};if(e.includes("Chrome")){t.name="Chrome";const s=e.match(/Chrome\/(\d+)/);s&&(t.version=s[1])}else if(e.includes("Firefox")){t.name="Firefox";const s=e.match(/Firefox\/(\d+)/);s&&(t.version=s[1])}else if(e.includes("Safari")){t.name="Safari";const s=e.match(/Version\/(\d+)/);s&&(t.version=s[1])}else if(e.includes("Edge")){t.name="Edge";const s=e.match(/Edge\/(\d+)/);s&&(t.version=s[1])}return t}getScreenInfo(){return{width:window.screen.width,height:window.screen.height,pixelRatio:window.devicePixelRatio||1}}getMemoryInfo(){if("memory"in performance){const e=performance.memory;return{used:e.usedJSHeapSize,total:e.totalJSHeapSize,limit:e.jsHeapSizeLimit}}}trackPageView(){this.pageViews++;const e=history.pushState;history.pushState=(...t)=>(this.pageViews++,e.apply(history,t))}startBatchReporting(){this.reportInterval=window.setInterval(()=>{this.flushQueue()},3e4),window.addEventListener("beforeunload",()=>{this.flushQueue()}),document.addEventListener("visibilitychange",()=>{document.hidden&&this.flushQueue()})}generateSessionId(){return`${Date.now()}-${Math.random().toString(36).substr(2,9)}`}setUserId(e){this.options.userId=e}updateMetadata(e){this.options.metadata=C(C({},this.options.metadata),e)}getStats(){return{queueSize:this.queue.length,sessionDuration:Date.now()-this.sessionStartTime,pageViews:this.pageViews,isReporting:this.isReporting}}destroy(){this.reportInterval&&(clearInterval(this.reportInterval),this.reportInterval=null),this.flushQueue()}}class zi{constructor(){p(this,"strategies",[]);p(this,"recoveryAttempts",new Map);p(this,"recoveryHistory",[]);p(this,"maxHistorySize",100);p(this,"gameStateBackup",null);p(this,"performanceBaseline",null);this.registerDefaultStrategies(),this.initializePerformanceBaseline()}initializePerformanceBaseline(){var e;try{const t=((e=performance.memory)==null?void 0:e.usedJSHeapSize)||0,s=performance.now();this.performanceBaseline={memory:t,timing:s}}catch(t){console.warn("[Recovery] Failed to initialize performance baseline:",t)}}registerDefaultStrategies(){this.registerStrategy({name:"network-retry",description:"ネットワーク接続の再試行と復旧",condition:e=>e.category==="network"||e.message.includes("Failed to fetch")||e.message.includes("Network"),recover:e=>f(this,null,function*(){console.log("[Recovery] Attempting network recovery...");const t=yield this.diagnoseNetworkStatus();return t.isOffline&&(yield this.waitForOnline(3e4)),yield this.clearDNSCache(),this.getRecoveryAttempts("network-retry")>=2?yield this.enableOfflineMode():t.isOnline}),maxRetries:3,retryDelay:2e3,priority:8,healthCheck:()=>this.checkNetworkHealth()}),this.registerStrategy({name:"memory-cleanup",description:"メモリの最適化とクリーンアップ",condition:e=>e.message.includes("out of memory")||e.message.includes("Maximum call stack")||e.category==="performance",recover:e=>f(this,null,function*(){console.log("[Recovery] Attempting memory cleanup...");const t=this.getCurrentMemoryUsage();yield this.performMemoryCleanup();const s=this.getCurrentMemoryUsage(),i=t-s;return console.log(`[Recovery] Memory cleanup completed. Reduced: ${(i/1024/1024).toFixed(1)}MB`),i>10*1024*1024}),maxRetries:2,retryDelay:1e3,priority:7,healthCheck:()=>this.checkMemoryHealth()}),this.registerStrategy({name:"vue-component-remount",description:"Vueコンポーネントの再マウントと状態復旧",condition:e=>e.category==="vue",recover:e=>f(this,null,function*(){console.log("[Recovery] Attempting Vue component recovery...");const t=e.component||"unknown";yield this.backupComponentState(t);const s=new CustomEvent("app:remount-component",{detail:{component:t,preserveState:!0,errorId:e.fingerprint}});return window.dispatchEvent(s),yield new Promise(i=>setTimeout(i,1e3)),yield this.restoreComponentState(t),!0}),maxRetries:2,retryDelay:1e3,priority:6,rollback:()=>f(this,null,function*(){console.log("[Recovery] Vue recovery failed, reloading page"),location.reload()})}),this.registerStrategy({name:"storage-cleanup",condition:e=>e.message.includes("QuotaExceededError")||e.message.includes("storage"),recover:()=>f(this,null,function*(){return console.log("[Recovery] Attempting storage cleanup..."),this.cleanupLocalStorage(),!0}),maxRetries:1}),this.registerStrategy({name:"game-state-recovery",description:"ゲーム状態のバックアップからの復旧",condition:e=>e.category==="game"||e.message.includes("game")||e.message.includes("state"),recover:e=>f(this,null,function*(){if(console.log("[Recovery] Attempting game state recovery..."),yield this.restoreGameState()){const s=new CustomEvent("app:reinitialize-game",{detail:{reason:"error-recovery",errorId:e.fingerprint}});return window.dispatchEvent(s),!0}return!1}),maxRetries:1,priority:9,prerequisites:["memory-cleanup"],rollback:()=>f(this,null,function*(){const e=new CustomEvent("app:start-new-game",{detail:{reason:"recovery-failed"}});window.dispatchEvent(e)})}),this.registerStrategy({name:"async-retry",description:"非同期処理の再試行",condition:e=>e.category==="async"&&!e.message.includes("Network"),recover:e=>f(this,null,function*(){console.log("[Recovery] Attempting async operation retry...");const t=this.getRecoveryAttempts("async-retry"),s=Math.min(1e3*Math.pow(2,t),1e4);yield new Promise(n=>setTimeout(n,s));const i=new CustomEvent("app:retry-async-operation",{detail:{originalError:e,attempt:t+1}});return window.dispatchEvent(i),!0}),maxRetries:3,retryDelay:1e3,priority:4}),this.registerStrategy({name:"security-fallback",description:"セキュリティ制限を回避するフォールバック",condition:e=>e.category==="security"||e.message.includes("CORS")||e.message.includes("blocked"),recover:e=>f(this,null,function*(){console.log("[Recovery] Attempting security fallback...");const t=new CustomEvent("app:enable-security-fallback",{detail:{reason:e.message}});return window.dispatchEvent(t),!0}),maxRetries:1,priority:5})}registerStrategy(e){const t=e.priority||0,s=this.strategies.findIndex(i=>(i.priority||0)<t);s===-1?this.strategies.push(e):this.strategies.splice(s,0,e)}tryRecover(e){return f(this,null,function*(){console.log("[Recovery] Attempting recovery for error:",e.message);for(const s of this.strategies)if(s.condition(e)){const i=this.getRecoveryAttempts(s.name),n=s.maxRetries||1;if(i>=n){console.log(`[Recovery] Max retries reached for strategy: ${s.name}`);continue}try{i>0&&s.retryDelay&&(yield new Promise(u=>setTimeout(u,s.retryDelay))),this.incrementRecoveryAttempts(s.name);const r=yield s.recover(),d={success:r,strategyUsed:s.name,attemptsCount:i+1};return this.addToHistory(e,d),r&&(console.log(`[Recovery] Successfully recovered using strategy: ${s.name}`),this.resetRecoveryAttempts(s.name)),d}catch(r){console.error(`[Recovery] Strategy ${s.name} failed:`,r);const d={success:!1,strategyUsed:s.name,attemptsCount:i+1,error:r};return this.addToHistory(e,d),d}}const t={success:!1,attemptsCount:0};return this.addToHistory(e,t),t})}waitForOnline(e=3e4){return f(this,null,function*(){if(!navigator.onLine)return new Promise(t=>{const s=()=>{window.removeEventListener("online",s),t()};window.addEventListener("online",s),setTimeout(()=>{window.removeEventListener("online",s),t()},e)})})}cleanupEventListeners(){const e=new CustomEvent("app:cleanup-listeners");window.dispatchEvent(e)}clearCaches(){try{sessionStorage.clear()}catch(t){console.error("[Recovery] Failed to clear session storage:",t)}const e=new CustomEvent("app:clear-caches");window.dispatchEvent(e)}cleanupLocalStorage(){try{const e=[],t=Date.now();for(let s=0;s<localStorage.length;s++){const i=localStorage.key(s);if(i)try{const n=localStorage.getItem(i);if(!n)continue;const r=JSON.parse(n);r.expiry&&r.expiry<t&&e.push(i)}catch(n){}}if(e.forEach(s=>localStorage.removeItem(s)),e.length===0){const s=[];for(let i=0;i<localStorage.length;i++){const n=localStorage.key(i);n&&n.startsWith("game_")&&s.push(n)}s.length>0&&localStorage.removeItem(s[0])}}catch(e){console.error("[Recovery] Failed to cleanup local storage:",e)}}getRecoveryAttempts(e){return this.recoveryAttempts.get(e)||0}incrementRecoveryAttempts(e){const t=this.getRecoveryAttempts(e);this.recoveryAttempts.set(e,t+1)}resetRecoveryAttempts(e){this.recoveryAttempts.delete(e)}addToHistory(e,t){this.recoveryHistory.push({timestamp:Date.now(),errorInfo:e,result:t}),this.recoveryHistory.length>this.maxHistorySize&&(this.recoveryHistory=this.recoveryHistory.slice(-this.maxHistorySize))}getStatistics(){const e=this.recoveryHistory.filter(i=>i.result.success).length,t=this.recoveryHistory.filter(i=>!i.result.success).length,s=new Map;return this.recoveryHistory.forEach(i=>{if(i.result.strategyUsed){const n=s.get(i.result.strategyUsed)||{success:0,failed:0};i.result.success?n.success++:n.failed++,s.set(i.result.strategyUsed,n)}}),{total:this.recoveryHistory.length,successful:e,failed:t,successRate:this.recoveryHistory.length>0?e/this.recoveryHistory.length:0,byStrategy:Object.fromEntries(s),currentAttempts:Object.fromEntries(this.recoveryAttempts)}}diagnoseNetworkStatus(){return f(this,null,function*(){if(!navigator.onLine)return{isOnline:!1,isOffline:!0};try{const t=performance.now(),s=yield fetch("/favicon.ico",{method:"HEAD",cache:"no-cache"}),i=performance.now()-t,n=navigator.connection,r=(n==null?void 0:n.effectiveType)||"unknown";return{isOnline:s.ok,isOffline:!s.ok,latency:i,bandwidth:r}}catch(t){return{isOnline:!1,isOffline:!0}}})}clearDNSCache(){return f(this,null,function*(){try{"serviceWorker"in navigator&&navigator.serviceWorker.controller&&navigator.serviceWorker.controller.postMessage({type:"CLEAR_DNS_CACHE"})}catch(e){console.warn("[Recovery] Could not clear DNS cache:",e)}})}enableOfflineMode(){return f(this,null,function*(){try{const e=new CustomEvent("app:enable-offline-mode",{detail:{reason:"network-recovery-failed"}});return window.dispatchEvent(e),!0}catch(e){return console.error("[Recovery] Failed to enable offline mode:",e),!1}})}checkNetworkHealth(){return f(this,null,function*(){try{return(yield fetch("/api/health",{method:"GET",cache:"no-cache",signal:AbortSignal.timeout(5e3)})).ok}catch(e){return navigator.onLine}})}getCurrentMemoryUsage(){var e;try{return((e=performance.memory)==null?void 0:e.usedJSHeapSize)||0}catch(t){return 0}}performMemoryCleanup(){return f(this,null,function*(){this.clearCaches(),yield new Promise(e=>setTimeout(e,100)),this.cleanupEventListeners(),yield new Promise(e=>setTimeout(e,100)),yield this.cleanupDOMElements(),"gc"in window&&window.gc(),yield this.detectAndFixMemoryLeaks()})}cleanupDOMElements(){return f(this,null,function*(){document.querySelectorAll('[style*="display: none"]').forEach(s=>{s.parentNode&&!s.hasAttribute("data-keep")&&s.parentNode.removeChild(s)});const t=document.querySelectorAll("[data-log-entry]");t.length>100&&Array.from(t).slice(0,t.length-50).forEach(i=>i.remove())})}detectAndFixMemoryLeaks(){return f(this,null,function*(){const e=new CustomEvent("app:detect-memory-leaks");window.dispatchEvent(e),this.cleanupOrphanedTimers()})}cleanupOrphanedTimers(){const e=new CustomEvent("app:cleanup-timers");window.dispatchEvent(e)}checkMemoryHealth(){return f(this,null,function*(){const e=this.getCurrentMemoryUsage();if(!this.performanceBaseline||e===0)return!0;const t=e-this.performanceBaseline.memory,s=100*1024*1024;return t<s})}backupComponentState(e){return f(this,null,function*(){const t=new CustomEvent("app:backup-component-state",{detail:{component:e}});window.dispatchEvent(t)})}restoreComponentState(e){return f(this,null,function*(){const t=new CustomEvent("app:restore-component-state",{detail:{component:e}});window.dispatchEvent(t)})}restoreGameState(){return f(this,null,function*(){try{const e=localStorage.getItem("game_state_backup");if(e){const s=JSON.parse(e),i=new CustomEvent("app:restore-game-state",{detail:{state:s,source:"backup"}});return window.dispatchEvent(i),!0}const t=localStorage.getItem("game_autosave");if(t){const s=JSON.parse(t),i=new CustomEvent("app:restore-game-state",{detail:{state:s,source:"autosave"}});return window.dispatchEvent(i),!0}return!1}catch(e){return console.error("[Recovery] Failed to restore game state:",e),!1}})}checkPrerequisites(e){return f(this,null,function*(){if(!e.prerequisites||e.prerequisites.length===0)return!0;for(const t of e.prerequisites){const s=this.strategies.find(i=>i.name===t);if(s)try{if(!(yield s.recover({})))return console.log(`[Recovery] Prerequisite ${t} failed`),!1}catch(i){return console.error(`[Recovery] Prerequisite ${t} threw error:`,i),!1}}return!0})}tryAdvancedRecover(e){return f(this,null,function*(){console.log("[Recovery] Starting advanced recovery for error:",e.message);const t=[...this.strategies].sort((i,n)=>(n.priority||0)-(i.priority||0));for(const i of t)if(i.condition(e)){const n=this.getRecoveryAttempts(i.name),r=i.maxRetries||1;if(n>=r){console.log(`[Recovery] Max retries reached for strategy: ${i.name}`);continue}if(!(yield this.checkPrerequisites(i))){console.log(`[Recovery] Prerequisites not met for strategy: ${i.name}`);continue}try{n>0&&i.retryDelay&&(yield new Promise(E=>setTimeout(E,i.retryDelay))),this.incrementRecoveryAttempts(i.name);const u=yield i.recover(e);let m=!0;u&&i.healthCheck&&(m=yield i.healthCheck(),m||console.log(`[Recovery] Health check failed for strategy: ${i.name}`));const h={success:u&&m,strategyUsed:i.name,attemptsCount:n+1};return this.addToHistory(e,h),h.success?(console.log(`[Recovery] Successfully recovered using strategy: ${i.name}`),this.resetRecoveryAttempts(i.name),h):(i.rollback&&(console.log(`[Recovery] Rolling back strategy: ${i.name}`),yield i.rollback()),h)}catch(u){if(console.error(`[Recovery] Strategy ${i.name} failed:`,u),i.rollback)try{yield i.rollback()}catch(h){console.error(`[Recovery] Rollback failed for ${i.name}:`,h)}const m={success:!1,strategyUsed:i.name,attemptsCount:n+1,error:u};return this.addToHistory(e,m),m}}const s={success:!1,attemptsCount:0};return this.addToHistory(e,s),s})}clear(){this.recoveryAttempts.clear(),this.recoveryHistory=[],this.gameStateBackup=null,this.performanceBaseline=null}}const J=class J{constructor(e={}){p(this,"errorLogger");p(this,"errorReporter");p(this,"errorRecovery");p(this,"options");p(this,"errorCount",0);p(this,"errorTimestamps",[]);p(this,"isInitialized",!1);p(this,"duplicateErrors",new Map);p(this,"errorPerformanceHistory",[]);this.options=C({enableLogging:!0,enableReporting:!0,enableRecovery:!0,logToConsole:!0,reportToServer:!1,showUserNotification:!0,maxErrorsPerMinute:10,recoveryStrategies:new Map},e),this.errorLogger=new Hi,this.errorReporter=new Ni,this.errorRecovery=new zi}static getInstance(e){return J.instance||(J.instance=new J(e)),J.instance}setupVueErrorHandler(e){e.config.errorHandler=(t,s,i)=>{this.handleError({message:t.message||"Unknown Vue error",stack:t.stack,component:(s==null?void 0:s.$options.name)||"Unknown",props:s==null?void 0:s.$props,info:i,timestamp:Date.now(),userAgent:navigator.userAgent,severity:this.determineSeverity(t),category:"vue"})},e.config.warnHandler=(t,s,i)=>{this.options.logToConsole&&console.warn(`Vue warning: ${t}
Trace: ${i}`),this.errorLogger.logWarning({message:t,component:(s==null?void 0:s.$options.name)||"Unknown",trace:i,timestamp:Date.now()})}}setupGlobalHandlers(){if(this.isInitialized){console.warn("GlobalErrorHandler is already initialized");return}if(window.onerror=(e,t,s,i,n)=>(this.handleError({message:typeof e=="string"?e:"Unknown error",stack:n==null?void 0:n.stack,url:t,line:s,column:i,timestamp:Date.now(),userAgent:navigator.userAgent,severity:this.determineSeverity(n),category:"javascript"}),!0),window.addEventListener("unhandledrejection",e=>{var t;this.handleError({message:`Unhandled Promise rejection: ${e.reason}`,stack:(t=e.reason)==null?void 0:t.stack,timestamp:Date.now(),userAgent:navigator.userAgent,severity:"high",category:"async"}),e.preventDefault()}),"PerformanceObserver"in window){const e=new PerformanceObserver(t=>{for(const s of t.getEntries())s.entryType==="resource"&&"responseStatus"in s&&s.responseStatus>=400&&this.handleError({message:`Network error: ${s.name}`,url:s.name,timestamp:Date.now(),userAgent:navigator.userAgent,severity:"medium",category:"network"})});try{e.observe({entryTypes:["resource"]})}catch(t){}}this.isInitialized=!0}handleError(e){const t=this.enhanceErrorInfo(e);if(!this.checkRateLimit()){console.error("Error rate limit exceeded");return}if(this.errorCount++,t.fingerprint=this.generateFingerprint(t),this.isDuplicateError(t)){console.log("Duplicate error detected, skipping notification"),this.options.enableLogging&&this.errorLogger.log(t);return}this.options.enableLogging&&(this.errorLogger.log(t),this.options.logToConsole&&this.logStructuredError(t)),this.options.enableReporting&&this.options.reportToServer&&this.errorReporter.report(t),this.options.enableRecovery&&this.errorRecovery.tryAdvancedRecover(t).then(s=>{const i=new CustomEvent("app:recovery-result",{detail:{success:s.success,strategy:s.strategyUsed,attempts:s.attemptsCount,errorId:t.fingerprint}});if(window.dispatchEvent(i),s.success){console.log(`[ErrorHandler] Auto-recovery successful using ${s.strategyUsed}`);const n=new CustomEvent("app:error",{detail:{message:`エラーから自動復旧しました (${s.strategyUsed})`,severity:"info",category:"system",timestamp:Date.now(),userAgent:navigator.userAgent,context:{originalError:t.fingerprint,recoveryStrategy:s.strategyUsed}}});window.dispatchEvent(n)}}).catch(s=>{console.error("[ErrorHandler] Recovery failed:",s),this.handleError({message:`Recovery system failure: ${s.message}`,stack:s.stack,category:"system",severity:"high",timestamp:Date.now(),userAgent:navigator.userAgent,context:{originalError:t.fingerprint,recoveryError:!0}})}),this.options.showUserNotification&&t.severity!=="low"&&this.notifyUser(t),this.trackErrorPerformance(t)}determineSeverity(e){if(!e)return"low";const t=e.message||e.toString(),s=e.stack||"";return t.includes("Cannot read property")||t.includes("Cannot access before initialization")||t.includes("is not defined")||t.includes("Maximum call stack")||t.includes("Out of memory")||t.includes("Script error")||t.includes("ChunkLoadError")||s.includes("at Object.exports")||e.name==="TypeError"&&t.includes("null")?"critical":t.includes("Network error")||t.includes("Failed to fetch")||t.includes("Promise rejection")||t.includes("Timeout")||t.includes("CORS")||t.includes("401")||t.includes("403")||t.includes("500")||t.includes("Game state")||t.includes("Save failed")||e.name==="SecurityError"?"high":t.includes("Warning")||t.includes("Deprecated")||t.includes("Performance")||t.includes("Slow")||t.includes("404")||t.includes("Render")||t.includes("Animation")?"medium":"low"}checkRateLimit(){const e=Date.now(),t=e-6e4;return this.errorTimestamps=this.errorTimestamps.filter(s=>s>t),this.errorTimestamps.length>=this.options.maxErrorsPerMinute?!1:(this.errorTimestamps.push(e),!0)}notifyUser(e){let t="エラーが発生しました";switch(e.category){case"network":t="ネットワーク接続に問題が発生しました";break;case"async":t="処理中にエラーが発生しました";break;case"vue":t="画面の表示でエラーが発生しました";break;default:t="予期しないエラーが発生しました"}this.showErrorNotification(t,e.severity)}showErrorNotification(e,t){console.warn(`[User Notification] ${t.toUpperCase()}: ${e}`);const s=new CustomEvent("app:error",{detail:{message:e,severity:t}});window.dispatchEvent(s)}getErrorStats(){return{totalErrors:this.errorCount,recentErrors:this.errorTimestamps.length,logs:this.errorLogger.getLogs(),isHealthy:this.errorTimestamps.length<this.options.maxErrorsPerMinute/2}}reset(){this.errorCount=0,this.errorTimestamps=[],this.errorLogger.clear()}enhanceErrorInfo(e){var n;const t=R(C({},e.context),{route:window.location.pathname,deviceInfo:{isMobile:/Mobile|Android|iPhone|iPad/.test(navigator.userAgent),screenSize:`${window.screen.width}x${window.screen.height}`,connection:((n=navigator.connection)==null?void 0:n.effectiveType)||"unknown"}}),s=[...e.tags||[],e.category,e.severity,t.deviceInfo.isMobile?"mobile":"desktop"],i=[...e.breadcrumbs||[],{timestamp:Date.now(),category:"error",message:"Error captured by handler",data:{component:e.component}}];return R(C({},e),{context:t,tags:s,breadcrumbs:i})}generateFingerprint(e){var i;const t=[e.message,e.component||"unknown",e.category,((i=e.context)==null?void 0:i.route)||"unknown"].join("|");let s=0;for(let n=0;n<t.length;n++){const r=t.charCodeAt(n);s=(s<<5)-s+r,s=s&s}return Math.abs(s).toString(16)}isDuplicateError(e){if(!e.fingerprint)return!1;const t=Date.now(),s=this.duplicateErrors.get(e.fingerprint)||0;return t-s<6e4?!0:(this.duplicateErrors.set(e.fingerprint,t),!1)}logStructuredError(e){const t={message:e.message,severity:e.severity,category:e.category,component:e.component,fingerprint:e.fingerprint,context:e.context,tags:e.tags,timestamp:new Date(e.timestamp).toISOString()};console.group(`🚨 [${e.severity.toUpperCase()}] ${e.category}`),console.error("Message:",e.message),console.log("Data:",t),e.stack&&console.log("Stack:",e.stack),console.groupEnd()}trackErrorPerformance(e){this.errorPerformanceHistory.push({timestamp:Date.now(),severity:e.severity});const t=Date.now()-36e5;this.errorPerformanceHistory=this.errorPerformanceHistory.filter(i=>i.timestamp>t),this.errorPerformanceHistory.filter(i=>i.severity==="critical"&&i.timestamp>Date.now()-3e5).length>=3&&this.triggerSystemAlert("Multiple critical errors detected")}triggerSystemAlert(e){console.error(`🚀 SYSTEM ALERT: ${e}`);const t=new CustomEvent("app:system-alert",{detail:{message:e,timestamp:Date.now()}});window.dispatchEvent(t)}addBreadcrumb(e,t,s){console.log(`[Breadcrumb] ${e}: ${t}`,s)}getHealthStatus(){const e=this.errorTimestamps.filter(s=>s>Date.now()-3e5).length,t=this.errorPerformanceHistory.filter(s=>s.severity==="critical"&&s.timestamp>Date.now()-3e5).length;return{isHealthy:e<this.options.maxErrorsPerMinute/2&&t===0,recentErrorCount:e,criticalErrorCount:t,totalErrors:this.errorCount,rateLimit:{current:this.errorTimestamps.length,max:this.options.maxErrorsPerMinute}}}destroy(){window.onerror=null,window.removeEventListener("unhandledrejection",()=>{}),this.duplicateErrors.clear(),this.errorPerformanceHistory=[],this.reset(),this.isInitialized=!1}};p(J,"instance");let Ee=J;const Pe={BASE_URL:"/insurance_self_game/",DEV:!1,MODE:"production",PROD:!0,SSR:!1};class Ui{constructor(e,t="unknown",s="unknown"){p(this,"sessionId");p(this,"buildVersion");p(this,"environment");p(this,"gameStateProvider");p(this,"componentProvider");p(this,"featureProvider");this.sessionId=e,this.buildVersion=t,this.environment=s}setGameStateProvider(e){this.gameStateProvider=e}setComponentProvider(e){this.componentProvider=e}setFeatureProvider(e){this.featureProvider=e}collect(e={}){const t=C({includeMemory:!0,includePerformance:!0,includeGameState:!0,includeExperimental:!1,sanitize:!0,maxDataSize:102400},e);try{const s={timestamp:new Date().toISOString(),sessionId:this.sessionId,buildVersion:this.buildVersion,environment:this.environment,system:this.collectSystemInfo(),performance:this.collectPerformanceInfo(t),application:this.collectApplicationInfo(t),features:this.collectFeatureInfo()};return t.includeExperimental&&(s.experimental=this.collectExperimentalInfo()),t.maxDataSize&&JSON.stringify(s).length>t.maxDataSize?(console.warn("[DebugInfoCollector] Data size exceeds limit, truncating..."),this.truncateData(s,t.maxDataSize)):t.sanitize?this.sanitizeData(s):s}catch(s){return console.error("[DebugInfoCollector] Failed to collect debug info:",s),{timestamp:new Date().toISOString(),sessionId:this.sessionId,buildVersion:this.buildVersion,environment:this.environment,system:{userAgent:navigator.userAgent,platform:navigator.platform,language:navigator.language,cookieEnabled:navigator.cookieEnabled,onLine:navigator.onLine,screenResolution:`${screen.width}x${screen.height}`,viewportSize:`${window.innerWidth}x${window.innerHeight}`,devicePixelRatio:window.devicePixelRatio,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone},performance:{timing:{navigationStart:0,loadComplete:0,domReady:0}},application:{url:this.sanitizeUrl(window.location.href),referrer:this.sanitizeUrl(document.referrer),activeFeatures:[],errorCount:0},features:{localStorage:!1,sessionStorage:!1,webGL:!1,webWorker:!1,serviceWorker:!1,notifications:!1,geolocation:!1,mediaDevices:!1}}}}collectSystemInfo(){return{userAgent:navigator.userAgent,platform:navigator.platform,language:navigator.language,cookieEnabled:navigator.cookieEnabled,onLine:navigator.onLine,screenResolution:`${screen.width}x${screen.height}`,viewportSize:`${window.innerWidth}x${window.innerHeight}`,devicePixelRatio:window.devicePixelRatio,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone}}collectPerformanceInfo(e){const t={timing:{navigationStart:performance.timing.navigationStart,loadComplete:performance.timing.loadEventEnd-performance.timing.navigationStart,domReady:performance.timing.domContentLoadedEventEnd-performance.timing.navigationStart}};if(e.includeMemory&&"memory"in performance){const s=performance.memory;t.memory={used:s.usedJSHeapSize,total:s.totalJSHeapSize,limit:s.jsHeapSizeLimit}}if(e.includePerformance&&"getEntriesByType"in performance)try{const s=performance.getEntriesByType("paint"),i=s.find(r=>r.name==="first-paint"),n=s.find(r=>r.name==="first-contentful-paint");i&&(t.timing.firstPaint=i.startTime),n&&(t.timing.firstContentfulPaint=n.startTime)}catch(s){}if("connection"in navigator){const s=navigator.connection;t.connection={effectiveType:s.effectiveType||"unknown",downlink:s.downlink||0,rtt:s.rtt||0}}return t}collectApplicationInfo(e){const t={url:this.sanitizeUrl(window.location.href),referrer:this.sanitizeUrl(document.referrer),activeFeatures:this.featureProvider?this.featureProvider():this.detectActiveFeatures(),errorCount:this.getErrorCount()};if(e.includeGameState&&this.gameStateProvider)try{t.gameState=this.gameStateProvider()}catch(i){t.gameState="error"}if(this.componentProvider)try{t.currentComponent=this.componentProvider()}catch(i){}window.location.pathname&&(t.routePath=window.location.pathname);const s=this.getLastError();return s&&(t.lastError=s),t}collectFeatureInfo(){return{localStorage:this.testFeature(()=>"localStorage"in window&&window.localStorage!==null),sessionStorage:this.testFeature(()=>"sessionStorage"in window&&window.sessionStorage!==null),webGL:this.testFeature(()=>this.hasWebGL()),webWorker:this.testFeature(()=>"Worker"in window),serviceWorker:this.testFeature(()=>"serviceWorker"in navigator),notifications:this.testFeature(()=>"Notification"in window),geolocation:this.testFeature(()=>"geolocation"in navigator),mediaDevices:this.testFeature(()=>"mediaDevices"in navigator)}}collectExperimentalInfo(){return{flags:this.getFeatureFlags(),abTests:this.getABTests(),featureToggles:this.getFeatureToggles()}}testFeature(e){try{return e()}catch(t){return!1}}hasWebGL(){try{const e=document.createElement("canvas");return!!(e.getContext("webgl")||e.getContext("experimental-webgl"))}catch(e){return!1}}sanitizeUrl(e){if(!e)return"";try{const t=new URL(e),s=new URLSearchParams;return t.searchParams.forEach((i,n)=>{this.isSensitiveParam(n)||s.set(n,i)}),`${t.origin}${t.pathname}${s.toString()?`?${s.toString()}`:""}`}catch(t){return e.split("?")[0].split("#")[0]}}isSensitiveParam(e){return["token","auth","session","key","secret","password","pwd","pass","api_key","apikey","access_token","refresh_token","jwt","bearer"].some(s=>e.toLowerCase().includes(s))}detectActiveFeatures(){const e=[];document.querySelector("[data-game-canvas]")&&e.push("game"),document.querySelector("[data-tutorial]")&&e.push("tutorial"),document.querySelector("[data-statistics]")&&e.push("statistics"),document.querySelector("[data-settings]")&&e.push("settings");try{localStorage.getItem("game_settings")&&e.push("settings-saved"),localStorage.getItem("game_progress")&&e.push("progress-saved"),localStorage.getItem("tutorial_completed")&&e.push("tutorial-completed")}catch(t){}return e}getErrorCount(){try{const e=window.__errorHandling;if(e!=null&&e.getStatistics)return e.getStatistics().totalErrors||0}catch(e){}return 0}getLastError(){try{const e=window.__errorHandling;if(e!=null&&e.getStatistics){const t=e.getStatistics();if(t.logs&&t.logs.length>0){const s=t.logs[t.logs.length-1];return{message:s.errorInfo.message,timestamp:s.timestamp,severity:s.errorInfo.severity}}}}catch(e){}}getFeatureFlags(){const e={};try{Object.keys(Pe).filter(s=>s.startsWith("VITE_FEATURE_FLAG_")).forEach(s=>{const i=s.replace("VITE_FEATURE_FLAG_","").toLowerCase();e[i]=Pe[s]==="true"})}catch(t){}return e}getABTests(){const e={};try{const t=localStorage.getItem("ab_tests");t&&Object.assign(e,JSON.parse(t))}catch(t){}return e}getFeatureToggles(){const e={};try{const t=localStorage.getItem("feature_toggles");t&&Object.assign(e,JSON.parse(t))}catch(t){}return e}sanitizeData(e){const t=JSON.parse(JSON.stringify(e));return t.system.userAgent&&(t.system.userAgent=this.sanitizeUserAgent(t.system.userAgent)),t}sanitizeUserAgent(e){return e.split(" ").filter(i=>i.includes("Chrome")||i.includes("Firefox")||i.includes("Safari")||i.includes("Edge")||i.includes("Mobile")||i.includes("Windows")||i.includes("Mac")||i.includes("Linux")).slice(0,5).join(" ")}truncateData(e,t){const s=C({},e);return delete s.experimental,s.performance.memory&&delete s.performance.memory,s.performance.connection&&delete s.performance.connection,JSON.stringify(s).length>t&&(s.application={url:s.application.url,errorCount:s.application.errorCount,activeFeatures:[]}),s}}let ye=null;function Vi(o,e,t){return ye||(ye=new Ui(o||"unknown",e||void 0||"unknown",t||"production")),ye}class Bi{constructor(){p(this,"globalHandler");p(this,"isInitialized",!1);p(this,"config",{});p(this,"debugCollector")}initialize(e={}){if(this.isInitialized){console.warn("[ErrorHandlingSystem] Already initialized");return}this.config=C({enableLogging:!0,enableReporting:!0,enableRecovery:!0,enableUserNotifications:!0,maxErrorsPerMinute:10,logToConsole:!1,reportToServer:!0,environment:"production"},e),this.globalHandler=Ee.getInstance({enableLogging:this.config.enableLogging,enableReporting:this.config.enableReporting,enableRecovery:this.config.enableRecovery,logToConsole:this.config.logToConsole,reportToServer:this.config.reportToServer,showUserNotification:this.config.enableUserNotifications,maxErrorsPerMinute:this.config.maxErrorsPerMinute}),this.globalHandler.setupGlobalHandlers(),this.debugCollector=Vi(this.generateSessionId(),this.config.buildVersion,this.config.environment),this.config.userId&&this.setUserId(this.config.userId),this.setupEventListeners(),this.isInitialized=!0,console.log("[ErrorHandlingSystem] Initialized successfully",{config:this.config,environment:this.config.environment})}integrateWithVue(e){if(!this.globalHandler)throw new Error("ErrorHandlingSystem must be initialized before Vue integration");this.globalHandler.setupVueErrorHandler(e)}setUserId(e){if(this.config.userId=e,this.globalHandler)try{this.globalHandler.errorReporter.setUserId(e)(this.globalHandler).errorLogger.setUserId(e)}catch(t){console.warn("[ErrorHandlingSystem] Failed to set user ID:",t)}}reportError(e,t,s="user"){if(!this.globalHandler){console.error("[ErrorHandlingSystem] Not initialized");return}const i={message:typeof e=="string"?e:e.message,stack:typeof e=="object"?e.stack:void 0,category:s,severity:"medium",timestamp:Date.now(),userAgent:navigator.userAgent,context:R(C({},t),{source:"manual-report",userId:this.config.userId})};this.globalHandler.handleError(i)}addErrorPattern(e){Ne.addPattern(e)}getHealthStatus(){return this.globalHandler?this.globalHandler.getHealthStatus():{isHealthy:!1,error:"Not initialized"}}getStatistics(){return this.globalHandler?this.globalHandler.getErrorStats():null}addErrorListener(e){const t=s=>{e(s.detail)};return window.addEventListener("app:error",t),()=>{window.removeEventListener("app:error",t)}}setupEventListeners(){window.addEventListener("app:error-alert",e=>{this.config.onAlert&&this.config.onAlert(e.detail.type,e.detail.data)}),window.addEventListener("app:system-alert",e=>{console.error(`🚨 SYSTEM ALERT: ${e.detail.message}`),this.config.onAlert&&this.config.onAlert("system-alert",e.detail)}),window.addEventListener("app:recovery-result",e=>{this.config.onRecovery&&this.config.onRecovery(e.detail.success,e.detail.strategy)}),this.setupPerformanceMonitoring()}setupVueDevToolsIntegration(){const e=window.__VUE_DEVTOOLS_GLOBAL_HOOK__;this.addErrorListener(t=>{e.emit("app:error",{type:"error",payload:{error:t,timestamp:Date.now()}})})}setupPerformanceMonitoring(){if("memory"in performance&&setInterval(()=>{const e=performance.memory,t=e.usedJSHeapSize,s=e.jsHeapSizeLimit;t/s>.8&&this.reportError("High memory usage detected",{memoryUsed:t,memoryLimit:s,percentage:Math.round(t/s*100)},"performance")},3e4),"PerformanceObserver"in window)try{new PerformanceObserver(t=>{for(const s of t.getEntries())s.duration>50&&this.reportError("Long task detected",{duration:s.duration,startTime:s.startTime,name:s.name},"performance")}).observe({entryTypes:["longtask"]})}catch(e){console.warn("[ErrorHandlingSystem] Long task monitoring not supported:",e)}}collectDebugInfo(e){if(this.debugCollector)try{return this.debugCollector.collect(e)}catch(s){console.error("[ErrorHandlingSystem] Failed to collect debug info:",s)}const t={timestamp:new Date().toISOString(),userAgent:navigator.userAgent,url:window.location.href,config:this.config,isInitialized:this.isInitialized};return"memory"in performance&&(t.memory=performance.memory),"connection"in navigator&&(t.connection=navigator.connection),t.timing=performance.timing,this.globalHandler&&(t.errorStats=this.getStatistics(),t.healthStatus=this.getHealthStatus()),t}setGameStateProvider(e){this.debugCollector&&this.debugCollector.setGameStateProvider(e)}setComponentProvider(e){this.debugCollector&&this.debugCollector.setComponentProvider(e)}setFeatureProvider(e){this.debugCollector&&this.debugCollector.setFeatureProvider(e)}generateSessionId(){return`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}destroy(){this.globalHandler&&(this.globalHandler.destroy(),this.globalHandler=void 0),this.isInitialized=!1,console.log("[ErrorHandlingSystem] Destroyed")}}const P=new Bi,ji={install(o,e={}){P.initialize(e),P.integrateWithVue(o),o.config.globalProperties.$errorHandling={reportError:P.reportError.bind(P),getHealth:P.getHealthStatus.bind(P),getStats:P.getStatistics.bind(P),collectDebugInfo:P.collectDebugInfo.bind(P)},o.provide("errorHandling",P)}};class qi{constructor(){p(this,"registration",null);p(this,"updateAvailable",!1);p(this,"refreshing",!1)}register(){return f(this,arguments,function*(e={}){if(!("serviceWorker"in navigator)){console.log("Service Worker is not supported");return}try{const t="/insurance_self_game/",s=yield navigator.serviceWorker.register(`${t}service-worker.js`,{scope:t});this.registration=s,console.log("Service Worker registered:",s),e.onSuccess&&e.onSuccess(s),this.checkForUpdates(s,e),this.setupNetworkListeners(e),this.setupRefreshListener(),setInterval(()=>{s.update()},3600*1e3)}catch(t){console.error("Service Worker registration failed:",t),e.onError&&e.onError(t)}})}checkForUpdates(e,t){e.installing&&this.trackInstalling(e.installing,t),e.waiting&&(this.updateAvailable=!0,t.onUpdate&&t.onUpdate(e)),e.addEventListener("updatefound",()=>{const s=e.installing;s&&this.trackInstalling(s,t)})}trackInstalling(e,t){e.addEventListener("statechange",()=>{e.state==="installed"&&navigator.serviceWorker.controller&&(this.updateAvailable=!0,t.onUpdate&&t.onUpdate(this.registration))})}setupNetworkListeners(e){window.addEventListener("online",()=>{console.log("Network: Online"),e.onOnline&&e.onOnline()}),window.addEventListener("offline",()=>{console.log("Network: Offline"),e.onOffline&&e.onOffline()})}setupRefreshListener(){navigator.serviceWorker.addEventListener("controllerchange",()=>{this.refreshing||(this.refreshing=!0,window.location.reload())})}update(){return f(this,null,function*(){if(this.registration)try{yield this.registration.update(),this.registration.waiting&&this.registration.waiting.postMessage({type:"SKIP_WAITING"})}catch(e){console.error("Service Worker update failed:",e)}})}clearCache(){return f(this,null,function*(){if(navigator.serviceWorker.controller&&(navigator.serviceWorker.controller.postMessage({type:"CLEAR_CACHE"}),"caches"in window)){const e=yield caches.keys();yield Promise.all(e.map(t=>caches.delete(t)))}})}unregister(){return f(this,null,function*(){if(this.registration)try{(yield this.registration.unregister())&&(console.log("Service Worker unregistered"),this.registration=null)}catch(e){console.error("Service Worker unregistration failed:",e)}})}isUpdateAvailable(){return this.updateAvailable}isOfflineReady(){return this.registration!==null&&this.registration.active!==null}}const Ki=new qi;function Gi(){return f(this,arguments,function*(o={}){window.addEventListener("load",()=>{Ki.register(o)})})}const Wi={color:"rgba(255, 255, 255, 0.6)",duration:700,opacity:.6,centered:!1,disabled:!1};function Qi(o,e,t={}){const s=C(C({},Wi),t);if(s.disabled)return;o.classList.contains("ripple-container")||o.classList.add("ripple-container");const i=document.createElement("span");i.classList.add("ripple");const n=o.getBoundingClientRect(),r=Math.max(n.width,n.height),d=r/2;let u,m;if(s.centered)u=n.width/2,m=n.height/2;else{const E="touches"in e?e.touches[0].clientX:e.clientX,S="touches"in e?e.touches[0].clientY:e.clientY;u=E-n.left,m=S-n.top}Object.assign(i.style,{width:`${r}px`,height:`${r}px`,left:`${u-d}px`,top:`${m-d}px`,backgroundColor:s.color,opacity:s.opacity.toString(),animationDuration:`${s.duration}ms`}),o.appendChild(i);const h=()=>{i.parentNode&&i.parentNode.removeChild(i)};i.addEventListener("animationend",h),setTimeout(h,s.duration+100)}function Ji(o,e={}){const t=s=>{Qi(o,s,e)};return o.addEventListener("mousedown",t),o.addEventListener("touchstart",t,{passive:!0}),()=>{o.removeEventListener("mousedown",t),o.removeEventListener("touchstart",t)}}function Yi(){const o=()=>{document.querySelectorAll(".ripple-container").forEach(s=>{const i=s;i._hasRipple||(Ji(i),i._hasRipple=!0)})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",o):o();const e=new MutationObserver(t=>{let s=!1;t.forEach(i=>{i.type==="childList"&&i.addedNodes.forEach(n=>{var r,d;if(n.nodeType===Node.ELEMENT_NODE){const u=n;((r=u.classList)!=null&&r.contains("ripple-container")||((d=u.querySelectorAll)==null?void 0:d.call(u,".ripple-container").length)>0)&&(s=!0)}})}),s&&setTimeout(o,0)});return e.observe(document.body,{childList:!0,subtree:!0}),()=>{e.disconnect()}}const ce=Xe(wi);ce.use(xe);ce.use(ji,{enableLogging:!0,enableReporting:!0,enableRecovery:!0,enableUserNotifications:!0,logToConsole:!1,reportToServer:!0,maxErrorsPerMinute:20,environment:"production",buildVersion:void 0,reportEndpoint:void 0,reportApiKey:void 0,onError:o=>{console.log("[App] Error reported:",o.message)},onRecovery:(o,e)=>{console.log(`[App] Recovery ${o?"succeeded":"failed"}${e?` using ${e}`:""}`)},onAlert:(o,e)=>{console.warn(`[App] Alert: ${o}`,e)}});function Xi(){return f(this,null,function*(){try{yield Ue(),console.log("🛡️ セキュリティシステムが正常に初期化されました"),ce.mount("#app")}catch(o){console.error("アプリケーション初期化に失敗しました:",o),P.reportError(o,{component:"app-initialization"},"system"),console.warn("⚠️ セキュリティシステムなしでアプリケーションを起動します"),ce.mount("#app")}})}Xi();Yi();Gi({onSuccess:o=>{console.log("PWA: Service Worker 登録成功",o)},onUpdate:o=>{console.log("PWA: 新しいバージョンが利用可能です",o)},onOffline:()=>{console.log("PWA: オフラインモード")},onOnline:()=>{console.log("PWA: オンラインに復帰")},onError:o=>{console.error("PWA: Service Worker エラー",o),P.reportError(o,{component:"service-worker"},"system")}});export{he as _};
//# sourceMappingURL=index-CsX-0awL.js.map
