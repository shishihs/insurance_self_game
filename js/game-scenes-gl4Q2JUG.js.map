{"version":3,"file":"game-scenes-gl4Q2JUG.js","sources":["../../src/game/scenes/BaseScene.ts","../../src/game/scenes/PreloadScene.ts","../../src/game/scenes/MainMenuScene.ts","../../src/game/scenes/GameSceneOptimized.ts","../../src/game/scenes/GameScene.ts"],"sourcesContent":["import { Scene } from 'phaser'\r\nimport type { Card } from '@/domain/entities/Card'\r\nimport { GAME_CONSTANTS } from '../config/gameConfig'\r\n\r\n/**\r\n * ã™ã¹ã¦ã®ã‚·ãƒ¼ãƒ³ã®åŸºåº•ã‚¯ãƒ©ã‚¹\r\n */\r\nexport abstract class BaseScene extends Scene {\r\n  protected centerX!: number\r\n  protected centerY!: number\r\n  protected gameWidth!: number\r\n  protected gameHeight!: number\r\n\r\n  create(): void {\r\n    // ç”»é¢ã‚µã‚¤ã‚ºã®å–å¾—\r\n    this.gameWidth = this.cameras.main.width\r\n    this.gameHeight = this.cameras.main.height\r\n    this.centerX = this.gameWidth / 2\r\n    this.centerY = this.gameHeight / 2\r\n\r\n    // å„ã‚·ãƒ¼ãƒ³ã®åˆæœŸåŒ–\r\n    this.initialize()\r\n  }\r\n\r\n  /**\r\n   * å„ã‚·ãƒ¼ãƒ³ã§å®Ÿè£…ã™ã‚‹åˆæœŸåŒ–å‡¦ç†\r\n   */\r\n  protected abstract initialize(): void\r\n\r\n  /**\r\n   * æ¯ãƒ•ãƒ¬ãƒ¼ãƒ å®Ÿè¡Œã•ã‚Œã‚‹æ›´æ–°å‡¦ç†ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰\r\n   */\r\n  update(time: number, delta: number): void {\r\n    // ã‚µãƒ–ã‚¯ãƒ©ã‚¹ã§ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰å¯èƒ½\r\n  }\r\n\r\n  /**\r\n   * ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³åŠ¹æœ\r\n   */\r\n  protected fadeIn(duration: number = 500): void {\r\n    this.cameras.main.fadeIn(duration, 0, 0, 0)\r\n  }\r\n\r\n  /**\r\n   * ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆåŠ¹æœ\r\n   */\r\n  protected fadeOut(duration: number = 500, callback?: () => void): void {\r\n    this.cameras.main.fadeOut(duration, 0, 0, 0)\r\n    \r\n    if (callback) {\r\n      this.cameras.main.once('camerafadeoutcomplete', callback)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ãƒ†ã‚­ã‚¹ãƒˆã‚¹ã‚¿ã‚¤ãƒ«ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®š\r\n   */\r\n  protected getTextStyle(size: number = 24): Phaser.Types.GameObjects.Text.TextStyle {\r\n    return {\r\n      fontFamily: 'Noto Sans JP',\r\n      fontSize: `${size}px`,\r\n      color: '#333333'\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ãƒœã‚¿ãƒ³ã‚’ä½œæˆ\r\n   */\r\n  protected createButton(\r\n    x: number,\r\n    y: number,\r\n    text: string,\r\n    onClick: () => void,\r\n    style?: Phaser.Types.GameObjects.Text.TextStyle\r\n  ): Phaser.GameObjects.Text {\r\n    const button = this.add.text(x, y, text, style || this.getTextStyle())\r\n      .setOrigin(0.5)\r\n      .setInteractive({ useHandCursor: true })\r\n      .setPadding(20, 10)\r\n      .setBackgroundColor('#4C6EF5')\r\n      .setColor('#ffffff')\r\n\r\n    // ãƒ›ãƒãƒ¼åŠ¹æœ\r\n    button.on('pointerover', () => {\r\n      button.setBackgroundColor('#364FC7')\r\n      button.setScale(1.05)\r\n    })\r\n\r\n    button.on('pointerout', () => {\r\n      button.setBackgroundColor('#4C6EF5')\r\n      button.setScale(1)\r\n    })\r\n\r\n    button.on('pointerdown', () => {\r\n      button.setScale(0.95)\r\n    })\r\n\r\n    button.on('pointerup', () => {\r\n      button.setScale(1.05)\r\n      onClick()\r\n    })\r\n\r\n    return button\r\n  }\r\n\r\n  /**\r\n   * ã‚³ãƒ³ãƒ†ãƒŠãƒœã‚¿ãƒ³ã‚’ä½œæˆï¼ˆã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚¹èƒŒæ™¯ä»˜ãï¼‰\r\n   */\r\n  protected createContainerButton(\r\n    x: number,\r\n    y: number,\r\n    text: string,\r\n    onClick: () => void,\r\n    style?: Phaser.Types.GameObjects.Text.TextStyle\r\n  ): Phaser.GameObjects.Container {\r\n    const container = this.add.container(x, y)\r\n    \r\n    // èƒŒæ™¯\r\n    const bg = this.add.graphics()\r\n    bg.fillStyle(0x4C6EF5, 1)\r\n    bg.fillRoundedRect(-80, -20, 160, 40, 8)\r\n    \r\n    // ãƒ†ã‚­ã‚¹ãƒˆ\r\n    const buttonText = this.add.text(0, 0, text, style || this.getTextStyle())\r\n      .setOrigin(0.5)\r\n    \r\n    container.add([bg, buttonText])\r\n    container.setSize(160, 40)\r\n    container.setInteractive({ useHandCursor: true })\r\n    \r\n    // ãƒ›ãƒãƒ¼åŠ¹æœ\r\n    container.on('pointerover', () => {\r\n      bg.clear()\r\n      bg.fillStyle(0x364FC7, 1)\r\n      bg.fillRoundedRect(-80, -20, 160, 40, 8)\r\n      container.setScale(1.05)\r\n    })\r\n    \r\n    container.on('pointerout', () => {\r\n      bg.clear()\r\n      bg.fillStyle(0x4C6EF5, 1)\r\n      bg.fillRoundedRect(-80, -20, 160, 40, 8)\r\n      container.setScale(1)\r\n    })\r\n    \r\n    container.on('pointerdown', () => {\r\n      container.setScale(0.95)\r\n    })\r\n    \r\n    container.on('pointerup', () => {\r\n      container.setScale(1.05)\r\n      onClick()\r\n    })\r\n    \r\n    return container\r\n  }\r\n\r\n  /**\r\n   * ã‚«ãƒ¼ãƒ‰ã‚³ãƒ³ãƒ†ãƒŠã‚’ä½œæˆï¼ˆæ”¹å–„ã•ã‚ŒãŸãƒ‡ã‚¶ã‚¤ãƒ³ï¼‰\r\n   */\r\n  protected createCardContainer(card: Card, x: number, y: number): Phaser.GameObjects.Container {\r\n    const container = this.add.container(x, y)\r\n    \r\n    // ã‚«ãƒ¼ãƒ‰ã®ã‚µã‚¤ã‚º\r\n    const cardWidth = GAME_CONSTANTS.CARD_WIDTH\r\n    const cardHeight = GAME_CONSTANTS.CARD_HEIGHT\r\n    \r\n    // èƒŒæ™¯ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚¹\r\n    const cardBg = this.add.graphics()\r\n    \r\n    // ä¿é™ºã‚«ãƒ¼ãƒ‰ã‹ã©ã†ã‹ã§èƒŒæ™¯ã‚’å¤‰ãˆã‚‹\r\n    const isInsuranceCard = card.cardType === 'insurance'\r\n    \r\n    if (isInsuranceCard) {\r\n      // ä¿é™ºã‚«ãƒ¼ãƒ‰ï¼šã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³èƒŒæ™¯ + ç‰¹åˆ¥ãªãƒœãƒ¼ãƒ€ãƒ¼\r\n      // å¤–å´ã®ã‚°ãƒ­ãƒ¼åŠ¹æœ\r\n      cardBg.fillStyle(0x818CF8, 0.3)\r\n      cardBg.fillRoundedRect(-cardWidth/2 - 4, -cardHeight/2 - 4, cardWidth + 8, cardHeight + 8, 14)\r\n      \r\n      // ãƒ¡ã‚¤ãƒ³ã‚«ãƒ¼ãƒ‰èƒŒæ™¯ï¼ˆã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³é¢¨ï¼‰\r\n      const gradient = this.add.graphics()\r\n      gradient.fillStyle(0x6366F1, 1)\r\n      gradient.fillRoundedRect(-cardWidth/2, -cardHeight/2, cardWidth, cardHeight, 12)\r\n      \r\n      // å…‰æ²¢åŠ¹æœ\r\n      const gloss = this.add.graphics()\r\n      gloss.fillStyle(0xFFFFFF, 0.15)\r\n      gloss.fillRoundedRect(-cardWidth/2, -cardHeight/2, cardWidth, cardHeight/2, 12)\r\n      \r\n      // è£…é£¾çš„ãªãƒ‘ã‚¿ãƒ¼ãƒ³\r\n      const pattern = this.add.graphics()\r\n      pattern.lineStyle(1, 0xFFFFFF, 0.1)\r\n      for (let i = 0; i < 5; i++) {\r\n        pattern.beginPath()\r\n        pattern.arc(-cardWidth/2 + 20 + i * 30, -cardHeight/2 + 20, 15, 0, Math.PI * 2)\r\n        pattern.strokePath()\r\n      }\r\n      \r\n      container.add([cardBg, gradient, gloss, pattern])\r\n    } else {\r\n      // é€šå¸¸ã‚«ãƒ¼ãƒ‰ï¼šã‚·ãƒ³ãƒ—ãƒ«ãªèƒŒæ™¯\r\n      cardBg.fillStyle(0xFFFFFF, 0.95)\r\n      cardBg.fillRoundedRect(-cardWidth/2, -cardHeight/2, cardWidth, cardHeight, 12)\r\n      \r\n      // è–„ã„ãƒœãƒ¼ãƒ€ãƒ¼\r\n      cardBg.lineStyle(2, 0xE5E7EB, 1)\r\n      cardBg.strokeRoundedRect(-cardWidth/2, -cardHeight/2, cardWidth, cardHeight, 12)\r\n      \r\n      container.add(cardBg)\r\n    }\r\n    \r\n    // ã‚«ãƒ¼ãƒ‰ã®ç¨®é¡ã‚¢ã‚¤ã‚³ãƒ³\r\n    let typeIcon = 'ğŸ¯'\r\n    let iconBgColor = 0x64748B\r\n    \r\n    switch (card.cardType) {\r\n      case 'insurance':\r\n        typeIcon = 'ğŸ›¡ï¸'\r\n        iconBgColor = 0x6366F1\r\n        break\r\n      case 'lifeEvent':\r\n        typeIcon = card.power > 0 ? 'âœ¨' : 'âš¡'\r\n        iconBgColor = card.power > 0 ? 0x10B981 : 0xF59E0B\r\n        break\r\n      case 'chance':\r\n        typeIcon = 'ğŸ²'\r\n        iconBgColor = 0x8B5CF6\r\n        break\r\n      case 'special':\r\n        typeIcon = 'â­'\r\n        iconBgColor = 0xF59E0B\r\n        break\r\n    }\r\n    \r\n    // ã‚¢ã‚¤ã‚³ãƒ³èƒŒæ™¯\r\n    const iconBg = this.add.graphics()\r\n    iconBg.fillStyle(iconBgColor, isInsuranceCard ? 0.3 : 0.15)\r\n    iconBg.fillCircle(-cardWidth/2 + 25, -cardHeight/2 + 25, 20)\r\n    \r\n    // ã‚«ãƒ¼ãƒ‰ã‚¢ã‚¤ã‚³ãƒ³\r\n    const icon = this.add.text(-cardWidth/2 + 25, -cardHeight/2 + 25, typeIcon, {\r\n      fontFamily: 'Arial',\r\n      fontSize: '20px'\r\n    }).setOrigin(0.5)\r\n    \r\n    // ã‚«ãƒ¼ãƒ‰å\r\n    const cardName = this.add.text(0, -cardHeight/2 + 30, card.name, {\r\n      fontFamily: 'Noto Sans JP',\r\n      fontSize: '16px',\r\n      fontStyle: 'bold',\r\n      color: isInsuranceCard ? '#FFFFFF' : '#1F2937',\r\n      align: 'center',\r\n      wordWrap: { width: cardWidth - 20 }\r\n    }).setOrigin(0.5, 0)\r\n    \r\n    // ã‚«ãƒ¼ãƒ‰èª¬æ˜\r\n    const description = this.add.text(0, -10, card.description, {\r\n      fontFamily: 'Noto Sans JP',\r\n      fontSize: '12px',\r\n      color: isInsuranceCard ? '#E0E7FF' : '#6B7280',\r\n      align: 'center',\r\n      wordWrap: { width: cardWidth - 30 },\r\n      lineSpacing: 4\r\n    }).setOrigin(0.5)\r\n    \r\n    // ãƒ‘ãƒ¯ãƒ¼è¡¨ç¤ºï¼ˆä¿é™ºã‚«ãƒ¼ãƒ‰ä»¥å¤–ï¼‰\r\n    if (!isInsuranceCard && card.power !== 0) {\r\n      const powerBg = this.add.graphics()\r\n      const powerColor = card.power > 0 ? 0x10B981 : 0xEF4444\r\n      powerBg.fillStyle(powerColor, 1)\r\n      powerBg.fillCircle(cardWidth/2 - 25, cardHeight/2 - 25, 18)\r\n      \r\n      const powerText = this.add.text(\r\n        cardWidth/2 - 25,\r\n        cardHeight/2 - 25,\r\n        `${card.power > 0 ? '+' : ''}${card.power}`,\r\n        {\r\n          fontFamily: 'Arial',\r\n          fontSize: '14px',\r\n          fontStyle: 'bold',\r\n          color: '#FFFFFF'\r\n        }\r\n      ).setOrigin(0.5)\r\n      \r\n      container.add([powerBg, powerText])\r\n    }\r\n    \r\n    // ä¿é™ºã‚«ãƒ¼ãƒ‰ã®è¿½åŠ æƒ…å ±\r\n    if (isInsuranceCard) {\r\n      // ä¿é™ºã®ç¨®é¡ãƒ©ãƒ™ãƒ«\r\n      const insuranceType = card.insuranceType === 'whole_life' ? 'çµ‚èº«ä¿é™º' : 'å®šæœŸä¿é™º'\r\n      const typeBg = this.add.graphics()\r\n      typeBg.fillStyle(0xFFFFFF, 0.2)\r\n      typeBg.fillRoundedRect(-50, cardHeight/2 - 35, 100, 20, 10)\r\n      \r\n      const typeText = this.add.text(0, cardHeight/2 - 25, insuranceType, {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '11px',\r\n        fontStyle: 'bold',\r\n        color: '#FFFFFF'\r\n      }).setOrigin(0.5)\r\n      \r\n      container.add([typeBg, typeText])\r\n    }\r\n    \r\n    container.add([iconBg, icon, cardName, description])\r\n    \r\n    // ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–è¨­å®š\r\n    container.setSize(cardWidth, cardHeight)\r\n    container.setInteractive({ useHandCursor: true })\r\n    container.setData('card', card)\r\n    container.setData('originalX', x)\r\n    container.setData('originalY', y)\r\n    \r\n    // ãƒ›ãƒãƒ¼åŠ¹æœ\r\n    container.on('pointerover', () => {\r\n      this.tweens.add({\r\n        targets: container,\r\n        scaleX: 1.05,\r\n        scaleY: 1.05,\r\n        duration: 200,\r\n        ease: 'Power2'\r\n      })\r\n      \r\n      // ä¿é™ºã‚«ãƒ¼ãƒ‰ã¯ç‰¹åˆ¥ãªè¼ãåŠ¹æœ\r\n      if (isInsuranceCard) {\r\n        const glow = this.add.graphics()\r\n        glow.lineStyle(4, 0x818CF8, 0.6)\r\n        glow.strokeRoundedRect(-cardWidth/2 - 2, -cardHeight/2 - 2, cardWidth + 4, cardHeight + 4, 12)\r\n        container.add(glow)\r\n        container.setData('glowEffect', glow)\r\n        \r\n        this.tweens.add({\r\n          targets: glow,\r\n          alpha: 0.3,\r\n          duration: 500,\r\n          yoyo: true,\r\n          repeat: -1\r\n        })\r\n      }\r\n    })\r\n    \r\n    container.on('pointerout', () => {\r\n      this.tweens.add({\r\n        targets: container,\r\n        scaleX: 1,\r\n        scaleY: 1,\r\n        duration: 200,\r\n        ease: 'Power2'\r\n      })\r\n      \r\n      // ã‚°ãƒ­ãƒ¼åŠ¹æœã‚’å‰Šé™¤\r\n      const glow = container.getData('glowEffect')\r\n      if (glow) {\r\n        glow.destroy()\r\n        container.setData('glowEffect', null)\r\n      }\r\n    })\r\n    \r\n    return container\r\n  }\r\n}","import { BaseScene } from './BaseScene'\r\n\r\n/**\r\n * ã‚¢ã‚»ãƒƒãƒˆã‚’ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã‚·ãƒ¼ãƒ³\r\n */\r\nexport class PreloadScene extends BaseScene {\r\n  constructor() {\r\n    super({ key: 'PreloadScene' })\r\n  }\r\n\r\n  preload(): void {\r\n    // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒãƒ¼ã®ä½œæˆ\r\n    const progressBar = this.add.graphics()\r\n    const progressBox = this.add.graphics()\r\n    progressBox.fillStyle(0x222222, 0.8)\r\n    progressBox.fillRect(240, 270, 320, 50)\r\n\r\n    const loadingText = this.add.text(\r\n      this.cameras.main.centerX,\r\n      this.cameras.main.centerY - 50,\r\n      'Loading...',\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '20px',\r\n        color: '#ffffff'\r\n      }\r\n    ).setOrigin(0.5)\r\n\r\n    const percentText = this.add.text(\r\n      this.cameras.main.centerX,\r\n      this.cameras.main.centerY - 5,\r\n      '0%',\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '18px',\r\n        color: '#ffffff'\r\n      }\r\n    ).setOrigin(0.5)\r\n\r\n    // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°é€²æ—ã®æ›´æ–°\r\n    this.load.on('progress', (value: number) => {\r\n      percentText.setText(`${Math.round(value * 100)}%`)\r\n      progressBar.clear()\r\n      progressBar.fillStyle(0xffffff, 1)\r\n      progressBar.fillRect(250, 280, 300 * value, 30)\r\n    })\r\n\r\n    // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°å®Œäº†\r\n    this.load.on('complete', () => {\r\n      progressBar.destroy()\r\n      progressBox.destroy()\r\n      loadingText.destroy()\r\n      percentText.destroy()\r\n    })\r\n\r\n    // ã‚¢ã‚»ãƒƒãƒˆã®ãƒ­ãƒ¼ãƒ‰\r\n    this.loadAssets()\r\n  }\r\n\r\n  /**\r\n   * ã‚¢ã‚»ãƒƒãƒˆã‚’ãƒ­ãƒ¼ãƒ‰\r\n   */\r\n  private loadAssets(): void {\r\n    // ã‚«ãƒ¼ãƒ‰è£é¢\r\n    this.createCardBack()\r\n    \r\n    // ã‚«ãƒ¼ãƒ‰è¡¨é¢ï¼ˆä»®ã®ç”»åƒã‚’ç”Ÿæˆï¼‰\r\n    this.createCardFaces()\r\n    \r\n    // UIè¦ç´ \r\n    this.createUIAssets()\r\n  }\r\n\r\n  /**\r\n   * ã‚«ãƒ¼ãƒ‰è£é¢ã‚’å‹•çš„ã«ç”Ÿæˆ\r\n   */\r\n  private createCardBack(): void {\r\n    const graphics = this.add.graphics()\r\n    \r\n    // ã‚«ãƒ¼ãƒ‰èƒŒæ™¯\r\n    graphics.fillStyle(0x2C3E50, 1)\r\n    graphics.fillRoundedRect(0, 0, 120, 180, 8)\r\n    \r\n    // ãƒ‘ã‚¿ãƒ¼ãƒ³\r\n    graphics.lineStyle(2, 0x34495E)\r\n    for (let i = 10; i < 110; i += 20) {\r\n      for (let j = 10; j < 170; j += 20) {\r\n        graphics.strokeCircle(i, j, 8)\r\n      }\r\n    }\r\n    \r\n    // ãƒ†ã‚¯ã‚¹ãƒãƒ£ã¨ã—ã¦ä¿å­˜\r\n    graphics.generateTexture('card-back', 120, 180)\r\n    graphics.destroy()\r\n  }\r\n\r\n  /**\r\n   * ã‚«ãƒ¼ãƒ‰è¡¨é¢ã‚’å‹•çš„ã«ç”Ÿæˆ\r\n   */\r\n  private createCardFaces(): void {\r\n    // äººç”Ÿã‚«ãƒ¼ãƒ‰\r\n    this.createCardFace('life-card-template', 0x4C6EF5)\r\n    \r\n    // ä¿é™ºã‚«ãƒ¼ãƒ‰\r\n    this.createCardFace('insurance-card-template', 0x51CF66)\r\n    \r\n    // è½ã¨ã—ç©´ã‚«ãƒ¼ãƒ‰\r\n    this.createCardFace('pitfall-card-template', 0xFF6B6B)\r\n  }\r\n\r\n  /**\r\n   * ã‚«ãƒ¼ãƒ‰ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½œæˆ\r\n   */\r\n  private createCardFace(key: string, color: number): void {\r\n    const graphics = this.add.graphics()\r\n    \r\n    // ã‚«ãƒ¼ãƒ‰èƒŒæ™¯\r\n    graphics.fillStyle(color, 1)\r\n    graphics.fillRoundedRect(0, 0, 120, 180, 8)\r\n    \r\n    // ç™½ã„å†…å´ã®æ \r\n    graphics.fillStyle(0xFFFFFF, 1)\r\n    graphics.fillRoundedRect(5, 5, 110, 170, 6)\r\n    \r\n    // ä¸Šéƒ¨ã®ã‚«ãƒ©ãƒ¼ãƒãƒ¼\r\n    graphics.fillStyle(color, 1)\r\n    graphics.fillRect(5, 5, 110, 30)\r\n    \r\n    // ãƒ†ã‚¯ã‚¹ãƒãƒ£ã¨ã—ã¦ä¿å­˜\r\n    graphics.generateTexture(key, 120, 180)\r\n    graphics.destroy()\r\n  }\r\n\r\n  /**\r\n   * UIè¦ç´ ã‚’ä½œæˆ\r\n   */\r\n  private createUIAssets(): void {\r\n    // ãƒœã‚¿ãƒ³èƒŒæ™¯\r\n    const buttonGraphics = this.add.graphics()\r\n    buttonGraphics.fillStyle(0x4C6EF5, 1)\r\n    buttonGraphics.fillRoundedRect(0, 0, 200, 50, 25)\r\n    buttonGraphics.generateTexture('button-bg', 200, 50)\r\n    buttonGraphics.destroy()\r\n    \r\n    // ãƒã‚¤ãƒ©ã‚¤ãƒˆ\r\n    const highlightGraphics = this.add.graphics()\r\n    highlightGraphics.lineStyle(4, 0xFFD43B, 1)\r\n    highlightGraphics.strokeRoundedRect(0, 0, 130, 190, 8)\r\n    highlightGraphics.generateTexture('card-highlight', 130, 190)\r\n    highlightGraphics.destroy()\r\n  }\r\n\r\n  protected initialize(): void {\r\n    // ãƒ—ãƒªãƒ­ãƒ¼ãƒ‰å®Œäº†å¾Œã€ãƒ¡ã‚¤ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¸é·ç§»\r\n    this.scene.start('MainMenuScene')\r\n  }\r\n}","import { BaseScene } from './BaseScene'\r\n\r\n/**\r\n * ãƒ¡ã‚¤ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚·ãƒ¼ãƒ³\r\n */\r\nexport class MainMenuScene extends BaseScene {\r\n  constructor() {\r\n    super({ key: 'MainMenuScene' })\r\n  }\r\n\r\n  protected initialize(): void {\r\n    // ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³\r\n    this.fadeIn()\r\n\r\n    // ã‚¿ã‚¤ãƒˆãƒ«\r\n    this.add.text(\r\n      this.centerX,\r\n      100,\r\n      'äººç”Ÿå……å®Ÿã‚²ãƒ¼ãƒ ',\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '48px',\r\n        color: '#333333',\r\n        fontStyle: 'bold'\r\n      }\r\n    ).setOrigin(0.5)\r\n\r\n    // ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«\r\n    this.add.text(\r\n      this.centerX,\r\n      160,\r\n      'Life Fulfillment - ç”Ÿå‘½ä¿é™ºã‚’ã€Œäººç”Ÿã®å‘³æ–¹ã€ã¨ã—ã¦æã',\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '18px',\r\n        color: '#666666'\r\n      }\r\n    ).setOrigin(0.5)\r\n\r\n    // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒœã‚¿ãƒ³\r\n    this.createMenuButtons()\r\n\r\n    // ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±\r\n    this.add.text(\r\n      10,\r\n      this.gameHeight - 30,\r\n      'v0.0.1 - Phase 1 Development',\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '14px',\r\n        color: '#999999'\r\n      }\r\n    )\r\n  }\r\n\r\n  /**\r\n   * ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒœã‚¿ãƒ³ã‚’ä½œæˆ\r\n   */\r\n  private createMenuButtons(): void {\r\n    const buttonY = 300\r\n    const buttonSpacing = 80\r\n\r\n    // ã‚²ãƒ¼ãƒ é–‹å§‹ãƒœã‚¿ãƒ³\r\n    this.createButton(\r\n      this.centerX,\r\n      buttonY,\r\n      'ã‚²ãƒ¼ãƒ ã‚’å§‹ã‚ã‚‹',\r\n      () => this.startGame(),\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '24px',\r\n        color: '#ffffff'\r\n      }\r\n    )\r\n\r\n    // ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ãƒœã‚¿ãƒ³\r\n    this.createButton(\r\n      this.centerX,\r\n      buttonY + buttonSpacing,\r\n      'ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«',\r\n      () => this.startTutorial(),\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '24px',\r\n        color: '#ffffff'\r\n      }\r\n    )\r\n\r\n    // è¨­å®šãƒœã‚¿ãƒ³\r\n    this.createButton(\r\n      this.centerX,\r\n      buttonY + buttonSpacing * 2,\r\n      'è¨­å®š',\r\n      () => this.openSettings(),\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '24px',\r\n        color: '#ffffff'\r\n      }\r\n    )\r\n\r\n    // ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆãƒœã‚¿ãƒ³\r\n    this.createButton(\r\n      this.centerX,\r\n      buttonY + buttonSpacing * 3,\r\n      'ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆ',\r\n      () => this.showCredits(),\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '24px',\r\n        color: '#ffffff'\r\n      }\r\n    )\r\n  }\r\n\r\n  /**\r\n   * ã‚²ãƒ¼ãƒ é–‹å§‹\r\n   */\r\n  private startGame(): void {\r\n    this.fadeOut(500, () => {\r\n      this.scene.start('GameScene')\r\n    })\r\n  }\r\n\r\n  /**\r\n   * ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«é–‹å§‹\r\n   */\r\n  private startTutorial(): void {\r\n    this.fadeOut(500, () => {\r\n      // GameSceneã‚’é–‹å§‹ã—ã¦ã™ãã«ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’å®Ÿè¡Œ\r\n      this.scene.start('GameScene', { startTutorial: true })\r\n    })\r\n  }\r\n\r\n  /**\r\n   * è¨­å®šç”»é¢ã‚’é–‹ã\r\n   */\r\n  private openSettings(): void {\r\n    // è¨­å®šæ©Ÿèƒ½ã¯å°†æ¥ã®ãƒªãƒªãƒ¼ã‚¹ã§å®Ÿè£…äºˆå®š\r\n    // - éŸ³é‡è¨­å®š\r\n    // - ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯å“è³ªè¨­å®š\r\n    // - ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆè¨­å®š\r\n    this.showNotification('è¨­å®šæ©Ÿèƒ½ã¯é–‹ç™ºä¸­ã§ã™', 'info')\r\n  }\r\n\r\n  /**\r\n   * ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆè¡¨ç¤º\r\n   */\r\n  private showCredits(): void {\r\n    // ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚’ä½œæˆ\r\n    const overlay = this.add.graphics()\r\n    overlay.fillStyle(0x000000, 0.8)\r\n    overlay.fillRect(0, 0, this.gameWidth, this.gameHeight)\r\n\r\n    const creditContainer = this.add.container(this.centerX, this.centerY)\r\n\r\n    // ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆãƒ†ã‚­ã‚¹ãƒˆ\r\n    const creditText = this.add.text(\r\n      0,\r\n      -100,\r\n      'äººç”Ÿå……å®Ÿã‚²ãƒ¼ãƒ \\n\\né–‹ç™º: Claude Code & You\\n\\nPhase 1 - ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—é–‹ç™ºä¸­\\n\\nã”æœŸå¾…ãã ã•ã„ï¼',\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '20px',\r\n        color: '#ffffff',\r\n        align: 'center',\r\n        lineSpacing: 10\r\n      }\r\n    ).setOrigin(0.5)\r\n\r\n    // é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³\r\n    const closeButton = this.createButton(\r\n      0,\r\n      100,\r\n      'é–‰ã˜ã‚‹',\r\n      () => {\r\n        creditContainer.destroy()\r\n        overlay.destroy()\r\n      },\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '20px',\r\n        color: '#ffffff'\r\n      }\r\n    )\r\n\r\n    creditContainer.add([creditText, closeButton])\r\n\r\n    // ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³åŠ¹æœ\r\n    creditContainer.setAlpha(0)\r\n    this.tweens.add({\r\n      targets: creditContainer,\r\n      alpha: 1,\r\n      duration: 300\r\n    })\r\n  }\r\n}","import { BaseScene } from './BaseScene'\r\n\r\n/**\r\n * ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ã•ã‚ŒãŸã‚²ãƒ¼ãƒ ã‚·ãƒ¼ãƒ³ç”¨ã®mixin\r\n */\r\nexport const GameSceneOptimizationMixin = {\r\n  /**\r\n   * ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–: æ›´æ–°å‡¦ç†ã®ã‚¹ãƒ­ãƒƒãƒˆãƒªãƒ³ã‚°\r\n   */\r\n  setupPerformanceOptimizations(this: any): void {\r\n    // ãƒ•ãƒ¬ãƒ¼ãƒ ã‚¹ã‚­ãƒƒãƒ—ã®è¨­å®š\r\n    this.frameSkipCounter = 0\r\n    this.frameSkipThreshold = 2 // 2ãƒ•ãƒ¬ãƒ¼ãƒ ã«1å›æ›´æ–°\r\n    \r\n    // ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ—ãƒ¼ãƒªãƒ³ã‚°\r\n    this.objectPools = {\r\n      effects: [],\r\n      texts: [],\r\n      graphics: []\r\n    }\r\n    \r\n    // ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æœ€é©åŒ–\r\n    this.cameras.main.setRoundPixels(true)\r\n    \r\n    // ãƒãƒƒãƒå‡¦ç†ã®æœ‰åŠ¹åŒ–\r\n    this.game.renderer.setMaxTextures(16)\r\n  },\r\n\r\n  /**\r\n   * ã‚¹ãƒ­ãƒƒãƒˆãƒ«ä»˜ãUIæ›´æ–°\r\n   */\r\n  throttledUIUpdate(this: any, deltaTime: number): void {\r\n    // ãƒ•ãƒ¬ãƒ¼ãƒ ã‚¹ã‚­ãƒƒãƒ—\r\n    this.frameSkipCounter++\r\n    if (this.frameSkipCounter < this.frameSkipThreshold) {\r\n      return\r\n    }\r\n    this.frameSkipCounter = 0\r\n    \r\n    // ãƒ€ãƒ¼ãƒ†ã‚£ãƒ•ãƒ©ã‚°ã«åŸºã¥ãé¸æŠçš„æ›´æ–°\r\n    if (this.dirtyFlags.vitality && this.updateThrottleTimers.vitality <= 0) {\r\n      this.updateVitalityBar()\r\n      this.updateThrottleTimers.vitality = 100 // 100msé–“éš”\r\n      this.dirtyFlags.vitality = false\r\n    }\r\n    \r\n    if (this.dirtyFlags.insurance && this.updateThrottleTimers.insurance <= 0) {\r\n      this.updateInsuranceList()\r\n      this.updateThrottleTimers.insurance = 200 // 200msé–“éš”\r\n      this.dirtyFlags.insurance = false\r\n    }\r\n    \r\n    if (this.dirtyFlags.burden && this.updateThrottleTimers.burden <= 0) {\r\n      this.updateBurdenIndicator()\r\n      this.updateThrottleTimers.burden = 150 // 150msé–“éš”\r\n      this.dirtyFlags.burden = false\r\n    }\r\n    \r\n    // ã‚¿ã‚¤ãƒãƒ¼ã‚’æ¸›ã‚‰ã™\r\n    Object.keys(this.updateThrottleTimers).forEach(key => {\r\n      if (this.updateThrottleTimers[key] > 0) {\r\n        this.updateThrottleTimers[key] -= deltaTime\r\n      }\r\n    })\r\n  },\r\n\r\n  /**\r\n   * ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ—ãƒ¼ãƒ«ã‹ã‚‰ã®å–å¾—\r\n   */\r\n  getFromPool(this: any, type: string): any {\r\n    const pool = this.objectPools[type]\r\n    if (pool && pool.length > 0) {\r\n      return pool.pop()\r\n    }\r\n    return null\r\n  },\r\n\r\n  /**\r\n   * ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ—ãƒ¼ãƒ«ã¸ã®è¿”å´\r\n   */\r\n  returnToPool(this: any, type: string, object: any): void {\r\n    const pool = this.objectPools[type]\r\n    if (pool && pool.length < 50) { // ãƒ—ãƒ¼ãƒ«ã‚µã‚¤ã‚ºåˆ¶é™\r\n      object.setVisible(false)\r\n      object.setActive(false)\r\n      pool.push(object)\r\n    } else {\r\n      object.destroy()\r\n    }\r\n  },\r\n\r\n  /**\r\n   * æœ€é©åŒ–ã•ã‚ŒãŸã‚¨ãƒ•ã‚§ã‚¯ãƒˆç”Ÿæˆ\r\n   */\r\n  createOptimizedEffect(this: any, x: number, y: number, type: string): void {\r\n    let effect = this.getFromPool('effects')\r\n    \r\n    if (!effect) {\r\n      effect = this.add.graphics()\r\n    } else {\r\n      effect.clear()\r\n      effect.setVisible(true)\r\n      effect.setActive(true)\r\n    }\r\n    \r\n    effect.setPosition(x, y)\r\n    effect.setAlpha(1)\r\n    effect.setScale(1)\r\n    \r\n    // ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã®æç”»ï¼ˆtypeã«å¿œã˜ã¦ï¼‰\r\n    switch (type) {\r\n      case 'success':\r\n        effect.fillStyle(0x4ADE80, 0.6)\r\n        effect.fillCircle(0, 0, 20)\r\n        break\r\n      case 'failure':\r\n        effect.lineStyle(4, 0xEF4444, 0.8)\r\n        effect.beginPath()\r\n        effect.moveTo(-15, -15)\r\n        effect.lineTo(15, 15)\r\n        effect.moveTo(15, -15)\r\n        effect.lineTo(-15, 15)\r\n        effect.strokePath()\r\n        break\r\n    }\r\n    \r\n    // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆå®Œäº†å¾Œãƒ—ãƒ¼ãƒ«ã«è¿”å´ï¼‰\r\n    this.tweens.add({\r\n      targets: effect,\r\n      alpha: 0,\r\n      scale: type === 'success' ? 3 : 1,\r\n      duration: 500,\r\n      ease: 'Power2.out',\r\n      onComplete: () => {\r\n        this.returnToPool('effects', effect)\r\n      }\r\n    })\r\n  },\r\n\r\n  /**\r\n   * ãƒãƒƒãƒå‡¦ç†ã«ã‚ˆã‚‹æ‰‹æœ­ã®æ›´æ–°\r\n   */\r\n  batchUpdateHandCards(this: any): void {\r\n    // ä¸€åº¦ã«ã™ã¹ã¦ã®ã‚«ãƒ¼ãƒ‰ã‚’æ›´æ–°\r\n    const updates: Array<{card: any, x: number, y: number}> = []\r\n    \r\n    this.handCards.forEach((cardContainer: any, index: number) => {\r\n      const targetX = this.centerX - ((this.handCards.length - 1) * 60) / 2 + index * 60\r\n      const targetY = this.cameras.main.height - 120\r\n      \r\n      updates.push({\r\n        card: cardContainer,\r\n        x: targetX,\r\n        y: targetY\r\n      })\r\n    })\r\n    \r\n    // ãƒãƒƒãƒã§Tweenå®Ÿè¡Œ\r\n    if (updates.length > 0) {\r\n      this.tweens.add({\r\n        targets: updates.map(u => u.card),\r\n        duration: 300,\r\n        ease: 'Power2.out',\r\n        onUpdate: (tween: any) => {\r\n          const progress = tween.progress\r\n          updates.forEach((update, i) => {\r\n            const target = tween.targets[i]\r\n            if (target) {\r\n              target.x = Phaser.Math.Linear(target.x, update.x, progress)\r\n              target.y = Phaser.Math.Linear(target.y, update.y, progress)\r\n            }\r\n          })\r\n        }\r\n      })\r\n    }\r\n  },\r\n\r\n  /**\r\n   * ãƒ†ã‚¯ã‚¹ãƒãƒ£ã‚¢ãƒˆãƒ©ã‚¹ã®ä½¿ç”¨\r\n   */\r\n  preloadOptimizedAssets(this: any): void {\r\n    // è¤‡æ•°ã®ç”»åƒã‚’1ã¤ã®ã‚¢ãƒˆãƒ©ã‚¹ã«ã¾ã¨ã‚ã‚‹\r\n    this.load.atlas('game-atlas', 'assets/game-atlas.png', 'assets/game-atlas.json')\r\n  },\r\n\r\n  /**\r\n   * ã‚«ãƒ¡ãƒ©ã‚«ãƒªãƒ³ã‚°ã®æœ€é©åŒ–\r\n   */\r\n  setupCameraCulling(this: any): void {\r\n    // ã‚«ãƒ¡ãƒ©ã®å¯è¦–ç¯„å›²å¤–ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è‡ªå‹•çš„ã«éè¡¨ç¤º\r\n    this.cameras.main.setBackgroundColor(0x1a1a1a)\r\n    this.cameras.main.useBounds = true\r\n    \r\n    // ã‚«ãƒªãƒ³ã‚°ã®æœ‰åŠ¹åŒ–\r\n    this.children.list.forEach((child: any) => {\r\n      if (child.setScrollFactor) {\r\n        child.setScrollFactor(1)\r\n      }\r\n    })\r\n  },\r\n\r\n  /**\r\n   * ãƒ¡ãƒ¢ãƒªæœ€é©åŒ–: æœªä½¿ç”¨ãƒªã‚½ãƒ¼ã‚¹ã®è§£æ”¾\r\n   */\r\n  cleanupUnusedResources(this: any): void {\r\n    // ä½¿ç”¨ã•ã‚Œã¦ã„ãªã„ãƒ†ã‚¯ã‚¹ãƒãƒ£ã®è§£æ”¾\r\n    const textureKeys = this.textures.getTextureKeys()\r\n    const usedTextures = new Set<string>()\r\n    \r\n    // ä½¿ç”¨ä¸­ã®ãƒ†ã‚¯ã‚¹ãƒãƒ£ã‚’åé›†\r\n    this.children.list.forEach((child: any) => {\r\n      if (child.texture?.key) {\r\n        usedTextures.add(child.texture.key)\r\n      }\r\n    })\r\n    \r\n    // æœªä½¿ç”¨ã®ãƒ†ã‚¯ã‚¹ãƒãƒ£ã‚’å‰Šé™¤\r\n    textureKeys.forEach(key => {\r\n      if (!usedTextures.has(key) && !['__DEFAULT', '__MISSING', '__WHITE'].includes(key)) {\r\n        try {\r\n          this.textures.remove(key)\r\n        } catch (e) {\r\n          // ã‚¨ãƒ©ãƒ¼ã¯ç„¡è¦–\r\n        }\r\n      }\r\n    })\r\n  },\r\n\r\n  /**\r\n   * æç”»å‘¼ã³å‡ºã—ã®æœ€å°åŒ–\r\n   */\r\n  minimizeDrawCalls(this: any): void {\r\n    // åŒã˜ãƒ†ã‚¯ã‚¹ãƒãƒ£ã‚’ä½¿ç”¨ã™ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚°ãƒ«ãƒ¼ãƒ—åŒ–\r\n    const textureGroups = new Map<string, any[]>()\r\n    \r\n    this.children.list.forEach((child: any) => {\r\n      if (child.texture?.key) {\r\n        const key = child.texture.key\r\n        if (!textureGroups.has(key)) {\r\n          textureGroups.set(key, [])\r\n        }\r\n        textureGroups.get(key)!.push(child)\r\n      }\r\n    })\r\n    \r\n    // ã‚°ãƒ«ãƒ¼ãƒ—ã”ã¨ã«æ·±åº¦ã‚’èª¿æ•´ã—ã¦ãƒãƒƒãƒå‡¦ç†ã‚’ä¿ƒé€²\r\n    let depth = 0\r\n    textureGroups.forEach((group) => {\r\n      group.forEach(child => {\r\n        child.setDepth(depth)\r\n      })\r\n      depth++\r\n    })\r\n  }\r\n}","import { BaseScene } from './BaseScene'\r\nimport { Game } from '@/domain/entities/Game'\r\nimport type { Card } from '@/domain/entities/Card'\r\nimport { CardFactory } from '@/domain/services/CardFactory'\r\nimport { GAME_CONSTANTS } from '../config/gameConfig'\r\nimport type { CardType } from '@/domain/types/card.types'\r\nimport type { ChallengeResult } from '@/domain/types/game.types'\r\nimport { AGE_PARAMETERS } from '@/domain/types/game.types'\r\nimport { TutorialManager } from '../systems/TutorialManager'\r\nimport { TutorialOverlay } from '../ui/TutorialOverlay'\r\nimport type { TutorialConfig, TutorialStep } from '@/domain/types/tutorial.types'\r\nimport { setupGlobalTutorialTests } from '../tutorial/TutorialTestHelper'\r\nimport { INTERACTIVE_GAME_TUTORIAL } from '../tutorial/InteractiveTutorialConfig'\r\nimport { DropZoneIntegration } from '../systems/DropZoneIntegration'\r\nimport { KeyboardController } from '../systems/KeyboardController'\r\nimport { SoundManager } from '../systems/SoundManager'\r\nimport { GameSceneOptimizationMixin } from './GameSceneOptimized'\r\nimport { EventCleanupManager } from '../systems/EventCleanupManager'\r\nimport { ResponsiveGameSceneMixin } from './ResponsiveGameScene'\r\nimport { getUnifiedAnimationManager } from '../systems/UnifiedAnimationManager'\r\nimport type { UnifiedAnimationManager } from '../systems/UnifiedAnimationManager'\r\nimport { MobilePerformanceManager } from '../systems/MobilePerformanceManager'\r\n\r\n/**\r\n * ãƒ¡ã‚¤ãƒ³ã‚²ãƒ¼ãƒ ã‚·ãƒ¼ãƒ³\r\n */\r\nexport class GameScene extends BaseScene {\r\n  private gameInstance!: Game\r\n  private handCards: Phaser.GameObjects.Container[] = []\r\n  private selectedCards: Set<string> = new Set()\r\n  private cardSelectionUI?: Phaser.GameObjects.Container\r\n  private insuranceTypeSelectionUI?: Phaser.GameObjects.Container\r\n  private selectedInsuranceType?: 'whole_life' | 'term'\r\n  private vitalityBarContainer?: Phaser.GameObjects.Container\r\n  private vitalityBar?: Phaser.GameObjects.Rectangle\r\n  private vitalityBarMaxWidth: number = 300\r\n  private insuranceListContainer?: Phaser.GameObjects.Container\r\n  private burdenIndicatorContainer?: Phaser.GameObjects.Container\r\n  private insuranceRenewalDialogUI?: Phaser.GameObjects.Container\r\n  \r\n  // ãƒ€ãƒ¼ãƒ†ã‚£ãƒ•ãƒ©ã‚°ã«ã‚ˆã‚‹UIæœ€é©åŒ–\r\n  private dirtyFlags = {\r\n    vitality: false,\r\n    insurance: false,\r\n    burden: false,\r\n    hand: false,\r\n    actionButtons: false,\r\n    challenge: false,\r\n    stage: false,\r\n    deck: false\r\n  }\r\n  \r\n  // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ç”¨ã®ã‚¹ãƒ­ãƒƒãƒˆãƒªãƒ³ã‚°\r\n  private updateThrottleTimers = {\r\n    vitality: 0,\r\n    insurance: 0,\r\n    burden: 0\r\n  }\r\n  \r\n  // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ç”¨\r\n  private frameSkipCounter: number = 0\r\n  private frameSkipThreshold: number = 2\r\n  private objectPools: Record<string, any[]> = {\r\n    effects: [],\r\n    texts: [],\r\n    graphics: []\r\n  }\r\n  \r\n  // ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—é–¢é€£ï¼ˆæ–°ã‚·ã‚¹ãƒ†ãƒ ï¼‰\r\n  private dropZoneIntegration?: DropZoneIntegration\r\n  \r\n  // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œé–¢é€£\r\n  private keyboardController?: KeyboardController\r\n  \r\n  // ã‚µã‚¦ãƒ³ãƒ‰é–¢é€£\r\n  private soundManager?: SoundManager\r\n  \r\n  // ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯é˜²æ­¢ç”¨\r\n  private eventCleanupManager: EventCleanupManager = new EventCleanupManager()\r\n  \r\n  // ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«é–¢é€£\r\n  private tutorialManager?: TutorialManager\r\n  private tutorialOverlay?: TutorialOverlay\r\n  private isTutorialMode: boolean = false\r\n  private tutorialStepElements: Map<string, Phaser.GameObjects.GameObject> = new Map()\r\n  private shouldStartTutorial: boolean = false\r\n  \r\n  // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é–¢é€£\r\n  private animationManager: UnifiedAnimationManager\r\n\r\n  constructor() {\r\n    super({ key: 'GameScene' })\r\n    // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã®å–å¾—ï¼ˆã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ï¼‰\r\n    this.animationManager = getUnifiedAnimationManager()\r\n  }\r\n\r\n  init(data: { startTutorial?: boolean }): void {\r\n    // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«é–‹å§‹è¦æ±‚ã‚’ãƒ•ãƒ©ã‚°ã¨ã—ã¦ä¿å­˜\r\n    this.shouldStartTutorial = data.startTutorial || false\r\n  }\r\n\r\n  protected initialize(): void {\r\n    // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—\r\n    GameSceneOptimizationMixin.setupPerformanceOptimizations.call(this)\r\n    GameSceneOptimizationMixin.setupCameraCulling.call(this)\r\n    \r\n    // ã‚·ãƒ¼ãƒ³ç ´æ£„æ™‚ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—è¨­å®š\r\n    this.events.once('shutdown', this.cleanup, this)\r\n    this.events.once('destroy', this.cleanup, this)\r\n\r\n    // ã‚²ãƒ¼ãƒ ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®åˆæœŸåŒ–\r\n    this.initializeGame()\r\n\r\n    // UIè¦ç´ ã®ä½œæˆ\r\n    this.createUI()\r\n\r\n    // ã‚«ãƒ¼ãƒ‰ã‚¨ãƒªã‚¢ã®ä½œæˆ\r\n    this.createCardAreas()\r\n\r\n    // ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«UIã®åˆæœŸåŒ–\r\n    this.initializeTutorial()\r\n\r\n    // ã‚²ãƒ¼ãƒ é–‹å§‹\r\n    this.startGame()\r\n    \r\n    // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œã®åˆæœŸåŒ–\r\n    this.initializeKeyboardControls()\r\n    \r\n    // ã‚µã‚¦ãƒ³ãƒ‰ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã®åˆæœŸåŒ–\r\n    this.initializeSoundManager()\r\n    \r\n    // ãƒ¢ãƒã‚¤ãƒ«ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç®¡ç†ã®åˆæœŸåŒ–\r\n    this.initializePerformanceManager()\r\n\r\n    // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ãŒè¦æ±‚ã•ã‚ŒãŸå ´åˆã¯è‡ªå‹•é–‹å§‹\r\n    if (this.shouldStartTutorial) {\r\n      this.time.delayedCall(500, () => {\r\n        this.autoStartTutorial()\r\n      })\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ã‚²ãƒ¼ãƒ ã‚’åˆæœŸåŒ–\r\n   */\r\n  private initializeGame(): void {\r\n    this.gameInstance = new Game({\r\n      difficulty: 'normal',\r\n      startingVitality: 20,\r\n      startingHandSize: 5,\r\n      maxHandSize: 7,\r\n      dreamCardCount: 2\r\n    })\r\n\r\n    // åˆæœŸãƒ‡ãƒƒã‚­ã‚’ä½œæˆ\r\n    const starterCards = CardFactory.createStarterLifeCards()\r\n    this.gameInstance.playerDeck.addCards(starterCards)\r\n    this.gameInstance.playerDeck.shuffle()\r\n\r\n    // ãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒ‡ãƒƒã‚­ã‚’ä½œæˆ\r\n    const challengeCards = CardFactory.createChallengeCards(this.gameInstance.stage)\r\n    this.gameInstance.challengeDeck.addCards(challengeCards)\r\n    this.gameInstance.challengeDeck.shuffle()\r\n  }\r\n\r\n  /**\r\n   * UIè¦ç´ ã‚’ä½œæˆ\r\n   */\r\n  private createUI(): void {\r\n    // èƒŒæ™¯ - ãƒ€ãƒ¼ã‚¯ã§ãƒ¢ãƒ€ãƒ³ãªèƒŒæ™¯\r\n    this.add.rectangle(0, 0, this.gameWidth, this.gameHeight, 0x1F2937)\r\n      .setOrigin(0, 0)\r\n\r\n    // ãƒ˜ãƒƒãƒ€ãƒ¼ - ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³é¢¨ã®è¦‹ãŸç›®\r\n    const header = this.add.rectangle(0, 0, this.gameWidth, 80, 0x4C1D95)\r\n      .setOrigin(0, 0)\r\n    header.setAlpha(0.9)\r\n\r\n    // ã‚¹ãƒ†ãƒ¼ã‚¸è¡¨ç¤º\r\n    const stageText = this.add.text(\r\n      20,\r\n      40,\r\n      this.getStageDisplayText(),\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '20px',\r\n        color: '#F9FAFB',\r\n        fontStyle: 'bold'\r\n      }\r\n    )\r\n    stageText.setOrigin(0, 0.5)\r\n    stageText.setName('stage-text')\r\n\r\n    // äººç”Ÿæ®µéšé€²è¡Œã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼\r\n    this.createLifeStageIndicator()\r\n\r\n    // æ´»åŠ›ãƒãƒ¼ã‚³ãƒ³ãƒ†ãƒŠ\r\n    this.createVitalityBar()\r\n\r\n    // æ´»åŠ›è¡¨ç¤ºï¼ˆå¹´é½¢æ®µéšã‚’å«ã‚€ï¼‰\r\n    const stageLabel = this.getStageDisplayText()\r\n    const vitalityText = this.add.text(\r\n      this.centerX,\r\n      40,\r\n      `æ´»åŠ›: ${this.gameInstance.vitality} / ${this.gameInstance.maxVitality} (${stageLabel})`,\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '24px',\r\n        color: '#F9FAFB',\r\n        fontStyle: 'bold'\r\n      }\r\n    )\r\n    vitalityText.setOrigin(0.5)\r\n    vitalityText.setShadow(2, 2, '#000000', 0.5, true, true)\r\n    vitalityText.setName('vitality-text')\r\n\r\n    // ã‚¿ãƒ¼ãƒ³è¡¨ç¤º\r\n    const turnText = this.add.text(\r\n      this.gameWidth - 20,\r\n      40,\r\n      `ã‚¿ãƒ¼ãƒ³: ${this.gameInstance.turn}`,\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '20px',\r\n        color: '#E5E7EB'\r\n      }\r\n    )\r\n    turnText.setOrigin(1, 0.5)\r\n    turnText.setName('turn-text')\r\n\r\n    // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³\r\n    this.createActionButtons()\r\n\r\n    // Phase 3-3: ä¿é™ºæ–™è² æ‹…ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼\r\n    this.createBurdenIndicator()\r\n\r\n    // Phase 3-3: ä¿é™ºã‚«ãƒ¼ãƒ‰ä¸€è¦§\r\n    this.createInsuranceListDisplay()\r\n  }\r\n\r\n  /**\r\n   * Phase 3-3: ä¿é™ºæ–™è² æ‹…ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã‚’ä½œæˆ\r\n   */\r\n  private createBurdenIndicator(): void {\r\n    this.burdenIndicatorContainer = this.add.container(this.gameWidth - 200, 120)\r\n    this.burdenIndicatorContainer.setName('burden-indicator')\r\n\r\n    // èƒŒæ™¯ - ã‚¬ãƒ©ã‚¹ãƒ¢ãƒ«ãƒ•ã‚£ã‚ºãƒ é¢¨\r\n    const bg = this.add.rectangle(0, 0, 180, 50, 0x111827, 0.8)\r\n    bg.setStrokeStyle(1, 0x818CF8, 0.5)\r\n\r\n    // ãƒ©ãƒ™ãƒ«\r\n    const label = this.add.text(\r\n      -80, 0,\r\n      'ä¿é™ºæ–™è² æ‹…:',\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '16px',\r\n        color: '#E5E7EB'\r\n      }\r\n    ).setOrigin(0, 0.5)\r\n\r\n    // è² æ‹…å€¤\r\n    const burden = this.gameInstance.insuranceBurden\r\n    const burdenText = this.add.text(\r\n      40, 0,\r\n      burden === 0 ? 'è² æ‹…ãªã—' : `${burden}`,\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '20px',\r\n        color: burden === 0 ? '#10B981' : '#EF4444',\r\n        fontStyle: 'bold'\r\n      }\r\n    ).setOrigin(0.5)\r\n    burdenText.setShadow(1, 1, '#000000', 0.3, true, true)\r\n    burdenText.setName('burden-value')\r\n\r\n    this.burdenIndicatorContainer.add([bg, label, burdenText])\r\n  }\r\n\r\n  /**\r\n   * Phase 3-3: ä¿é™ºã‚«ãƒ¼ãƒ‰ä¸€è¦§è¡¨ç¤ºã‚’ä½œæˆ\r\n   */\r\n  private createInsuranceListDisplay(): void {\r\n    this.insuranceListContainer = this.add.container(this.gameWidth - 150, 250)\r\n    this.insuranceListContainer.setName('insurance-list')\r\n\r\n    // ã‚¿ã‚¤ãƒˆãƒ«\r\n    const title = this.add.text(\r\n      0, 0,\r\n      'æœ‰åŠ¹ãªä¿é™º',\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '18px',\r\n        color: '#F9FAFB',\r\n        fontStyle: 'bold'\r\n      }\r\n    ).setOrigin(0.5)\r\n    title.setShadow(1, 1, '#000000', 0.3, true, true)\r\n\r\n    this.insuranceListContainer.add(title)\r\n\r\n    // ä¿é™ºã‚«ãƒ¼ãƒ‰ãƒªã‚¹ãƒˆã‚’æ›´æ–°\r\n    this.updateInsuranceList()\r\n  }\r\n\r\n  /**\r\n   * äººç”Ÿæ®µéšã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã‚’ä½œæˆ\r\n   */\r\n  private createLifeStageIndicator(): void {\r\n    const indicatorContainer = this.add.container(20, 70)\r\n    indicatorContainer.setName('life-stage-indicator')\r\n\r\n    const stages = ['youth', 'middle', 'fulfillment'] as const\r\n    const stageLabels = ['é’å¹´æœŸ', 'ä¸­å¹´æœŸ', 'å……å®ŸæœŸ']\r\n    const stageColors = [0x10B981, 0xF59E0B, 0xA78BFA]\r\n    const currentStageIndex = stages.indexOf(this.gameInstance.stage as 'youth' | 'middle' | 'fulfillment')\r\n\r\n    stages.forEach((stage, index) => {\r\n      const isActive = index <= currentStageIndex\r\n      const isCurrent = index === currentStageIndex\r\n      \r\n      // ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ‰ãƒƒãƒˆ\r\n      const dot = this.add.circle(\r\n        index * 50, 0,\r\n        isCurrent ? 8 : 6,\r\n        isActive ? stageColors[index] : 0x4B5563,\r\n        isActive ? 1 : 0.5\r\n      )\r\n      \r\n      // ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ©ãƒ™ãƒ«\r\n      const label = this.add.text(\r\n        index * 50, 15,\r\n        stageLabels[index],\r\n        {\r\n          fontFamily: 'Noto Sans JP',\r\n          fontSize: '10px',\r\n          color: isActive ? '#F9FAFB' : '#6B7280',\r\n          fontStyle: isCurrent ? 'bold' : 'normal'\r\n        }\r\n      ).setOrigin(0.5)\r\n      \r\n      // æœ€å¤§æ´»åŠ›è¡¨ç¤º\r\n      const maxVitalityForStage = index === 0 ? 35 : index === 1 ? 30 : 27\r\n      const maxVitalityLabel = this.add.text(\r\n        index * 50, 25,\r\n        `æœ€å¤§${maxVitalityForStage}`,\r\n        {\r\n          fontFamily: 'Noto Sans JP',\r\n          fontSize: '8px',\r\n          color: isActive ? '#9CA3AF' : '#4B5563'\r\n        }\r\n      ).setOrigin(0.5)\r\n      \r\n      indicatorContainer.add([dot, label, maxVitalityLabel])\r\n      \r\n      // ç¾åœ¨ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã«ãƒ‘ãƒ«ã‚¹åŠ¹æœ\r\n      if (isCurrent) {\r\n        this.tweens.add({\r\n          targets: dot,\r\n          scale: 1.2,\r\n          duration: 1500,\r\n          yoyo: true,\r\n          repeat: -1,\r\n          ease: 'Sine.easeInOut'\r\n        })\r\n      }\r\n      \r\n      // æ¥ç¶šç·šï¼ˆæœ€å¾Œã®ã‚¹ãƒ†ãƒ¼ã‚¸ä»¥å¤–ï¼‰\r\n      if (index < stages.length - 1) {\r\n        const line = this.add.rectangle(\r\n          index * 50 + 25, 0,\r\n          20, 2,\r\n          isActive && index < currentStageIndex ? stageColors[index] : 0x4B5563,\r\n          isActive && index < currentStageIndex ? 1 : 0.3\r\n        )\r\n        indicatorContainer.add(line)\r\n      }\r\n    })\r\n  }\r\n\r\n  /**\r\n   * äººç”Ÿæ®µéšã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã‚’æ›´æ–°\r\n   */\r\n  private updateLifeStageIndicator(): void {\r\n    const indicatorContainer = this.children.getByName('life-stage-indicator') as Phaser.GameObjects.Container\r\n    if (!indicatorContainer) return\r\n\r\n    indicatorContainer.destroy()\r\n    this.createLifeStageIndicator()\r\n  }\r\n\r\n  /**\r\n   * æ´»åŠ›ãƒãƒ¼ã‚’ä½œæˆ\r\n   */\r\n  private createVitalityBar(): void {\r\n    this.vitalityBarContainer = this.add.container(this.centerX, 65)\r\n    this.vitalityBarContainer.setName('vitality-bar-container')\r\n\r\n    // æ´»åŠ›ãƒãƒ¼ã®èƒŒæ™¯ - ã‚ˆã‚Šãƒ¢ãƒ€ãƒ³ãªã‚¹ã‚¿ã‚¤ãƒ«\r\n    const barBg = this.add.rectangle(\r\n      0, 0,\r\n      this.vitalityBarMaxWidth + 4,\r\n      24,\r\n      0x111827\r\n    )\r\n    barBg.setStrokeStyle(2, 0x818CF8)\r\n    barBg.setAlpha(0.8)\r\n\r\n    // æ´»åŠ›ãƒãƒ¼æœ¬ä½“\r\n    const vitalityPercentage = this.gameInstance.vitality / this.gameInstance.maxVitality\r\n    const barWidth = Math.max(0, this.vitalityBarMaxWidth * vitalityPercentage)\r\n    \r\n    this.vitalityBar = this.add.rectangle(\r\n      -this.vitalityBarMaxWidth / 2, 0,\r\n      barWidth,\r\n      20,\r\n      this.getVitalityBarColor(vitalityPercentage)\r\n    )\r\n    this.vitalityBar.setOrigin(0, 0.5)\r\n\r\n    // æœ€å¤§å€¤ãƒãƒ¼ã‚«ãƒ¼ï¼ˆç¾åœ¨ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã®æœ€å¤§å€¤ã‚’ç¤ºã™ï¼‰\r\n    const maxMarker = this.add.rectangle(\r\n      -this.vitalityBarMaxWidth / 2 + this.vitalityBarMaxWidth, 0,\r\n      2,\r\n      24,\r\n      0x818CF8\r\n    )\r\n    maxMarker.setOrigin(0.5)\r\n\r\n    this.vitalityBarContainer.add([barBg, this.vitalityBar, maxMarker])\r\n  }\r\n\r\n  /**\r\n   * æ´»åŠ›ãƒãƒ¼ã®è‰²ã‚’å–å¾—\r\n   */\r\n  private getVitalityBarColor(percentage: number): number {\r\n    if (percentage > 0.6) return 0x10B981 // ç·‘ - é«˜æ´»åŠ›\r\n    if (percentage > 0.3) return 0xF59E0B // ã‚ªãƒ¬ãƒ³ã‚¸ - ä¸­æ´»åŠ›\r\n    return 0xEF4444 // èµ¤ - ä½æ´»åŠ›\r\n  }\r\n\r\n  /**\r\n   * ã‚«ãƒ¼ãƒ‰ã‚¨ãƒªã‚¢ã‚’ä½œæˆ\r\n   */\r\n  private createCardAreas(): void {\r\n    // ãƒ‡ãƒƒã‚­ã‚¨ãƒªã‚¢\r\n    const deckArea = this.add.container(\r\n      GAME_CONSTANTS.DECK_X_POSITION,\r\n      GAME_CONSTANTS.DECK_Y_POSITION\r\n    )\r\n    \r\n    const deckBack = this.add.image(0, 0, 'card-back')\r\n    const deckCount = this.add.text(\r\n      0,\r\n      70,\r\n      `${this.gameInstance.playerDeck.size()}`,\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '18px',\r\n        color: '#333333'\r\n      }\r\n    )\r\n    deckCount.setOrigin(0.5)\r\n    deckCount.setName('deck-count')\r\n\r\n    deckArea.add([deckBack, deckCount])\r\n    deckArea.setName('deck-area')\r\n\r\n    // æ¨ã¦æœ­ã‚¨ãƒªã‚¢\r\n    const discardArea = this.add.container(\r\n      GAME_CONSTANTS.DISCARD_X_POSITION,\r\n      GAME_CONSTANTS.DISCARD_Y_POSITION\r\n    )\r\n\r\n    const discardPlaceholder = this.add.rectangle(\r\n      0,\r\n      0,\r\n      GAME_CONSTANTS.CARD_WIDTH,\r\n      GAME_CONSTANTS.CARD_HEIGHT,\r\n      0xCCCCCC,\r\n      0.3\r\n    )\r\n    discardPlaceholder.setStrokeStyle(2, 0x999999)\r\n\r\n    const discardLabel = this.add.text(\r\n      0,\r\n      70,\r\n      'æ¨ã¦æœ­',\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '16px',\r\n        color: '#666666'\r\n      }\r\n    ).setOrigin(0.5)\r\n\r\n    discardArea.add([discardPlaceholder, discardLabel])\r\n    discardArea.setName('discard-area')\r\n\r\n    // ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã‚¨ãƒªã‚¢\r\n    const challengeArea = this.add.container(\r\n      this.centerX,\r\n      GAME_CONSTANTS.CHALLENGE_Y_POSITION\r\n    )\r\n\r\n    const challengePlaceholder = this.add.rectangle(\r\n      0,\r\n      0,\r\n      GAME_CONSTANTS.CARD_WIDTH,\r\n      GAME_CONSTANTS.CARD_HEIGHT,\r\n      0xFFD43B,\r\n      0.3\r\n    )\r\n    challengePlaceholder.setStrokeStyle(2, 0xFAB005)\r\n\r\n    const challengeLabel = this.add.text(\r\n      0,\r\n      -100,\r\n      'ãƒãƒ£ãƒ¬ãƒ³ã‚¸',\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '20px',\r\n        color: '#333333'\r\n      }\r\n    ).setOrigin(0.5)\r\n\r\n    challengeArea.add([challengePlaceholder, challengeLabel])\r\n    challengeArea.setName('challenge-area')\r\n    \r\n    // ãƒ‰ãƒ­ãƒƒãƒ—ã‚¾ãƒ¼ãƒ³ã®åˆæœŸåŒ–\r\n    this.initializeDropZones()\r\n    \r\n    // æ–°ã—ã„ãƒ‰ãƒ­ãƒƒãƒ—ã‚¾ãƒ¼ãƒ³ã‚·ã‚¹ãƒ†ãƒ ã®åˆæœŸåŒ–\r\n    this.initializeNewDropZoneSystem()\r\n  }\r\n\r\n  /**\r\n   * ãƒ‰ãƒ­ãƒƒãƒ—ã‚¾ãƒ¼ãƒ³ã‚’åˆæœŸåŒ–\r\n   */\r\n  private initializeDropZones(): void {\r\n    // ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã‚¨ãƒªã‚¢ã®ãƒ‰ãƒ­ãƒƒãƒ—ã‚¾ãƒ¼ãƒ³ã‚’ç™»éŒ²\r\n    const challengeArea = this.children.getByName('challenge-area') as Phaser.GameObjects.Container\r\n    if (challengeArea) {\r\n      // challengeAreaã¯æ–°ã‚·ã‚¹ãƒ†ãƒ ã§ç®¡ç†\r\n      // ãƒã‚¤ãƒ©ã‚¤ãƒˆã¯æ–°ã‚·ã‚¹ãƒ†ãƒ ã§ç®¡ç†\r\n    }\r\n    \r\n    // æ¨ã¦æœ­ã‚¨ãƒªã‚¢ã®ãƒ‰ãƒ­ãƒƒãƒ—ã‚¾ãƒ¼ãƒ³ã‚’ç™»éŒ²\r\n    const discardArea = this.children.getByName('discard-area') as Phaser.GameObjects.Container\r\n    if (discardArea) {\r\n      // discardAreaã¯æ–°ã‚·ã‚¹ãƒ†ãƒ ã§ç®¡ç†\r\n      // ãƒã‚¤ãƒ©ã‚¤ãƒˆã¯æ–°ã‚·ã‚¹ãƒ†ãƒ ã§ç®¡ç†\r\n    }\r\n    \r\n    // ãƒ‰ãƒ©ãƒƒã‚°ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã¯æ–°ã‚·ã‚¹ãƒ†ãƒ ã§ç®¡ç†\r\n  }\r\n\r\n  /**\r\n   * æ–°ã—ã„ãƒ‰ãƒ­ãƒƒãƒ—ã‚¾ãƒ¼ãƒ³ã‚·ã‚¹ãƒ†ãƒ ã‚’åˆæœŸåŒ–\r\n   */\r\n  private initializeNewDropZoneSystem(): void {\r\n    // DropZoneIntegrationã‚’åˆæœŸåŒ–ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¾ãƒ¼ãƒ³ã¯è‡ªå‹•çš„ã«è¨­å®šã•ã‚Œã‚‹ï¼‰\r\n    this.dropZoneIntegration = new DropZoneIntegration(this, this.gameInstance)\r\n    \r\n    // ã‚«ãƒ¼ãƒ‰é¸æŠã‚¤ãƒ™ãƒ³ãƒˆã®ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’è¨­å®š\r\n    this.data.events.on('cardSelected', (cardContainer: Phaser.GameObjects.Container) => {\r\n      this.toggleCardSelection(cardContainer)\r\n    })\r\n  }\r\n\r\n\r\n  /**\r\n   * ãƒ‰ãƒ­ãƒƒãƒ—ã‚¾ãƒ¼ãƒ³ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚’è¡¨ç¤º\r\n   */\r\n  private showDropZoneHighlights(draggedCard?: Phaser.GameObjects.Container): void {\r\n    this.dropZoneHighlights.forEach((highlight, zoneName) => {\r\n      const isValid = this.isValidDropZone(zoneName, draggedCard)\r\n      const color = isValid ? GAME_CONSTANTS.COLORS.DROP_ZONE_VALID : GAME_CONSTANTS.COLORS.DROP_ZONE_INVALID\r\n      const alpha = isValid ? 0.3 : 0.15\r\n      \r\n      // ãƒã‚¤ãƒ©ã‚¤ãƒˆã®æç”»ã‚’ã‚¯ãƒªã‚¢\r\n      highlight.clear()\r\n      \r\n      // å††å½¢ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚’æç”»\r\n      const radius = (GAME_CONSTANTS.CARD_WIDTH + 40) / 2\r\n      highlight.fillStyle(color, alpha)\r\n      highlight.fillCircle(0, 0, radius)\r\n      \r\n      // å¢ƒç•Œç·šã‚’æç”»\r\n      highlight.lineStyle(3, color, 0.8)\r\n      highlight.strokeCircle(0, 0, radius)\r\n      \r\n      // ãƒ‘ãƒ«ã‚¹åŠ¹æœã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³\r\n      this.tweens.add({\r\n        targets: highlight,\r\n        alpha: alpha * 1.5,\r\n        scaleX: 1.1,\r\n        scaleY: 1.1,\r\n        duration: GAME_CONSTANTS.DRAG_DROP.GLOW_PULSE_DURATION / 2,\r\n        ease: 'Sine.easeInOut',\r\n        yoyo: true,\r\n        repeat: -1\r\n      })\r\n      \r\n      // ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³\r\n      this.tweens.add({\r\n        targets: highlight,\r\n        alpha,\r\n        duration: 200,\r\n        ease: 'Power2'\r\n      })\r\n    })\r\n  }\r\n\r\n  /**\r\n   * ãƒ‰ãƒ­ãƒƒãƒ—ã‚¾ãƒ¼ãƒ³ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚’éš ã™\r\n   */\r\n  private hideDropZoneHighlights(): void {\r\n    this.dropZoneHighlights.forEach((highlight) => {\r\n      // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³åœæ­¢\r\n      this.tweens.killTweensOf(highlight)\r\n      \r\n      // ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆ\r\n      this.tweens.add({\r\n        targets: highlight,\r\n        alpha: 0,\r\n        scaleX: 1,\r\n        scaleY: 1,\r\n        duration: 200,\r\n        ease: 'Power2',\r\n        onComplete: () => {\r\n          highlight.clear()\r\n        }\r\n      })\r\n    })\r\n  }\r\n\r\n  /**\r\n   * ãƒ‰ãƒ­ãƒƒãƒ—ã‚¾ãƒ¼ãƒ³ãŒæœ‰åŠ¹ã‹ã©ã†ã‹ã‚’åˆ¤å®š\r\n   */\r\n  private isValidDropZone(zoneName: string, draggedCard?: Phaser.GameObjects.Container): boolean {\r\n    if (!draggedCard) return true\r\n    \r\n    switch (zoneName) {\r\n      case 'challenge':\r\n        // ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã‚¨ãƒªã‚¢ã¯ã€ãƒãƒ£ãƒ¬ãƒ³ã‚¸ãŒé–‹å§‹ã•ã‚Œã¦ã„ã‚‹ã€ã‹ã¤ç¾åœ¨ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã‚«ãƒ¼ãƒ‰ãŒãªã„å ´åˆã«æœ‰åŠ¹\r\n        return this.gameInstance.currentChallenge !== null && !this.gameInstance.currentChallenge.isCardPlaced\r\n      case 'discard':\r\n        // æ¨ã¦æœ­ã‚¨ãƒªã‚¢ã¯å¸¸ã«æœ‰åŠ¹\r\n        return true\r\n      default:\r\n        return false\r\n    }\r\n  }\r\n  /**\r\n   * ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã‚’ä½œæˆ\r\n   */\r\n  private createActionButtons(): void {\r\n    const buttonContainer = this.add.container(this.gameWidth - 150, 150)\r\n    buttonContainer.setName('action-buttons')\r\n\r\n    // ãƒ‰ãƒ­ãƒ¼ãƒœã‚¿ãƒ³\r\n    const drawButton = this.createContainerButton(\r\n      0,\r\n      0,\r\n      'ã‚«ãƒ¼ãƒ‰ã‚’å¼•ã',\r\n      () => this.drawCards(1),\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '18px',\r\n        color: '#ffffff'\r\n      }\r\n    )\r\n    drawButton.setName('draw-button')\r\n\r\n    // ãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒœã‚¿ãƒ³\r\n    const challengeButton = this.createContainerButton(\r\n      0,\r\n      60,\r\n      'ãƒãƒ£ãƒ¬ãƒ³ã‚¸',\r\n      () => this.startChallenge(),\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '18px',\r\n        color: '#ffffff'\r\n      }\r\n    )\r\n    challengeButton.setName('challenge-button')\r\n\r\n    // ã‚¿ãƒ¼ãƒ³çµ‚äº†ãƒœã‚¿ãƒ³\r\n    const endTurnButton = this.createContainerButton(\r\n      0,\r\n      120,\r\n      'ã‚¿ãƒ¼ãƒ³çµ‚äº†',\r\n      () => this.endTurn(),\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '18px',\r\n        color: '#ffffff'\r\n      }\r\n    )\r\n    endTurnButton.setName('end-turn-button')\r\n\r\n    buttonContainer.add([drawButton, challengeButton, endTurnButton])\r\n    \r\n    // åˆæœŸçŠ¶æ…‹ã§ãƒœã‚¿ãƒ³ã®æœ‰åŠ¹/ç„¡åŠ¹ã‚’è¨­å®š\r\n    this.updateActionButtons()\r\n  }\r\n\r\n  /**\r\n   * ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œã®åˆæœŸåŒ–\r\n   */\r\n  private initializeKeyboardControls(): void {\r\n    // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’ä½œæˆ\r\n    this.keyboardController = new KeyboardController(this)\r\n    \r\n    // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’ç™»éŒ²\r\n    this.keyboardController.registerActionCallback('draw', () => {\r\n      if (this.gameInstance.phase === 'draw' && this.gameInstance.isInProgress()) {\r\n        this.drawCards(1)\r\n      }\r\n    })\r\n    \r\n    this.keyboardController.registerActionCallback('challenge', () => {\r\n      if (this.gameInstance.phase === 'draw' && !this.gameInstance.currentChallenge && this.gameInstance.isInProgress()) {\r\n        this.startChallenge()\r\n      }\r\n    })\r\n    \r\n    this.keyboardController.registerActionCallback('endTurn', () => {\r\n      const phase = this.gameInstance.phase\r\n      if ((phase === 'draw' || phase === 'resolution') && this.gameInstance.isInProgress()) {\r\n        this.endTurn()\r\n      }\r\n    })\r\n    \r\n    // æ•°å­—ã‚­ãƒ¼ã§ã‚«ãƒ¼ãƒ‰é¸æŠ\r\n    for (let i = 1; i <= 7; i++) {\r\n      this.keyboardController.registerActionCallback(`card${i}`, () => {\r\n        if (i <= this.handCards.length) {\r\n          const card = this.handCards[i - 1]\r\n          const cardData = card.getData('card') as Card\r\n          if (cardData) {\r\n            this.toggleCardSelection(card)\r\n          }\r\n        }\r\n      })\r\n    }\r\n    \r\n    // ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆé¸æŠè§£é™¤ï¼‰\r\n    this.keyboardController.registerActionCallback('cancel', () => {\r\n      this.clearCardSelection()\r\n    })\r\n    \r\n    // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã‚’ç™»éŒ²\r\n    this.time.delayedCall(100, () => {\r\n      this.registerFocusableElements()\r\n    })\r\n    \r\n    // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œã‚’æœ‰åŠ¹åŒ–\r\n    this.keyboardController.enable()\r\n  }\r\n  \r\n  /**\r\n   * ãƒ•ã‚©ãƒ¼ã‚«ã‚¹å¯èƒ½ãªè¦ç´ ã‚’ç™»éŒ²\r\n   */\r\n  private registerFocusableElements(): void {\r\n    if (!this.keyboardController) return\r\n    \r\n    // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã‚’ç™»éŒ²\r\n    const actionButtons = this.children.getByName('action-buttons') as Phaser.GameObjects.Container\r\n    if (actionButtons) {\r\n      const drawButton = actionButtons.getByName('draw-button') as Phaser.GameObjects.Container\r\n      const challengeButton = actionButtons.getByName('challenge-button') as Phaser.GameObjects.Container\r\n      const endTurnButton = actionButtons.getByName('end-turn-button') as Phaser.GameObjects.Container\r\n      \r\n      if (drawButton) {\r\n        this.keyboardController.registerFocusableElement(drawButton, () => {\r\n          if (this.gameInstance.phase === 'draw' && this.gameInstance.isInProgress()) {\r\n            this.drawCards(1)\r\n          }\r\n        })\r\n      }\r\n      \r\n      if (challengeButton) {\r\n        this.keyboardController.registerFocusableElement(challengeButton, () => {\r\n          if (this.gameInstance.phase === 'draw' && !this.gameInstance.currentChallenge && this.gameInstance.isInProgress()) {\r\n            this.startChallenge()\r\n          }\r\n        })\r\n      }\r\n      \r\n      if (endTurnButton) {\r\n        this.keyboardController.registerFocusableElement(endTurnButton, () => {\r\n          const phase = this.gameInstance.phase\r\n          if ((phase === 'draw' || phase === 'resolution') && this.gameInstance.isInProgress()) {\r\n            this.endTurn()\r\n          }\r\n        })\r\n      }\r\n    }\r\n    \r\n    // æ‰‹æœ­ã®ã‚«ãƒ¼ãƒ‰ã‚’ç™»éŒ²\r\n    this.registerHandCardsFocus()\r\n  }\r\n  \r\n  /**\r\n   * æ‰‹æœ­ã®ã‚«ãƒ¼ãƒ‰ã‚’ãƒ•ã‚©ãƒ¼ã‚«ã‚¹å¯èƒ½è¦ç´ ã¨ã—ã¦ç™»éŒ²\r\n   */\r\n  private registerHandCardsFocus(): void {\r\n    if (!this.keyboardController) return\r\n    \r\n    // æ—¢å­˜ã®æ‰‹æœ­ç™»éŒ²ã‚’è§£é™¤\r\n    this.handCards.forEach((cardContainer) => {\r\n      this.keyboardController!.unregisterFocusableElement(cardContainer)\r\n    })\r\n    \r\n    // æ–°ã—ãç™»éŒ²\r\n    this.handCards.forEach((cardContainer) => {\r\n      this.keyboardController!.registerFocusableElement(cardContainer, () => {\r\n        const cardData = cardContainer.getData('card') as Card\r\n        if (cardData) {\r\n          this.toggleCardSelection(cardContainer)\r\n        }\r\n      })\r\n    })\r\n  }\r\n\r\n  /**\r\n   * ã‚²ãƒ¼ãƒ é–‹å§‹\r\n   */\r\n  private startGame(): void {\r\n    this.gameInstance.start()\r\n    \r\n    // åˆæœŸæ‰‹æœ­ã‚’å¼•ã\r\n    this.drawCards(GAME_CONSTANTS.INITIAL_DRAW)\r\n    \r\n    // ãƒœã‚¿ãƒ³çŠ¶æ…‹ã‚’åˆæœŸåŒ–\r\n    this.time.delayedCall(100, () => {\r\n      this.updateActionButtons()\r\n    })\r\n\r\n    // ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã‚’å…¬é–‹ï¼ˆãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ç”¨ï¼‰\r\n    this.updateGameStateForTutorial()\r\n  }\r\n\r\n  /**\r\n   * ã‚«ãƒ¼ãƒ‰ã‚’å¼•ã\r\n   */\r\n  private drawCards(count: number): void {\r\n    const drawnCards = this.gameInstance.drawCards(count)\r\n    \r\n    drawnCards.forEach((card, index) => {\r\n      this.time.delayedCall(index * 100, () => {\r\n        this.createHandCard(card)\r\n        // ã‚«ãƒ¼ãƒ‰ãƒ‰ãƒ­ãƒ¼éŸ³ã‚’å†ç”Ÿ\r\n        this.soundManager?.play('cardDraw')\r\n      })\r\n    })\r\n\r\n    // æ‰‹æœ­ã‚’å†é…ç½®\r\n    this.time.delayedCall(count * 100 + 100, () => {\r\n      this.arrangeHand()\r\n      // ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ç”¨ã«ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã‚’æ›´æ–°\r\n      this.updateGameStateForTutorial()\r\n    })\r\n  }\r\n\r\n  /**\r\n   * æ‰‹æœ­ã«ã‚«ãƒ¼ãƒ‰ã‚’ä½œæˆ\r\n   */\r\n  private createHandCard(card: Card): void {\r\n    const cardContainer = this.add.container(\r\n      GAME_CONSTANTS.DECK_X_POSITION,\r\n      GAME_CONSTANTS.DECK_Y_POSITION\r\n    )\r\n\r\n    // ã‚«ãƒ¼ãƒ‰èƒŒæ™¯ - ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã¨è§’ä¸¸\r\n    const graphics = this.add.graphics()\r\n    const cardColor = this.getCardColor(card.type)\r\n    \r\n    // ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³èƒŒæ™¯\r\n    graphics.fillGradientStyle(cardColor.top, cardColor.top, cardColor.bottom, cardColor.bottom, 1)\r\n    graphics.fillRoundedRect(-60, -80, 120, 160, 12)\r\n    \r\n    // ã‚¬ãƒ©ã‚¹ãƒ¢ãƒ«ãƒ•ã‚£ã‚ºãƒ åŠ¹æœ\r\n    const glassBg = this.add.rectangle(0, 0, 116, 156, 0xffffff, 0.1)\r\n    glassBg.setStrokeStyle(1, 0xffffff, 0.3)\r\n    \r\n    // ã‚«ãƒ¼ãƒ‰ã‚’ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ã«\r\n    const hitArea = new Phaser.Geom.Rectangle(-60, -80, 120, 160)\r\n    cardContainer.setInteractive(hitArea, Phaser.Geom.Rectangle.Contains)\r\n    \r\n    // ã‚«ãƒ¼ãƒ‰ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆãƒãƒ£ãƒ¬ãƒ³ã‚¸ä¸­ã®é¸æŠç”¨ï¼‰\r\n    cardContainer.on('pointerdown', () => {\r\n      // ãƒãƒ£ãƒ¬ãƒ³ã‚¸ä¸­ãªã‚‰é¸æŠãƒˆã‚°ãƒ«\r\n      if (this.gameInstance.currentChallenge && !cardContainer.getData('isDragging')) {\r\n        this.toggleCardSelection(cardContainer)\r\n      }\r\n    })\r\n\r\n    // ã‚«ãƒ¼ãƒ‰å\r\n    const cardName = this.add.text(\r\n      0,\r\n      -60,\r\n      card.name,\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '14px',\r\n        color: '#F9FAFB',\r\n        fontStyle: 'bold',\r\n        wordWrap: { width: 100 }\r\n      }\r\n    ).setOrigin(0.5)\r\n    cardName.setShadow(1, 1, '#000000', 0.5, true, true)\r\n\r\n    // ãƒ‘ãƒ¯ãƒ¼è¡¨ç¤º\r\n    const powerBg = this.add.circle(-40, 60, 20, 0x111827, 0.8)\r\n    const powerText = this.add.text(\r\n      -40,\r\n      60,\r\n      `${card.power}`,\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '24px',\r\n        color: '#10B981',\r\n        fontStyle: 'bold'\r\n      }\r\n    ).setOrigin(0.5)\r\n\r\n    // ã‚³ã‚¹ãƒˆè¡¨ç¤º\r\n    const costBg = this.add.circle(40, 60, 18, 0x111827, 0.8)\r\n    const costText = this.add.text(\r\n      40,\r\n      60,\r\n      `${card.cost}`,\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '20px',\r\n        color: '#F59E0B',\r\n        fontStyle: 'bold'\r\n      }\r\n    ).setOrigin(0.5)\r\n\r\n    // å¹´é½¢ãƒœãƒ¼ãƒŠã‚¹è¡¨ç¤ºï¼ˆä¿é™ºã‚«ãƒ¼ãƒ‰ã®å ´åˆï¼‰\r\n    let ageBonusIndicator: Phaser.GameObjects.Container | null = null\r\n    if (card.type === 'insurance' && card.ageBonus !== undefined && card.ageBonus > 0) {\r\n      const stage = this.gameInstance.stage\r\n      let currentBonus = 0\r\n      if (stage === 'middle') currentBonus = 0.5\r\n      else if (stage === 'fulfillment') currentBonus = 1.0\r\n      \r\n      if (currentBonus > 0) {\r\n        // å¹´é½¢ãƒœãƒ¼ãƒŠã‚¹èƒŒæ™¯\r\n        const bonusBg = this.add.circle(0, -60, 12, 0x6366F1, 0.9)\r\n        \r\n        // å¹´é½¢ãƒœãƒ¼ãƒŠã‚¹ãƒ†ã‚­ã‚¹ãƒˆ\r\n        const bonusText = this.add.text(\r\n          0, -60,\r\n          `+${currentBonus}`,\r\n          {\r\n            fontFamily: 'Noto Sans JP',\r\n            fontSize: '12px',\r\n            color: '#FFFFFF',\r\n            fontStyle: 'bold'\r\n          }\r\n        ).setOrigin(0.5)\r\n        \r\n        ageBonusIndicator = this.add.container(0, 0, [bonusBg, bonusText])\r\n        ageBonusIndicator.setAlpha(0.8)\r\n        \r\n        // ãƒ‘ãƒ«ã‚¹åŠ¹æœ\r\n        this.tweens.add({\r\n          targets: ageBonusIndicator,\r\n          alpha: 1,\r\n          scale: 1.1,\r\n          duration: 1000,\r\n          yoyo: true,\r\n          repeat: -1,\r\n          ease: 'Sine.easeInOut'\r\n        })\r\n      }\r\n    }\r\n\r\n    // åŠ¹æœçš„ãƒ‘ãƒ¯ãƒ¼è¡¨ç¤ºï¼ˆå¹´é½¢ãƒœãƒ¼ãƒŠã‚¹é©ç”¨å¾Œï¼‰\r\n    let effectivePower = card.power\r\n    if (card.type === 'insurance' && card.ageBonus !== undefined) {\r\n      const stage = this.gameInstance.stage\r\n      let multiplier = 1\r\n      if (stage === 'middle') multiplier = 1.5\r\n      else if (stage === 'fulfillment') multiplier = 2.0\r\n      effectivePower = Math.floor(card.power * multiplier)\r\n    }\r\n\r\n    // ãƒ‘ãƒ¯ãƒ¼è¡¨ç¤ºã‚’åŠ¹æœçš„ãƒ‘ãƒ¯ãƒ¼ã«æ›´æ–°\r\n    if (effectivePower !== card.power) {\r\n      powerText.setText(`${effectivePower}`)\r\n      powerText.setColor('#A78BFA') // ç´«è‰²ã§å¹´é½¢ãƒœãƒ¼ãƒŠã‚¹ã‚’è¡¨ç¤º\r\n      \r\n      // åŸºæœ¬ãƒ‘ãƒ¯ãƒ¼ã‚’å°ã•ãè¡¨ç¤º\r\n      const basePowerText = this.add.text(\r\n        -40, 45,\r\n        `(${card.power})`,\r\n        {\r\n          fontFamily: 'Noto Sans JP',\r\n          fontSize: '12px',\r\n          color: '#9CA3AF',\r\n          fontStyle: 'normal'\r\n        }\r\n      ).setOrigin(0.5)\r\n      \r\n      const cardElements = [graphics, glassBg, cardName, powerBg, powerText, basePowerText, costBg, costText]\r\n      if (ageBonusIndicator) cardElements.push(ageBonusIndicator)\r\n      cardContainer.add(cardElements)\r\n    } else {\r\n      const cardElements = [graphics, glassBg, cardName, powerBg, powerText, costBg, costText]\r\n      if (ageBonusIndicator) cardElements.push(ageBonusIndicator)\r\n      cardContainer.add(cardElements)\r\n    }\r\n    \r\n    cardContainer.setData('card', card)\r\n    cardContainer.setData('selected', false)\r\n    \r\n    // ãƒ›ãƒãƒ¼ã‚¨ãƒ•ã‚§ã‚¯ãƒˆç”¨ã®ã‚°ãƒ­ã‚¦\r\n    const glow = this.add.rectangle(0, 0, 130, 170, 0x818CF8, 0)\r\n    glow.setAlpha(0)\r\n    cardContainer.add(glow)\r\n    cardContainer.sendToBack(glow)\r\n    cardContainer.setData('glow', glow)\r\n    \r\n    // ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³è¨­å®š\r\n    this.setupCardInteraction(cardContainer)\r\n    \r\n    // æ–°ã—ã„ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã‚·ã‚¹ãƒ†ãƒ ã®è¨­å®š\r\n    if (this.dropZoneIntegration) {\r\n      this.dropZoneIntegration.setupCardDragAndDrop(cardContainer)\r\n    }\r\n    \r\n    this.handCards.push(cardContainer)\r\n  }\r\n\r\n  /**\r\n   * ã‚«ãƒ¼ãƒ‰ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’å–å¾—\r\n   */\r\n  private getCardTemplate(type: CardType): string {\r\n    switch (type) {\r\n      case 'life':\r\n        return 'life-card-template'\r\n      case 'insurance':\r\n        return 'insurance-card-template'\r\n      case 'pitfall':\r\n        return 'pitfall-card-template'\r\n      default:\r\n        return 'life-card-template'\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ã‚«ãƒ¼ãƒ‰ã®è‰²ã‚’å–å¾—\r\n   */\r\n  private getCardColor(type: CardType): { top: number; bottom: number } {\r\n    switch (type) {\r\n      case 'life':\r\n        return { top: 0x667eea, bottom: 0x764ba2 }  // ç´«ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³\r\n      case 'insurance':\r\n        return { top: 0x10B981, bottom: 0x059669 }  // ç·‘ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³\r\n      case 'pitfall':\r\n        return { top: 0xEF4444, bottom: 0xDC2626 }  // èµ¤ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³\r\n      case 'dream':\r\n        return { top: 0xFCD34D, bottom: 0xF59E0B }  // é‡‘è‰²ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³\r\n      default:\r\n        return { top: 0x6B7280, bottom: 0x4B5563 }  // ã‚°ãƒ¬ãƒ¼ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ã‚«ãƒ¼ãƒ‰ã®ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¨­å®š\r\n   */\r\n  private setupCardInteraction(cardContainer: Phaser.GameObjects.Container): void {\r\n    // ãƒ‰ãƒ©ãƒƒã‚°ç”¨ã®åˆæœŸä½ç½®ã‚’ä¿å­˜\r\n    cardContainer.setData('originalX', cardContainer.x)\r\n    cardContainer.setData('originalY', cardContainer.y)\r\n    cardContainer.setData('isDragging', false)\r\n    \r\n    const glow = cardContainer.getData('glow')\r\n\r\n    // ãƒ‰ãƒ©ãƒƒã‚°å¯èƒ½ã«è¨­å®š\r\n    this.input.setDraggable(cardContainer)\r\n\r\n    // ãƒ›ãƒãƒ¼åŠ¹æœ\r\n    cardContainer.on('pointerover', () => {\r\n      if (!cardContainer.getData('selected') && !cardContainer.getData('isDragging')) {\r\n        // ã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ãƒƒãƒ—ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³\r\n        this.tweens.add({\r\n          targets: cardContainer,\r\n          scaleX: GAME_CONSTANTS.CARD_HOVER_SCALE,\r\n          scaleY: GAME_CONSTANTS.CARD_HOVER_SCALE,\r\n          duration: 200,\r\n          ease: 'Power2'\r\n        })\r\n        \r\n        // ã‚°ãƒ­ã‚¦ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ\r\n        if (glow) {\r\n          this.tweens.add({\r\n            targets: glow,\r\n            alpha: 0.3,\r\n            duration: 200,\r\n            ease: 'Power2'\r\n          })\r\n        }\r\n      }\r\n    })\r\n\r\n    cardContainer.on('pointerout', () => {\r\n      if (!cardContainer.getData('selected') && !cardContainer.getData('isDragging')) {\r\n        // ã‚¹ã‚±ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³\r\n        this.tweens.add({\r\n          targets: cardContainer,\r\n          scaleX: 1,\r\n          scaleY: 1,\r\n          duration: 200,\r\n          ease: 'Power2'\r\n        })\r\n        \r\n        // ã‚°ãƒ­ã‚¦ã‚¨ãƒ•ã‚§ã‚¯ãƒˆæ¶ˆå»\r\n        if (glow) {\r\n          this.tweens.add({\r\n            targets: glow,\r\n            alpha: 0,\r\n            duration: 200,\r\n            ease: 'Power2'\r\n          })\r\n        }\r\n      }\r\n    })\r\n\r\n    // ã‚¯ãƒªãƒƒã‚¯ï¼ˆé¸æŠï¼‰\r\n    cardContainer.on('pointerdown', (pointer: Phaser.Input.Pointer) => {\r\n      // å³ã‚¯ãƒªãƒƒã‚¯ã§ãƒ‰ãƒ©ãƒƒã‚°é–‹å§‹ã‚’é˜²ã\r\n      if (pointer.rightButtonDown()) return\r\n      \r\n      cardContainer.setData('dragStartTime', this.time.now)\r\n      cardContainer.setDepth(1000) // æœ€å‰é¢ã«è¡¨ç¤º\r\n    })\r\n\r\n    cardContainer.on('pointerup', () => {\r\n      const dragStartTime = cardContainer.getData('dragStartTime')\r\n      const isDragging = cardContainer.getData('isDragging')\r\n      \r\n      // ã‚¯ãƒªãƒƒã‚¯åˆ¤å®šï¼ˆãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ã„ãªã„å ´åˆï¼‰\r\n      if (!isDragging && dragStartTime && this.time.now - dragStartTime < 200) {\r\n        this.toggleCardSelection(cardContainer)\r\n      }\r\n      \r\n      cardContainer.setData('isDragging', false)\r\n    })\r\n\r\n    // ãƒ‰ãƒ©ãƒƒã‚°é–‹å§‹\r\n    cardContainer.on('dragstart', () => {\r\n      cardContainer.setData('isDragging', true)\r\n      this.isDragInProgress = true\r\n      \r\n      // æ–°ã—ã„ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«åŠ¹æœ\r\n      cardContainer.setScale(GAME_CONSTANTS.DRAG_DROP.DRAG_SCALE)\r\n      cardContainer.setAlpha(GAME_CONSTANTS.DRAG_DROP.DRAG_ALPHA)\r\n      \r\n      \r\n      // ãƒ‰ãƒ©ãƒƒã‚°ä¸­ã¯é¸æŠã‚’è§£é™¤\r\n      if (cardContainer.getData('selected')) {\r\n        this.toggleCardSelection(cardContainer)\r\n      }\r\n    })\r\n\r\n    // ãƒ‰ãƒ©ãƒƒã‚°ä¸­\r\n    cardContainer.on('drag', (pointer: Phaser.Input.Pointer, dragX: number, dragY: number) => {\r\n      // ãƒ¢ãƒã‚¤ãƒ«ç«¯æœ«ã§ã®ã‚¿ãƒƒãƒã‚ªãƒ•ã‚»ãƒƒãƒˆèª¿æ•´\r\n      const isMobile = this.scale.orientation === Phaser.Scale.LANDSCAPE || this.scale.orientation === Phaser.Scale.PORTRAIT\r\n      const offsetY = isMobile ? -GAME_CONSTANTS.DRAG_DROP.MOBILE_TOUCH_OFFSET : 0\r\n      \r\n      cardContainer.x = dragX\r\n      cardContainer.y = dragY + offsetY\r\n      \r\n    })\r\n\r\n    // ãƒ‰ãƒ©ãƒƒã‚°çµ‚äº†\r\n    cardContainer.on('dragend', () => {\r\n      // ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«åŠ¹æœã‚’ãƒªã‚»ãƒƒãƒˆ\r\n      cardContainer.setScale(1)\r\n      cardContainer.setAlpha(1)\r\n      \r\n      // ãƒ‰ãƒ­ãƒƒãƒ—å…ˆã®åˆ¤å®š\r\n      const dropZone = this.getDropZone(cardContainer.x, cardContainer.y)\r\n      \r\n      if (dropZone && this.isValidDropZone(dropZone, cardContainer)) {\r\n        // æœ‰åŠ¹ãªãƒ‰ãƒ­ãƒƒãƒ—ã‚¾ãƒ¼ãƒ³ã«ãƒ‰ãƒ­ãƒƒãƒ—\r\n        this.handleValidDrop(dropZone, cardContainer)\r\n      } else {\r\n        // ç„¡åŠ¹ãªãƒ‰ãƒ­ãƒƒãƒ— - å…ƒã®ä½ç½®ã«æˆ»ã™ï¼ˆæŒ¯å‹•åŠ¹æœä»˜ãï¼‰\r\n        this.handleInvalidDrop(cardContainer)\r\n      }\r\n      \r\n      cardContainer.setDepth(0) // é€šå¸¸ã®æ·±åº¦ã«æˆ»ã™\r\n    })\r\n  }\r\n\r\n  /**\r\n   * ã‚«ãƒ¼ãƒ‰ã®é¸æŠçŠ¶æ…‹ã‚’åˆ‡ã‚Šæ›¿ãˆ\r\n   */\r\n  private toggleCardSelection(cardContainer: Phaser.GameObjects.Container): void {\r\n    // ãƒãƒ£ãƒ¬ãƒ³ã‚¸ä¸­ã§ãªã„å ´åˆã¯é¸æŠã§ããªã„\r\n    if (!this.gameInstance.currentChallenge) {\r\n      return\r\n    }\r\n    \r\n    const card = cardContainer.getData('card') as Card\r\n    const isSelected = cardContainer.getData('selected')\r\n    \r\n    if (isSelected) {\r\n      // ã‚²ãƒ¼ãƒ ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ã‚«ãƒ¼ãƒ‰é¸æŠã‚’æ›´æ–°\r\n      this.gameInstance.toggleCardSelection(card)\r\n      this.selectedCards.delete(card.id)\r\n      cardContainer.setData('selected', false)\r\n      cardContainer.setScale(1)\r\n      \r\n      // ã‚«ãƒ¼ãƒ‰é¸æŠè§£é™¤éŸ³ã‚’å†ç”Ÿ\r\n      this.soundManager?.play('cardDeselect')\r\n      \r\n      // ãƒã‚¤ãƒ©ã‚¤ãƒˆå‰Šé™¤\r\n      const highlight = cardContainer.getByName('highlight')\r\n      if (highlight) {\r\n        highlight.destroy()\r\n      }\r\n      \r\n      // é¸æŠè§£é™¤æ™‚ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³\r\n      this.tweens.add({\r\n        targets: cardContainer,\r\n        scale: 1,\r\n        duration: 200,\r\n        ease: 'Back.easeOut'\r\n      })\r\n    } else {\r\n      // ã‚²ãƒ¼ãƒ ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ã‚«ãƒ¼ãƒ‰é¸æŠã‚’æ›´æ–°\r\n      this.gameInstance.toggleCardSelection(card)\r\n      this.selectedCards.add(card.id)\r\n      cardContainer.setData('selected', true)\r\n      \r\n      // ã‚«ãƒ¼ãƒ‰é¸æŠéŸ³ã‚’å†ç”Ÿ\r\n      this.soundManager?.play('cardSelect')\r\n      \r\n      // é¸æŠæ™‚ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³\r\n      this.tweens.add({\r\n        targets: cardContainer,\r\n        scale: 1.1,\r\n        duration: 200,\r\n        ease: 'Back.easeOut'\r\n      })\r\n      \r\n      // ãƒã‚¤ãƒ©ã‚¤ãƒˆè¿½åŠ \r\n      const graphics = this.add.graphics()\r\n      graphics.lineStyle(4, 0x00ff00, 1)\r\n      graphics.strokeRoundedRect(-62, -82, 124, 164, 12)\r\n      graphics.setName('highlight')\r\n      cardContainer.addAt(graphics, 0)\r\n      \r\n      // ã‚°ãƒ­ã‚¦åŠ¹æœ\r\n      this.tweens.add({\r\n        targets: graphics,\r\n        alpha: 0.5,\r\n        duration: 500,\r\n        yoyo: true,\r\n        repeat: -1,\r\n        ease: 'Sine.easeInOut'\r\n      })\r\n    }\r\n\r\n    // ãƒãƒ£ãƒ¬ãƒ³ã‚¸ä¸­ãªã‚‰ãƒ‘ãƒ¯ãƒ¼è¡¨ç¤ºã‚’æ›´æ–°\r\n    if (this.gameInstance.currentChallenge) {\r\n      this.updatePowerDisplay()\r\n    }\r\n  }\r\n\r\n  /**\r\n   * æ‰‹æœ­ã‚’æ•´åˆ—\r\n   */\r\n  private arrangeHand(): void {\r\n    const cardCount = this.handCards.length\r\n    const totalWidth = (cardCount - 1) * (GAME_CONSTANTS.CARD_WIDTH + GAME_CONSTANTS.CARD_SPACING)\r\n    const startX = this.centerX - totalWidth / 2\r\n\r\n    this.handCards.forEach((card, index) => {\r\n      const targetX = startX + index * (GAME_CONSTANTS.CARD_WIDTH + GAME_CONSTANTS.CARD_SPACING)\r\n      \r\n      // ãƒ‰ãƒ©ãƒƒã‚°ç”¨ã®å…ƒã®ä½ç½®ã‚’æ›´æ–°\r\n      card.setData('originalX', targetX)\r\n      card.setData('originalY', GAME_CONSTANTS.HAND_Y_POSITION)\r\n      \r\n      this.tweens.add({\r\n        targets: card,\r\n        x: targetX,\r\n        y: GAME_CONSTANTS.HAND_Y_POSITION,\r\n        duration: GAME_CONSTANTS.CARD_MOVE_DURATION,\r\n        ease: 'Power2'\r\n      })\r\n    })\r\n    \r\n    // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œç”¨ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹å¯èƒ½è¦ç´ ã‚’å†ç™»éŒ²\r\n    this.registerHandCardsFocus()\r\n  }\r\n\r\n  /**\r\n   * ãƒãƒ£ãƒ¬ãƒ³ã‚¸é–‹å§‹\r\n   */\r\n  private startChallenge(): void {\r\n    if (this.gameInstance.currentChallenge) {\r\n      // ã™ã§ã«ãƒãƒ£ãƒ¬ãƒ³ã‚¸ãŒé€²è¡Œä¸­\r\n      return\r\n    }\r\n\r\n    // ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã‚«ãƒ¼ãƒ‰ã‚’å¼•ã\r\n    const challengeCard = this.gameInstance.challengeDeck.drawCard()\r\n    if (!challengeCard) {\r\n      // ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã‚«ãƒ¼ãƒ‰ãŒã‚ã‚Šã¾ã›ã‚“\r\n      return\r\n    }\r\n\r\n    // ãƒãƒ£ãƒ¬ãƒ³ã‚¸é–‹å§‹\r\n    this.gameInstance.startChallenge(challengeCard)\r\n    \r\n    // ãƒãƒ£ãƒ¬ãƒ³ã‚¸é–‹å§‹éŸ³ã‚’å†ç”Ÿ\r\n    this.soundManager?.play('challengeStart')\r\n    \r\n    // ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã‚«ãƒ¼ãƒ‰ã‚’è¡¨ç¤º\r\n    this.displayChallengeCard(challengeCard)\r\n    \r\n    // UIã‚’æ›´æ–°\r\n    this.updateChallengeUI()\r\n    this.updateActionButtons()\r\n    \r\n    // æ‰‹æœ­ã®ã‚«ãƒ¼ãƒ‰ã‚’é¸æŠå¯èƒ½ã«ã™ã‚‹\r\n    this.enableHandCardSelection()\r\n  }\r\n\r\n  /**\r\n   * æ‰‹æœ­ã®ã‚«ãƒ¼ãƒ‰ã‚’é¸æŠå¯èƒ½ã«ã™ã‚‹\r\n   */\r\n  private enableHandCardSelection(): void {\r\n    this.handCards.forEach(cardContainer => {\r\n      // ãƒãƒ£ãƒ¬ãƒ³ã‚¸ä¸­ã§ã‚ã‚‹ã“ã¨ã‚’æ˜ç¤º\r\n      cardContainer.setData('challengeActive', true)\r\n      \r\n      // DropZoneIntegrationã®setupCardDragAndDropã‚’ä½¿ç”¨\r\n      if (this.dropZoneIntegration) {\r\n        // ãƒ‰ãƒ©ãƒƒã‚°å¯èƒ½ã«è¨­å®š\r\n        this.input.setDraggable(cardContainer, true)\r\n        \r\n        // æ—¢å­˜ã®ãƒ‰ãƒ©ãƒƒã‚°ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã‚’ã‚¯ãƒªã‚¢\r\n        cardContainer.off('dragstart')\r\n        cardContainer.off('drag')\r\n        cardContainer.off('dragend')\r\n        \r\n        // DropZoneIntegrationã®ãƒ‰ãƒ©ãƒƒã‚°ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã‚’è¨­å®š\r\n        this.dropZoneIntegration.setupCardDragAndDrop(cardContainer)\r\n      } else {\r\n        // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: åŸºæœ¬çš„ãªãƒ‰ãƒ©ãƒƒã‚°æ©Ÿèƒ½\r\n        this.input.setDraggable(cardContainer, true)\r\n        \r\n        cardContainer.on('dragstart', (pointer: Phaser.Input.Pointer) => {\r\n          cardContainer.setData('isDragging', true)\r\n          cardContainer.setDepth(1000)\r\n        })\r\n        \r\n        cardContainer.on('drag', (pointer: Phaser.Input.Pointer, dragX: number, dragY: number) => {\r\n          cardContainer.x = dragX\r\n          cardContainer.y = dragY\r\n        })\r\n        \r\n        cardContainer.on('dragend', (pointer: Phaser.Input.Pointer) => {\r\n          cardContainer.setData('isDragging', false)\r\n          cardContainer.setDepth(10)\r\n          \r\n          // å…ƒã®ä½ç½®ã«æˆ»ã™\r\n          const originalX = cardContainer.getData('originalX') || cardContainer.x\r\n          const originalY = cardContainer.getData('originalY') || cardContainer.y\r\n          \r\n          this.tweens.add({\r\n            targets: cardContainer,\r\n            x: originalX,\r\n            y: originalY,\r\n            duration: 300,\r\n            ease: 'Back.easeOut'\r\n          })\r\n        })\r\n      }\r\n      \r\n      // è¦–è¦šçš„ã«ãƒ‰ãƒ©ãƒƒã‚°å¯èƒ½ã§ã‚ã‚‹ã“ã¨ã‚’ç¤ºã™\r\n      const glowEffect = cardContainer.getData('glow')\r\n      if (glowEffect) {\r\n        glowEffect.setVisible(true)\r\n      }\r\n    })\r\n  }\r\n\r\n  /**\r\n   * ã‚¿ãƒ¼ãƒ³çµ‚äº†\r\n   */\r\n  private endTurn(): void {\r\n    if (!this.gameInstance.isInProgress()) return\r\n    \r\n    // ãƒ•ã‚§ãƒ¼ã‚ºã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦é©åˆ‡ã«å‡¦ç†\r\n    if (this.gameInstance.phase === 'resolution' || this.gameInstance.phase === 'draw') {\r\n      // ã‚¿ãƒ¼ãƒ³é·ç§»ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤\r\n      const transitionOverlay = this.add.rectangle(\r\n        this.centerX,\r\n        this.centerY,\r\n        this.gameWidth,\r\n        this.gameHeight,\r\n        0x000000,\r\n        0\r\n      )\r\n      transitionOverlay.setDepth(1999)\r\n      \r\n      // ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³\r\n      this.tweens.add({\r\n        targets: transitionOverlay,\r\n        alpha: 0.5,\r\n        duration: 200,\r\n        ease: 'Power2',\r\n        onComplete: () => {\r\n          // ã‚¹ãƒ†ãƒ¼ã‚¸é€²è¡Œãƒã‚§ãƒƒã‚¯\r\n          this.checkStageProgress()\r\n          \r\n          // æ¬¡ã®ã‚¿ãƒ¼ãƒ³ã¸\r\n          this.gameInstance.nextTurn()\r\n          \r\n          // ç°¡ç´ åŒ–ç‰ˆï¼šä¿é™ºã¯æ°¸ç¶šåŠ¹æœã®ãŸã‚ã€æœŸé™åˆ‡ã‚Œå‡¦ç†ã¯ä¸è¦\r\n          \r\n          // UIæ›´æ–°ï¼ˆãƒ€ãƒ¼ãƒ†ã‚£ãƒ•ãƒ©ã‚°ã‚’è¨­å®šï¼‰\r\n          this.dirtyFlags.vitality = true\r\n          this.dirtyFlags.stage = true  \r\n          this.dirtyFlags.actionButtons = true\r\n          this.updateUI()\r\n          \r\n          // ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ç”¨ã«ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã‚’æ›´æ–°\r\n          this.updateGameStateForTutorial()\r\n          \r\n          // ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆ\r\n          this.tweens.add({\r\n            targets: transitionOverlay,\r\n            alpha: 0,\r\n            duration: 200,\r\n            ease: 'Power2',\r\n            onComplete: () => {\r\n              transitionOverlay.destroy()\r\n              // ã‚²ãƒ¼ãƒ çµ‚äº†åˆ¤å®š\r\n              this.checkGameEnd()\r\n            }\r\n          })\r\n        }\r\n      })\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Phase 3-3: ä¿é™ºã‚«ãƒ¼ãƒ‰ãƒªã‚¹ãƒˆã‚’æ›´æ–°\r\n   */\r\n  private updateInsuranceList(): void {\r\n    if (!this.insuranceListContainer) return\r\n\r\n    // æ—¢å­˜ã®ã‚«ãƒ¼ãƒ‰ã‚¢ã‚¤ãƒ†ãƒ ã‚’å‰Šé™¤ï¼ˆã‚¿ã‚¤ãƒˆãƒ«ä»¥å¤–ï¼‰\r\n    const itemsToRemove = this.insuranceListContainer.list.filter((item, index) => index > 0)\r\n    itemsToRemove.forEach(item => item.destroy())\r\n\r\n    const activeInsurances = this.gameInstance.getActiveInsurances()\r\n    \r\n    if (activeInsurances.length === 0) {\r\n      const noInsuranceText = this.add.text(\r\n        0, 30,\r\n        'ãªã—',\r\n        {\r\n          fontFamily: 'Noto Sans JP',\r\n          fontSize: '14px',\r\n          color: '#999999'\r\n        }\r\n      ).setOrigin(0.5)\r\n      this.insuranceListContainer.add(noInsuranceText)\r\n      return\r\n    }\r\n\r\n    // ä¿é™ºã‚«ãƒ¼ãƒ‰ã‚’ãƒªã‚¹ãƒˆè¡¨ç¤º\r\n    activeInsurances.forEach((insurance, index) => {\r\n      const yPos = 30 + index * 35\r\n\r\n      // ã‚«ãƒ¼ãƒ‰ã‚³ãƒ³ãƒ†ãƒŠ\r\n      const cardItem = this.add.container(0, yPos)\r\n\r\n      // Phase 5-2: æœŸé™åˆ‡ã‚Œé–“è¿‘ã®è­¦å‘Šè¡¨ç¤º\r\n      const isExpiringSoon = insurance.durationType === 'term' && \r\n                             insurance.remainingTurns !== undefined && \r\n                             insurance.remainingTurns <= 2\r\n      const isExpiringSoonTwoTurns = isExpiringSoon && insurance.remainingTurns === 2\r\n      const isExpiringSoonOneTurn = isExpiringSoon && insurance.remainingTurns === 1\r\n\r\n      // ã‚«ãƒ¼ãƒ‰èƒŒæ™¯è‰²ã®æ±ºå®š\r\n      let bgColor = insurance.durationType === 'whole_life' ? 0xFFD700 : 0xC0C0C0\r\n      let strokeColor = bgColor\r\n      \r\n      if (isExpiringSoonTwoTurns) {\r\n        bgColor = 0xFFA500  // ã‚ªãƒ¬ãƒ³ã‚¸è‰²ï¼ˆè­¦å‘Šï¼‰\r\n        strokeColor = 0xFFA500\r\n      } else if (isExpiringSoonOneTurn) {\r\n        bgColor = 0xFF4444  // èµ¤è‰²ï¼ˆå±é™ºï¼‰\r\n        strokeColor = 0xFF4444\r\n      }\r\n\r\n      // ã‚«ãƒ¼ãƒ‰èƒŒæ™¯\r\n      const itemBg = this.add.rectangle(\r\n        0, 0, 240, 30,\r\n        bgColor,\r\n        0.2\r\n      )\r\n      itemBg.setStrokeStyle(2, strokeColor)\r\n\r\n      // Phase 5-2: æœŸé™åˆ‡ã‚Œé–“è¿‘ã®ç‚¹æ»…ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³\r\n      if (isExpiringSoon) {\r\n        const animationDuration = isExpiringSoonOneTurn ? 300 : 500  // 1ã‚¿ãƒ¼ãƒ³æ®‹ã‚Šã¯é€Ÿã„ç‚¹æ»…\r\n        this.tweens.add({\r\n          targets: itemBg,\r\n          alpha: 0.3,\r\n          duration: animationDuration,\r\n          yoyo: true,\r\n          repeat: -1,\r\n          ease: 'Sine.easeInOut'\r\n        })\r\n        itemBg.setFillStyle(bgColor, 0.3)\r\n      }\r\n\r\n      // Phase 5-2: ä¿é™ºç¨®åˆ¥ãƒãƒƒã‚¸ï¼ˆè­¦å‘ŠçŠ¶æ³ã«å¿œã˜ã¦è‰²å¤‰æ›´ï¼‰\r\n      let badgeColor = insurance.durationType === 'whole_life' ? 0xFFD700 : 0xC0C0C0\r\n      let textColor = insurance.durationType === 'whole_life' ? '#000000' : '#ffffff'\r\n      \r\n      if (isExpiringSoonTwoTurns) {\r\n        badgeColor = 0xFFA500  // ã‚ªãƒ¬ãƒ³ã‚¸è‰²ï¼ˆè­¦å‘Šï¼‰\r\n        textColor = '#000000'\r\n      } else if (isExpiringSoonOneTurn) {\r\n        badgeColor = 0xFF4444  // èµ¤è‰²ï¼ˆå±é™ºï¼‰\r\n        textColor = '#ffffff'\r\n      }\r\n\r\n      const typeBadge = this.add.rectangle(\r\n        -100, 0, 40, 20,\r\n        badgeColor\r\n      )\r\n      typeBadge.setStrokeStyle(1, 0xffffff)\r\n\r\n      const typeText = this.add.text(\r\n        -100, 0,\r\n        insurance.durationType === 'whole_life' ? 'çµ‚èº«' : 'å®šæœŸ',\r\n        {\r\n          fontFamily: 'Noto Sans JP',\r\n          fontSize: '10px',\r\n          color: textColor,\r\n          fontStyle: 'bold'\r\n        }\r\n      ).setOrigin(0.5)\r\n\r\n      // ã‚«ãƒ¼ãƒ‰å\r\n      const nameText = this.add.text(\r\n        -50, 0,\r\n        insurance.name.length > 8 ? `${insurance.name.substring(0, 8)  }...` : insurance.name,\r\n        {\r\n          fontFamily: 'Noto Sans JP',\r\n          fontSize: '12px',\r\n          color: '#ffffff'\r\n        }\r\n      ).setOrigin(0, 0.5)\r\n\r\n      // Phase 5-2: å¹´é½¢ãƒœãƒ¼ãƒŠã‚¹è¡¨ç¤ºï¼ˆçµ‚èº«ä¿é™ºã®ã¿ï¼‰\r\n      if (insurance.durationType === 'whole_life') {\r\n        const stage = this.gameInstance.stage\r\n        let bonus = 0\r\n        if (stage === 'middle') bonus = 0.5\r\n        else if (stage === 'fulfillment') bonus = 1.0\r\n        \r\n        if (bonus > 0) {\r\n          const bonusText = this.add.text(\r\n            50, 0,\r\n            `+${bonus}`,\r\n            {\r\n              fontFamily: 'Noto Sans JP',\r\n              fontSize: '12px',\r\n              color: '#4ade80',\r\n              fontStyle: 'bold'\r\n            }\r\n          ).setOrigin(0.5)\r\n          cardItem.add(bonusText)\r\n        }\r\n      }\r\n\r\n      // æ®‹ã‚Šã‚¿ãƒ¼ãƒ³æ•°ï¼ˆå®šæœŸä¿é™ºã®å ´åˆï¼‰\r\n      if (insurance.durationType === 'term' && insurance.remainingTurns !== undefined) {\r\n        // æ®‹ã‚Šã‚¿ãƒ¼ãƒ³æ•°ã«å¿œã˜ãŸè‰²åˆ†ã‘\r\n        let turnsTextColor = '#ffffff'\r\n        if (insurance.remainingTurns === 2) {\r\n          turnsTextColor = '#FFA500'  // ã‚ªãƒ¬ãƒ³ã‚¸è‰²ï¼ˆè­¦å‘Šï¼‰\r\n        } else if (insurance.remainingTurns === 1) {\r\n          turnsTextColor = '#FF4444'  // èµ¤è‰²ï¼ˆå±é™ºï¼‰\r\n        }\r\n\r\n        const turnsText = this.add.text(\r\n          100, 0,\r\n          `æ®‹ã‚Š${insurance.remainingTurns}T`,\r\n          {\r\n            fontFamily: 'Noto Sans JP',\r\n            fontSize: '12px',\r\n            color: turnsTextColor,\r\n            fontStyle: insurance.remainingTurns <= 2 ? 'bold' : 'normal'\r\n          }\r\n        ).setOrigin(1, 0.5)\r\n        \r\n        // Phase 5-2: æœŸé™åˆ‡ã‚Œé–“è¿‘ã®è­¦å‘Šã‚¢ã‚¤ã‚³ãƒ³ï¼ˆè‰²åˆ†ã‘å¯¾å¿œï¼‰\r\n        if (insurance.remainingTurns <= 2) {\r\n          const warningIconColor = insurance.remainingTurns === 1 ? '#FF4444' : '#FFA500'\r\n          const warningIcon = this.add.text(\r\n            115, 0,\r\n            insurance.remainingTurns === 1 ? 'ğŸš¨' : 'âš ',\r\n            {\r\n              fontFamily: 'Noto Sans JP',\r\n              fontSize: '14px',\r\n              color: warningIconColor\r\n            }\r\n          ).setOrigin(0.5)\r\n          cardItem.add(warningIcon)\r\n        }\r\n        \r\n        cardItem.add(turnsText)\r\n      }\r\n\r\n      cardItem.add([itemBg, typeBadge, typeText, nameText])\r\n      this.insuranceListContainer.add(cardItem)\r\n\r\n      // 3æšã”ã¨ã«åŒºåˆ‡ã‚Šç·š\r\n      if ((index + 1) % 3 === 0 && index < activeInsurances.length - 1) {\r\n        const divider = this.add.rectangle(\r\n          0, yPos + 20, 200, 2,\r\n          0xff4444, 0.5\r\n        )\r\n        this.insuranceListContainer.add(divider)\r\n      }\r\n    })\r\n\r\n    // è² æ‹…ç™ºç”Ÿã®è­¦å‘Š\r\n    if (activeInsurances.length >= 3) {\r\n      const warningText = this.add.text(\r\n        0, 30 + activeInsurances.length * 35 + 10,\r\n        `âš  ${Math.floor(activeInsurances.length / 3)}ãƒã‚¤ãƒ³ãƒˆè² æ‹…ä¸­`,\r\n        {\r\n          fontFamily: 'Noto Sans JP',\r\n          fontSize: '14px',\r\n          color: '#ff4444',\r\n          fontStyle: 'bold'\r\n        }\r\n      ).setOrigin(0.5)\r\n      this.insuranceListContainer.add(warningText)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Phase 3-3: ä¿é™ºæ–™è² æ‹…ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã‚’æ›´æ–°\r\n   */\r\n  private updateBurdenIndicator(): void {\r\n    if (!this.burdenIndicatorContainer) return\r\n\r\n    const burdenText = this.burdenIndicatorContainer.getByName('burden-value') as Phaser.GameObjects.Text\r\n    if (!burdenText) return\r\n\r\n    const burden = this.gameInstance.insuranceBurden\r\n    const previousBurden = parseInt(burdenText.text === 'è² æ‹…ãªã—' ? '0' : burdenText.text)\r\n\r\n    // è² æ‹…å€¤ã‚’æ›´æ–°\r\n    burdenText.setText(burden === 0 ? 'è² æ‹…ãªã—' : `${burden}`)\r\n    burdenText.setColor(burden === 0 ? '#00ff00' : '#ff4444')\r\n\r\n    // è² æ‹…ãŒå¢—ãˆãŸå ´åˆã¯è­¦å‘Šã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³\r\n    if (burden < previousBurden) { // è² ã®å€¤ãªã®ã§é€†\r\n      this.tweens.add({\r\n        targets: this.burdenIndicatorContainer,\r\n        scaleX: 1.2,\r\n        scaleY: 1.2,\r\n        duration: 200,\r\n        yoyo: true,\r\n        ease: 'Power2',\r\n        onComplete: () => {\r\n          // èµ¤ãç‚¹æ»…\r\n          const bg = this.burdenIndicatorContainer?.list[0] as Phaser.GameObjects.Rectangle\r\n          if (bg) {\r\n            bg.setFillStyle(0xff0000, 0.8)\r\n            this.time.delayedCall(300, () => {\r\n              bg.setFillStyle(0x000000, 0.7)\r\n            })\r\n          }\r\n        }\r\n      })\r\n    }\r\n  }\r\n\r\n  /**\r\n   * UIæ›´æ–°ï¼ˆæœ€é©åŒ–ç‰ˆï¼‰\r\n   */\r\n  private updateUI(): void {\r\n    // ãƒ€ãƒ¼ãƒ†ã‚£ãƒ•ãƒ©ã‚°ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦å¿…è¦ãªéƒ¨åˆ†ã®ã¿æ›´æ–°\r\n    if (this.dirtyFlags.vitality) {\r\n      this.updateVitalityDisplay()\r\n      this.dirtyFlags.vitality = false\r\n    }\r\n\r\n    if (this.dirtyFlags.stage) {\r\n      this.updateStageDisplay() \r\n      this.dirtyFlags.stage = false\r\n    }\r\n\r\n    if (this.dirtyFlags.deck) {\r\n      this.updateDeckDisplay()\r\n      this.dirtyFlags.deck = false\r\n    }\r\n\r\n    if (this.dirtyFlags.insurance) {\r\n      this.updateInsuranceList()\r\n      this.dirtyFlags.insurance = false\r\n    }\r\n\r\n    if (this.dirtyFlags.burden) {\r\n      this.updateBurdenIndicator()\r\n      this.dirtyFlags.burden = false\r\n    }\r\n\r\n    if (this.dirtyFlags.hand) {\r\n      this.arrangeHand()\r\n      this.dirtyFlags.hand = false\r\n    }\r\n\r\n    if (this.dirtyFlags.actionButtons) {\r\n      this.updateActionButtons()\r\n      this.dirtyFlags.actionButtons = false\r\n    }\r\n\r\n    if (this.dirtyFlags.challenge) {\r\n      this.updateChallengeUI()\r\n      this.dirtyFlags.challenge = false\r\n    }\r\n  }\r\n\r\n  /**\r\n   * æ´»åŠ›è¡¨ç¤ºã‚’æ›´æ–°\r\n   */\r\n  private updateVitalityDisplay(): void {\r\n    const currentTime = this.time.now\r\n    \r\n    // ã‚¹ãƒ­ãƒƒãƒˆãƒªãƒ³ã‚°: 100msä»¥å†…ã®æ›´æ–°ã¯ç„¡è¦–\r\n    if (currentTime - this.updateThrottleTimers.vitality < 100) {\r\n      return\r\n    }\r\n    this.updateThrottleTimers.vitality = currentTime\r\n\r\n    const vitalityText = this.children.getByName('vitality-text') as Phaser.GameObjects.Text\r\n    if (vitalityText) {\r\n      const stageLabel = this.getStageDisplayText()\r\n      vitalityText.setText(`æ´»åŠ›: ${this.gameInstance.vitality} / ${this.gameInstance.maxVitality} (${stageLabel})`)\r\n    }\r\n\r\n    this.updateVitalityBar()\r\n  }\r\n\r\n  /**\r\n   * ã‚¹ãƒ†ãƒ¼ã‚¸è¡¨ç¤ºã‚’æ›´æ–°  \r\n   */\r\n  private updateStageDisplay(): void {\r\n    const turnText = this.children.getByName('turn-text') as Phaser.GameObjects.Text\r\n    if (turnText) {\r\n      turnText.setText(`ã‚¿ãƒ¼ãƒ³: ${this.gameInstance.turn}`)\r\n    }\r\n    \r\n    const stageText = this.children.getByName('stage-text') as Phaser.GameObjects.Text\r\n    if (stageText) {\r\n      stageText.setText(this.getStageDisplayText())\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ãƒ‡ãƒƒã‚­è¡¨ç¤ºã‚’æ›´æ–°\r\n   */\r\n  private updateDeckDisplay(): void {\r\n    const deckCount = this.children.getByName('deck-count') as Phaser.GameObjects.Text\r\n    if (deckCount) {\r\n      deckCount.setText(`${this.gameInstance.playerDeck.size()}`)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * æ´»åŠ›ãƒãƒ¼ã‚’æ›´æ–°\r\n   */\r\n  private updateVitalityBar(): void {\r\n    if (!this.vitalityBar || !this.vitalityBarContainer) return\r\n\r\n    const oldVitality = this.vitalityBar.getData('currentVitality') || this.gameInstance.vitality\r\n    const newVitality = this.gameInstance.vitality\r\n    const vitalityPercentage = newVitality / this.gameInstance.maxVitality\r\n    const targetWidth = Math.max(0, this.vitalityBarMaxWidth * vitalityPercentage)\r\n    const newColor = this.getVitalityBarColor(vitalityPercentage)\r\n\r\n    // æ•°å€¤ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³\r\n    const counter = { value: oldVitality }\r\n    this.tweens.add({\r\n      targets: counter,\r\n      value: newVitality,\r\n      duration: 800,\r\n      ease: 'Cubic.out',\r\n      onUpdate: () => {\r\n        const vitalityText = this.children.getByName('vitality-text') as Phaser.GameObjects.Text\r\n        if (vitalityText) {\r\n          const stageLabel = this.getStageDisplayText()\r\n          vitalityText.setText(`æ´»åŠ›: ${Math.floor(counter.value)} / ${this.gameInstance.maxVitality} (${stageLabel})`)\r\n        }\r\n      }\r\n    })\r\n\r\n    // ãƒãƒ¼ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆã‚ˆã‚Šæ»‘ã‚‰ã‹ï¼‰\r\n    this.tweens.add({\r\n      targets: this.vitalityBar,\r\n      width: targetWidth,\r\n      duration: 800,\r\n      ease: 'Cubic.out',\r\n      onUpdate: () => {\r\n        // ç¾åœ¨ã®å‰²åˆã«åŸºã¥ã„ã¦è‰²ã‚’å‹•çš„ã«æ›´æ–°\r\n        const currentPercentage = this.vitalityBar!.width / this.vitalityBarMaxWidth\r\n        const currentColor = this.getVitalityBarColor(currentPercentage)\r\n        this.vitalityBar?.setFillStyle(currentColor)\r\n      },\r\n      onComplete: () => {\r\n        // æœ€çµ‚çš„ãªè‰²ã‚’è¨­å®š\r\n        this.vitalityBar?.setFillStyle(newColor)\r\n      }\r\n    })\r\n\r\n    // ãƒã‚¤ã‚¿ãƒªãƒ†ã‚£ãŒæ¸›ã£ãŸå ´åˆã®ãƒ‘ãƒ«ã‚¹ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ\r\n    if (newVitality < oldVitality) {\r\n      this.tweens.add({\r\n        targets: this.vitalityBarContainer,\r\n        scaleX: 1.05,\r\n        scaleY: 1.05,\r\n        duration: 150,\r\n        ease: 'Power2',\r\n        yoyo: true,\r\n        repeat: 1\r\n      })\r\n    }\r\n    \r\n    // ãƒã‚¤ã‚¿ãƒªãƒ†ã‚£ãŒå¢—ãˆãŸå ´åˆã®ã‚°ãƒ­ãƒ¼ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ\r\n    if (newVitality > oldVitality) {\r\n      const glow = this.add.rectangle(0, 0, this.vitalityBarMaxWidth + 20, 30, 0x10B981, 0.5)\r\n      glow.setAlpha(0)\r\n      this.vitalityBarContainer.add(glow)\r\n      \r\n      this.tweens.add({\r\n        targets: glow,\r\n        alpha: 0.6,\r\n        duration: 200,\r\n        ease: 'Power2',\r\n        yoyo: true,\r\n        repeat: 1,\r\n        onComplete: () => glow.destroy()\r\n      })\r\n    }\r\n\r\n    // ç¾åœ¨å€¤ã‚’ä¿å­˜\r\n    this.vitalityBar.setData('currentVitality', newVitality)\r\n  }\r\n\r\n  /**\r\n   * ãƒ‘ãƒ¯ãƒ¼è¡¨ç¤ºã‚’æ›´æ–°\r\n   */\r\n  private updatePowerDisplay(): void {\r\n    const powerDisplay = this.children.getByName('power-display') as Phaser.GameObjects.Container\r\n    if (!powerDisplay) return\r\n\r\n    // Phase 3-3: è©³ç´°ãªãƒ‘ãƒ¯ãƒ¼è¨ˆç®—\r\n    const selectedCardsArray = this.handCards\r\n      .filter(cardContainer => this.selectedCards.has(cardContainer.getData('card').id))\r\n      .map(cardContainer => cardContainer.getData('card') as Card)\r\n    \r\n    const powerBreakdown = this.gameInstance.calculateTotalPower(selectedCardsArray)\r\n    \r\n    // æ—¢å­˜ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’å‰Šé™¤\r\n    const textsToRemove = powerDisplay.list.filter(item => \r\n      item instanceof Phaser.GameObjects.Text && item.name !== 'power-text' && item.name !== 'count-text'\r\n    )\r\n    textsToRemove.forEach(text => text.destroy())\r\n    \r\n    const powerText = powerDisplay.getByName('power-text') as Phaser.GameObjects.Text\r\n    const countText = powerDisplay.getByName('count-text') as Phaser.GameObjects.Text\r\n    \r\n    if (powerText) {\r\n      powerText.setText(`åˆè¨ˆãƒ‘ãƒ¯ãƒ¼: ${powerBreakdown.total}`)\r\n      powerText.setColor(powerBreakdown.total > 0 ? '#00ff00' : '#ff4444')\r\n    }\r\n    if (countText) {\r\n      countText.setText(`é¸æŠã‚«ãƒ¼ãƒ‰: ${this.selectedCards.size}æš`)\r\n    }\r\n\r\n    // Phase 3-3: ãƒ‘ãƒ¯ãƒ¼ã®å†…è¨³ã‚’è¡¨ç¤º\r\n    let yOffset = 40\r\n    \r\n    // åŸºæœ¬ãƒ‘ãƒ¯ãƒ¼\r\n    if (powerBreakdown.base > 0) {\r\n      const baseText = this.add.text(\r\n        0, yOffset,\r\n        `åŸºæœ¬: +${powerBreakdown.base}`,\r\n        {\r\n          fontFamily: 'Noto Sans JP',\r\n          fontSize: '14px',\r\n          color: '#ffffff'\r\n        }\r\n      ).setOrigin(0.5)\r\n      powerDisplay.add(baseText)\r\n      yOffset += 20\r\n    }\r\n\r\n    // ä¿é™ºãƒœãƒ¼ãƒŠã‚¹\r\n    if (powerBreakdown.insurance > 0) {\r\n      const insuranceText = this.add.text(\r\n        0, yOffset,\r\n        `ä¿é™º: +${powerBreakdown.insurance}`,\r\n        {\r\n          fontFamily: 'Noto Sans JP',\r\n          fontSize: '14px',\r\n          color: '#4ade80'\r\n        }\r\n      ).setOrigin(0.5)\r\n      powerDisplay.add(insuranceText)\r\n      yOffset += 20\r\n    }\r\n\r\n    // ä¿é™ºæ–™è² æ‹…\r\n    if (powerBreakdown.burden < 0) {\r\n      const burdenText = this.add.text(\r\n        0, yOffset,\r\n        `è² æ‹…: ${powerBreakdown.burden}`,\r\n        {\r\n          fontFamily: 'Noto Sans JP',\r\n          fontSize: '14px',\r\n          color: '#ff4444',\r\n          fontStyle: 'bold'\r\n        }\r\n      ).setOrigin(0.5)\r\n      powerDisplay.add(burdenText)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ãƒ‰ãƒ­ãƒƒãƒ—ã‚¾ãƒ¼ãƒ³ã‚’åˆ¤å®š\r\n   */\r\n  private getDropZone(x: number, y: number): string | null {\r\n    // ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã‚¨ãƒªã‚¢ã®åˆ¤å®š\r\n    const challengeX = this.centerX\r\n    const challengeY = GAME_CONSTANTS.CHALLENGE_Y_POSITION\r\n    const distance = Phaser.Math.Distance.Between(x, y, challengeX, challengeY)\r\n    \r\n    if (distance < 100) {\r\n      return 'challenge'\r\n    }\r\n    \r\n    // æ–°ã—ã„DropZoneã‚·ã‚¹ãƒ†ãƒ ã§æ•ã¦æœ­ã‚¾ãƒ¼ãƒ³ã¯å®Ÿè£…æ¸ˆã¿\r\n    \r\n    return null\r\n  }\r\n\r\n  /**\r\n   * æœ‰åŠ¹ãªãƒ‰ãƒ­ãƒƒãƒ—å‡¦ç†\r\n   */\r\n  private handleValidDrop(zoneName: string, cardContainer: Phaser.GameObjects.Container): void {\r\n    const zone = this.dropZones.get(zoneName)\r\n    if (!zone) return\r\n    \r\n    // ãƒã‚¦ãƒ³ã‚¹åŠ¹æœä»˜ãã§ãƒ‰ãƒ­ãƒƒãƒ—ã‚¾ãƒ¼ãƒ³ã«ç§»å‹•\r\n    this.tweens.add({\r\n      targets: cardContainer,\r\n      x: zone.x,\r\n      y: zone.y,\r\n      scaleX: GAME_CONSTANTS.DRAG_DROP.DROP_ZONE_SCALE,\r\n      scaleY: GAME_CONSTANTS.DRAG_DROP.DROP_ZONE_SCALE,\r\n      duration: GAME_CONSTANTS.DRAG_DROP.BOUNCE_DURATION / 2,\r\n      ease: 'Back.out',\r\n      onComplete: () => {\r\n        // ã‚¹ã‚±ãƒ¼ãƒ«ã‚’å…ƒã«æˆ»ã™\r\n        this.tweens.add({\r\n          targets: cardContainer,\r\n          scaleX: 1,\r\n          scaleY: 1,\r\n          duration: GAME_CONSTANTS.DRAG_DROP.BOUNCE_DURATION / 2,\r\n          ease: 'Elastic.out'\r\n        })\r\n      }\r\n    })\r\n    \r\n    // æˆåŠŸã‚¨ãƒ•ã‚§ã‚¯ãƒˆ\r\n    this.showDropSuccessEffect(zone.x, zone.y)\r\n    \r\n    // ã‚¾ãƒ¼ãƒ³åˆ¥ã®å‡¦ç†\r\n    switch (zoneName) {\r\n      case 'challenge':\r\n        this.handleCardDropToChallenge(cardContainer)\r\n        break\r\n      case 'discard':\r\n        this.handleCardDropToDiscard(cardContainer)\r\n        break\r\n      default:\r\n        console.warn(`Unknown drop zone: ${zoneName}`)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ç„¡åŠ¹ãªãƒ‰ãƒ­ãƒƒãƒ—å‡¦ç†\r\n   */\r\n  private handleInvalidDrop(cardContainer: Phaser.GameObjects.Container): void {\r\n    // æŒ¯å‹•åŠ¹æœ\r\n    const originalX = cardContainer.getData('originalX')\r\n    const originalY = cardContainer.getData('originalY')\r\n    \r\n    // ã¾ãšæŒ¯å‹•\r\n    this.tweens.add({\r\n      targets: cardContainer,\r\n      x: cardContainer.x + 10,\r\n      duration: GAME_CONSTANTS.DRAG_DROP.VIBRATION_DURATION / 6,\r\n      ease: 'Power2',\r\n      yoyo: true,\r\n      repeat: 5,\r\n      onComplete: () => {\r\n        // æŒ¯å‹•å¾Œã€å…ƒã®ä½ç½®ã«æˆ»ã‚‹\r\n        this.tweens.add({\r\n          targets: cardContainer,\r\n          x: originalX,\r\n          y: originalY,\r\n          duration: GAME_CONSTANTS.CARD_MOVE_DURATION,\r\n          ease: 'Back.out'\r\n        })\r\n      }\r\n    })\r\n    \r\n    // å¤±æ•—ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ\r\n    this.showDropFailureEffect(cardContainer.x, cardContainer.y)\r\n  }\r\n\r\n  /**\r\n   * ãƒ‰ãƒ­ãƒƒãƒ—æˆåŠŸã‚¨ãƒ•ã‚§ã‚¯ãƒˆ\r\n   */\r\n  private showDropSuccessEffect(x: number, y: number): void {\r\n    // æˆåŠŸæ™‚ã®ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«åŠ¹æœï¼ˆç·‘è‰²ã®è¼ãï¼‰\r\n    const effect = this.add.graphics()\r\n    effect.setPosition(x, y)\r\n    effect.setDepth(1100)\r\n    \r\n    // å††å½¢ã®è¼ãã‚’æç”»\r\n    effect.fillStyle(GAME_CONSTANTS.COLORS.DROP_ZONE_VALID, 0.8)\r\n    effect.fillCircle(0, 0, 20)\r\n    \r\n    // æ‹¡å¤§ã—ãªãŒã‚‰ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆ\r\n    this.tweens.add({\r\n      targets: effect,\r\n      scaleX: 3,\r\n      scaleY: 3,\r\n      alpha: 0,\r\n      duration: 500,\r\n      ease: 'Power2.out',\r\n      onComplete: () => {\r\n        effect.destroy()\r\n      }\r\n    })\r\n    \r\n    // è¤‡æ•°ã®å°ã•ãªè¼ãã‚’æ•£ã‚‰ã™\r\n    for (let i = 0; i < 6; i++) {\r\n      const spark = this.add.graphics()\r\n      spark.setPosition(x, y)\r\n      spark.setDepth(1100)\r\n      spark.fillStyle(GAME_CONSTANTS.COLORS.DROP_ZONE_VALID, 0.6)\r\n      spark.fillCircle(0, 0, 5)\r\n      \r\n      const angle = (i / 6) * Math.PI * 2\r\n      const distance = 50\r\n      \r\n      this.tweens.add({\r\n        targets: spark,\r\n        x: x + Math.cos(angle) * distance,\r\n        y: y + Math.sin(angle) * distance,\r\n        alpha: 0,\r\n        duration: 600,\r\n        ease: 'Power2.out',\r\n        onComplete: () => {\r\n          spark.destroy()\r\n        }\r\n      })\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ãƒ‰ãƒ­ãƒƒãƒ—å¤±æ•—ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ\r\n   */\r\n  private showDropFailureEffect(x: number, y: number): void {\r\n    // å¤±æ•—æ™‚ã®Xå°ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ\r\n    const effect = this.add.graphics()\r\n    effect.setPosition(x, y)\r\n    effect.setDepth(1100)\r\n    \r\n    // Xå°ã‚’æç”»\r\n    effect.lineStyle(4, GAME_CONSTANTS.COLORS.DROP_ZONE_INVALID, 0.8)\r\n    effect.beginPath()\r\n    effect.moveTo(-15, -15)\r\n    effect.lineTo(15, 15)\r\n    effect.moveTo(15, -15)\r\n    effect.lineTo(-15, 15)\r\n    effect.strokePath()\r\n    \r\n    // æŒ¯å‹•ã—ãªãŒã‚‰ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆ\r\n    this.tweens.add({\r\n      targets: effect,\r\n      x: x + 5,\r\n      duration: 100,\r\n      ease: 'Power2',\r\n      yoyo: true,\r\n      repeat: 3,\r\n    })\r\n    \r\n    this.tweens.add({\r\n      targets: effect,\r\n      alpha: 0,\r\n      duration: 800,\r\n      ease: 'Power2.out',\r\n      onComplete: () => {\r\n        effect.destroy()\r\n      }\r\n    })\r\n  }\r\n\r\n  /**\r\n   * æ¨ã¦æœ­ã‚¨ãƒªã‚¢ã¸ã®ãƒ‰ãƒ­ãƒƒãƒ—å‡¦ç†\r\n   */\r\n  private handleCardDropToDiscard(cardContainer: Phaser.GameObjects.Container): void {\r\n    const card = cardContainer.getData('card') as Card\r\n    \r\n    // ã‚«ãƒ¼ãƒ‰ã‚’æ¨ã¦æœ­ã«ç§»å‹•\r\n    this.gameInstance.discardCard(card.id)\r\n    \r\n    // æ‰‹æœ­ã‹ã‚‰ã‚«ãƒ¼ãƒ‰ã‚’å‰Šé™¤\r\n    const cardIndex = this.handCards.indexOf(cardContainer)\r\n    if (cardIndex > -1) {\r\n      this.handCards.splice(cardIndex, 1)\r\n      cardContainer.destroy()\r\n    }\r\n    \r\n    // æ‰‹æœ­ã‚’å†é…ç½®\r\n    this.arrangeHand()\r\n    \r\n    // UIæ›´æ–°ï¼ˆãƒ€ãƒ¼ãƒ†ã‚£ãƒ•ãƒ©ã‚°ã‚’è¨­å®šï¼‰\r\n    this.dirtyFlags.vitality = true\r\n    this.dirtyFlags.insurance = true\r\n    this.dirtyFlags.burden = true\r\n    this.updateUI()\r\n  }\r\n\r\n  /**\r\n   * ã‚«ãƒ¼ãƒ‰ã‚’ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã‚¨ãƒªã‚¢ã«ãƒ‰ãƒ­ãƒƒãƒ—ã—ãŸæ™‚ã®å‡¦ç†\r\n   */\r\n  private handleCardDropToChallenge(cardContainer: Phaser.GameObjects.Container): void {\r\n    const card = cardContainer.getData('card') as Card\r\n    \r\n    // ã™ã§ã«ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã‚«ãƒ¼ãƒ‰ãŒã‚ã‚‹å ´åˆã¯æˆ»ã™\r\n    if (this.gameInstance.currentChallenge) {\r\n      this.tweens.add({\r\n        targets: cardContainer,\r\n        x: cardContainer.getData('originalX'),\r\n        y: cardContainer.getData('originalY'),\r\n        duration: GAME_CONSTANTS.CARD_MOVE_DURATION,\r\n        ease: 'Power2'\r\n      })\r\n      return\r\n    }\r\n    \r\n    // ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã‚¨ãƒªã‚¢ã«é…ç½®\r\n    this.tweens.add({\r\n      targets: cardContainer,\r\n      x: this.centerX,\r\n      y: GAME_CONSTANTS.CHALLENGE_Y_POSITION,\r\n      duration: GAME_CONSTANTS.CARD_MOVE_DURATION,\r\n      ease: 'Power2',\r\n      onComplete: () => {\r\n        // æ‰‹æœ­ã‹ã‚‰å‰Šé™¤\r\n        const index = this.handCards.indexOf(cardContainer)\r\n        if (index !== -1) {\r\n          this.handCards.splice(index, 1)\r\n        }\r\n        \r\n        // ãƒãƒ£ãƒ¬ãƒ³ã‚¸é–‹å§‹\r\n        this.gameInstance.startChallenge(card)\r\n        \r\n        // æ‰‹æœ­ã‚’å†é…ç½®\r\n        this.arrangeHand()\r\n        \r\n        // ãƒãƒ£ãƒ¬ãƒ³ã‚¸UIè¡¨ç¤º\r\n        this.showChallengeUI(card)\r\n      }\r\n    })\r\n  }\r\n\r\n  /**\r\n   * ãƒãƒ£ãƒ¬ãƒ³ã‚¸UIã‚’è¡¨ç¤º\r\n   */\r\n  private showChallengeUI(challengeCard: Card): void {\r\n    // ãƒãƒ£ãƒ¬ãƒ³ã‚¸æƒ…å ±ã‚’è¡¨ç¤º\r\n    const challengeInfo = this.add.container(this.centerX, GAME_CONSTANTS.CHALLENGE_Y_POSITION - 150)\r\n    \r\n    const bg = this.add.rectangle(0, 0, 300, 60, 0x000000, 0.8)\r\n    const text = this.add.text(\r\n      0,\r\n      0,\r\n      `ãƒãƒ£ãƒ¬ãƒ³ã‚¸: ${challengeCard.name}\\nãƒ‘ãƒ¯ãƒ¼: ${challengeCard.power}`,\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '18px',\r\n        color: '#ffffff',\r\n        align: 'center'\r\n      }\r\n    ).setOrigin(0.5)\r\n    \r\n    challengeInfo.add([bg, text])\r\n    challengeInfo.setName('challenge-info')\r\n    \r\n    // ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³\r\n    challengeInfo.setAlpha(0)\r\n    this.tweens.add({\r\n      targets: challengeInfo,\r\n      alpha: 1,\r\n      duration: 300\r\n    })\r\n  }\r\n\r\n  /**\r\n   * ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã‚«ãƒ¼ãƒ‰ã‚’è¡¨ç¤º\r\n   */\r\n  private displayChallengeCard(challengeCard: Card): void {\r\n    const challengeContainer = this.add.container(\r\n      this.centerX,\r\n      GAME_CONSTANTS.CHALLENGE_Y_POSITION\r\n    )\r\n\r\n    // ã‚«ãƒ¼ãƒ‰èƒŒæ™¯\r\n    const cardBg = this.add.image(0, 0, this.getCardTemplate('life'))\r\n    cardBg.setTint(0xFFD43B)\r\n\r\n    // ã‚«ãƒ¼ãƒ‰å\r\n    const cardName = this.add.text(\r\n      0,\r\n      -60,\r\n      challengeCard.name,\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '16px',\r\n        color: '#333333',\r\n        fontStyle: 'bold',\r\n        wordWrap: { width: 100 }\r\n      }\r\n    ).setOrigin(0.5)\r\n\r\n    // ãƒ‘ãƒ¯ãƒ¼è¡¨ç¤º\r\n    const powerText = this.add.text(\r\n      0,\r\n      20,\r\n      `${challengeCard.power}`,\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '36px',\r\n        color: '#FF0000',\r\n        fontStyle: 'bold'\r\n      }\r\n    ).setOrigin(0.5)\r\n\r\n    // èª¬æ˜æ–‡\r\n    const descText = this.add.text(\r\n      0,\r\n      60,\r\n      challengeCard.description,\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '12px',\r\n        color: '#666666',\r\n        wordWrap: { width: 100 }\r\n      }\r\n    ).setOrigin(0.5)\r\n\r\n    challengeContainer.add([cardBg, cardName, powerText, descText])\r\n    challengeContainer.setName('challenge-card')\r\n    challengeContainer.setScale(0)\r\n    \r\n    // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³\r\n    this.tweens.add({\r\n      targets: challengeContainer,\r\n      scale: 1.2,\r\n      duration: 500,\r\n      ease: 'Back.easeOut'\r\n    })\r\n  }\r\n\r\n  /**\r\n   * ãƒãƒ£ãƒ¬ãƒ³ã‚¸UIæ›´æ–°\r\n   */\r\n  private updateChallengeUI(): void {\r\n    // æ—¢å­˜ã®ãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒœã‚¿ãƒ³ã‚’å‰Šé™¤\r\n    const existingButton = this.children.getByName('resolve-challenge-button')\r\n    if (existingButton) {\r\n      existingButton.destroy()\r\n    }\r\n\r\n    // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‘ãƒ¯ãƒ¼è¡¨ç¤º\r\n    const powerDisplay = this.add.container(this.gameWidth - 150, 300)\r\n    powerDisplay.setName('power-display')\r\n\r\n    const bg = this.add.rectangle(0, 0, 200, 140, 0x000000, 0.8)\r\n    \r\n    const selectedPower = this.calculateSelectedPower()\r\n    const text = this.add.text(\r\n      0,\r\n      -50,\r\n      `é¸æŠãƒ‘ãƒ¯ãƒ¼: ${selectedPower}`,\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '20px',\r\n        color: '#00FF00'\r\n      }\r\n    )\r\n    text.setOrigin(0.5)\r\n    text.setName('power-text')\r\n\r\n    const subText = this.add.text(\r\n      0,\r\n      -20,\r\n      `é¸æŠã‚«ãƒ¼ãƒ‰: ${this.selectedCards.size}æš`,\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '14px',\r\n        color: '#ffffff'\r\n      }\r\n    )\r\n    subText.setOrigin(0.5)\r\n    subText.setName('count-text')\r\n\r\n    powerDisplay.add([bg, text, subText])\r\n\r\n    // åˆå›è¡¨ç¤ºæ™‚ã«ãƒ‘ãƒ¯ãƒ¼ã®å†…è¨³ã‚’æ›´æ–°\r\n    this.updatePowerDisplay()\r\n\r\n    // ãƒãƒ£ãƒ¬ãƒ³ã‚¸è§£æ±ºãƒœã‚¿ãƒ³\r\n    const resolveButton = this.createButton(\r\n      this.gameWidth - 150,\r\n      400,\r\n      'ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã«æŒ‘ã‚€',\r\n      () => this.resolveChallenge(),\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '20px',\r\n        color: '#ffffff'\r\n      }\r\n    )\r\n    resolveButton.setName('resolve-challenge-button')\r\n  }\r\n\r\n  /**\r\n   * é¸æŠã—ãŸã‚«ãƒ¼ãƒ‰ã®åˆè¨ˆãƒ‘ãƒ¯ãƒ¼ã‚’è¨ˆç®—\r\n   */\r\n  private calculateSelectedPower(): number {\r\n    let totalPower = 0\r\n    this.handCards.forEach(cardContainer => {\r\n      const card = cardContainer.getData('card') as Card\r\n      if (this.selectedCards.has(card.id)) {\r\n        totalPower += card.power\r\n      }\r\n    })\r\n    return totalPower\r\n  }\r\n\r\n  /**\r\n   * ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã‚’è§£æ±º\r\n   */\r\n  private resolveChallenge(): void {\r\n    if (!this.gameInstance.currentChallenge) {\r\n      return\r\n    }\r\n\r\n    // æ³¨: ã‚«ãƒ¼ãƒ‰ã®é¸æŠçŠ¶æ…‹ã¯æ—¢ã«toggleCardSelectionã§ç®¡ç†ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€\r\n    // ã“ã“ã§ã¯ä½•ã‚‚ã™ã‚‹å¿…è¦ãŒãªã„\r\n\r\n    // ãƒãƒ£ãƒ¬ãƒ³ã‚¸è§£æ±º\r\n    const result = this.gameInstance.resolveChallenge()\r\n    \r\n    // ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ç”¨ã«ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã‚’æ›´æ–°\r\n    const gameState = (window as Window & { __gameState?: Record<string, unknown> }).__gameState || {}\r\n    gameState.lastChallengeResult = result\r\n    this.updateGameStateForTutorial()\r\n    \r\n    // çµæœã«å¿œã˜ãŸã‚µã‚¦ãƒ³ãƒ‰ã‚’å†ç”Ÿ\r\n    if (result.success) {\r\n      this.soundManager?.play('challengeSuccess')\r\n    } else {\r\n      this.soundManager?.play('challengeFail')\r\n    }\r\n    \r\n    // çµæœè¡¨ç¤º\r\n    this.showChallengeResult(result)\r\n    \r\n    // ã‚«ãƒ¼ãƒ‰é¸æŠãƒ•ã‚§ãƒ¼ã‚ºã‹ãƒã‚§ãƒƒã‚¯\r\n    if (result.success && result.cardChoices) {\r\n      // Phase 2: ä¿é™ºç¨®åˆ¥é¸æŠUIã‚’å…ˆã«è¡¨ç¤º\r\n      this.time.delayedCall(2000, () => {\r\n        this.showInsuranceTypeSelection()\r\n      })\r\n    } else {\r\n      // å¤±æ•—æ™‚ã¾ãŸã¯é¸æŠè‚¢ãŒãªã„å ´åˆã¯ã€UIã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã—ã¦é€šå¸¸ãƒ•ãƒ­ãƒ¼ã«æˆ»ã™\r\n      this.time.delayedCall(2000, () => {\r\n        this.cleanupChallengeUI()\r\n        this.updateActionButtons()\r\n      })\r\n    }\r\n    \r\n    // ä½¿ç”¨ã—ãŸã‚«ãƒ¼ãƒ‰ã‚’å‰Šé™¤\r\n    this.handCards = this.handCards.filter(cardContainer => {\r\n      const card = cardContainer.getData('card') as Card\r\n      if (this.selectedCards.has(card.id)) {\r\n        cardContainer.destroy()\r\n        return false\r\n      }\r\n      return true\r\n    })\r\n    \r\n    // é¸æŠã‚’ã‚¯ãƒªã‚¢\r\n    this.selectedCards.clear()\r\n    \r\n    // ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã‚«ãƒ¼ãƒ‰ã‚’å‰Šé™¤\r\n    const challengeCard = this.children.getByName('challenge-card')\r\n    if (challengeCard) {\r\n      this.tweens.add({\r\n        targets: challengeCard,\r\n        scale: 0,\r\n        duration: 300,\r\n        onComplete: () => challengeCard.destroy()\r\n      })\r\n    }\r\n    \r\n    // æ‰‹æœ­ã®é¸æŠçŠ¶æ…‹ã‚’ã‚¯ãƒªã‚¢\r\n    this.clearHandSelection()\r\n\r\n    // UIæ›´æ–°ï¼ˆãƒ€ãƒ¼ãƒ†ã‚£ãƒ•ãƒ©ã‚°ã‚’è¨­å®šï¼‰\r\n    this.dirtyFlags.vitality = true\r\n    this.dirtyFlags.insurance = true\r\n    this.dirtyFlags.burden = true\r\n    this.dirtyFlags.hand = true\r\n    this.dirtyFlags.actionButtons = true\r\n    this.updateUI()\r\n  }\r\n\r\n  /**\r\n   * ãƒãƒ£ãƒ¬ãƒ³ã‚¸çµæœã‚’è¡¨ç¤º\r\n   */\r\n  private showChallengeResult(result: ChallengeResult): void {\r\n    const resultContainer = this.add.container(this.centerX, this.centerY)\r\n    \r\n    const bg = this.add.rectangle(0, 0, 500, 300, 0x000000, 0.9)\r\n    \r\n    const titleText = this.add.text(\r\n      0,\r\n      -100,\r\n      result.success ? 'ãƒãƒ£ãƒ¬ãƒ³ã‚¸æˆåŠŸï¼' : 'ãƒãƒ£ãƒ¬ãƒ³ã‚¸å¤±æ•—...',\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '28px',\r\n        color: result.success ? '#00FF00' : '#FF0000',\r\n        fontStyle: 'bold'\r\n      }\r\n    ).setOrigin(0.5)\r\n    \r\n    // Phase 3-3: ãƒ‘ãƒ¯ãƒ¼è¨ˆç®—ã®å†…è¨³ã‚’è¡¨ç¤º\r\n    let detailContent = `ãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒ‘ãƒ¯ãƒ¼: ${result.challengePower}\\n\\n`\r\n    \r\n    if (result.powerBreakdown) {\r\n      detailContent += 'ã‚ãªãŸã®ãƒ‘ãƒ¯ãƒ¼å†…è¨³:\\n'\r\n      if (result.powerBreakdown.base > 0) {\r\n        detailContent += `  åŸºæœ¬ãƒ‘ãƒ¯ãƒ¼: +${result.powerBreakdown.base}\\n`\r\n      }\r\n      if (result.powerBreakdown.insurance > 0) {\r\n        detailContent += `  ä¿é™ºãƒœãƒ¼ãƒŠã‚¹: +${result.powerBreakdown.insurance}\\n`\r\n      }\r\n      if (result.powerBreakdown.burden < 0) {\r\n        detailContent += `  ä¿é™ºæ–™è² æ‹…: ${result.powerBreakdown.burden}\\n`\r\n      }\r\n      detailContent += `  åˆè¨ˆ: ${result.powerBreakdown.total}\\n\\n`\r\n    } else {\r\n      detailContent += `ã‚ãªãŸã®ãƒ‘ãƒ¯ãƒ¼: ${result.playerPower}\\n\\n`\r\n    }\r\n    \r\n    detailContent += `æ´»åŠ›å¤‰åŒ–: ${result.vitalityChange > 0 ? '+' : ''}${result.vitalityChange}`\r\n    \r\n    const detailText = this.add.text(\r\n      0,\r\n      -20,\r\n      detailContent,\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '16px',\r\n        color: '#ffffff',\r\n        align: 'center',\r\n        lineSpacing: 5\r\n      }\r\n    ).setOrigin(0.5)\r\n\r\n    // Phase 3-3: ä¿é™ºæ–™è² æ‹…ãŒå‹æ•—ã«å½±éŸ¿ã—ãŸå ´åˆã®ç‰¹åˆ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸\r\n    if (!result.success && result.powerBreakdown && result.powerBreakdown.burden < 0) {\r\n      const withoutBurden = result.powerBreakdown.base + result.powerBreakdown.insurance\r\n      if (withoutBurden >= result.challengePower) {\r\n        const burdenImpactText = this.add.text(\r\n          0,\r\n          90,\r\n          'âš  ä¿é™ºæ–™è² æ‹…ã«ã‚ˆã‚Šæ•—åŒ—ã—ã¾ã—ãŸ',\r\n          {\r\n            fontFamily: 'Noto Sans JP',\r\n            fontSize: '14px',\r\n            color: '#ff9999',\r\n            fontStyle: 'bold'\r\n          }\r\n        ).setOrigin(0.5)\r\n        resultContainer.add(burdenImpactText)\r\n      }\r\n    }\r\n    \r\n    const closeButton = this.createButton(\r\n      0,\r\n      120,\r\n      'é–‰ã˜ã‚‹',\r\n      () => {\r\n        this.tweens.add({\r\n          targets: resultContainer,\r\n          scale: 0,\r\n          duration: 300,\r\n          onComplete: () => resultContainer.destroy()\r\n        })\r\n      },\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '16px',\r\n        color: '#ffffff'\r\n      }\r\n    )\r\n    \r\n    resultContainer.add([bg, titleText, detailText, closeButton])\r\n    resultContainer.setScale(0)\r\n    \r\n    // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³\r\n    this.tweens.add({\r\n      targets: resultContainer,\r\n      scale: 1,\r\n      duration: 500,\r\n      ease: 'Back.easeOut'\r\n    })\r\n  }\r\n\r\n  /**\r\n   * ã‚¹ãƒ†ãƒ¼ã‚¸è¡¨ç¤ºãƒ†ã‚­ã‚¹ãƒˆã‚’å–å¾—\r\n   */\r\n  private getStageDisplayText(): string {\r\n    const currentStage = this.gameInstance.stage\r\n    const stageName = AGE_PARAMETERS[currentStage].label\r\n    \r\n    const turnsInStage = this.getTurnsInCurrentStage()\r\n    const maxTurns = GAME_CONSTANTS.STAGE_TURNS[currentStage]\r\n    \r\n    return `${stageName} (${turnsInStage}/${maxTurns})`\r\n  }\r\n\r\n  /**\r\n   * ç¾åœ¨ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã§ã®ã‚¿ãƒ¼ãƒ³æ•°ã‚’å–å¾—\r\n   */\r\n  private getTurnsInCurrentStage(): number {\r\n    const turn = this.gameInstance.turn\r\n    \r\n    if (this.gameInstance.stage === 'youth') {\r\n      return turn\r\n    } else if (this.gameInstance.stage === 'middle') {\r\n      return turn - GAME_CONSTANTS.STAGE_TURNS.youth\r\n    } else {\r\n      return turn - GAME_CONSTANTS.STAGE_TURNS.youth - GAME_CONSTANTS.STAGE_TURNS.middle\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ã‚¹ãƒ†ãƒ¼ã‚¸é€²è¡Œã‚’ãƒã‚§ãƒƒã‚¯\r\n   */\r\n  private checkStageProgress(): void {\r\n    const turn = this.gameInstance.turn\r\n    const stage = this.gameInstance.stage\r\n    \r\n    if (stage === 'youth' && turn >= GAME_CONSTANTS.STAGE_TURNS.youth) {\r\n      const previousMaxVitality = this.gameInstance.maxVitality\r\n      this.gameInstance.advanceStage()\r\n      this.showStageTransition('ä¸­å¹´æœŸ', previousMaxVitality, this.gameInstance.maxVitality)\r\n      this.updateChallengeDeck()\r\n    } else if (stage === 'middle' && \r\n               turn >= GAME_CONSTANTS.STAGE_TURNS.youth + GAME_CONSTANTS.STAGE_TURNS.middle) {\r\n      const previousMaxVitality = this.gameInstance.maxVitality\r\n      this.gameInstance.advanceStage()\r\n      this.showStageTransition('å……å®ŸæœŸ', previousMaxVitality, this.gameInstance.maxVitality)\r\n      this.updateChallengeDeck()\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒ‡ãƒƒã‚­ã‚’æ›´æ–°\r\n   */\r\n  private updateChallengeDeck(): void {\r\n    // å¤ã„ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã‚«ãƒ¼ãƒ‰ã‚’ã‚¯ãƒªã‚¢\r\n    this.gameInstance.challengeDeck.clear()\r\n    \r\n    // æ–°ã—ã„ã‚¹ãƒ†ãƒ¼ã‚¸ã®ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã‚«ãƒ¼ãƒ‰ã‚’è¿½åŠ \r\n    const newChallenges = CardFactory.createChallengeCards(this.gameInstance.stage)\r\n    this.gameInstance.challengeDeck.addCards(newChallenges)\r\n    this.gameInstance.challengeDeck.shuffle()\r\n  }\r\n\r\n  /**\r\n   * ã‚¹ãƒ†ãƒ¼ã‚¸é·ç§»æ¼”å‡ºã‚’è¡¨ç¤º\r\n   */\r\n  private showStageTransition(stageName: string, previousMaxVitality: number, newMaxVitality: number): void {\r\n    const transitionContainer = this.add.container(this.centerX, this.centerY)\r\n    transitionContainer.setDepth(2000)\r\n    \r\n    const bg = this.add.rectangle(0, 0, this.gameWidth, this.gameHeight, 0x000000, 0.8)\r\n    \r\n    const text = this.add.text(\r\n      0,\r\n      -80,\r\n      `${stageName}ã¸çªå…¥ï¼`,\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '48px',\r\n        color: '#ffffff',\r\n        fontStyle: 'bold'\r\n      }\r\n    ).setOrigin(0.5)\r\n    \r\n    // DOMè¦ç´ ã¨ã—ã¦ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é©ç”¨\r\n    const textElement = text.canvas as HTMLCanvasElement\r\n    if (textElement && textElement.parentElement) {\r\n      this.animationManager.animate(textElement.parentElement, 'scaleIn', {\r\n        duration: 600,\r\n        intensity: 'high'\r\n      })\r\n    }\r\n    \r\n    // ä½“åŠ›æ¸›å°‘ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸\r\n    const vitalityChangeText = this.add.text(\r\n      0,\r\n      -20,\r\n      `ä½“åŠ›ãŒè¡°ãˆã¾ã—ãŸ (æœ€å¤§å€¤: ${previousMaxVitality} â†’ ${newMaxVitality})`,\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '24px',\r\n        color: '#ff9999'\r\n      }\r\n    ).setOrigin(0.5)\r\n    \r\n    // Phase 5-1: ä¿é™ºè¦‹ç›´ã—æ¨å¥¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸\r\n    const reviewRecommendation = this.getInsuranceReviewRecommendation(stageName)\r\n    const reviewText = this.add.text(\r\n      0,\r\n      40,\r\n      reviewRecommendation,\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '20px',\r\n        color: '#00ff00',\r\n        align: 'center'\r\n      }\r\n    ).setOrigin(0.5)\r\n\r\n    // Phase 5-1: ä¿é™ºè¦‹ç›´ã—ãƒœã‚¿ãƒ³\r\n    const reviewButton = this.createButton(\r\n      0,\r\n      100,\r\n      'ä¿é™ºã‚’è¦‹ç›´ã™',\r\n      () => {\r\n        this.showInsuranceReviewDialog()\r\n        transitionContainer.destroy()\r\n      },\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '18px',\r\n        color: '#ffffff'\r\n      }\r\n    )\r\n\r\n    const skipButton = this.createButton(\r\n      0,\r\n      150,\r\n      'ã‚ã¨ã§è¦‹ç›´ã™',\r\n      () => {\r\n        this.tweens.add({\r\n          targets: transitionContainer,\r\n          alpha: 0,\r\n          duration: 500,\r\n          onComplete: () => transitionContainer.destroy()\r\n        })\r\n      },\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '16px',\r\n        color: '#cccccc'\r\n      }\r\n    )\r\n    \r\n    transitionContainer.add([bg, text, vitalityChangeText, reviewText, reviewButton, skipButton])\r\n    transitionContainer.setAlpha(0)\r\n    \r\n    // ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³ã¨åŒæ™‚ã«ãƒ†ã‚­ã‚¹ãƒˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³\r\n    this.tweens.add({\r\n      targets: transitionContainer,\r\n      alpha: 1,\r\n      duration: 500\r\n    })\r\n    \r\n    // ã‚¿ã‚¤ãƒˆãƒ«ãƒ†ã‚­ã‚¹ãƒˆã«ã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³\r\n    text.setScale(0)\r\n    this.tweens.add({\r\n      targets: text,\r\n      scale: 1,\r\n      duration: 800,\r\n      delay: 200,\r\n      ease: 'Back.easeOut'\r\n    })\r\n    \r\n    // æ´»åŠ›å¤‰åŒ–ãƒ†ã‚­ã‚¹ãƒˆã«ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³\r\n    vitalityChangeText.setAlpha(0)\r\n    this.tweens.add({\r\n      targets: vitalityChangeText,\r\n      alpha: 1,\r\n      duration: 600,\r\n      delay: 500\r\n    })\r\n    \r\n    // ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã‚¨ãƒ•ã‚§ã‚¯ãƒˆï¼ˆæ˜Ÿã¨ã‹å…‰ã®ç²’å­ï¼‰\r\n    for (let i = 0; i < 20; i++) {\r\n      const particle = this.add.circle(\r\n        Phaser.Math.Between(-200, 200),\r\n        Phaser.Math.Between(-150, 150),\r\n        Phaser.Math.Between(2, 6),\r\n        0xFFD700,\r\n        0.8\r\n      )\r\n      transitionContainer.add(particle)\r\n      \r\n      // ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³\r\n      this.tweens.add({\r\n        targets: particle,\r\n        alpha: 0,\r\n        scale: 1.5,\r\n        duration: 2000,\r\n        delay: Phaser.Math.Between(0, 1000),\r\n        ease: 'Power2'\r\n      })\r\n    }\r\n    \r\n    // ã‚¹ãƒ†ãƒ¼ã‚¸è¡¨ç¤ºã‚’æ›´æ–°\r\n    const stageText = this.children.getByName('stage-text') as Phaser.GameObjects.Text\r\n    if (stageText) {\r\n      stageText.setText(this.getStageDisplayText())\r\n    }\r\n    \r\n    // äººç”Ÿæ®µéšã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã‚’æ›´æ–°\r\n    this.updateLifeStageIndicator()\r\n    \r\n    // æ´»åŠ›ãƒãƒ¼ã®æœ€å¤§å€¤å¤‰æ›´ã‚’ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³\r\n    this.animateMaxVitalityChange()\r\n  }\r\n\r\n  /**\r\n   * Phase 5-1: ä¿é™ºè¦‹ç›´ã—æ¨å¥¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å–å¾—\r\n   */\r\n  private getInsuranceReviewRecommendation(stageName: string): string {\r\n    if (stageName === 'ä¸­å¹´æœŸ') {\r\n      return 'ğŸ“Œ ä¿é™ºè¦‹ç›´ã—ã®æ©Ÿä¼š\\nå®šæœŸä¿é™ºã‹ã‚‰çµ‚èº«ä¿é™ºã¸ã®å¤‰æ›´ã‚’æ¤œè¨ã—ã¾ã—ã‚‡ã†'\r\n    } else if (stageName === 'å……å®ŸæœŸ') {\r\n      return 'ğŸ“Œ ç·åˆçš„ãªä¿é™ºè¦‹ç›´ã—\\nçµ‚èº«ä¿é™ºã®ä¾¡å€¤ãŒå¤§å¹…ã«ä¸Šæ˜‡ã—ã¾ã™ï¼'\r\n    }\r\n    return ''\r\n  }\r\n\r\n  /**\r\n   * Phase 5-1: ä¿é™ºè¦‹ç›´ã—ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤º\r\n   */\r\n  private showInsuranceReviewDialog(): void {\r\n    // ä¿é™ºè¦‹ç›´ã—æ©Ÿèƒ½ã¯å°†æ¥ã®ãƒªãƒªãƒ¼ã‚¹ã§å®Ÿè£…äºˆå®š\r\n    this.showNotification('ä¿é™ºè¦‹ç›´ã—æ©Ÿèƒ½ã¯é–‹ç™ºä¸­ã§ã™', 'info')\r\n  }\r\n\r\n  /**\r\n   * Phase 5-1: æœŸé™åˆ‡ã‚Œé–“è¿‘ã®ä¿é™ºã‚’ãƒã‚§ãƒƒã‚¯\r\n   * DISABLED: ä¿é™ºæ›´æ–°ã‚·ã‚¹ãƒ†ãƒ ãŒå‰Šé™¤ã•ã‚ŒãŸãŸã‚ç„¡åŠ¹åŒ–\r\n   */\r\n  private checkExpiringInsurances(): void {\r\n    // ä¿é™ºæ›´æ–°ã‚·ã‚¹ãƒ†ãƒ ãŒå‰Šé™¤ã•ã‚ŒãŸãŸã‚ã€ã“ã®æ©Ÿèƒ½ã¯ç„¡åŠ¹åŒ–\r\n    return\r\n  }\r\n\r\n  /**\r\n   * Phase 5-1: æœŸé™åˆ‡ã‚Œé–“è¿‘ã®ä¿é™ºè­¦å‘Šã‚’è¡¨ç¤º\r\n   */\r\n  private showExpiringInsuranceWarning(insurance: Card): void {\r\n    const warningContainer = this.add.container(this.centerX, 300)\r\n    warningContainer.setDepth(2000)\r\n\r\n    const bg = this.add.rectangle(0, 0, 400, 120, 0xff4444, 0.95)\r\n    bg.setStrokeStyle(3, 0xffffff)\r\n\r\n    const iconText = this.add.text(\r\n      -170, 0,\r\n      'âš ',\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '48px',\r\n        color: '#ffffff'\r\n      }\r\n    ).setOrigin(0.5)\r\n\r\n    const messageText = this.add.text(\r\n      20, -20,\r\n      `${insurance.name}ãŒ\\nã‚ã¨${insurance.remainingTurns}ã‚¿ãƒ¼ãƒ³ã§æœŸé™åˆ‡ã‚Œã§ã™ï¼`,\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '18px',\r\n        color: '#ffffff',\r\n        fontStyle: 'bold'\r\n      }\r\n    ).setOrigin(0.5)\r\n\r\n    const actionText = this.add.text(\r\n      20, 20,\r\n      'æ›´æ–°ã¾ãŸã¯çµ‚èº«ä¿é™ºã¸ã®åˆ‡ã‚Šæ›¿ãˆã‚’æ¤œè¨ã—ã¾ã—ã‚‡ã†',\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '14px',\r\n        color: '#ffcccc'\r\n      }\r\n    ).setOrigin(0.5)\r\n\r\n    warningContainer.add([bg, iconText, messageText, actionText])\r\n    warningContainer.setScale(0)\r\n    warningContainer.setAlpha(0)\r\n\r\n    // è­¦å‘Šã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³\r\n    this.tweens.add({\r\n      targets: warningContainer,\r\n      scale: 1.1,\r\n      alpha: 1,\r\n      duration: 300,\r\n      ease: 'Back.easeOut',\r\n      onComplete: () => {\r\n        // ãƒ‘ãƒ«ã‚¹ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ\r\n        this.tweens.add({\r\n          targets: warningContainer,\r\n          scale: 1,\r\n          duration: 800,\r\n          yoyo: true,\r\n          repeat: 2,\r\n          ease: 'Sine.easeInOut'\r\n        })\r\n\r\n        // è‡ªå‹•ã§æ¶ˆãˆã‚‹\r\n        this.time.delayedCall(5000, () => {\r\n          this.tweens.add({\r\n            targets: warningContainer,\r\n            scale: 0.8,\r\n            alpha: 0,\r\n            duration: 500,\r\n            ease: 'Power2',\r\n            onComplete: () => warningContainer.destroy()\r\n          })\r\n        })\r\n      }\r\n    })\r\n  }\r\n\r\n  /**\r\n   * ä¿é™ºæœŸé™åˆ‡ã‚Œè­¦å‘Šã‚·ã‚¹ãƒ†ãƒ  - æ”¹è‰¯ç‰ˆ\r\n   * getPendingRenewalInsurances()ã¨é€£æºã—ã€æ®‹ã‚Š1-2ã‚¿ãƒ¼ãƒ³ã®ä¿é™ºã«å¯¾å¿œ\r\n   */\r\n  private showInsuranceExpirationWarning(renewal: InsuranceRenewalOption): void {\r\n    const remainingTurns = renewal.remainingTurns\r\n    // renewalOptionã‹ã‚‰ä¿é™ºæƒ…å ±ã‚’å–å¾—ï¼ˆcardNameã‚’ä½¿ç”¨ï¼‰\r\n    const insuranceName = renewal.cardName\r\n    \r\n    // è­¦å‘Šãƒ¬ãƒ™ãƒ«ã«å¿œã˜ãŸè‰²ã¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ±ºå®š\r\n    let warningColor = 0xFFA500  // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼šã‚ªãƒ¬ãƒ³ã‚¸ï¼ˆè­¦å‘Šï¼‰\r\n    let iconEmoji = 'âš '\r\n    let urgencyText = ''\r\n    \r\n    if (remainingTurns === 1) {\r\n      warningColor = 0xFF4444  // èµ¤è‰²ï¼ˆå±é™ºï¼‰\r\n      iconEmoji = 'ğŸš¨'\r\n      urgencyText = 'ç·Šæ€¥ï¼'\r\n    } else if (remainingTurns === 2) {\r\n      warningColor = 0xFFA500  // ã‚ªãƒ¬ãƒ³ã‚¸è‰²ï¼ˆè­¦å‘Šï¼‰\r\n      iconEmoji = 'âš '\r\n      urgencyText = 'è­¦å‘Šï¼š'\r\n    }\r\n\r\n    const warningContainer = this.add.container(this.centerX, 350)\r\n    warningContainer.setDepth(2000)\r\n\r\n    const bg = this.add.rectangle(0, 0, 450, 130, warningColor, 0.95)\r\n    bg.setStrokeStyle(3, 0xffffff)\r\n\r\n    const iconText = this.add.text(\r\n      -190, 0,\r\n      iconEmoji,\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '48px',\r\n        color: '#ffffff'\r\n      }\r\n    ).setOrigin(0.5)\r\n\r\n    const messageText = this.add.text(\r\n      20, -25,\r\n      `${urgencyText} ${insuranceName}ãŒ\\næ®‹ã‚Š${remainingTurns}ã‚¿ãƒ¼ãƒ³ã§æœŸé™åˆ‡ã‚Œã§ã™`,\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '18px',\r\n        color: '#ffffff',\r\n        fontStyle: 'bold',\r\n        align: 'center'\r\n      }\r\n    ).setOrigin(0.5)\r\n\r\n    const actionText = this.add.text(\r\n      20, 25,\r\n      'æ›´æ–°æ‰‹ç¶šãã¾ãŸã¯çµ‚èº«ä¿é™ºã¸ã®åˆ‡ã‚Šæ›¿ãˆã‚’ã”æ¤œè¨ãã ã•ã„',\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '14px',\r\n        color: '#ffcccc'\r\n      }\r\n    ).setOrigin(0.5)\r\n\r\n    warningContainer.add([bg, iconText, messageText, actionText])\r\n    warningContainer.setScale(0)\r\n    warningContainer.setAlpha(0)\r\n\r\n    // è­¦å‘Šã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆç·Šæ€¥åº¦ã«å¿œã˜ãŸé€Ÿåº¦ï¼‰\r\n    const animationDuration = remainingTurns === 1 ? 200 : 300\r\n    this.tweens.add({\r\n      targets: warningContainer,\r\n      scale: 1.1,\r\n      alpha: 1,\r\n      duration: animationDuration,\r\n      ease: 'Back.easeOut',\r\n      onComplete: () => {\r\n        // ãƒ‘ãƒ«ã‚¹ã‚¨ãƒ•ã‚§ã‚¯ãƒˆï¼ˆç·Šæ€¥åº¦ã«å¿œã˜ãŸå›æ•°ï¼‰\r\n        const pulseRepeats = remainingTurns === 1 ? 4 : 2\r\n        this.tweens.add({\r\n          targets: warningContainer,\r\n          scale: 1,\r\n          duration: remainingTurns === 1 ? 400 : 600,\r\n          yoyo: true,\r\n          repeat: pulseRepeats,\r\n          ease: 'Sine.easeInOut'\r\n        })\r\n\r\n        // è‡ªå‹•ã§æ¶ˆãˆã‚‹ï¼ˆç·Šæ€¥åº¦ã«å¿œã˜ãŸè¡¨ç¤ºæ™‚é–“ï¼‰\r\n        const displayTime = remainingTurns === 1 ? 7000 : 5000\r\n        this.time.delayedCall(displayTime, () => {\r\n          this.tweens.add({\r\n            targets: warningContainer,\r\n            scale: 0.8,\r\n            alpha: 0,\r\n            duration: 500,\r\n            ease: 'Power2',\r\n            onComplete: () => warningContainer.destroy()\r\n          })\r\n        })\r\n      }\r\n    })\r\n  }\r\n\r\n  /**\r\n   * æœ€å¤§æ´»åŠ›å¤‰æ›´æ™‚ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³\r\n   */\r\n  private animateMaxVitalityChange(): void {\r\n    if (!this.vitalityBarContainer) return\r\n\r\n    // æœ€å¤§å€¤ãƒãƒ¼ã‚«ãƒ¼ã‚’ç‚¹æ»…ã•ã›ã‚‹\r\n    const maxMarker = this.vitalityBarContainer.list[2] as Phaser.GameObjects.Rectangle\r\n    if (maxMarker) {\r\n      this.tweens.add({\r\n        targets: maxMarker,\r\n        alpha: 0.3,\r\n        duration: 300,\r\n        yoyo: true,\r\n        repeat: 3,\r\n        ease: 'Power2'\r\n      })\r\n    }\r\n\r\n    // æ´»åŠ›ãƒãƒ¼ã‚³ãƒ³ãƒ†ãƒŠã‚’æºã‚‰ã™\r\n    this.tweens.add({\r\n      targets: this.vitalityBarContainer,\r\n      y: this.vitalityBarContainer.y - 5,\r\n      duration: 100,\r\n      yoyo: true,\r\n      repeat: 2,\r\n      ease: 'Power2'\r\n    })\r\n\r\n    // UI ã‚’æ›´æ–°ï¼ˆãƒ€ãƒ¼ãƒ†ã‚£ãƒ•ãƒ©ã‚°ã‚’è¨­å®šï¼‰\r\n    this.dirtyFlags.vitality = true\r\n    this.dirtyFlags.insurance = true\r\n    this.dirtyFlags.burden = true\r\n    this.updateUI()\r\n  }\r\n\r\n  /**\r\n   * ã‚²ãƒ¼ãƒ çµ‚äº†ã‚’ãƒã‚§ãƒƒã‚¯\r\n   */\r\n  private checkGameEnd(): void {\r\n    if (this.gameInstance.isCompleted()) {\r\n      if (this.gameInstance.status === 'victory') {\r\n        this.showGameEnd(true)\r\n      } else if (this.gameInstance.status === 'game_over') {\r\n        this.showGameEnd(false)\r\n      }\r\n    } else if (this.gameInstance.stage === 'fulfillment' && \r\n               this.gameInstance.vitality >= GAME_CONSTANTS.VICTORY_VITALITY) {\r\n      // å……å®ŸæœŸã§æ´»åŠ›ãŒä¸€å®šä»¥ä¸Šãªã‚‰å‹åˆ©\r\n      this.gameInstance.status = 'victory'\r\n      this.showGameEnd(true)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ä¿é™ºç¨®åˆ¥é¸æŠUIã‚’è¡¨ç¤ºï¼ˆPhase 2ï¼‰\r\n   */\r\n  private showInsuranceTypeSelection(): void {\r\n    // æ—¢å­˜ã®ä¿é™ºç¨®åˆ¥é¸æŠUIãŒã‚ã‚Œã°å‰Šé™¤\r\n    if (this.insuranceTypeSelectionUI) {\r\n      this.insuranceTypeSelectionUI.destroy()\r\n    }\r\n\r\n    // ä¿é™ºç¨®åˆ¥é¸æŠã‚³ãƒ³ãƒ†ãƒŠã‚’ä½œæˆ\r\n    this.insuranceTypeSelectionUI = this.add.container(this.centerX, this.centerY)\r\n    this.insuranceTypeSelectionUI.setDepth(2000)\r\n\r\n    // èƒŒæ™¯ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤\r\n    const overlay = this.add.rectangle(\r\n      0, 0,\r\n      this.gameWidth, this.gameHeight,\r\n      0x000000, 0.8\r\n    )\r\n    overlay.setOrigin(0.5)\r\n\r\n    // ã‚¿ã‚¤ãƒˆãƒ«\r\n    const titleText = this.add.text(\r\n      0, -200,\r\n      'ä¿é™ºç¨®åˆ¥ã‚’é¸æŠã—ã¦ãã ã•ã„',\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '36px',\r\n        color: '#ffffff',\r\n        fontStyle: 'bold'\r\n      }\r\n    ).setOrigin(0.5)\r\n\r\n    // å¹´é½¢ã«å¿œã˜ãŸæ¨å¥¨ãƒ†ã‚­ã‚¹ãƒˆ\r\n    const recommendationText = this.getInsuranceRecommendation()\r\n    const recommendText = this.add.text(\r\n      0, -140,\r\n      recommendationText,\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '20px',\r\n        color: '#00ff00'\r\n      }\r\n    ).setOrigin(0.5)\r\n\r\n    this.insuranceTypeSelectionUI.add([overlay, titleText, recommendText])\r\n\r\n    // çµ‚èº«ä¿é™ºé¸æŠãƒœã‚¿ãƒ³\r\n    this.createInsuranceTypeButton(\r\n      -180, 0,\r\n      'çµ‚èº«ä¿é™º',\r\n      'ä¸€ç”Ÿæ¶¯ã®ä¿éšœ\\né«˜ã‚³ã‚¹ãƒˆãƒ»é«˜åŠ¹æœ',\r\n      0xFFD700, // é‡‘è‰²\r\n      'whole_life'\r\n    )\r\n\r\n    // å®šæœŸä¿é™ºé¸æŠãƒœã‚¿ãƒ³\r\n    this.createInsuranceTypeButton(\r\n      180, 0,\r\n      'å®šæœŸä¿é™º',\r\n      '10ã‚¿ãƒ¼ãƒ³ã®ä¿éšœ\\nä½ã‚³ã‚¹ãƒˆãƒ»æ¨™æº–åŠ¹æœ',\r\n      0xC0C0C0, // éŠ€è‰²\r\n      'term'\r\n    )\r\n\r\n    // ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¬ãƒ¼ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š\r\n    const buttons = this.insuranceTypeSelectionUI.list.filter(child => \r\n      child instanceof Phaser.GameObjects.Container && child !== overlay\r\n    )\r\n    \r\n    buttons.forEach((button) => {\r\n      if (button instanceof Phaser.GameObjects.Container) {\r\n        button.setScale(0)\r\n        button.setAlpha(0)\r\n      }\r\n    })\r\n\r\n    // ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³\r\n    this.insuranceTypeSelectionUI.setAlpha(0)\r\n    this.tweens.add({\r\n      targets: this.insuranceTypeSelectionUI,\r\n      alpha: 1,\r\n      duration: 500,\r\n      ease: 'Power2',\r\n      onComplete: () => {\r\n        // ãƒœã‚¿ãƒ³ã‚’é †ç•ªã«è¡¨ç¤º\r\n        buttons.forEach((button, index) => {\r\n          if (button instanceof Phaser.GameObjects.Container) {\r\n            this.time.delayedCall(index * 200, () => {\r\n              this.tweens.add({\r\n                targets: button,\r\n                scale: 1,\r\n                alpha: 1,\r\n                duration: 500,\r\n                ease: 'Back.easeOut'\r\n              })\r\n            })\r\n          }\r\n        })\r\n      }\r\n    })\r\n  }\r\n\r\n  /**\r\n   * ä¿é™ºç¨®åˆ¥é¸æŠãƒœã‚¿ãƒ³ã‚’ä½œæˆ\r\n   */\r\n  private createInsuranceTypeButton(\r\n    x: number,\r\n    y: number,\r\n    title: string,\r\n    description: string,\r\n    color: number,\r\n    insuranceType: 'whole_life' | 'term'\r\n  ): void {\r\n    if (!this.insuranceTypeSelectionUI) return\r\n\r\n    const buttonContainer = this.add.container(x, y)\r\n\r\n    // ã‚«ãƒ¼ãƒ‰é¢¨ã®èƒŒæ™¯\r\n    const cardBg = this.add.rectangle(0, 0, 300, 400, 0x2C3E50)\r\n    cardBg.setStrokeStyle(4, color)\r\n    cardBg.setInteractive()\r\n    \r\n    // å…‰å½©ã‚¨ãƒ•ã‚§ã‚¯ãƒˆï¼ˆçµ‚èº«ä¿é™ºã®ã¿ï¼‰\r\n    if (insuranceType === 'whole_life') {\r\n      const glow = this.add.rectangle(0, 0, 310, 410, color, 0.2)\r\n      glow.setAlpha(0.5)\r\n      buttonContainer.addAt(glow, 0)\r\n      \r\n      // ãƒ‘ãƒ«ã‚¹ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ\r\n      this.tweens.add({\r\n        targets: glow,\r\n        alpha: 0.2,\r\n        scale: 1.05,\r\n        duration: 2000,\r\n        yoyo: true,\r\n        repeat: -1,\r\n        ease: 'Sine.easeInOut'\r\n      })\r\n    }\r\n\r\n    // ã‚¿ã‚¤ãƒˆãƒ«èƒŒæ™¯\r\n    const titleBg = this.add.rectangle(0, -150, 280, 60, color)\r\n\r\n    // ã‚¿ã‚¤ãƒˆãƒ«ãƒ†ã‚­ã‚¹ãƒˆ\r\n    const titleText = this.add.text(\r\n      0, -150,\r\n      title,\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '28px',\r\n        color: '#000000',\r\n        fontStyle: 'bold'\r\n      }\r\n    ).setOrigin(0.5)\r\n\r\n    // èª¬æ˜ãƒ†ã‚­ã‚¹ãƒˆ\r\n    const descText = this.add.text(\r\n      0, -50,\r\n      description,\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '18px',\r\n        color: '#ffffff',\r\n        align: 'center',\r\n        lineSpacing: 10\r\n      }\r\n    ).setOrigin(0.5)\r\n\r\n    // ç‰¹å¾´ã‚¢ã‚¤ã‚³ãƒ³ã¨èª¬æ˜\r\n    const features = insuranceType === 'whole_life' \r\n      ? ['æ°¸ç¶šçš„ãªä¿éšœ', 'ãƒ‘ãƒ¯ãƒ¼ +2', 'ã‚³ã‚¹ãƒˆ +2']\r\n      : ['æœŸé–“é™å®šä¿éšœ', 'æ¨™æº–ãƒ‘ãƒ¯ãƒ¼', 'æ¨™æº–ã‚³ã‚¹ãƒˆ']\r\n\r\n    features.forEach((feature, index) => {\r\n      const featureText = this.add.text(\r\n        0, 50 + index * 30,\r\n        `â€¢ ${feature}`,\r\n        {\r\n          fontFamily: 'Noto Sans JP',\r\n          fontSize: '16px',\r\n          color: '#cccccc'\r\n        }\r\n      ).setOrigin(0.5)\r\n      buttonContainer.add(featureText)\r\n    })\r\n\r\n    // Phase 5-1: è©³ç´°ãªæ¨å¥¨ç†ç”±ã‚’è¿½åŠ \r\n    const detailBg = this.add.rectangle(0, 280, 280, 80, 0x000000, 0.5)\r\n    detailBg.setStrokeStyle(1, 0x666666)\r\n    \r\n    const detailText = this.add.text(\r\n      0, 280,\r\n      this.getDetailedInsuranceRecommendation(insuranceType),\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '12px',\r\n        color: '#aaaaaa',\r\n        align: 'center',\r\n        lineSpacing: 5,\r\n        wordWrap: { width: 260 }\r\n      }\r\n    ).setOrigin(0.5)\r\n    \r\n    buttonContainer.add([detailBg, detailText])\r\n\r\n    // é¸æŠãƒœã‚¿ãƒ³\r\n    const selectButton = this.createButton(\r\n      0, 160,\r\n      'é¸æŠã™ã‚‹',\r\n      () => this.onInsuranceTypeSelected(insuranceType),\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '20px',\r\n        color: '#ffffff'\r\n      }\r\n    )\r\n\r\n    // ãƒ›ãƒãƒ¼åŠ¹æœ\r\n    cardBg.on('pointerover', () => {\r\n      buttonContainer.setScale(1.05)\r\n      cardBg.setFillStyle(0x34495E)\r\n      this.tweens.add({\r\n        targets: buttonContainer,\r\n        y: y - 10,\r\n        duration: 200,\r\n        ease: 'Power2'\r\n      })\r\n    })\r\n\r\n    cardBg.on('pointerout', () => {\r\n      buttonContainer.setScale(1)\r\n      cardBg.setFillStyle(0x2C3E50)\r\n      this.tweens.add({\r\n        targets: buttonContainer,\r\n        y,\r\n        duration: 200,\r\n        ease: 'Power2'\r\n      })\r\n    })\r\n\r\n    // ã‚¯ãƒªãƒƒã‚¯ã§é¸æŠ\r\n    cardBg.on('pointerdown', () => {\r\n      this.onInsuranceTypeSelected(insuranceType)\r\n    })\r\n\r\n    buttonContainer.add([cardBg, titleBg, titleText, descText, selectButton])\r\n    this.insuranceTypeSelectionUI.add(buttonContainer)\r\n  }\r\n\r\n  /**\r\n   * å¹´é½¢ã«å¿œã˜ãŸä¿é™ºæ¨å¥¨ã‚’å–å¾—\r\n   */\r\n  private getInsuranceRecommendation(): string {\r\n    const stage = this.gameInstance.stage\r\n    \r\n    switch (stage) {\r\n      case 'youth':\r\n        return 'ğŸ’¡ é’å¹´æœŸã¯å®šæœŸä¿é™ºãŒãŠã™ã™ã‚ - ã‚³ã‚¹ãƒˆã‚’æŠ‘ãˆã¦æ´»åŠ›ã«æŠ•è³‡'\r\n      case 'middle':\r\n        return 'ğŸ’¡ ä¸­å¹´æœŸã¯çµ‚èº«ä¿é™ºã‚‚æ¤œè¨ - å°†æ¥ã¸ã®å‚™ãˆã‚’å¼·åŒ–'\r\n      case 'fulfillment':\r\n        return 'ğŸ’¡ å……å®ŸæœŸã¯çµ‚èº«ä¿é™ºãŒæœ‰åˆ© - å¹´é½¢ãƒœãƒ¼ãƒŠã‚¹ã§åŠ¹æœæœ€å¤§åŒ–'\r\n      default:\r\n        return 'ä¿é™ºç¨®åˆ¥ã‚’é¸ã‚“ã§ãã ã•ã„'\r\n    }\r\n  }\r\n\r\n  /**\r\n   * å¹´é½¢ã«å¿œã˜ãŸè©³ç´°ãªä¿é™ºæ¨å¥¨ç†ç”±ã‚’å–å¾—\r\n   */\r\n  private getDetailedInsuranceRecommendation(insuranceType: 'whole_life' | 'term'): string {\r\n    const stage = this.gameInstance.stage\r\n    \r\n    if (insuranceType === 'whole_life') {\r\n      switch (stage) {\r\n        case 'youth':\r\n          return 'çµ‚èº«ä¿é™ºã¯é«˜ã‚³ã‚¹ãƒˆã§ã™ãŒã€çµå©šã‚„å­¦è³‡ãªã©\\näººç”Ÿã®åŸºç›¤ã¨ãªã‚‹ä¿éšœã«ã¯é©ã—ã¦ã„ã¾ã™ã€‚\\né•·æœŸçš„ãªè¦–ç‚¹ã§é¸æŠã—ã¾ã—ã‚‡ã†ã€‚'\r\n        case 'middle':\r\n          return 'ä¸­å¹´æœŸã®çµ‚èº«ä¿é™ºã¯+0.5ãƒœãƒ¼ãƒŠã‚¹ä»˜ãã€‚\\næ®‹ã‚Šã®äººç”Ÿã‚’è€ƒãˆã‚‹ã¨ã€ä»ŠãŒçµ‚èº«ä¿é™ºã¸ã®\\nåˆ‡ã‚Šæ›¿ãˆã‚’æ¤œè¨ã™ã‚‹è‰¯ã„ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã™ã€‚'\r\n        case 'fulfillment':\r\n          return 'å……å®ŸæœŸã®çµ‚èº«ä¿é™ºã¯+1.0ãƒœãƒ¼ãƒŠã‚¹ï¼\\nå¹´é½¢ã«ã‚ˆã‚‹ä¾¡å€¤ä¸Šæ˜‡ã‚’æœ€å¤§é™æ´»ç”¨ã§ãã¾ã™ã€‚\\nå®‰å®šã—ãŸè€å¾Œã®åŸºç›¤ä½œã‚Šã«æœ€é©ã§ã™ã€‚'\r\n        default:\r\n          return 'æ°¸ç¶šçš„ãªä¿éšœã‚’æä¾›ã—ã¾ã™ã€‚'\r\n      }\r\n    } else {\r\n      switch (stage) {\r\n        case 'youth':\r\n          return 'å®šæœŸä¿é™ºã¯ä½ã‚³ã‚¹ãƒˆã§åŠ¹ç‡çš„ãªé¸æŠã§ã™ã€‚\\nè‹¥ã„æ™‚æœŸã¯å¤‰åŒ–ã‚‚å¤šã„ãŸã‚ã€æŸ”è»Ÿã«\\nè¦‹ç›´ã›ã‚‹å®šæœŸä¿é™ºãŒæœ‰åˆ©ã§ã™ã€‚'\r\n        case 'middle':\r\n          return 'å®šæœŸä¿é™ºã¯æœŸé™ãŒã‚ã‚‹ãŸã‚è¦æ³¨æ„ã€‚\\n10ã‚¿ãƒ¼ãƒ³å¾Œã®æ›´æ–°æ™‚ã«ã¯ã‚³ã‚¹ãƒˆãŒä¸ŠãŒã‚Šã¾ã™ã€‚\\né•·æœŸçš„ãªä¿éšœã¯çµ‚èº«ã¸ã®åˆ‡ã‚Šæ›¿ãˆã‚‚æ¤œè¨ã‚’ã€‚'\r\n        case 'fulfillment':\r\n          return 'å……å®ŸæœŸã§ã¯çµ‚èº«ä¿é™ºã®ãƒœãƒ¼ãƒŠã‚¹ãŒå¤§ãã„ãŸã‚ã€\\nå®šæœŸä¿é™ºã®ç›¸å¯¾çš„ä¾¡å€¤ã¯ä¸‹ãŒã‚Šã¾ã™ã€‚\\nä¸€æ™‚çš„ãªä¿éšœã®ã¿ã«ä½¿ç”¨ã‚’æ¨å¥¨ã—ã¾ã™ã€‚'\r\n        default:\r\n          return '10ã‚¿ãƒ¼ãƒ³ã®æœŸé–“é™å®šä¿éšœã§ã™ã€‚'\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Phase 5-1: å¹´é½¢ã«ã‚ˆã‚‹é›£æ˜“åº¦èª¿æ•´ã®è¡¨ç¤ºã‚’å–å¾—\r\n   */\r\n  private getAgeAdjustmentDisplay(challengeCard: Card): Phaser.GameObjects.Container | null {\r\n    // challengeCategoryãŒå®šç¾©ã•ã‚Œã¦ã„ãªã„å ´åˆã¯ä½•ã‚‚è¡¨ç¤ºã—ãªã„\r\n    if (!challengeCard.challengeCategory) return null\r\n\r\n    const stage = this.gameInstance.stage\r\n    let adjustment = 0\r\n    let color = 0xffffff\r\n    let icon = ''\r\n\r\n    // ã‚«ãƒ†ã‚´ãƒªã«å¿œã˜ã¦èª¿æ•´å€¤ã‚’è¨ˆç®—\r\n    if (challengeCard.challengeCategory === 'physical') {\r\n      // ä½“åŠ›ç³»: å¹´é½¢ã¨ã¨ã‚‚ã«é›£ã—ããªã‚‹\r\n      if (stage === 'middle') {\r\n        adjustment = 3\r\n        color = 0xff9999\r\n        icon = 'â†‘'\r\n      } else if (stage === 'fulfillment') {\r\n        adjustment = 6\r\n        color = 0xff4444\r\n        icon = 'â†‘â†‘'\r\n      }\r\n    } else if (challengeCard.challengeCategory === 'knowledge') {\r\n      // çŸ¥è­˜ç³»: å¹´é½¢ã¨ã¨ã‚‚ã«ç°¡å˜ã«ãªã‚‹\r\n      if (stage === 'middle') {\r\n        adjustment = -2\r\n        color = 0x99ff99\r\n        icon = 'â†“'\r\n      } else if (stage === 'fulfillment') {\r\n        adjustment = -4\r\n        color = 0x44ff44\r\n        icon = 'â†“â†“'\r\n      }\r\n    }\r\n\r\n    if (adjustment === 0) return null\r\n\r\n    const container = this.add.container(60, 20)\r\n\r\n    // èƒŒæ™¯\r\n    const bg = this.add.rectangle(0, 0, 40, 25, color, 0.3)\r\n    bg.setStrokeStyle(1, color)\r\n\r\n    // ã‚¢ã‚¤ã‚³ãƒ³ã¨æ•°å€¤\r\n    const text = this.add.text(\r\n      0, 0,\r\n      `${icon}${Math.abs(adjustment)}`,\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '14px',\r\n        color: `#${color.toString(16).padStart(6, '0')}`,\r\n        fontStyle: 'bold'\r\n      }\r\n    ).setOrigin(0.5)\r\n\r\n    container.add([bg, text])\r\n    return container\r\n  }\r\n\r\n  /**\r\n   * Phase 5-1: é›£æ˜“åº¦ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã‚’è¿½åŠ \r\n   */\r\n  private addDifficultyTooltip(challengeContainer: Phaser.GameObjects.Container, challengeCard: Card): void {\r\n    const cardBg = challengeContainer.list[0] as Phaser.GameObjects.Image\r\n    if (!cardBg) return\r\n\r\n    let tooltipText = ''\r\n    const stage = this.gameInstance.stage\r\n\r\n    if (challengeCard.challengeCategory === 'physical') {\r\n      tooltipText = 'ä½“åŠ›ç³»ãƒãƒ£ãƒ¬ãƒ³ã‚¸\\n'\r\n      if (stage === 'middle') {\r\n        tooltipText += 'ä¸­å¹´æœŸ: å¿…è¦ãƒ‘ãƒ¯ãƒ¼+3\\nä½“åŠ›ã®è¡°ãˆã«ã‚ˆã‚Šé›£æ˜“åº¦ä¸Šæ˜‡'\r\n      } else if (stage === 'fulfillment') {\r\n        tooltipText += 'å……å®ŸæœŸ: å¿…è¦ãƒ‘ãƒ¯ãƒ¼+6\\nå¤§å¹…ãªä½“åŠ›ä½ä¸‹ã«ã‚ˆã‚Šé«˜é›£åº¦'\r\n      } else {\r\n        tooltipText += 'é’å¹´æœŸ: æ¨™æº–é›£æ˜“åº¦\\nä½“åŠ›ãŒå……å®Ÿã—ã¦ã„ã‚‹æ™‚æœŸ'\r\n      }\r\n    } else if (challengeCard.challengeCategory === 'knowledge') {\r\n      tooltipText = 'çŸ¥è­˜ç³»ãƒãƒ£ãƒ¬ãƒ³ã‚¸\\n'\r\n      if (stage === 'middle') {\r\n        tooltipText += 'ä¸­å¹´æœŸ: å¿…è¦ãƒ‘ãƒ¯ãƒ¼-2\\nçµŒé¨“ã®è“„ç©ã«ã‚ˆã‚Šå®¹æ˜“åŒ–'\r\n      } else if (stage === 'fulfillment') {\r\n        tooltipText += 'å……å®ŸæœŸ: å¿…è¦ãƒ‘ãƒ¯ãƒ¼-4\\nè±Šå¯ŒãªçŸ¥è­˜ã§å¤§å¹…ã«å®¹æ˜“åŒ–'\r\n      } else {\r\n        tooltipText += 'é’å¹´æœŸ: æ¨™æº–é›£æ˜“åº¦\\nçµŒé¨“ã¯ã¾ã æµ…ã„æ™‚æœŸ'\r\n      }\r\n    } else if (challengeCard.challengeCategory === 'balanced') {\r\n      tooltipText = 'è¤‡åˆç³»ãƒãƒ£ãƒ¬ãƒ³ã‚¸\\nå¹´é½¢ã«ã‚ˆã‚‹é›£æ˜“åº¦å¤‰åŒ–ãªã—\\nä½“åŠ›ã¨çŸ¥è­˜ã®ãƒãƒ©ãƒ³ã‚¹ãŒé‡è¦'\r\n    }\r\n\r\n    if (!tooltipText) return\r\n\r\n    // ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã‚³ãƒ³ãƒ†ãƒŠï¼ˆåˆæœŸã¯éè¡¨ç¤ºï¼‰\r\n    const tooltipContainer = this.add.container(0, -120)\r\n    tooltipContainer.setVisible(false)\r\n    tooltipContainer.setDepth(1000)\r\n\r\n    const bg = this.add.rectangle(0, 0, 250, 80, 0x000000, 0.9)\r\n    bg.setStrokeStyle(2, 0xffffff)\r\n\r\n    const text = this.add.text(\r\n      0, 0,\r\n      tooltipText,\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '12px',\r\n        color: '#ffffff',\r\n        align: 'center',\r\n        lineSpacing: 5\r\n      }\r\n    ).setOrigin(0.5)\r\n\r\n    tooltipContainer.add([bg, text])\r\n    challengeContainer.add(tooltipContainer)\r\n\r\n    // ãƒ›ãƒãƒ¼ã§ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—è¡¨ç¤º\r\n    cardBg.setInteractive()\r\n    cardBg.on('pointerover', () => {\r\n      tooltipContainer.setVisible(true)\r\n      this.tweens.add({\r\n        targets: tooltipContainer,\r\n        alpha: 1,\r\n        duration: 200\r\n      })\r\n    })\r\n\r\n    cardBg.on('pointerout', () => {\r\n      this.tweens.add({\r\n        targets: tooltipContainer,\r\n        alpha: 0,\r\n        duration: 200,\r\n        onComplete: () => tooltipContainer.setVisible(false)\r\n      })\r\n    })\r\n  }\r\n\r\n  /**\r\n   * ä¿é™ºç¨®åˆ¥é¸æŠæ™‚ã®å‡¦ç†\r\n   */\r\n  private onInsuranceTypeSelected(insuranceType: 'whole_life' | 'term'): void {\r\n    if (!this.insuranceTypeSelectionUI) return\r\n\r\n    this.selectedInsuranceType = insuranceType\r\n\r\n    // é¸æŠã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³\r\n    const selectedTypeText = insuranceType === 'whole_life' ? 'çµ‚èº«ä¿é™º' : 'å®šæœŸä¿é™º'\r\n    const confirmText = this.add.text(\r\n      0, 250,\r\n      `${selectedTypeText}ã‚’é¸æŠã—ã¾ã—ãŸ`,\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '24px',\r\n        color: '#00ff00',\r\n        fontStyle: 'bold'\r\n      }\r\n    ).setOrigin(0.5)\r\n    confirmText.setAlpha(0)\r\n    this.insuranceTypeSelectionUI.add(confirmText)\r\n    \r\n    // é¸æŠã‚¨ãƒ•ã‚§ã‚¯ãƒˆ\r\n    this.tweens.add({\r\n      targets: confirmText,\r\n      alpha: 1,\r\n      scale: 1.2,\r\n      duration: 300,\r\n      yoyo: true,\r\n      ease: 'Power2'\r\n    })\r\n\r\n    // é¸æŠå¾Œã€ã‚«ãƒ¼ãƒ‰é¸æŠç”»é¢ã¸é·ç§»\r\n    this.time.delayedCall(1000, () => {\r\n      this.hideInsuranceTypeSelection(() => {\r\n        // é¸æŠã—ãŸä¿é™ºç¨®åˆ¥ã«åŸºã¥ã„ã¦ã‚«ãƒ¼ãƒ‰ã‚’ç”Ÿæˆ\r\n        const cardChoices = this.generateInsuranceCards(insuranceType)\r\n        this.showCardSelection(cardChoices)\r\n      })\r\n    })\r\n  }\r\n\r\n  /**\r\n   * ä¿é™ºç¨®åˆ¥é¸æŠUIã‚’éš ã™\r\n   */\r\n  private hideInsuranceTypeSelection(onComplete?: () => void): void {\r\n    if (!this.insuranceTypeSelectionUI) return\r\n\r\n    this.tweens.add({\r\n      targets: this.insuranceTypeSelectionUI,\r\n      alpha: 0,\r\n      scale: 0.8,\r\n      duration: 500,\r\n      ease: 'Power2',\r\n      onComplete: () => {\r\n        this.insuranceTypeSelectionUI?.destroy()\r\n        this.insuranceTypeSelectionUI = undefined\r\n        if (onComplete) onComplete()\r\n      }\r\n    })\r\n  }\r\n\r\n  /**\r\n   * é¸æŠã—ãŸä¿é™ºç¨®åˆ¥ã«åŸºã¥ã„ã¦ã‚«ãƒ¼ãƒ‰ã‚’ç”Ÿæˆ\r\n   */\r\n  private generateInsuranceCards(insuranceType: 'whole_life' | 'term'): Card[] {\r\n    // CardFactoryã‹ã‚‰æ‹¡å¼µä¿é™ºã‚«ãƒ¼ãƒ‰ã‚’å–å¾—\r\n    const allInsuranceCards = CardFactory.createExtendedInsuranceCards(this.gameInstance.stage)\r\n    \r\n    // é¸æŠã—ãŸä¿é™ºç¨®åˆ¥ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°\r\n    const filteredCards = allInsuranceCards.filter(card => \r\n      card.durationType === insuranceType\r\n    )\r\n    \r\n    // ãƒ©ãƒ³ãƒ€ãƒ ã«3æšé¸æŠ\r\n    const shuffled = [...filteredCards].sort(() => Math.random() - 0.5)\r\n    return shuffled.slice(0, 3)\r\n  }\r\n\r\n  /**\r\n   * ã‚«ãƒ¼ãƒ‰é¸æŠUIã‚’è¡¨ç¤º\r\n   */\r\n  private showCardSelection(cardChoices: Card[]): void {\r\n    // æ—¢å­˜ã®ã‚«ãƒ¼ãƒ‰é¸æŠUIãŒã‚ã‚Œã°å‰Šé™¤\r\n    if (this.cardSelectionUI) {\r\n      this.cardSelectionUI.destroy()\r\n    }\r\n\r\n    // ã‚«ãƒ¼ãƒ‰é¸æŠã‚³ãƒ³ãƒ†ãƒŠã‚’ä½œæˆ\r\n    this.cardSelectionUI = this.add.container(this.centerX, this.centerY)\r\n    this.cardSelectionUI.setDepth(2000)\r\n\r\n    // èƒŒæ™¯ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤\r\n    const overlay = this.add.rectangle(\r\n      0, 0,\r\n      this.gameWidth, this.gameHeight,\r\n      0x000000, 0.8\r\n    )\r\n    overlay.setOrigin(0.5)\r\n\r\n    // ã‚¿ã‚¤ãƒˆãƒ«\r\n    const titleText = this.add.text(\r\n      0, -200,\r\n      'ä¿é™ºã‚«ãƒ¼ãƒ‰ã‚’é¸æŠã—ã¦ãã ã•ã„',\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '32px',\r\n        color: '#ffffff',\r\n        fontStyle: 'bold'\r\n      }\r\n    ).setOrigin(0.5)\r\n\r\n    // èª¬æ˜æ–‡\r\n    const descText = this.add.text(\r\n      0, -150,\r\n      '1æšé¸ã‚“ã§ãƒ‡ãƒƒã‚­ã«è¿½åŠ ã•ã‚Œã¾ã™',\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '18px',\r\n        color: '#cccccc'\r\n      }\r\n    ).setOrigin(0.5)\r\n\r\n    this.cardSelectionUI.add([overlay, titleText, descText])\r\n\r\n    // ã‚«ãƒ¼ãƒ‰ã‚’è¡¨ç¤º\r\n    cardChoices.forEach((card, index) => {\r\n      this.createSelectableCard(card, index)\r\n    })\r\n\r\n    // ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³\r\n    this.cardSelectionUI.setAlpha(0)\r\n    this.tweens.add({\r\n      targets: this.cardSelectionUI,\r\n      alpha: 1,\r\n      duration: 500,\r\n      ease: 'Power2'\r\n    })\r\n    \r\n    // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–\r\n    this.updateActionButtons()\r\n  }\r\n\r\n  /**\r\n   * é¸æŠå¯èƒ½ãªã‚«ãƒ¼ãƒ‰ã‚’ä½œæˆ\r\n   */\r\n  private createSelectableCard(card: Card, index: number): void {\r\n    if (!this.cardSelectionUI) return\r\n\r\n    const cardSpacing = 220\r\n    const totalCards = 3 // å¸¸ã«3æšã®ã‚«ãƒ¼ãƒ‰\r\n    const startX = -(totalCards - 1) * cardSpacing / 2\r\n    const cardX = startX + index * cardSpacing\r\n\r\n    const cardContainer = this.add.container(cardX, 0)\r\n    cardContainer.setScale(1.2) // å°‘ã—å¤§ãã‚ã«è¡¨ç¤º\r\n\r\n    // ã‚«ãƒ¼ãƒ‰èƒŒæ™¯\r\n    const cardBg = this.add.image(0, 0, this.getCardTemplate(card.type))\r\n    cardBg.setInteractive()\r\n\r\n    // ã‚«ãƒ¼ãƒ‰å\r\n    const cardName = this.add.text(\r\n      0, -80,\r\n      card.name,\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '16px',\r\n        color: '#ffffff',\r\n        fontStyle: 'bold',\r\n        wordWrap: { width: 120 }\r\n      }\r\n    ).setOrigin(0.5)\r\n\r\n    // èª¬æ˜æ–‡\r\n    const cardDesc = this.add.text(\r\n      0, -40,\r\n      card.description,\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '12px',\r\n        color: '#cccccc',\r\n        wordWrap: { width: 120 },\r\n        align: 'center'\r\n      }\r\n    ).setOrigin(0.5)\r\n\r\n    // ãƒ‘ãƒ¯ãƒ¼è¡¨ç¤º\r\n    const powerText = this.add.text(\r\n      -40, 50,\r\n      `${card.power}`,\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '24px',\r\n        color: '#333333',\r\n        fontStyle: 'bold'\r\n      }\r\n    ).setOrigin(0.5)\r\n\r\n    // ã‚«ãƒãƒ¬ãƒƒã‚¸è¡¨ç¤ºï¼ˆä¿é™ºã‚«ãƒ¼ãƒ‰ã®å ´åˆï¼‰\r\n    let coverageText: Phaser.GameObjects.Text | undefined\r\n    if (card.coverage) {\r\n      coverageText = this.add.text(\r\n        40, 50,\r\n        `ä¿éšœ:${card.coverage}`,\r\n        {\r\n          fontFamily: 'Noto Sans JP',\r\n          fontSize: '14px',\r\n          color: '#0066cc',\r\n          fontStyle: 'bold'\r\n        }\r\n      ).setOrigin(0.5)\r\n    }\r\n\r\n    // Phase 2: ä¿é™ºæœŸé–“ã®è¡¨ç¤º\r\n    let durationText: Phaser.GameObjects.Text | undefined\r\n    if (card.durationType) {\r\n      const durationLabel = card.durationType === 'whole_life' ? 'çµ‚èº«' : '10ã‚¿ãƒ¼ãƒ³'\r\n      durationText = this.add.text(\r\n        0, 80,\r\n        durationLabel,\r\n        {\r\n          fontFamily: 'Noto Sans JP',\r\n          fontSize: '16px',\r\n          color: card.durationType === 'whole_life' ? '#FFD700' : '#C0C0C0',\r\n          fontStyle: 'bold'\r\n        }\r\n      ).setOrigin(0.5)\r\n    }\r\n\r\n    // Phase 2: ã‚«ãƒ¼ãƒ‰æ ç·šã®è‰²ã‚’ä¿é™ºç¨®åˆ¥ã«å¿œã˜ã¦å¤‰æ›´\r\n    if (card.durationType === 'whole_life') {\r\n      // çµ‚èº«ä¿é™ºã¯é‡‘è‰²ã®è¼ãã¨ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ\r\n      const goldGlow = this.add.rectangle(0, 0, GAME_CONSTANTS.CARD_WIDTH + 10, GAME_CONSTANTS.CARD_HEIGHT + 10, 0xFFD700, 0.3)\r\n      goldGlow.setAlpha(0.6)\r\n      cardContainer.addAt(goldGlow, 0)\r\n      \r\n      this.tweens.add({\r\n        targets: goldGlow,\r\n        alpha: 0.2,\r\n        scale: 1.1,\r\n        duration: 1500,\r\n        yoyo: true,\r\n        repeat: -1,\r\n        ease: 'Sine.easeInOut'\r\n      })\r\n    } else if (card.durationType === 'term') {\r\n      // å®šæœŸä¿é™ºã¯éŠ€è‰²ã®ã‚·ãƒ³ãƒ—ãƒ«ãªæ \r\n      cardBg.setStrokeStyle(3, 0xC0C0C0)\r\n    }\r\n\r\n    // é¸æŠãƒœã‚¿ãƒ³\r\n    const selectButton = this.createButton(\r\n      0, 120,\r\n      'é¸æŠ',\r\n      () => this.onCardSelected(card),\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '18px',\r\n        color: '#ffffff'\r\n      }\r\n    )\r\n\r\n    // ãƒ›ãƒãƒ¼åŠ¹æœ\r\n    cardBg.on('pointerover', () => {\r\n      cardContainer.setScale(1.3)\r\n      this.tweens.add({\r\n        targets: cardContainer,\r\n        y: -20,\r\n        duration: 200,\r\n        ease: 'Power2'\r\n      })\r\n    })\r\n\r\n    cardBg.on('pointerout', () => {\r\n      cardContainer.setScale(1.2)\r\n      this.tweens.add({\r\n        targets: cardContainer,\r\n        y: 0,\r\n        duration: 200,\r\n        ease: 'Power2'\r\n      })\r\n    })\r\n\r\n    // ã‚¯ãƒªãƒƒã‚¯ã§é¸æŠ\r\n    cardBg.on('pointerdown', () => {\r\n      this.onCardSelected(card)\r\n    })\r\n\r\n    const cardElements = [cardBg, cardName, cardDesc, powerText, selectButton]\r\n    if (coverageText) cardElements.push(coverageText)\r\n    if (durationText) cardElements.push(durationText)\r\n    \r\n    cardContainer.add(cardElements)\r\n    this.cardSelectionUI.add(cardContainer)\r\n  }\r\n\r\n  /**\r\n   * ã‚«ãƒ¼ãƒ‰é¸æŠæ™‚ã®å‡¦ç†\r\n   */\r\n  private onCardSelected(card: Card): void {\r\n    if (!this.cardSelectionUI) return\r\n\r\n    // Phase 5-2: ä¿é™ºæ–™è² æ‹…ã®å¢ƒç•Œè­¦å‘Š\r\n    const activeInsurances = this.gameInstance.getActiveInsurances()\r\n    const currentCount = activeInsurances.length\r\n    const nextCount = currentCount + 1\r\n    \r\n    // 3æšç›®ã€6æšç›®ã€9æšç›®ã®æ™‚ã«è­¦å‘Š\r\n    if (nextCount % 3 === 0) {\r\n      this.showInsuranceBurdenWarning(nextCount)\r\n    }\r\n\r\n    // é¸æŠã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³\r\n    const selectedContainer = this.cardSelectionUI.list.find(child => {\r\n      return child instanceof Phaser.GameObjects.Container &&\r\n             child.list.some(element => \r\n               element instanceof Phaser.GameObjects.Image && \r\n               element.input?.enabled\r\n             )\r\n    }) as Phaser.GameObjects.Container\r\n\r\n    // é¸æŠã•ã‚ŒãŸã‚«ãƒ¼ãƒ‰ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³\r\n    if (selectedContainer) {\r\n      this.tweens.add({\r\n        targets: selectedContainer,\r\n        scaleX: 1.1,\r\n        scaleY: 1.1,\r\n        duration: 150,\r\n        yoyo: true,\r\n        ease: 'Power2'\r\n      })\r\n    }\r\n\r\n    // ã‚«ãƒ¼ãƒ‰ã‚’ã‚²ãƒ¼ãƒ ã«è¿½åŠ ï¼ˆã“ã‚Œã«ã‚ˆã‚Š phase ãŒ 'resolution' ã«å¤‰ã‚ã‚‹ï¼‰\r\n    this.gameInstance.selectCard(card.id)\r\n    \r\n    // ä¿é™ºç²å¾—éŸ³ã‚’å†ç”Ÿ\r\n    this.soundManager?.play('insuranceGet')\r\n\r\n    // ã‚«ãƒ¼ãƒ‰ç²å¾—ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³\r\n    this.showCardAcquisitionAnimation(card, () => {\r\n      // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å®Œäº†å¾Œã«UIã‚’é–‰ã˜ã‚‹\r\n      this.hideCardSelection()\r\n    })\r\n  }\r\n\r\n  /**\r\n   * Phase 5-2: ä¿é™ºæ–™è² æ‹…ã®å¢ƒç•Œè­¦å‘Šã‚’è¡¨ç¤º\r\n   */\r\n  private showInsuranceBurdenWarning(insuranceCount: number): void {\r\n    const burdenAmount = Math.floor(insuranceCount / 3)\r\n    const warningContainer = this.add.container(this.centerX, 200)\r\n    warningContainer.setDepth(3500)\r\n\r\n    const bg = this.add.rectangle(0, 0, 450, 150, 0xff4444, 0.95)\r\n    bg.setStrokeStyle(3, 0xffffff)\r\n\r\n    // è­¦å‘Šã‚¢ã‚¤ã‚³ãƒ³\r\n    const iconText = this.add.text(\r\n      -180, 0,\r\n      'ğŸš¨',\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '48px',\r\n        color: '#ffffff'\r\n      }\r\n    ).setOrigin(0.5)\r\n\r\n    // è­¦å‘Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸\r\n    const titleText = this.add.text(\r\n      20, -30,\r\n      'ä¿é™ºæ–™è² æ‹…ãŒç™ºç”Ÿã—ã¾ã™ï¼',\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '24px',\r\n        color: '#ffffff',\r\n        fontStyle: 'bold'\r\n      }\r\n    ).setOrigin(0.5)\r\n\r\n    const detailText = this.add.text(\r\n      20, 10,\r\n      `ä¿é™º${insuranceCount}æšç›®ã§è² æ‹…ãŒ${burdenAmount}ãƒã‚¤ãƒ³ãƒˆã«å¢—åŠ ã—ã¾ã™`,\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '16px',\r\n        color: '#ffcccc'\r\n      }\r\n    ).setOrigin(0.5)\r\n\r\n    const adviceText = this.add.text(\r\n      20, 40,\r\n      'æœ¬å½“ã«å¿…è¦ãªä¿é™ºã‹ã€ã‚‚ã†ä¸€åº¦è€ƒãˆã¾ã—ã‚‡ã†',\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '14px',\r\n        color: '#ffffff'\r\n      }\r\n    ).setOrigin(0.5)\r\n\r\n    warningContainer.add([bg, iconText, titleText, detailText, adviceText])\r\n    warningContainer.setScale(0)\r\n    warningContainer.setAlpha(0)\r\n\r\n    // è­¦å‘Šã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³\r\n    this.tweens.add({\r\n      targets: warningContainer,\r\n      scale: 1.2,\r\n      alpha: 1,\r\n      duration: 300,\r\n      ease: 'Back.easeOut',\r\n      onComplete: () => {\r\n        // æºã‚Œã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³\r\n        this.tweens.add({\r\n          targets: warningContainer,\r\n          angle: -5,\r\n          duration: 100,\r\n          yoyo: true,\r\n          repeat: 3,\r\n          ease: 'Sine.easeInOut',\r\n          onComplete: () => {\r\n            // ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆ\r\n            this.time.delayedCall(3000, () => {\r\n              this.tweens.add({\r\n                targets: warningContainer,\r\n                scale: 0.8,\r\n                alpha: 0,\r\n                duration: 500,\r\n                ease: 'Power2',\r\n                onComplete: () => warningContainer.destroy()\r\n              })\r\n            })\r\n          }\r\n        })\r\n      }\r\n    })\r\n\r\n    // ç”»é¢å…¨ä½“ã‚’ä¸€ç¬èµ¤ããƒ•ãƒ©ãƒƒã‚·ãƒ¥\r\n    const flashOverlay = this.add.rectangle(\r\n      this.centerX,\r\n      this.centerY,\r\n      this.gameWidth,\r\n      this.gameHeight,\r\n      0xff0000,\r\n      0.3\r\n    )\r\n    flashOverlay.setDepth(3000)\r\n    \r\n    this.tweens.add({\r\n      targets: flashOverlay,\r\n      alpha: 0,\r\n      duration: 200,\r\n      onComplete: () => flashOverlay.destroy()\r\n    })\r\n  }\r\n\r\n  /**\r\n   * ã‚«ãƒ¼ãƒ‰ç²å¾—ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³\r\n   */\r\n  private showCardAcquisitionAnimation(card: Card, onComplete: () => void): void {\r\n    // é¸æŠã•ã‚ŒãŸã‚«ãƒ¼ãƒ‰ã‚’å¼·èª¿è¡¨ç¤º\r\n    const highlightContainer = this.add.container(this.centerX, this.centerY)\r\n    highlightContainer.setDepth(3000)\r\n\r\n    const cardBg = this.add.image(0, 0, this.getCardTemplate(card.type))\r\n    cardBg.setScale(2) // å¤§ããè¡¨ç¤º\r\n\r\n    const cardName = this.add.text(\r\n      0, -100,\r\n      card.name,\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '24px',\r\n        color: '#ffffff',\r\n        fontStyle: 'bold'\r\n      }\r\n    ).setOrigin(0.5)\r\n\r\n    const acquiredText = this.add.text(\r\n      0, 120,\r\n      'ãƒ‡ãƒƒã‚­ã«è¿½åŠ ã•ã‚Œã¾ã—ãŸï¼',\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '20px',\r\n        color: '#00ff00',\r\n        fontStyle: 'bold'\r\n      }\r\n    ).setOrigin(0.5)\r\n\r\n    highlightContainer.add([cardBg, cardName, acquiredText])\r\n\r\n    // ãƒ‘ãƒ«ã‚¹åŠ¹æœ\r\n    this.tweens.add({\r\n      targets: highlightContainer,\r\n      scale: 1.1,\r\n      duration: 300,\r\n      yoyo: true,\r\n      repeat: 1,\r\n      ease: 'Power2',\r\n      onComplete: () => {\r\n        // ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆ\r\n        this.tweens.add({\r\n          targets: highlightContainer,\r\n          alpha: 0,\r\n          scale: 0.5,\r\n          duration: 800,\r\n          ease: 'Power2',\r\n          onComplete: () => {\r\n            highlightContainer.destroy()\r\n            onComplete()\r\n          }\r\n        })\r\n      }\r\n    })\r\n  }\r\n\r\n  /**\r\n   * ã‚«ãƒ¼ãƒ‰é¸æŠUIã‚’éš ã™\r\n   */\r\n  private hideCardSelection(): void {\r\n    if (!this.cardSelectionUI) return\r\n\r\n    this.tweens.add({\r\n      targets: this.cardSelectionUI,\r\n      alpha: 0,\r\n      scale: 0.8,\r\n      duration: 500,\r\n      ease: 'Power2',\r\n      onComplete: () => {\r\n        this.cardSelectionUI?.destroy()\r\n        this.cardSelectionUI = undefined\r\n        \r\n        // ãƒãƒ£ãƒ¬ãƒ³ã‚¸UIã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—\r\n        this.cleanupChallengeUI()\r\n        \r\n        // é€šå¸¸ã®ã‚²ãƒ¼ãƒ ãƒ•ãƒ­ãƒ¼ã«æˆ»ã‚‹ï¼ˆãƒ€ãƒ¼ãƒ†ã‚£ãƒ•ãƒ©ã‚°ã‚’è¨­å®šï¼‰\r\n        this.dirtyFlags.vitality = true\r\n        this.dirtyFlags.actionButtons = true\r\n        this.updateUI()\r\n      }\r\n    })\r\n  }\r\n\r\n  /**\r\n   * ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã‚’ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ç”¨ã«å…¬é–‹\r\n   */\r\n  private updateGameStateForTutorial(): void {\r\n    // ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«ã¨Sceneãƒ‡ãƒ¼ã‚¿ã®ä¸¡æ–¹ã«è¨­å®š\r\n    const gameState = {\r\n      hand: this.gameInstance.hand,\r\n      selectedCards: [...this.gameInstance.selectedCards], // é…åˆ—ã®ã‚³ãƒ”ãƒ¼ã‚’ä½œæˆ\r\n      phase: this.gameInstance.phase,\r\n      turn: this.gameInstance.turn,\r\n      vitality: this.gameInstance.vitality,\r\n      maxVitality: this.gameInstance.maxVitality,\r\n      insuranceCards: this.gameInstance.insuranceCards,\r\n      config: this.gameInstance.config,\r\n      lastChallengeResult: null as ChallengeResult | null\r\n    };\r\n    \r\n    (window as Window & { __gameState?: typeof gameState }).__gameState = gameState;\r\n    this.data.set('gameState', gameState);\r\n  }\r\n\r\n  /**\r\n   * ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã®æœ‰åŠ¹/ç„¡åŠ¹ã‚’æ›´æ–°\r\n   */\r\n  private updateActionButtons(): void {\r\n    const actionButtons = this.children.getByName('action-buttons') as Phaser.GameObjects.Container\r\n    if (!actionButtons) return\r\n\r\n    const drawButton = actionButtons.getByName('draw-button') as Phaser.GameObjects.Container\r\n    const challengeButton = actionButtons.getByName('challenge-button') as Phaser.GameObjects.Container\r\n    const endTurnButton = actionButtons.getByName('end-turn-button') as Phaser.GameObjects.Container\r\n\r\n    const phase = this.gameInstance.phase\r\n    const isInProgress = this.gameInstance.isInProgress()\r\n\r\n    // ãƒ•ã‚§ãƒ¼ã‚ºã«å¿œã˜ã¦ãƒœã‚¿ãƒ³ã®æœ‰åŠ¹/ç„¡åŠ¹ã‚’åˆ‡ã‚Šæ›¿ãˆ\r\n    if (drawButton) {\r\n      this.setButtonEnabled(drawButton, isInProgress && phase === 'draw')\r\n    }\r\n\r\n    if (challengeButton) {\r\n      this.setButtonEnabled(challengeButton, isInProgress && phase === 'draw' && !this.gameInstance.currentChallenge)\r\n    }\r\n\r\n    if (endTurnButton) {\r\n      // ãƒ‰ãƒ­ãƒ¼ãƒ•ã‚§ãƒ¼ã‚ºã¾ãŸã¯è§£æ±ºãƒ•ã‚§ãƒ¼ã‚ºã§ã‚¿ãƒ¼ãƒ³çµ‚äº†ã‚’å¯èƒ½ã«\r\n      this.setButtonEnabled(endTurnButton, isInProgress && (phase === 'draw' || phase === 'resolution'))\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ã‚³ãƒ³ãƒ†ãƒŠãƒ™ãƒ¼ã‚¹ã®ãƒœã‚¿ãƒ³ã‚’ä½œæˆ\r\n   */\r\n  private createContainerButton(\r\n    x: number,\r\n    y: number,\r\n    text: string,\r\n    onClick: () => void,\r\n    style?: Phaser.Types.GameObjects.Text.TextStyle\r\n  ): Phaser.GameObjects.Container {\r\n    const container = this.add.container(x, y)\r\n    \r\n    // ãƒœã‚¿ãƒ³èƒŒæ™¯\r\n    const bg = this.add.rectangle(0, 0, 150, 40, 0x3498DB)\r\n    bg.setInteractive({ useHandCursor: true })\r\n    \r\n    // ãƒœã‚¿ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ\r\n    const textObj = this.add.text(0, 0, text, style || {\r\n      fontFamily: 'Noto Sans JP',\r\n      fontSize: '18px',\r\n      color: '#ffffff'\r\n    })\r\n    textObj.setOrigin(0.5)\r\n    \r\n    container.add([bg, textObj])\r\n    \r\n    // ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ\r\n    bg.on('pointerdown', () => {\r\n      // ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯éŸ³ã‚’å†ç”Ÿ\r\n      this.soundManager?.play('buttonClick')\r\n      onClick()\r\n    })\r\n    \r\n    // ãƒ›ãƒãƒ¼åŠ¹æœ\r\n    bg.on('pointerover', () => {\r\n      bg.setFillStyle(0x2980B9)\r\n      container.setScale(1.05)\r\n      // ãƒœã‚¿ãƒ³ãƒ›ãƒãƒ¼éŸ³ã‚’å†ç”Ÿ\r\n      this.soundManager?.play('buttonHover')\r\n    })\r\n    \r\n    bg.on('pointerout', () => {\r\n      bg.setFillStyle(0x3498DB)\r\n      container.setScale(1)\r\n    })\r\n    \r\n    return container\r\n  }\r\n\r\n  /**\r\n   * ãƒœã‚¿ãƒ³ã®æœ‰åŠ¹/ç„¡åŠ¹ã‚’åˆ‡ã‚Šæ›¿ãˆ\r\n   */\r\n  private setButtonEnabled(button: Phaser.GameObjects.Container, enabled: boolean): void {\r\n    if (!button?.list || button.list.length < 2) {\r\n      console.warn('Invalid button structure')\r\n      return\r\n    }\r\n\r\n    const buttonBg = button.list[0] as Phaser.GameObjects.Rectangle\r\n    const buttonText = button.list[1] as Phaser.GameObjects.Text\r\n\r\n    if (!buttonBg || !buttonText) {\r\n      console.warn('Button components not found')\r\n      return\r\n    }\r\n\r\n    if (enabled) {\r\n      buttonBg.setFillStyle(0x3498DB)\r\n      buttonText.setColor('#ffffff')\r\n      buttonBg.setInteractive()\r\n    } else {\r\n      buttonBg.setFillStyle(0x95A5A6)\r\n      buttonText.setColor('#cccccc')\r\n      buttonBg.disableInteractive()\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ãƒãƒ£ãƒ¬ãƒ³ã‚¸UIè¦ç´ ã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—\r\n   */\r\n  private cleanupChallengeUI(): void {\r\n    // ãƒ‘ãƒ¯ãƒ¼è¡¨ç¤ºã‚’å‰Šé™¤\r\n    const powerDisplay = this.children.getByName('power-display')\r\n    if (powerDisplay) {\r\n      powerDisplay.destroy()\r\n    }\r\n\r\n    // ãƒãƒ£ãƒ¬ãƒ³ã‚¸è§£æ±ºãƒœã‚¿ãƒ³ã‚’å‰Šé™¤\r\n    const resolveButton = this.children.getByName('resolve-challenge-button')\r\n    if (resolveButton) {\r\n      resolveButton.destroy()\r\n    }\r\n\r\n    // ãƒãƒ£ãƒ¬ãƒ³ã‚¸æƒ…å ±ã‚’å‰Šé™¤\r\n    const challengeInfo = this.children.getByName('challenge-info')\r\n    if (challengeInfo) {\r\n      challengeInfo.destroy()\r\n    }\r\n    \r\n    // æ‰‹æœ­ã®é¸æŠçŠ¶æ…‹ã‚’ã‚¯ãƒªã‚¢\r\n    this.clearHandSelection()\r\n  }\r\n\r\n  /**\r\n   * æ‰‹æœ­ã®é¸æŠçŠ¶æ…‹ã‚’ã‚¯ãƒªã‚¢\r\n   */\r\n  private clearHandSelection(): void {\r\n    this.handCards.forEach(cardContainer => {\r\n      // é¸æŠçŠ¶æ…‹ã‚’ã‚¯ãƒªã‚¢\r\n      if (cardContainer.getData('selected')) {\r\n        cardContainer.setData('selected', false)\r\n        cardContainer.setScale(1)\r\n        \r\n        // ãƒã‚¤ãƒ©ã‚¤ãƒˆå‰Šé™¤\r\n        const highlight = cardContainer.getByName('highlight')\r\n        if (highlight) {\r\n          highlight.destroy()\r\n        }\r\n      }\r\n    })\r\n    \r\n    // é¸æŠã‚«ãƒ¼ãƒ‰ã‚»ãƒƒãƒˆã‚’ã‚¯ãƒªã‚¢\r\n    this.selectedCards.clear()\r\n  }\r\n\r\n  /**\r\n   * ã‚²ãƒ¼ãƒ çµ‚äº†ç”»é¢ã‚’è¡¨ç¤º\r\n   */\r\n  private showGameEnd(isVictory: boolean): void {\r\n    // çµ±ä¸€ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã§æ¼”å‡ºã‚’å†ç”Ÿ\r\n    const gameCanvas = document.getElementById('game-container') as HTMLElement\r\n    if (gameCanvas) {\r\n      if (isVictory) {\r\n        this.animationManager.playVictoryAnimation(gameCanvas)\r\n      } else {\r\n        this.animationManager.playDefeatAnimation(gameCanvas)\r\n      }\r\n    }\r\n    \r\n    // æ—¢å­˜ã®ã‚²ãƒ¼ãƒ çµ‚äº†ç”»é¢ã‚‚è¡¨ç¤ºï¼ˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å¾Œã«ï¼‰\r\n    this.time.delayedCall(1000, () => {\r\n      const endContainer = this.add.container(this.centerX, this.centerY)\r\n      \r\n      const bg = this.add.rectangle(0, 0, this.gameWidth, this.gameHeight, 0x000000, 0.9)\r\n      \r\n      const titleText = this.add.text(\r\n        0,\r\n        -100,\r\n        isVictory ? 'äººç”Ÿå……å®Ÿï¼' : 'ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼',\r\n        {\r\n          fontFamily: 'Noto Sans JP',\r\n          fontSize: '48px',\r\n          color: isVictory ? '#FFD43B' : '#FF6B6B',\r\n          fontStyle: 'bold'\r\n        }\r\n      ).setOrigin(0.5)\r\n      \r\n      const stats = this.gameInstance.stats\r\n      const statsText = this.add.text(\r\n        0,\r\n        0,\r\n        `æœ€çµ‚æ´»åŠ›: ${this.gameInstance.vitality}\\n` +\r\n        `ç·ã‚¿ãƒ¼ãƒ³æ•°: ${stats.turnsPlayed}\\n` +\r\n        `ãƒãƒ£ãƒ¬ãƒ³ã‚¸æˆåŠŸæ•°: ${stats.successfulChallenges}/${stats.totalChallenges}\\n` +\r\n        `æœ€é«˜æ´»åŠ›: ${stats.highestVitality}`,\r\n        {\r\n          fontFamily: 'Noto Sans JP',\r\n          fontSize: '20px',\r\n          color: '#ffffff',\r\n          align: 'center',\r\n          lineSpacing: 10\r\n        }\r\n      ).setOrigin(0.5)\r\n      \r\n      const retryButton = this.createButton(\r\n        -100,\r\n        100,\r\n        'ã‚‚ã†ä¸€åº¦',\r\n        () => {\r\n          this.scene.restart()\r\n        },\r\n        {\r\n          fontFamily: 'Noto Sans JP',\r\n          fontSize: '20px',\r\n          color: '#ffffff'\r\n        }\r\n      )\r\n      \r\n      const menuButton = this.createButton(\r\n        100,\r\n        100,\r\n      'ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¸',\r\n      () => {\r\n        this.scene.start('MainMenuScene')\r\n      },\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '20px',\r\n        color: '#ffffff'\r\n      }\r\n    )\r\n    \r\n    endContainer.add([bg, titleText, statsText, retryButton, menuButton])\r\n    endContainer.setDepth(1000)\r\n    endContainer.setAlpha(0)\r\n    \r\n      // ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³\r\n      this.tweens.add({\r\n        targets: endContainer,\r\n        alpha: 1,\r\n        duration: 1000\r\n      })\r\n    }) // delayedCall ã®é–‰ã˜æ‹¬å¼§\r\n  }\r\n\r\n  /**\r\n   * Phase 3-3: é€šçŸ¥ã‚’è¡¨ç¤º\r\n   */\r\n  private showNotification(message: string, type: 'info' | 'warning' | 'success' = 'info'): void {\r\n    const notificationContainer = this.add.container(this.centerX, 200)\r\n    notificationContainer.setDepth(2500)\r\n\r\n    const colors = {\r\n      info: 0x3498db,\r\n      warning: 0xf39c12,\r\n      success: 0x2ecc71\r\n    }\r\n\r\n    const bg = this.add.rectangle(0, 0, 400, 60, colors[type], 0.9)\r\n    bg.setStrokeStyle(2, 0xffffff)\r\n\r\n    const text = this.add.text(\r\n      0, 0,\r\n      message,\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '16px',\r\n        color: '#ffffff',\r\n        fontStyle: 'bold'\r\n      }\r\n    ).setOrigin(0.5)\r\n\r\n    notificationContainer.add([bg, text])\r\n    notificationContainer.setScale(0)\r\n    notificationContainer.setAlpha(0)\r\n\r\n    // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³\r\n    this.tweens.add({\r\n      targets: notificationContainer,\r\n      scale: 1,\r\n      alpha: 1,\r\n      duration: 300,\r\n      ease: 'Back.easeOut',\r\n      onComplete: () => {\r\n        // 3ç§’å¾Œã«ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆ\r\n        this.time.delayedCall(3000, () => {\r\n          this.tweens.add({\r\n            targets: notificationContainer,\r\n            scale: 0.8,\r\n            alpha: 0,\r\n            duration: 300,\r\n            ease: 'Power2',\r\n            onComplete: () => notificationContainer.destroy()\r\n          })\r\n        })\r\n      }\r\n    })\r\n  }\r\n\r\n  /**\r\n   * ä¿é™ºæ›´æ–°é¸æŠãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤º\r\n   * DISABLED: ä¿é™ºæ›´æ–°ã‚·ã‚¹ãƒ†ãƒ ãŒå‰Šé™¤ã•ã‚ŒãŸãŸã‚ç„¡åŠ¹åŒ–\r\n   */\r\n  private showInsuranceRenewalDialog(renewalOption: unknown): void {\r\n    // ä¿é™ºæ›´æ–°ã‚·ã‚¹ãƒ†ãƒ ãŒå‰Šé™¤ã•ã‚ŒãŸãŸã‚ã€ã“ã®æ©Ÿèƒ½ã¯ç„¡åŠ¹åŒ–\r\n    console.warn('showInsuranceRenewalDialog: ä¿é™ºæ›´æ–°ã‚·ã‚¹ãƒ†ãƒ ãŒå‰Šé™¤ã•ã‚Œã¾ã—ãŸ')\r\n    return;\r\n\r\n    // ä¿é™ºæ›´æ–°é¸æŠã‚³ãƒ³ãƒ†ãƒŠã‚’ä½œæˆ\r\n    this.insuranceRenewalDialogUI = this.add.container(this.centerX, this.centerY)\r\n    this.insuranceRenewalDialogUI.setDepth(2100)\r\n\r\n    // èƒŒæ™¯ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤\r\n    const overlay = this.add.rectangle(\r\n      0, 0,\r\n      this.gameWidth, this.gameHeight,\r\n      0x000000, 0.8\r\n    )\r\n    overlay.setOrigin(0.5)\r\n\r\n    // ã‚«ãƒ¼ãƒ‰æƒ…å ±ã®èƒŒæ™¯\r\n    const cardInfoBg = this.add.rectangle(0, -50, 600, 400, 0x2C3E50)\r\n    cardInfoBg.setStrokeStyle(4, 0xFFD700)\r\n\r\n    // ã‚¿ã‚¤ãƒˆãƒ«\r\n    const titleText = this.add.text(\r\n      0, -220,\r\n      'ä¿é™ºæ›´æ–°ã®é¸æŠ',\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '36px',\r\n        color: '#ffffff',\r\n        fontStyle: 'bold'\r\n      }\r\n    ).setOrigin(0.5)\r\n\r\n    // ä¿é™ºåè¡¨ç¤º\r\n    const insuranceNameText = this.add.text(\r\n      0, -170,\r\n      renewalOption.cardName,\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '28px',\r\n        color: '#FFD700',\r\n        fontStyle: 'bold'\r\n      }\r\n    ).setOrigin(0.5)\r\n\r\n    // ã‚³ã‚¹ãƒˆæƒ…å ±è¡¨ç¤º\r\n    const currentVitality = this.gameInstance.vitality\r\n    const canAffordRenewal = currentVitality >= renewalOption.renewalCost\r\n    const costColor = canAffordRenewal ? '#00ff00' : '#ff4444'\r\n\r\n    const costInfoText = this.add.text(\r\n      0, -120,\r\n      `ç¾åœ¨ã‚³ã‚¹ãƒˆ: ${renewalOption.currentCost} â†’ æ›´æ–°ã‚³ã‚¹ãƒˆ: ${renewalOption.renewalCost} (+${renewalOption.costIncrease})`,\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '20px',\r\n        color: costColor,\r\n        fontStyle: 'bold'\r\n      }\r\n    ).setOrigin(0.5)\r\n\r\n    // æ´»åŠ›çŠ¶æ³è¡¨ç¤º\r\n    const vitalityStatusText = this.add.text(\r\n      0, -80,\r\n      `ç¾åœ¨ã®æ´»åŠ›: ${currentVitality}`,\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '18px',\r\n        color: '#ffffff'\r\n      }\r\n    ).setOrigin(0.5)\r\n\r\n    // å¹´é½¢ã«ã‚ˆã‚‹å¢—åŠ ç†ç”±\r\n    const ageReason = this.getAgeIncreaseReason()\r\n    const ageReasonText = this.add.text(\r\n      0, -50,\r\n      ageReason,\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '16px',\r\n        color: '#cccccc'\r\n      }\r\n    ).setOrigin(0.5)\r\n\r\n    // æ´»åŠ›ä¸è¶³è­¦å‘Šï¼ˆå¿…è¦ã«å¿œã˜ã¦è¡¨ç¤ºï¼‰\r\n    let insufficientVitalityWarning: Phaser.GameObjects.Text | null = null\r\n    if (!canAffordRenewal) {\r\n      insufficientVitalityWarning = this.add.text(\r\n        0, -10,\r\n        'âš  æ´»åŠ›ä¸è¶³ã§æ›´æ–°ã§ãã¾ã›ã‚“',\r\n        {\r\n          fontFamily: 'Noto Sans JP',\r\n          fontSize: '18px',\r\n          color: '#ff4444',\r\n          fontStyle: 'bold'\r\n        }\r\n      ).setOrigin(0.5)\r\n    }\r\n\r\n    this.insuranceRenewalDialogUI.add([\r\n      overlay, \r\n      cardInfoBg, \r\n      titleText, \r\n      insuranceNameText, \r\n      costInfoText, \r\n      vitalityStatusText, \r\n      ageReasonText\r\n    ])\r\n\r\n    if (insufficientVitalityWarning) {\r\n      this.insuranceRenewalDialogUI.add(insufficientVitalityWarning)\r\n    }\r\n\r\n    // æ›´æ–°ãƒœã‚¿ãƒ³ï¼ˆæ´»åŠ›ä¸è¶³ã§ã‚‚è¡¨ç¤ºã™ã‚‹ãŒã€åŠ¹æœçš„ã«ã¯å¤±åŠ¹ã™ã‚‹ï¼‰\r\n    this.createRenewalButton(\r\n      -150, 80,\r\n      'æ›´æ–°ã™ã‚‹',\r\n      `ã‚³ã‚¹ãƒˆ: ${renewalOption.renewalCost}`,\r\n      canAffordRenewal ? 0x4CAF50 : 0x9E9E9E, // ã‚°ãƒªãƒ¼ãƒ³ã¾ãŸã¯ã‚°ãƒ¬ãƒ¼\r\n      () => this.onRenewalSelected(renewalOption, true),\r\n      canAffordRenewal\r\n    )\r\n\r\n    // å¤±åŠ¹ãƒœã‚¿ãƒ³\r\n    this.createRenewalButton(\r\n      150, 80,\r\n      'å¤±åŠ¹ã•ã›ã‚‹',\r\n      'ãƒªã‚¹ã‚¯ã‚’å—ã‘å…¥ã‚Œã‚‹',\r\n      0xF44336, // ãƒ¬ãƒƒãƒ‰\r\n      () => this.onRenewalSelected(renewalOption, false),\r\n      true\r\n    )\r\n\r\n    // ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³\r\n    this.insuranceRenewalDialogUI.setAlpha(0)\r\n    this.tweens.add({\r\n      targets: this.insuranceRenewalDialogUI,\r\n      alpha: 1,\r\n      duration: 500,\r\n      ease: 'Power2'\r\n    })\r\n  }\r\n\r\n  /**\r\n   * æ›´æ–°é¸æŠãƒœã‚¿ãƒ³ã‚’ä½œæˆ\r\n   */\r\n  private createRenewalButton(\r\n    x: number,\r\n    y: number,\r\n    title: string,\r\n    subtitle: string,\r\n    color: number,\r\n    callback: () => void,\r\n    enabled: boolean\r\n  ): void {\r\n    if (!this.insuranceRenewalDialogUI) return\r\n\r\n    const buttonContainer = this.add.container(x, y)\r\n    \r\n    // ãƒœã‚¿ãƒ³èƒŒæ™¯\r\n    const buttonBg = this.add.rectangle(0, 0, 250, 100, color)\r\n    buttonBg.setStrokeStyle(3, enabled ? 0xffffff : 0x666666)\r\n    \r\n    if (enabled) {\r\n      buttonBg.setInteractive()\r\n    }\r\n    \r\n    // ã‚¿ã‚¤ãƒˆãƒ«ãƒ†ã‚­ã‚¹ãƒˆ\r\n    const titleText = this.add.text(\r\n      0, -15,\r\n      title,\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '20px',\r\n        color: enabled ? '#ffffff' : '#666666',\r\n        fontStyle: 'bold'\r\n      }\r\n    ).setOrigin(0.5)\r\n\r\n    // ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«ãƒ†ã‚­ã‚¹ãƒˆ\r\n    const subtitleText = this.add.text(\r\n      0, 15,\r\n      subtitle,\r\n      {\r\n        fontFamily: 'Noto Sans JP',\r\n        fontSize: '14px',\r\n        color: enabled ? '#ffffff' : '#666666'\r\n      }\r\n    ).setOrigin(0.5)\r\n\r\n    if (enabled) {\r\n      // ãƒ›ãƒãƒ¼åŠ¹æœ\r\n      buttonBg.on('pointerover', () => {\r\n        buttonContainer.setScale(1.05)\r\n        buttonBg.setFillStyle(Phaser.Display.Color.ValueToColor(color).brighten(20).color)\r\n      })\r\n\r\n      buttonBg.on('pointerout', () => {\r\n        buttonContainer.setScale(1)\r\n        buttonBg.setFillStyle(color)\r\n      })\r\n\r\n      // ã‚¯ãƒªãƒƒã‚¯å‡¦ç†\r\n      buttonBg.on('pointerdown', () => {\r\n        // å³åº§ã«UIå¿œç­”\r\n        buttonContainer.setScale(0.95)\r\n        \r\n        this.time.delayedCall(100, () => {\r\n          buttonContainer.setScale(1)\r\n          callback()\r\n        })\r\n      })\r\n    }\r\n\r\n    buttonContainer.add([buttonBg, titleText, subtitleText])\r\n    this.insuranceRenewalDialogUI.add(buttonContainer)\r\n  }\r\n\r\n  /**\r\n   * æ›´æ–°é¸æŠæ™‚ã®å‡¦ç†\r\n   */\r\n  private onRenewalSelected(renewalOption: InsuranceRenewalOption, shouldRenew: boolean): void {\r\n    // UIã‚’é–‰ã˜ã‚‹\r\n    if (this.insuranceRenewalDialogUI) {\r\n      this.tweens.add({\r\n        targets: this.insuranceRenewalDialogUI,\r\n        alpha: 0,\r\n        scale: 0.8,\r\n        duration: 300,\r\n        ease: 'Power2',\r\n        onComplete: () => {\r\n          this.insuranceRenewalDialogUI?.destroy()\r\n          this.insuranceRenewalDialogUI = undefined\r\n        }\r\n      })\r\n    }\r\n\r\n    try {\r\n      let result\r\n      if (shouldRenew) {\r\n        result = this.gameInstance.renewInsurance(renewalOption.cardId)\r\n      } else {\r\n        result = this.gameInstance.expireInsurance(renewalOption.cardId)\r\n      }\r\n\r\n      // çµæœãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º\r\n      const messageType = result.action === 'renewed' ? 'success' : 'warning'\r\n      this.showNotification(result.message, messageType)\r\n\r\n      // UIã‚’æ›´æ–°\r\n      this.time.delayedCall(500, () => {\r\n        this.updateInsuranceDisplay()\r\n        this.updateVitalityDisplay()\r\n        \r\n        // ä»–ã«æœŸé™åˆ‡ã‚Œã®ä¿é™ºãŒã‚ã‚‹ã‹ãƒã‚§ãƒƒã‚¯\r\n        this.checkForAdditionalRenewals()\r\n      })\r\n\r\n    } catch (error) {\r\n      console.error('Insurance renewal error:', error)\r\n      this.showNotification('ä¿é™ºå‡¦ç†ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ', 'error')\r\n    }\r\n  }\r\n\r\n  /**\r\n   * å¹´é½¢ã«ã‚ˆã‚‹å¢—åŠ ç†ç”±ã‚’å–å¾—\r\n   */\r\n  private getAgeIncreaseReason(): string {\r\n    const stage = this.gameInstance.stage\r\n    \r\n    switch (stage) {\r\n      case 'youth':\r\n        return 'é’å¹´æœŸã®ãŸã‚åŸºæœ¬ã‚³ã‚¹ãƒˆã§æ›´æ–°å¯èƒ½'\r\n      case 'middle':\r\n        return 'ä¸­å¹´æœŸã®ãŸã‚æ›´æ–°ã‚³ã‚¹ãƒˆãŒå¢—åŠ  (+2)'\r\n      case 'fulfillment':\r\n        return 'å……å®ŸæœŸã®ãŸã‚æ›´æ–°ã‚³ã‚¹ãƒˆãŒå¤§å¹…å¢—åŠ  (+4)'\r\n      default:\r\n        return 'å¹´é½¢ã«å¿œã˜ã¦ã‚³ã‚¹ãƒˆãŒèª¿æ•´ã•ã‚Œã¾ã™'\r\n    }\r\n  }\r\n\r\n  /**\r\n   * è¿½åŠ ã®æœŸé™åˆ‡ã‚Œä¿é™ºã‚’ãƒã‚§ãƒƒã‚¯\r\n   * DISABLED: ä¿é™ºæ›´æ–°ã‚·ã‚¹ãƒ†ãƒ ãŒå‰Šé™¤ã•ã‚ŒãŸãŸã‚ç„¡åŠ¹åŒ–\r\n   */\r\n  private checkForAdditionalRenewals(): void {\r\n    // ä¿é™ºæ›´æ–°ã‚·ã‚¹ãƒ†ãƒ ãŒå‰Šé™¤ã•ã‚ŒãŸãŸã‚ã€ã“ã®æ©Ÿèƒ½ã¯ç„¡åŠ¹åŒ–\r\n    return\r\n  }\r\n\r\n  // ===================\r\n  // ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«é–¢é€£\r\n  // ===================\r\n\r\n  /**\r\n   * ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã®åˆæœŸåŒ–\r\n   */\r\n  private initializeTutorial(): void {\r\n    try {\r\n      // TutorialManagerã®åˆæœŸåŒ–\r\n      this.tutorialManager = new TutorialManager(this, {\r\n        debugMode: false,\r\n        autoSaveProgress: true,\r\n        stepChangeDelay: 500,\r\n        defaultHighlightOptions: {\r\n          color: '#FFD700',\r\n          opacity: 0.4,\r\n          borderWidth: 3,\r\n          borderColor: '#FFA500',\r\n          glowEffect: true,\r\n          animationType: 'pulse',\r\n          duration: 1200\r\n        }\r\n      })\r\n\r\n      // TutorialOverlayã®åˆæœŸåŒ–\r\n      this.tutorialOverlay = new TutorialOverlay(this)\r\n      this.tutorialOverlay.setVisible(false)\r\n\r\n      // ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚¹ãƒ†ãƒƒãƒ—ã§å‚ç…§ã•ã‚Œã‚‹è¦ç´ ã‚’ç™»éŒ²\r\n      this.registerTutorialElements()\r\n\r\n      // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š\r\n      this.setupTutorialEventListeners()\r\n\r\n      // é–‹ç™ºç’°å¢ƒã§ã®ãƒ†ã‚¹ãƒˆãƒ˜ãƒ«ãƒ‘ãƒ¼è¨­å®š\r\n      if (process.env.NODE_ENV === 'development') {\r\n        this.time.delayedCall(1000, () => {\r\n          setupGlobalTutorialTests(this)\r\n        })\r\n      }\r\n\r\n    } catch (error) {\r\n      console.error('Tutorial initialization failed:', error)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«è¦ç´ ã®ç™»éŒ²\r\n   */\r\n  private registerTutorialElements(): void {\r\n    // æ‰‹æœ­ã‚¨ãƒªã‚¢\r\n    if (this.handCards.length > 0) {\r\n      this.tutorialStepElements.set('hand-area', this.handCards[0].parentContainer || this.handCards[0])\r\n    }\r\n\r\n    // ãƒã‚¤ã‚¿ãƒªãƒ†ã‚£ãƒãƒ¼\r\n    if (this.vitalityBarContainer) {\r\n      this.tutorialStepElements.set('vitality-bar', this.vitalityBarContainer)\r\n    }\r\n\r\n    // ä¿é™ºãƒªã‚¹ãƒˆ\r\n    if (this.insuranceListContainer) {\r\n      this.tutorialStepElements.set('insurance-list', this.insuranceListContainer)\r\n    }\r\n\r\n    // è² æ‹…æŒ‡æ¨™\r\n    if (this.burdenIndicatorContainer) {\r\n      this.tutorialStepElements.set('burden-indicator', this.burdenIndicatorContainer)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®è¨­å®š\r\n   */\r\n  private setupTutorialEventListeners(): void {\r\n    if (!this.tutorialManager) return\r\n\r\n    this.tutorialManager.on('tutorial:started', (data) => {\r\n      this.isTutorialMode = true\r\n      this.tutorialOverlay?.setVisible(true)\r\n      if (import.meta.env.DEV) console.log('Tutorial started:', data.tutorialId)\r\n    })\r\n\r\n    this.tutorialManager.on('tutorial:step:enter', (data) => {\r\n      this.handleTutorialStepEnter(data)\r\n    })\r\n\r\n    this.tutorialManager.on('tutorial:step:exit', () => {\r\n      this.tutorialOverlay?.clearHighlights()\r\n    })\r\n\r\n    this.tutorialManager.on('tutorial:completed', () => {\r\n      this.endTutorialMode()\r\n    })\r\n\r\n    this.tutorialManager.on('tutorial:skipped', () => {\r\n      this.endTutorialMode()\r\n    })\r\n\r\n    this.tutorialManager.on('tutorial:error', (data) => {\r\n      console.error('Tutorial error:', data.error)\r\n      this.endTutorialMode()\r\n    })\r\n\r\n    // ç”»é¢ãƒªã‚µã‚¤ã‚ºå¯¾å¿œ\r\n    this.scale.on('resize', () => {\r\n      this.tutorialOverlay?.onResize()\r\n    })\r\n  }\r\n\r\n  /**\r\n   * ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚¹ãƒ†ãƒƒãƒ—é–‹å§‹æ™‚ã®å‡¦ç†\r\n   */\r\n  private handleTutorialStepEnter(_data: unknown): void {\r\n    if (!this.tutorialOverlay || !this.tutorialManager) return\r\n\r\n    const currentStep = this.tutorialManager.getCurrentStep()\r\n    if (!currentStep) return\r\n\r\n    const progress = this.tutorialManager.getProgress()\r\n    if (!progress) return\r\n\r\n    // é€²æ—ãƒãƒ¼ã®æ›´æ–°\r\n    const totalSteps = this.tutorialManager.getCurrentStep() ? \r\n      (this.tutorialManager as unknown as { currentConfig?: { steps: { length: number } } }).currentConfig?.steps.length || 0 : 0\r\n    this.tutorialOverlay.createProgressBar(progress, totalSteps)\r\n\r\n    // ã‚¿ãƒ¼ã‚²ãƒƒãƒˆè¦ç´ ã®å‡¦ç†\r\n    let targetBounds: Phaser.Geom.Rectangle | undefined\r\n    if (currentStep.targetElement) {\r\n      const targetElement = this.tutorialStepElements.get(currentStep.targetElement) ||\r\n                          this.children.getByName(currentStep.targetElement)\r\n      \r\n      if (targetElement?.getBounds) {\r\n        targetBounds = targetElement.getBounds()\r\n        \r\n        // ã‚¹ãƒãƒƒãƒˆãƒ©ã‚¤ãƒˆåŠ¹æœ\r\n        this.tutorialOverlay.createSpotlight(targetElement)\r\n        \r\n        // ãƒã‚¤ãƒ©ã‚¤ãƒˆåŠ¹æœ\r\n        this.tutorialOverlay.highlightElement(\r\n          currentStep.targetElement, \r\n          currentStep.highlightOptions\r\n        )\r\n      }\r\n    }\r\n\r\n    // å¹ãå‡ºã—è¡¨ç¤º\r\n    this.tutorialOverlay.createSpeechBubble(currentStep, targetBounds)\r\n\r\n    // åˆ¶å¾¡ãƒœã‚¿ãƒ³\r\n    const canGoBack = progress.currentStepIndex > 0\r\n    const canSkip = true // åŸºæœ¬çš„ã«ã¯ã‚¹ã‚­ãƒƒãƒ—å¯èƒ½\r\n\r\n    this.tutorialOverlay.createControlButtons(\r\n      canGoBack,\r\n      canSkip,\r\n      () => this.tutorialManager?.nextStep(),\r\n      canGoBack ? () => this.tutorialManager?.previousStep() : undefined,\r\n      () => this.tutorialManager?.skipTutorial()\r\n    )\r\n\r\n    // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œã®æœ‰åŠ¹åŒ–\r\n    this.tutorialOverlay.enableKeyboardControls(\r\n      () => this.tutorialManager?.nextStep(),\r\n      canGoBack ? () => this.tutorialManager?.previousStep() : undefined,\r\n      () => this.tutorialManager?.skipTutorial()\r\n    )\r\n\r\n    // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å¾…æ©Ÿã®å ´åˆã®è‡ªå‹•é€²è¡Œè¨­å®š\r\n    if (currentStep.action === 'wait' && currentStep.waitTime) {\r\n      this.time.delayedCall(currentStep.waitTime, () => {\r\n        this.tutorialManager?.nextStep()\r\n      })\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ãƒ¢ãƒ¼ãƒ‰çµ‚äº†\r\n   */\r\n  private endTutorialMode(): void {\r\n    this.isTutorialMode = false\r\n    \r\n    if (this.tutorialOverlay) {\r\n      this.tutorialOverlay.setVisible(false)\r\n      this.tutorialOverlay.clearHighlights()\r\n    }\r\n\r\n    // é€šå¸¸ã®UIåˆ¶é™ã‚’è§£é™¤\r\n    this.enableAllGameUI()\r\n    \r\n    if (import.meta.env.DEV) console.log('Tutorial mode ended')\r\n  }\r\n\r\n  /**\r\n   * ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«è‡ªå‹•é–‹å§‹ï¼ˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰å‘¼ã³å‡ºã•ã‚ŒãŸå ´åˆï¼‰\r\n   */\r\n  private autoStartTutorial(): void {\r\n    if (import.meta.env.DEV) console.log('Auto-starting tutorial from menu')\r\n    \r\n    // ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’é–‹å§‹\r\n    this.startTutorial(INTERACTIVE_GAME_TUTORIAL)\r\n      .then(() => {\r\n        if (import.meta.env.DEV) console.log('Tutorial started successfully')\r\n      })\r\n      .catch((error) => {\r\n        console.error('Failed to start tutorial:', error)\r\n      })\r\n  }\r\n\r\n  /**\r\n   * ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«é–‹å§‹ï¼ˆå¤–éƒ¨ã‹ã‚‰å‘¼ã³å‡ºã—ç”¨ï¼‰\r\n   */\r\n  public startTutorial(config: TutorialConfig): Promise<void> {\r\n    if (!this.tutorialManager) {\r\n      return Promise.reject(new Error('Tutorial manager not initialized'))\r\n    }\r\n\r\n    // æ—¢å­˜ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ãŒå®Œäº†æ¸ˆã¿ã‹ãƒã‚§ãƒƒã‚¯\r\n    if (this.tutorialManager.isCompleted(config.id)) {\r\n      if (import.meta.env.DEV) console.log('Tutorial already completed:', config.id)\r\n      return Promise.resolve()\r\n    }\r\n\r\n    // ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ãƒ¢ãƒ¼ãƒ‰åˆ¶é™ã‚’é©ç”¨\r\n    this.applyTutorialModeRestrictions()\r\n\r\n    return this.tutorialManager.startTutorial(config)\r\n  }\r\n\r\n  /**\r\n   * ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ä¸­ã®UIåˆ¶é™é©ç”¨\r\n   */\r\n  private applyTutorialModeRestrictions(): void {\r\n    // ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã‚’ä¸€æ™‚ç„¡åŠ¹åŒ–\r\n    this.isDragInProgress = false\r\n    \r\n    // é€šå¸¸ã®ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–ï¼ˆãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã§æŒ‡ç¤ºã•ã‚ŒãŸã‚‚ã®ä»¥å¤–ï¼‰\r\n    this.disableNonTutorialUI()\r\n  }\r\n\r\n  /**\r\n   * éãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«UIã®ç„¡åŠ¹åŒ–\r\n   */\r\n  private disableNonTutorialUI(): void {\r\n    // å®Ÿè£…ï¼šãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ä¸­ã¯ç‰¹å®šã®UIè¦ç´ ã®ã¿ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«\r\n    // è©³ç´°ãªå®Ÿè£…ã¯æ—¢å­˜ã®UIè¦ç´ ã®æ§‹é€ ã«ä¾å­˜\r\n  }\r\n\r\n  /**\r\n   * å…¨ã‚²ãƒ¼ãƒ UIã®æœ‰åŠ¹åŒ–\r\n   */\r\n  private enableAllGameUI(): void {\r\n    // å®Ÿè£…ï¼šã™ã¹ã¦ã®UIè¦ç´ ã‚’å†åº¦æœ‰åŠ¹åŒ–\r\n    // ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã‚„ãƒœã‚¿ãƒ³ã®åˆ¶é™ã‚’è§£é™¤\r\n  }\r\n\r\n  /**\r\n   * ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«è¦ç´ ã®å‹•çš„ç™»éŒ²\r\n   */\r\n  public registerTutorialElement(name: string, element: Phaser.GameObjects.GameObject): void {\r\n    this.tutorialStepElements.set(name, element)\r\n  }\r\n\r\n  /**\r\n   * ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«çŠ¶æ…‹ã®ç¢ºèª\r\n   */\r\n  public isTutorialActive(): boolean {\r\n    return this.isTutorialMode\r\n  }\r\n\r\n  /**\r\n   * ç¾åœ¨ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚¹ãƒ†ãƒƒãƒ—å–å¾—\r\n   */\r\n  public getCurrentTutorialStep(): TutorialStep | null {\r\n    return this.tutorialManager?.getCurrentStep() || null\r\n  }\r\n\r\n  /**\r\n   * ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«å¼·åˆ¶çµ‚äº†\r\n   */\r\n  public stopTutorial(): void {\r\n    if (this.tutorialManager) {\r\n      this.tutorialManager.skipTutorial()\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ã‚·ãƒ¼ãƒ³ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å‡¦ç†\r\n   */\r\n  public destroy(): void {\r\n    // æ–°ã—ã„ãƒ‰ãƒ­ãƒƒãƒ—ã‚¾ãƒ¼ãƒ³ã‚·ã‚¹ãƒ†ãƒ ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—\r\n    if (this.dropZoneIntegration) {\r\n      this.dropZoneIntegration.destroy()\r\n      this.dropZoneIntegration = undefined\r\n    }\r\n    \r\n    // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—\r\n    if (this.keyboardController) {\r\n      this.keyboardController.destroy()\r\n      this.keyboardController = undefined\r\n    }\r\n\r\n    // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®å‰Šé™¤\r\n    this.data.events.off('cardSelected')\r\n\r\n    // è¦ªã‚¯ãƒ©ã‚¹ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚’å‘¼ã³å‡ºã—\r\n    super.destroy()\r\n  }\r\n\r\n  // === GameRenderer Interface Support Methods ===\r\n\r\n  /**\r\n   * ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã‚’æ›´æ–°\r\n   */\r\n  updateGameState(game: Game): void {\r\n    this.gameInstance = game\r\n    this.updateVitalityDisplay(game.vitality, game.getMaxVitality())\r\n    this.updateProgressDisplay(game.stage, game.turn)\r\n  }\r\n\r\n  /**\r\n   * æ‰‹æœ­ã‚«ãƒ¼ãƒ‰ã‚’è¡¨ç¤º\r\n   */\r\n  displayHandCards(cards: Card[]): void {\r\n    this.clearHandDisplay()\r\n    cards.forEach((card, index) => {\r\n      this.createHandCard(card, index)\r\n    })\r\n  }\r\n\r\n  /**\r\n   * ç¾åœ¨ã®ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã‚’è¡¨ç¤º\r\n   */\r\n  displayCurrentChallenge(challenge: Card): void {\r\n    this.updateChallengeDisplay(challenge)\r\n  }\r\n\r\n  /**\r\n   * ä¿é™ºè¡¨ç¤ºã‚’æ›´æ–°\r\n   */\r\n  updateInsuranceDisplay(insurances: Card[]): void {\r\n    this.updateInsuranceList(insurances)\r\n  }\r\n\r\n  /**\r\n   * ä¿é™ºæ–™è² æ‹…è¡¨ç¤ºã‚’æ›´æ–°\r\n   */\r\n  updateInsuranceBurdenDisplay(burden: number): void {\r\n    this.updateBurdenIndicator(burden)\r\n  }\r\n\r\n  /**\r\n   * é€²æ—è¡¨ç¤ºã‚’æ›´æ–°\r\n   */\r\n  updateProgressDisplay(stage: string, turn: number): void {\r\n    if (this.stageText) {\r\n      this.stageText.setText(`${stage} - ã‚¿ãƒ¼ãƒ³ ${turn}`)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ã‚«ãƒ¼ãƒ‰é¸æŠUIã‚’è¡¨ç¤º\r\n   */\r\n  showCardSelectionUI(\r\n    cards: Card[],\r\n    minSelection: number,\r\n    maxSelection: number,\r\n    message: string,\r\n    callback: (selectedCards: Card[]) => void\r\n  ): void {\r\n    this.createCardSelectionInterface(cards, minSelection, maxSelection, message, callback)\r\n  }\r\n\r\n  /**\r\n   * ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã‚¢ã‚¯ã‚·ãƒ§ãƒ³UIã‚’è¡¨ç¤º\r\n   */\r\n  showChallengeActionUI(\r\n    challenge: Card,\r\n    callback: (action: 'start' | 'skip') => void\r\n  ): void {\r\n    this.createChallengeActionInterface(challenge, callback)\r\n  }\r\n\r\n  /**\r\n   * ä¿é™ºé¸æŠUIã‚’è¡¨ç¤º\r\n   */\r\n  showInsuranceSelectionUI(\r\n    cards: Card[],\r\n    message: string,\r\n    callback: (selectedInsurance: Card) => void\r\n  ): void {\r\n    this.createInsuranceSelectionInterface(cards, message, callback)\r\n  }\r\n\r\n  /**\r\n   * ç¢ºèªUIã‚’è¡¨ç¤º\r\n   */\r\n  showConfirmationUI(\r\n    message: string,\r\n    defaultChoice: 'yes' | 'no',\r\n    callback: (choice: 'yes' | 'no') => void\r\n  ): void {\r\n    this.createConfirmationDialog(message, defaultChoice, callback)\r\n  }\r\n\r\n  /**\r\n   * ãƒãƒ£ãƒ¬ãƒ³ã‚¸çµæœã‚’è¡¨ç¤º\r\n   */\r\n  displayChallengeResult(result: ChallengeResult): void {\r\n    this.showChallengeResultScreen(result)\r\n  }\r\n\r\n  /**\r\n   * ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º\r\n   */\r\n  showMessage(message: string, level: 'info' | 'success' | 'warning' = 'info'): void {\r\n    const color = level === 'success' ? '#4CAF50' : level === 'warning' ? '#FF9800' : '#2196F3'\r\n    this.createTemporaryMessage(message, color)\r\n  }\r\n\r\n  /**\r\n   * ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º\r\n   */\r\n  showError(error: string): void {\r\n    this.createTemporaryMessage(error, '#F44336')\r\n  }\r\n\r\n  /**\r\n   * ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ç”»é¢ã‚’è¡¨ç¤º\r\n   */\r\n  showGameOverScreen(stats: PlayerStats): void {\r\n    this.createGameOverScreen(stats)\r\n  }\r\n\r\n  /**\r\n   * å‹åˆ©ç”»é¢ã‚’è¡¨ç¤º\r\n   */\r\n  showVictoryScreen(stats: PlayerStats): void {\r\n    this.createVictoryScreen(stats)\r\n  }\r\n\r\n  /**\r\n   * ã‚¹ãƒ†ãƒ¼ã‚¸ã‚¯ãƒªã‚¢ç”»é¢ã‚’è¡¨ç¤º\r\n   */\r\n  showStageClearScreen(stage: string, stats: PlayerStats): void {\r\n    this.createStageClearScreen(stage, stats)\r\n  }\r\n\r\n  /**\r\n   * ç”»é¢ã‚’ã‚¯ãƒªã‚¢\r\n   */\r\n  clearDisplay(): void {\r\n    this.clearAllUI()\r\n  }\r\n\r\n  // === Helper Methods for UI Creation ===\r\n\r\n  private createCardSelectionInterface(\r\n    cards: Card[],\r\n    minSelection: number,\r\n    maxSelection: number,\r\n    message: string,\r\n    callback: (selectedCards: Card[]) => void\r\n  ): void {\r\n    // ã‚«ãƒ¼ãƒ‰é¸æŠã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®å®Ÿè£…ï¼ˆç°¡ç•¥åŒ–ç‰ˆï¼‰\r\n    callback(cards.slice(0, Math.min(maxSelection, cards.length)))\r\n  }\r\n\r\n  private createChallengeActionInterface(\r\n    challenge: Card,\r\n    callback: (action: 'start' | 'skip') => void\r\n  ): void {\r\n    // ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã‚¢ã‚¯ã‚·ãƒ§ãƒ³é¸æŠã®å®Ÿè£…ï¼ˆç°¡ç•¥åŒ–ç‰ˆï¼šè‡ªå‹•ã§startã‚’é¸æŠï¼‰\r\n    callback('start')\r\n  }\r\n\r\n  private createInsuranceSelectionInterface(\r\n    cards: Card[],\r\n    message: string,\r\n    callback: (selectedInsurance: Card) => void\r\n  ): void {\r\n    // ä¿é™ºé¸æŠã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®å®Ÿè£…ï¼ˆç°¡ç•¥åŒ–ç‰ˆï¼šæœ€åˆã®ã‚«ãƒ¼ãƒ‰ã‚’é¸æŠï¼‰\r\n    if (cards.length > 0) {\r\n      callback(cards[0])\r\n    }\r\n  }\r\n\r\n  private createConfirmationDialog(\r\n    message: string,\r\n    defaultChoice: 'yes' | 'no',\r\n    callback: (choice: 'yes' | 'no') => void\r\n  ): void {\r\n    // ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã®å®Ÿè£…ï¼ˆç°¡ç•¥åŒ–ç‰ˆï¼šãƒ‡ãƒ•ã‚©ãƒ«ãƒˆé¸æŠã‚’è¿”ã™ï¼‰\r\n    callback(defaultChoice)\r\n  }\r\n\r\n  private showChallengeResultScreen(result: ChallengeResult): void {\r\n    // ãƒãƒ£ãƒ¬ãƒ³ã‚¸çµæœç”»é¢ã®å®Ÿè£…\r\n    console.log('Challenge result:', result)\r\n  }\r\n\r\n  private createTemporaryMessage(message: string, color: string): void {\r\n    // ä¸€æ™‚çš„ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º\r\n    const messageText = this.add.text(\r\n      this.cameras.main.centerX,\r\n      this.cameras.main.centerY - 100,\r\n      message,\r\n      {\r\n        fontSize: '24px',\r\n        color,\r\n        stroke: '#000000',\r\n        strokeThickness: 2\r\n      }\r\n    )\r\n    messageText.setOrigin(0.5)\r\n    messageText.setDepth(1000)\r\n\r\n    // 3ç§’å¾Œã«å‰Šé™¤\r\n    this.time.delayedCall(3000, () => {\r\n      messageText.destroy()\r\n    })\r\n  }\r\n\r\n  private createGameOverScreen(stats: PlayerStats): void {\r\n    // ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ç”»é¢ã®å®Ÿè£…\r\n    console.log('Game Over:', stats)\r\n  }\r\n\r\n  private createVictoryScreen(stats: PlayerStats): void {\r\n    // å‹åˆ©ç”»é¢ã®å®Ÿè£…\r\n    console.log('Victory:', stats)\r\n  }\r\n\r\n  private createStageClearScreen(stage: string, stats: PlayerStats): void {\r\n    // ã‚¹ãƒ†ãƒ¼ã‚¸ã‚¯ãƒªã‚¢ç”»é¢ã®å®Ÿè£…\r\n    console.log('Stage Clear:', stage, stats)\r\n  }\r\n\r\n  private clearAllUI(): void {\r\n    // ã™ã¹ã¦ã®UIè¦ç´ ã‚’ã‚¯ãƒªã‚¢\r\n    this.clearHandDisplay()\r\n    this.clearSelectionUI()\r\n  }\r\n\r\n  private clearHandDisplay(): void {\r\n    // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œã‹ã‚‰ç™»éŒ²è§£é™¤\r\n    if (this.keyboardController) {\r\n      this.handCards.forEach((cardContainer) => {\r\n        this.keyboardController!.unregisterFocusableElement(cardContainer)\r\n      })\r\n    }\r\n    \r\n    // æ‰‹æœ­è¡¨ç¤ºã‚’ã‚¯ãƒªã‚¢\r\n    this.handCards.forEach(card => card.destroy())\r\n    this.handCards = []\r\n  }\r\n\r\n  private clearSelectionUI(): void {\r\n    // é¸æŠUIè¦ç´ ã‚’ã‚¯ãƒªã‚¢\r\n    if (this.cardSelectionUI) {\r\n      this.cardSelectionUI.destroy()\r\n      this.cardSelectionUI = undefined\r\n    }\r\n    if (this.insuranceTypeSelectionUI) {\r\n      this.insuranceTypeSelectionUI.destroy()\r\n      this.insuranceTypeSelectionUI = undefined\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * ã‚µã‚¦ãƒ³ãƒ‰ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã‚’åˆæœŸåŒ–\r\n   */\r\n  private initializeSoundManager(): void {\r\n    this.soundManager = new SoundManager(this)\r\n    \r\n    // ã‚µã‚¦ãƒ³ãƒ‰ã®æœ‰åŠ¹/ç„¡åŠ¹åˆ‡ã‚Šæ›¿ãˆã‚­ãƒ¼ï¼ˆM ã‚­ãƒ¼ï¼‰\r\n    this.input.keyboard?.on('keydown-M', () => {\r\n      if (this.soundManager) {\r\n        const enabled = !this.soundManager.isEnabled()\r\n        this.soundManager.setEnabled(enabled)\r\n        this.soundManager.saveSettings()\r\n        this.showMessage(enabled ? 'ã‚µã‚¦ãƒ³ãƒ‰ ON' : 'ã‚µã‚¦ãƒ³ãƒ‰ OFF', 'info')\r\n      }\r\n    })\r\n  }\r\n  \r\n  /**\r\n   * ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç®¡ç†ã‚’åˆæœŸåŒ–\r\n   */\r\n  private initializePerformanceManager(): void {\r\n    const isMobile = this.registry.get('isMobile')\r\n    \r\n    if (isMobile) {\r\n      // ãƒ¢ãƒã‚¤ãƒ«ãƒ‡ãƒã‚¤ã‚¹ã§ã®ã¿ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç®¡ç†ã‚’æœ‰åŠ¹åŒ–\r\n      this.performanceManager = new MobilePerformanceManager(this, {\r\n        minFPS: 30,\r\n        maxMemoryUsage: 75,\r\n        maxRenderTime: 33.33, // 30fps target for mobile\r\n        maxDrawCalls: 80\r\n      })\r\n      \r\n      // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¬ãƒ™ãƒ«å¤‰æ›´ã®ãƒªã‚¹ãƒŠãƒ¼\r\n      this.events.on('optimizationLevelChanged', (level: 'low' | 'medium' | 'high') => {\r\n        this.handleOptimizationLevelChange(level)\r\n      })\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * æœ€é©åŒ–ãƒ¬ãƒ™ãƒ«å¤‰æ›´æ™‚ã®å‡¦ç†\r\n   */\r\n  private handleOptimizationLevelChange(level: 'low' | 'medium' | 'high'): void {\r\n    switch (level) {\r\n      case 'low':\r\n        // ä½å“è³ªè¨­å®š\r\n        this.frameSkipThreshold = 3\r\n        this.tweens.timeScale = 0.8 // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é€Ÿåº¦ã‚’ä¸‹ã’ã‚‹\r\n        break\r\n      case 'medium':\r\n        // ä¸­å“è³ªè¨­å®š\r\n        this.frameSkipThreshold = 2\r\n        this.tweens.timeScale = 1.0\r\n        break\r\n      case 'high':\r\n        // é«˜å“è³ªè¨­å®š\r\n        this.frameSkipThreshold = 1\r\n        this.tweens.timeScale = 1.0\r\n        break\r\n    }\r\n    \r\n    // æœ€é©åŒ–ãƒ¬ãƒ™ãƒ«ã®å¤‰æ›´ã‚’é€šçŸ¥\r\n    if (import.meta.env.DEV) {\r\n      console.log(`Performance optimization level changed to: ${level}`)\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * ãƒœã‚¿ãƒ³ã‚’ä½œæˆï¼ˆã‚µã‚¦ãƒ³ãƒ‰ä»˜ãï¼‰\r\n   */\r\n  protected createButton(\r\n    x: number,\r\n    y: number,\r\n    text: string,\r\n    onClick: () => void,\r\n    style?: Phaser.Types.GameObjects.Text.TextStyle\r\n  ): Phaser.GameObjects.Text {\r\n    const button = super.createButton(x, y, text, onClick, style)\r\n    \r\n    // ã‚µã‚¦ãƒ³ãƒ‰ä»˜ãã®ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ã‚’è¿½åŠ \r\n    button.removeAllListeners()\r\n    \r\n    button.on('pointerover', () => {\r\n      button.setBackgroundColor('#364FC7')\r\n      button.setScale(1.05)\r\n      this.soundManager?.play('buttonHover')\r\n    })\r\n\r\n    button.on('pointerout', () => {\r\n      button.setBackgroundColor('#4C6EF5')\r\n      button.setScale(1)\r\n    })\r\n\r\n    button.on('pointerdown', () => {\r\n      button.setScale(0.95)\r\n      this.soundManager?.play('buttonClick')\r\n    })\r\n\r\n    button.on('pointerup', () => {\r\n      button.setScale(1.05)\r\n      onClick()\r\n    })\r\n    \r\n    return button\r\n  }\r\n\r\n  /**\r\n   * æ¯ãƒ•ãƒ¬ãƒ¼ãƒ å®Ÿè¡Œã•ã‚Œã‚‹æ›´æ–°å‡¦ç†ï¼ˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ï¼‰\r\n   */\r\n  override update(time: number, delta: number): void {\r\n    // ã‚¹ãƒ­ãƒƒãƒˆãƒ«ä»˜ãUIæ›´æ–°\r\n    GameSceneOptimizationMixin.throttledUIUpdate.call(this, delta)\r\n    \r\n    // å®šæœŸçš„ãªãƒ¡ãƒ¢ãƒªã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ï¼ˆ10ç§’ã”ã¨ï¼‰\r\n    if (time % 10000 < delta) {\r\n      GameSceneOptimizationMixin.cleanupUnusedResources.call(this)\r\n    }\r\n    \r\n    // ãƒãƒƒãƒå‡¦ç†ã®æç”»å‘¼ã³å‡ºã—æœ€å°åŒ–ï¼ˆ5ç§’ã”ã¨ï¼‰\r\n    if (time % 5000 < delta) {\r\n      GameSceneOptimizationMixin.minimizeDrawCalls.call(this)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * æœ€é©åŒ–ã•ã‚ŒãŸã‚¨ãƒ•ã‚§ã‚¯ãƒˆè¡¨ç¤º\r\n   */\r\n  private showOptimizedDropEffect(x: number, y: number, success: boolean): void {\r\n    GameSceneOptimizationMixin.createOptimizedEffect.call(\r\n      this, \r\n      x, \r\n      y, \r\n      success ? 'success' : 'failure'\r\n    )\r\n  }\r\n\r\n  /**\r\n   * æœ€é©åŒ–ã•ã‚ŒãŸæ‰‹æœ­é…ç½®\r\n   */\r\n  private arrangeHandOptimized(): void {\r\n    GameSceneOptimizationMixin.batchUpdateHandCards.call(this)\r\n  }\r\n\r\n  /**\r\n   * ã‚·ãƒ¼ãƒ³ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å‡¦ç†\r\n   */\r\n  private cleanup(): void {\r\n    // ã™ã¹ã¦ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’å‰Šé™¤\r\n    this.eventCleanupManager.removeAll()\r\n    \r\n    // Tweenã‚’ã™ã¹ã¦åœæ­¢\r\n    this.tweens.killAll()\r\n    \r\n    // ã‚¿ã‚¤ãƒãƒ¼ã‚’ã™ã¹ã¦å‰Šé™¤\r\n    this.time.removeAllEvents()\r\n    \r\n    // ã‚µã‚¦ãƒ³ãƒ‰ã‚’åœæ­¢\r\n    if (this.soundManager) {\r\n      this.soundManager.stopAll()\r\n    }\r\n    \r\n    // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç®¡ç†ã®ç ´æ£„\r\n    if (this.performanceManager) {\r\n      this.performanceManager.destroy()\r\n    }\r\n    \r\n    // ãƒ‰ãƒ­ãƒƒãƒ—ã‚¾ãƒ¼ãƒ³ã®ç ´æ£„\r\n    if (this.dropZoneIntegration) {\r\n      this.dropZoneIntegration.destroy()\r\n    }\r\n    \r\n    // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã®ç ´æ£„\r\n    if (this.keyboardController) {\r\n      this.keyboardController.destroy()\r\n    }\r\n    \r\n    // ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã®ç ´æ£„\r\n    if (this.tutorialManager) {\r\n      this.tutorialManager.destroy()\r\n    }\r\n    \r\n    // UIã‚³ãƒ³ãƒ†ãƒŠã®ç ´æ£„\r\n    const containers = [\r\n      this.cardSelectionUI,\r\n      this.insuranceTypeSelectionUI,\r\n      this.vitalityBarContainer,\r\n      this.insuranceListContainer,\r\n      this.burdenIndicatorContainer,\r\n      this.insuranceRenewalDialogUI,\r\n      this.tutorialOverlay\r\n    ]\r\n    \r\n    containers.forEach(container => {\r\n      if (container) {\r\n        container.destroy()\r\n      }\r\n    })\r\n    \r\n    // æ‰‹æœ­ã‚«ãƒ¼ãƒ‰ã®ç ´æ£„\r\n    this.handCards.forEach(card => {\r\n      card.destroy()\r\n    })\r\n    this.handCards = []\r\n    \r\n    // ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ—ãƒ¼ãƒ«ã®ã‚¯ãƒªã‚¢\r\n    if (this.objectPools) {\r\n      Object.values(this.objectPools).forEach(pool => {\r\n        pool.forEach((obj: any) => {\r\n          if (obj?.destroy) {\r\n            obj.destroy()\r\n          }\r\n        })\r\n      })\r\n    }\r\n    \r\n    // ãƒ‡ãƒãƒƒã‚°å‡ºåŠ›\r\n    if (import.meta.env.DEV) {\r\n      console.log('GameScene cleanup completed')\r\n      this.eventCleanupManager.debugPrint()\r\n    }\r\n  }\r\n}"],"names":["BaseScene","Scene","__publicField","time","delta","duration","callback","size","x","y","text","onClick","style","button","container","bg","buttonText","card","cardWidth","GAME_CONSTANTS","cardHeight","cardBg","isInsuranceCard","gradient","gloss","pattern","i","typeIcon","iconBgColor","iconBg","icon","cardName","description","powerBg","powerColor","powerText","insuranceType","typeBg","typeText","glow","PreloadScene","progressBar","progressBox","loadingText","percentText","value","graphics","j","key","color","buttonGraphics","highlightGraphics","MainMenuScene","overlay","creditContainer","creditText","closeButton","GameSceneOptimizationMixin","deltaTime","type","pool","object","effect","updates","cardContainer","index","targetX","targetY","u","tween","progress","update","target","child","textureKeys","usedTextures","_a","textureGroups","depth","group","GameScene","EventCleanupManager","getUnifiedAnimationManager","data","Game","starterCards","CardFactory","challengeCards","stageText","stageLabel","vitalityText","turnText","label","burden","burdenText","title","indicatorContainer","stages","stageLabels","stageColors","currentStageIndex","stage","isActive","isCurrent","dot","maxVitalityForStage","maxVitalityLabel","line","barBg","vitalityPercentage","barWidth","maxMarker","percentage","deckArea","deckBack","deckCount","discardArea","discardPlaceholder","discardLabel","challengeArea","challengePlaceholder","challengeLabel","DropZoneIntegration","draggedCard","highlight","zoneName","isValid","alpha","radius","buttonContainer","drawButton","challengeButton","endTurnButton","KeyboardController","phase","actionButtons","count","cardColor","glassBg","hitArea","costBg","costText","ageBonusIndicator","currentBonus","bonusBg","bonusText","effectivePower","multiplier","basePowerText","cardElements","pointer","dragStartTime","dragX","dragY","offsetY","dropZone","_b","totalWidth","startX","challengeCard","originalX","originalY","glowEffect","transitionOverlay","item","activeInsurances","noInsuranceText","insurance","yPos","cardItem","isExpiringSoon","isExpiringSoonTwoTurns","isExpiringSoonOneTurn","bgColor","strokeColor","itemBg","animationDuration","badgeColor","textColor","typeBadge","nameText","bonus","turnsTextColor","turnsText","warningIconColor","warningIcon","divider","warningText","previousBurden","currentTime","oldVitality","newVitality","targetWidth","newColor","counter","currentPercentage","currentColor","powerDisplay","selectedCardsArray","powerBreakdown","countText","yOffset","baseText","insuranceText","challengeX","challengeY","zone","spark","angle","distance","cardIndex","challengeInfo","challengeContainer","descText","existingButton","selectedPower","subText","totalPower","result","gameState","resultContainer","titleText","detailContent","detailText","burdenImpactText","currentStage","stageName","AGE_PARAMETERS","turnsInStage","maxTurns","turn","previousMaxVitality","newChallenges","newMaxVitality","transitionContainer","textElement","vitalityChangeText","reviewRecommendation","reviewText","reviewButton","skipButton","particle","warningContainer","iconText","messageText","actionText","renewal","remainingTurns","insuranceName","warningColor","iconEmoji","urgencyText","pulseRepeats","displayTime","recommendationText","recommendText","buttons","titleBg","feature","featureText","detailBg","selectButton","adjustment","tooltipText","tooltipContainer","selectedTypeText","confirmText","cardChoices","onComplete","cardSpacing","cardX","cardDesc","coverageText","durationText","durationLabel","goldGlow","nextCount","selectedContainer","element","insuranceCount","burdenAmount","adviceText","flashOverlay","highlightContainer","acquiredText","isInProgress","textObj","enabled","buttonBg","resolveButton","isVictory","gameCanvas","endContainer","stats","statsText","retryButton","menuButton","message","notificationContainer","colors","renewalOption","subtitle","subtitleText","shouldRenew","messageType","error","TutorialManager","TutorialOverlay","_data","currentStep","totalSteps","targetBounds","targetElement","canGoBack","INTERACTIVE_GAME_TUTORIAL","config","name","game","cards","challenge","insurances","minSelection","maxSelection","defaultChoice","level","SoundManager","MobilePerformanceManager","success","obj"],"mappings":"0XAOO,MAAeA,UAAkBC,EAAAA,KAAM,CAAvC,kCACKC,EAAA,gBACAA,EAAA,gBACAA,EAAA,kBACAA,EAAA,mBAEV,QAAe,CAEb,KAAK,UAAY,KAAK,QAAQ,KAAK,MACnC,KAAK,WAAa,KAAK,QAAQ,KAAK,OACpC,KAAK,QAAU,KAAK,UAAY,EAChC,KAAK,QAAU,KAAK,WAAa,EAGjC,KAAK,WAAA,CACP,CAUA,OAAOC,EAAcC,EAAqB,CAE1C,CAKU,OAAOC,EAAmB,IAAW,CAC7C,KAAK,QAAQ,KAAK,OAAOA,EAAU,EAAG,EAAG,CAAC,CAC5C,CAKU,QAAQA,EAAmB,IAAKC,EAA6B,CACrE,KAAK,QAAQ,KAAK,QAAQD,EAAU,EAAG,EAAG,CAAC,EAEvCC,GACF,KAAK,QAAQ,KAAK,KAAK,wBAAyBA,CAAQ,CAE5D,CAKU,aAAaC,EAAe,GAA6C,CACjF,MAAO,CACL,WAAY,eACZ,SAAU,GAAGA,CAAI,KACjB,MAAO,SAAA,CAEX,CAKU,aACRC,EACAC,EACAC,EACAC,EACAC,EACyB,CACzB,MAAMC,EAAS,KAAK,IAAI,KAAKL,EAAGC,EAAGC,EAAME,GAAS,KAAK,aAAA,CAAc,EAClE,UAAU,EAAG,EACb,eAAe,CAAE,cAAe,EAAA,CAAM,EACtC,WAAW,GAAI,EAAE,EACjB,mBAAmB,SAAS,EAC5B,SAAS,SAAS,EAGrB,OAAAC,EAAO,GAAG,cAAe,IAAM,CAC7BA,EAAO,mBAAmB,SAAS,EACnCA,EAAO,SAAS,IAAI,CACtB,CAAC,EAEDA,EAAO,GAAG,aAAc,IAAM,CAC5BA,EAAO,mBAAmB,SAAS,EACnCA,EAAO,SAAS,CAAC,CACnB,CAAC,EAEDA,EAAO,GAAG,cAAe,IAAM,CAC7BA,EAAO,SAAS,GAAI,CACtB,CAAC,EAEDA,EAAO,GAAG,YAAa,IAAM,CAC3BA,EAAO,SAAS,IAAI,EACpBF,EAAA,CACF,CAAC,EAEME,CACT,CAKU,sBACRL,EACAC,EACAC,EACAC,EACAC,EAC8B,CAC9B,MAAME,EAAY,KAAK,IAAI,UAAUN,EAAGC,CAAC,EAGnCM,EAAK,KAAK,IAAI,SAAA,EACpBA,EAAG,UAAU,QAAU,CAAC,EACxBA,EAAG,gBAAgB,IAAK,IAAK,IAAK,GAAI,CAAC,EAGvC,MAAMC,EAAa,KAAK,IAAI,KAAK,EAAG,EAAGN,EAAME,GAAS,KAAK,aAAA,CAAc,EACtE,UAAU,EAAG,EAEhB,OAAAE,EAAU,IAAI,CAACC,EAAIC,CAAU,CAAC,EAC9BF,EAAU,QAAQ,IAAK,EAAE,EACzBA,EAAU,eAAe,CAAE,cAAe,EAAA,CAAM,EAGhDA,EAAU,GAAG,cAAe,IAAM,CAChCC,EAAG,MAAA,EACHA,EAAG,UAAU,QAAU,CAAC,EACxBA,EAAG,gBAAgB,IAAK,IAAK,IAAK,GAAI,CAAC,EACvCD,EAAU,SAAS,IAAI,CACzB,CAAC,EAEDA,EAAU,GAAG,aAAc,IAAM,CAC/BC,EAAG,MAAA,EACHA,EAAG,UAAU,QAAU,CAAC,EACxBA,EAAG,gBAAgB,IAAK,IAAK,IAAK,GAAI,CAAC,EACvCD,EAAU,SAAS,CAAC,CACtB,CAAC,EAEDA,EAAU,GAAG,cAAe,IAAM,CAChCA,EAAU,SAAS,GAAI,CACzB,CAAC,EAEDA,EAAU,GAAG,YAAa,IAAM,CAC9BA,EAAU,SAAS,IAAI,EACvBH,EAAA,CACF,CAAC,EAEMG,CACT,CAKU,oBAAoBG,EAAYT,EAAWC,EAAyC,CAC5F,MAAMK,EAAY,KAAK,IAAI,UAAUN,EAAGC,CAAC,EAGnCS,EAAYC,EAAe,WAC3BC,EAAaD,EAAe,YAG5BE,EAAS,KAAK,IAAI,SAAA,EAGlBC,EAAkBL,EAAK,WAAa,YAE1C,GAAIK,EAAiB,CAGnBD,EAAO,UAAU,QAAU,EAAG,EAC9BA,EAAO,gBAAgB,CAACH,EAAU,EAAI,EAAG,CAACE,EAAW,EAAI,EAAGF,EAAY,EAAGE,EAAa,EAAG,EAAE,EAG7F,MAAMG,EAAW,KAAK,IAAI,SAAA,EAC1BA,EAAS,UAAU,QAAU,CAAC,EAC9BA,EAAS,gBAAgB,CAACL,EAAU,EAAG,CAACE,EAAW,EAAGF,EAAWE,EAAY,EAAE,EAG/E,MAAMI,EAAQ,KAAK,IAAI,SAAA,EACvBA,EAAM,UAAU,SAAU,GAAI,EAC9BA,EAAM,gBAAgB,CAACN,EAAU,EAAG,CAACE,EAAW,EAAGF,EAAWE,EAAW,EAAG,EAAE,EAG9E,MAAMK,EAAU,KAAK,IAAI,SAAA,EACzBA,EAAQ,UAAU,EAAG,SAAU,EAAG,EAClC,QAASC,EAAI,EAAGA,EAAI,EAAGA,IACrBD,EAAQ,UAAA,EACRA,EAAQ,IAAI,CAACP,EAAU,EAAI,GAAKQ,EAAI,GAAI,CAACN,EAAW,EAAI,GAAI,GAAI,EAAG,KAAK,GAAK,CAAC,EAC9EK,EAAQ,WAAA,EAGVX,EAAU,IAAI,CAACO,EAAQE,EAAUC,EAAOC,CAAO,CAAC,CAClD,MAEEJ,EAAO,UAAU,SAAU,GAAI,EAC/BA,EAAO,gBAAgB,CAACH,EAAU,EAAG,CAACE,EAAW,EAAGF,EAAWE,EAAY,EAAE,EAG7EC,EAAO,UAAU,EAAG,SAAU,CAAC,EAC/BA,EAAO,kBAAkB,CAACH,EAAU,EAAG,CAACE,EAAW,EAAGF,EAAWE,EAAY,EAAE,EAE/EN,EAAU,IAAIO,CAAM,EAItB,IAAIM,EAAW,KACXC,EAAc,QAElB,OAAQX,EAAK,SAAA,CACX,IAAK,YACHU,EAAW,MACXC,EAAc,QACd,MACF,IAAK,YACHD,EAAWV,EAAK,MAAQ,EAAI,IAAM,IAClCW,EAAcX,EAAK,MAAQ,EAAI,QAAW,SAC1C,MACF,IAAK,SACHU,EAAW,KACXC,EAAc,QACd,MACF,IAAK,UACHD,EAAW,IACXC,EAAc,SACd,KAAA,CAIJ,MAAMC,EAAS,KAAK,IAAI,SAAA,EACxBA,EAAO,UAAUD,EAAaN,EAAkB,GAAM,GAAI,EAC1DO,EAAO,WAAW,CAACX,EAAU,EAAI,GAAI,CAACE,EAAW,EAAI,GAAI,EAAE,EAG3D,MAAMU,EAAO,KAAK,IAAI,KAAK,CAACZ,EAAU,EAAI,GAAI,CAACE,EAAW,EAAI,GAAIO,EAAU,CAC1E,WAAY,QACZ,SAAU,MAAA,CACX,EAAE,UAAU,EAAG,EAGVI,EAAW,KAAK,IAAI,KAAK,EAAG,CAACX,EAAW,EAAI,GAAIH,EAAK,KAAM,CAC/D,WAAY,eACZ,SAAU,OACV,UAAW,OACX,MAAOK,EAAkB,UAAY,UACrC,MAAO,SACP,SAAU,CAAE,MAAOJ,EAAY,EAAA,CAAG,CACnC,EAAE,UAAU,GAAK,CAAC,EAGbc,EAAc,KAAK,IAAI,KAAK,EAAG,IAAKf,EAAK,YAAa,CAC1D,WAAY,eACZ,SAAU,OACV,MAAOK,EAAkB,UAAY,UACrC,MAAO,SACP,SAAU,CAAE,MAAOJ,EAAY,EAAA,EAC/B,YAAa,CAAA,CACd,EAAE,UAAU,EAAG,EAGhB,GAAI,CAACI,GAAmBL,EAAK,QAAU,EAAG,CACxC,MAAMgB,EAAU,KAAK,IAAI,SAAA,EACnBC,EAAajB,EAAK,MAAQ,EAAI,QAAW,SAC/CgB,EAAQ,UAAUC,EAAY,CAAC,EAC/BD,EAAQ,WAAWf,EAAU,EAAI,GAAIE,EAAW,EAAI,GAAI,EAAE,EAE1D,MAAMe,EAAY,KAAK,IAAI,KACzBjB,EAAU,EAAI,GACdE,EAAW,EAAI,GACf,GAAGH,EAAK,MAAQ,EAAI,IAAM,EAAE,GAAGA,EAAK,KAAK,GACzC,CACE,WAAY,QACZ,SAAU,OACV,UAAW,OACX,MAAO,SAAA,CACT,EACA,UAAU,EAAG,EAEfH,EAAU,IAAI,CAACmB,EAASE,CAAS,CAAC,CACpC,CAGA,GAAIb,EAAiB,CAEnB,MAAMc,EAAgBnB,EAAK,gBAAkB,aAAe,OAAS,OAC/DoB,EAAS,KAAK,IAAI,SAAA,EACxBA,EAAO,UAAU,SAAU,EAAG,EAC9BA,EAAO,gBAAgB,IAAKjB,EAAW,EAAI,GAAI,IAAK,GAAI,EAAE,EAE1D,MAAMkB,EAAW,KAAK,IAAI,KAAK,EAAGlB,EAAW,EAAI,GAAIgB,EAAe,CAClE,WAAY,eACZ,SAAU,OACV,UAAW,OACX,MAAO,SAAA,CACR,EAAE,UAAU,EAAG,EAEhBtB,EAAU,IAAI,CAACuB,EAAQC,CAAQ,CAAC,CAClC,CAEA,OAAAxB,EAAU,IAAI,CAACe,EAAQC,EAAMC,EAAUC,CAAW,CAAC,EAGnDlB,EAAU,QAAQI,EAAWE,CAAU,EACvCN,EAAU,eAAe,CAAE,cAAe,EAAA,CAAM,EAChDA,EAAU,QAAQ,OAAQG,CAAI,EAC9BH,EAAU,QAAQ,YAAaN,CAAC,EAChCM,EAAU,QAAQ,YAAaL,CAAC,EAGhCK,EAAU,GAAG,cAAe,IAAM,CAUhC,GATA,KAAK,OAAO,IAAI,CACd,QAASA,EACT,OAAQ,KACR,OAAQ,KACR,SAAU,IACV,KAAM,QAAA,CACP,EAGGQ,EAAiB,CACnB,MAAMiB,EAAO,KAAK,IAAI,SAAA,EACtBA,EAAK,UAAU,EAAG,QAAU,EAAG,EAC/BA,EAAK,kBAAkB,CAACrB,EAAU,EAAI,EAAG,CAACE,EAAW,EAAI,EAAGF,EAAY,EAAGE,EAAa,EAAG,EAAE,EAC7FN,EAAU,IAAIyB,CAAI,EAClBzB,EAAU,QAAQ,aAAcyB,CAAI,EAEpC,KAAK,OAAO,IAAI,CACd,QAASA,EACT,MAAO,GACP,SAAU,IACV,KAAM,GACN,OAAQ,EAAA,CACT,CACH,CACF,CAAC,EAEDzB,EAAU,GAAG,aAAc,IAAM,CAC/B,KAAK,OAAO,IAAI,CACd,QAASA,EACT,OAAQ,EACR,OAAQ,EACR,SAAU,IACV,KAAM,QAAA,CACP,EAGD,MAAMyB,EAAOzB,EAAU,QAAQ,YAAY,EACvCyB,IACFA,EAAK,QAAA,EACLzB,EAAU,QAAQ,aAAc,IAAI,EAExC,CAAC,EAEMA,CACT,CACF,CCpWO,MAAM0B,UAAqBxC,CAAU,CAC1C,aAAc,CACZ,MAAM,CAAE,IAAK,eAAgB,CAC/B,CAEA,SAAgB,CAEd,MAAMyC,EAAc,KAAK,IAAI,SAAA,EACvBC,EAAc,KAAK,IAAI,SAAA,EAC7BA,EAAY,UAAU,QAAU,EAAG,EACnCA,EAAY,SAAS,IAAK,IAAK,IAAK,EAAE,EAEtC,MAAMC,EAAc,KAAK,IAAI,KAC3B,KAAK,QAAQ,KAAK,QAClB,KAAK,QAAQ,KAAK,QAAU,GAC5B,aACA,CACE,WAAY,eACZ,SAAU,OACV,MAAO,SAAA,CACT,EACA,UAAU,EAAG,EAETC,EAAc,KAAK,IAAI,KAC3B,KAAK,QAAQ,KAAK,QAClB,KAAK,QAAQ,KAAK,QAAU,EAC5B,KACA,CACE,WAAY,eACZ,SAAU,OACV,MAAO,SAAA,CACT,EACA,UAAU,EAAG,EAGf,KAAK,KAAK,GAAG,WAAaC,GAAkB,CAC1CD,EAAY,QAAQ,GAAG,KAAK,MAAMC,EAAQ,GAAG,CAAC,GAAG,EACjDJ,EAAY,MAAA,EACZA,EAAY,UAAU,SAAU,CAAC,EACjCA,EAAY,SAAS,IAAK,IAAK,IAAMI,EAAO,EAAE,CAChD,CAAC,EAGD,KAAK,KAAK,GAAG,WAAY,IAAM,CAC7BJ,EAAY,QAAA,EACZC,EAAY,QAAA,EACZC,EAAY,QAAA,EACZC,EAAY,QAAA,CACd,CAAC,EAGD,KAAK,WAAA,CACP,CAKQ,YAAmB,CAEzB,KAAK,eAAA,EAGL,KAAK,gBAAA,EAGL,KAAK,eAAA,CACP,CAKQ,gBAAuB,CAC7B,MAAME,EAAW,KAAK,IAAI,SAAA,EAG1BA,EAAS,UAAU,QAAU,CAAC,EAC9BA,EAAS,gBAAgB,EAAG,EAAG,IAAK,IAAK,CAAC,EAG1CA,EAAS,UAAU,EAAG,OAAQ,EAC9B,QAASpB,EAAI,GAAIA,EAAI,IAAKA,GAAK,GAC7B,QAASqB,EAAI,GAAIA,EAAI,IAAKA,GAAK,GAC7BD,EAAS,aAAapB,EAAGqB,EAAG,CAAC,EAKjCD,EAAS,gBAAgB,YAAa,IAAK,GAAG,EAC9CA,EAAS,QAAA,CACX,CAKQ,iBAAwB,CAE9B,KAAK,eAAe,qBAAsB,OAAQ,EAGlD,KAAK,eAAe,0BAA2B,OAAQ,EAGvD,KAAK,eAAe,wBAAyB,QAAQ,CACvD,CAKQ,eAAeE,EAAaC,EAAqB,CACvD,MAAMH,EAAW,KAAK,IAAI,SAAA,EAG1BA,EAAS,UAAUG,EAAO,CAAC,EAC3BH,EAAS,gBAAgB,EAAG,EAAG,IAAK,IAAK,CAAC,EAG1CA,EAAS,UAAU,SAAU,CAAC,EAC9BA,EAAS,gBAAgB,EAAG,EAAG,IAAK,IAAK,CAAC,EAG1CA,EAAS,UAAUG,EAAO,CAAC,EAC3BH,EAAS,SAAS,EAAG,EAAG,IAAK,EAAE,EAG/BA,EAAS,gBAAgBE,EAAK,IAAK,GAAG,EACtCF,EAAS,QAAA,CACX,CAKQ,gBAAuB,CAE7B,MAAMI,EAAiB,KAAK,IAAI,SAAA,EAChCA,EAAe,UAAU,QAAU,CAAC,EACpCA,EAAe,gBAAgB,EAAG,EAAG,IAAK,GAAI,EAAE,EAChDA,EAAe,gBAAgB,YAAa,IAAK,EAAE,EACnDA,EAAe,QAAA,EAGf,MAAMC,EAAoB,KAAK,IAAI,SAAA,EACnCA,EAAkB,UAAU,EAAG,SAAU,CAAC,EAC1CA,EAAkB,kBAAkB,EAAG,EAAG,IAAK,IAAK,CAAC,EACrDA,EAAkB,gBAAgB,iBAAkB,IAAK,GAAG,EAC5DA,EAAkB,QAAA,CACpB,CAEU,YAAmB,CAE3B,KAAK,MAAM,MAAM,eAAe,CAClC,CACF,CCvJO,MAAMC,UAAsBpD,CAAU,CAC3C,aAAc,CACZ,MAAM,CAAE,IAAK,gBAAiB,CAChC,CAEU,YAAmB,CAE3B,KAAK,OAAA,EAGL,KAAK,IAAI,KACP,KAAK,QACL,IACA,UACA,CACE,WAAY,eACZ,SAAU,OACV,MAAO,UACP,UAAW,MAAA,CACb,EACA,UAAU,EAAG,EAGf,KAAK,IAAI,KACP,KAAK,QACL,IACA,uCACA,CACE,WAAY,eACZ,SAAU,OACV,MAAO,SAAA,CACT,EACA,UAAU,EAAG,EAGf,KAAK,kBAAA,EAGL,KAAK,IAAI,KACP,GACA,KAAK,WAAa,GAClB,+BACA,CACE,WAAY,eACZ,SAAU,OACV,MAAO,SAAA,CACT,CAEJ,CAKQ,mBAA0B,CAKhC,KAAK,aACH,KAAK,QACL,IACA,UACA,IAAM,KAAK,UAAA,EACX,CACE,WAAY,eACZ,SAAU,OACV,MAAO,SAAA,CACT,EAIF,KAAK,aACH,KAAK,QACL,IACA,UACA,IAAM,KAAK,cAAA,EACX,CACE,WAAY,eACZ,SAAU,OACV,MAAO,SAAA,CACT,EAIF,KAAK,aACH,KAAK,QACL,IACA,KACA,IAAM,KAAK,aAAA,EACX,CACE,WAAY,eACZ,SAAU,OACV,MAAO,SAAA,CACT,EAIF,KAAK,aACH,KAAK,QACL,IACA,QACA,IAAM,KAAK,YAAA,EACX,CACE,WAAY,eACZ,SAAU,OACV,MAAO,SAAA,CACT,CAEJ,CAKQ,WAAkB,CACxB,KAAK,QAAQ,IAAK,IAAM,CACtB,KAAK,MAAM,MAAM,WAAW,CAC9B,CAAC,CACH,CAKQ,eAAsB,CAC5B,KAAK,QAAQ,IAAK,IAAM,CAEtB,KAAK,MAAM,MAAM,YAAa,CAAE,cAAe,GAAM,CACvD,CAAC,CACH,CAKQ,cAAqB,CAK3B,KAAK,iBAAiB,aAAc,MAAM,CAC5C,CAKQ,aAAoB,CAE1B,MAAMqD,EAAU,KAAK,IAAI,SAAA,EACzBA,EAAQ,UAAU,EAAU,EAAG,EAC/BA,EAAQ,SAAS,EAAG,EAAG,KAAK,UAAW,KAAK,UAAU,EAEtD,MAAMC,EAAkB,KAAK,IAAI,UAAU,KAAK,QAAS,KAAK,OAAO,EAG/DC,EAAa,KAAK,IAAI,KAC1B,EACA,KACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UACA,CACE,WAAY,eACZ,SAAU,OACV,MAAO,UACP,MAAO,SACP,YAAa,EAAA,CACf,EACA,UAAU,EAAG,EAGTC,EAAc,KAAK,aACvB,EACA,IACA,MACA,IAAM,CACJF,EAAgB,QAAA,EAChBD,EAAQ,QAAA,CACV,EACA,CACE,WAAY,eACZ,SAAU,OACV,MAAO,SAAA,CACT,EAGFC,EAAgB,IAAI,CAACC,EAAYC,CAAW,CAAC,EAG7CF,EAAgB,SAAS,CAAC,EAC1B,KAAK,OAAO,IAAI,CACd,QAASA,EACT,MAAO,EACP,SAAU,GAAA,CACX,CACH,CACF,CC/LO,MAAMG,EAA6B,CAIxC,+BAA+C,CAE7C,KAAK,iBAAmB,EACxB,KAAK,mBAAqB,EAG1B,KAAK,YAAc,CACjB,QAAS,CAAA,EACT,MAAO,CAAA,EACP,SAAU,CAAA,CAAC,EAIb,KAAK,QAAQ,KAAK,eAAe,EAAI,EAGrC,KAAK,KAAK,SAAS,eAAe,EAAE,CACtC,EAKA,kBAA6BC,EAAyB,CAEpD,KAAK,mBACD,OAAK,iBAAmB,KAAK,sBAGjC,KAAK,iBAAmB,EAGpB,KAAK,WAAW,UAAY,KAAK,qBAAqB,UAAY,IACpE,KAAK,kBAAA,EACL,KAAK,qBAAqB,SAAW,IACrC,KAAK,WAAW,SAAW,IAGzB,KAAK,WAAW,WAAa,KAAK,qBAAqB,WAAa,IACtE,KAAK,oBAAA,EACL,KAAK,qBAAqB,UAAY,IACtC,KAAK,WAAW,UAAY,IAG1B,KAAK,WAAW,QAAU,KAAK,qBAAqB,QAAU,IAChE,KAAK,sBAAA,EACL,KAAK,qBAAqB,OAAS,IACnC,KAAK,WAAW,OAAS,IAI3B,OAAO,KAAK,KAAK,oBAAoB,EAAE,QAAQV,GAAO,CAChD,KAAK,qBAAqBA,CAAG,EAAI,IACnC,KAAK,qBAAqBA,CAAG,GAAKU,EAEtC,CAAC,EACH,EAKA,YAAuBC,EAAmB,CACxC,MAAMC,EAAO,KAAK,YAAYD,CAAI,EAClC,OAAIC,GAAQA,EAAK,OAAS,EACjBA,EAAK,IAAA,EAEP,IACT,EAKA,aAAwBD,EAAcE,EAAmB,CACvD,MAAMD,EAAO,KAAK,YAAYD,CAAI,EAC9BC,GAAQA,EAAK,OAAS,IACxBC,EAAO,WAAW,EAAK,EACvBA,EAAO,UAAU,EAAK,EACtBD,EAAK,KAAKC,CAAM,GAEhBA,EAAO,QAAA,CAEX,EAKA,sBAAiCrD,EAAWC,EAAWkD,EAAoB,CACzE,IAAIG,EAAS,KAAK,YAAY,SAAS,EAevC,OAbKA,GAGHA,EAAO,MAAA,EACPA,EAAO,WAAW,EAAI,EACtBA,EAAO,UAAU,EAAI,GAJrBA,EAAS,KAAK,IAAI,SAAA,EAOpBA,EAAO,YAAYtD,EAAGC,CAAC,EACvBqD,EAAO,SAAS,CAAC,EACjBA,EAAO,SAAS,CAAC,EAGTH,EAAA,CACN,IAAK,UACHG,EAAO,UAAU,QAAU,EAAG,EAC9BA,EAAO,WAAW,EAAG,EAAG,EAAE,EAC1B,MACF,IAAK,UACHA,EAAO,UAAU,EAAG,SAAU,EAAG,EACjCA,EAAO,UAAA,EACPA,EAAO,OAAO,IAAK,GAAG,EACtBA,EAAO,OAAO,GAAI,EAAE,EACpBA,EAAO,OAAO,GAAI,GAAG,EACrBA,EAAO,OAAO,IAAK,EAAE,EACrBA,EAAO,WAAA,EACP,KAAA,CAIJ,KAAK,OAAO,IAAI,CACd,QAASA,EACT,MAAO,EACP,MAAOH,IAAS,UAAY,EAAI,EAChC,SAAU,IACV,KAAM,aACN,WAAY,IAAM,CAChB,KAAK,aAAa,UAAWG,CAAM,CACrC,CAAA,CACD,CACH,EAKA,sBAAsC,CAEpC,MAAMC,EAAoD,CAAA,EAE1D,KAAK,UAAU,QAAQ,CAACC,EAAoBC,IAAkB,CAC5D,MAAMC,EAAU,KAAK,SAAY,KAAK,UAAU,OAAS,GAAK,GAAM,EAAID,EAAQ,GAC1EE,EAAU,KAAK,QAAQ,KAAK,OAAS,IAE3CJ,EAAQ,KAAK,CACX,KAAMC,EACN,EAAGE,EACH,EAAGC,CAAA,CACJ,CACH,CAAC,EAGGJ,EAAQ,OAAS,GACnB,KAAK,OAAO,IAAI,CACd,QAASA,EAAQ,IAAIK,GAAKA,EAAE,IAAI,EAChC,SAAU,IACV,KAAM,aACN,SAAWC,GAAe,CACxB,MAAMC,EAAWD,EAAM,SACvBN,EAAQ,QAAQ,CAACQ,EAAQ7C,IAAM,CAC7B,MAAM8C,EAASH,EAAM,QAAQ3C,CAAC,EAC1B8C,IACFA,EAAO,EAAI,OAAO,KAAK,OAAOA,EAAO,EAAGD,EAAO,EAAGD,CAAQ,EAC1DE,EAAO,EAAI,OAAO,KAAK,OAAOA,EAAO,EAAGD,EAAO,EAAGD,CAAQ,EAE9D,CAAC,CACH,CAAA,CACD,CAEL,EAKA,wBAAwC,CAEtC,KAAK,KAAK,MAAM,aAAc,wBAAyB,wBAAwB,CACjF,EAKA,oBAAoC,CAElC,KAAK,QAAQ,KAAK,mBAAmB,OAAQ,EAC7C,KAAK,QAAQ,KAAK,UAAY,GAG9B,KAAK,SAAS,KAAK,QAASG,GAAe,CACrCA,EAAM,iBACRA,EAAM,gBAAgB,CAAC,CAE3B,CAAC,CACH,EAKA,wBAAwC,CAEtC,MAAMC,EAAc,KAAK,SAAS,eAAA,EAC5BC,MAAmB,IAGzB,KAAK,SAAS,KAAK,QAASF,GAAe,QACrCG,EAAAH,EAAM,UAAN,MAAAG,EAAe,KACjBD,EAAa,IAAIF,EAAM,QAAQ,GAAG,CAEtC,CAAC,EAGDC,EAAY,QAAQ1B,GAAO,CACzB,GAAI,CAAC2B,EAAa,IAAI3B,CAAG,GAAK,CAAC,CAAC,YAAa,YAAa,SAAS,EAAE,SAASA,CAAG,EAC/E,GAAI,CACF,KAAK,SAAS,OAAOA,CAAG,CAC1B,OAAS,EAAG,CAEZ,CAEJ,CAAC,CACH,EAKA,mBAAmC,CAEjC,MAAM6B,MAAoB,IAE1B,KAAK,SAAS,KAAK,QAASJ,GAAe,OACzC,IAAIG,EAAAH,EAAM,UAAN,MAAAG,EAAe,IAAK,CACtB,MAAM5B,EAAMyB,EAAM,QAAQ,IACrBI,EAAc,IAAI7B,CAAG,GACxB6B,EAAc,IAAI7B,EAAK,EAAE,EAE3B6B,EAAc,IAAI7B,CAAG,EAAG,KAAKyB,CAAK,CACpC,CACF,CAAC,EAGD,IAAIK,EAAQ,EACZD,EAAc,QAASE,GAAU,CAC/BA,EAAM,QAAQN,GAAS,CACrBA,EAAM,SAASK,CAAK,CACtB,CAAC,EACDA,GACF,CAAC,CACH,CACF,ECpOO,MAAME,UAAkBhF,CAAU,CAgEvC,aAAc,CACZ,MAAM,CAAE,IAAK,YAAa,EAhEpBE,EAAA,qBACAA,EAAA,iBAA4C,CAAA,GAC5CA,EAAA,yBAAiC,KACjCA,EAAA,wBACAA,EAAA,iCACAA,EAAA,8BACAA,EAAA,6BACAA,EAAA,oBACAA,EAAA,2BAA8B,KAC9BA,EAAA,+BACAA,EAAA,iCACAA,EAAA,iCAGAA,EAAA,kBAAa,CACnB,SAAU,GACV,UAAW,GACX,OAAQ,GACR,KAAM,GACN,cAAe,GACf,UAAW,GACX,MAAO,GACP,KAAM,EAAA,GAIAA,EAAA,4BAAuB,CAC7B,SAAU,EACV,UAAW,EACX,OAAQ,CAAA,GAIFA,EAAA,wBAA2B,GAC3BA,EAAA,0BAA6B,GAC7BA,EAAA,mBAAqC,CAC3C,QAAS,CAAA,EACT,MAAO,CAAA,EACP,SAAU,CAAA,CAAC,GAILA,EAAA,4BAGAA,EAAA,2BAGAA,EAAA,qBAGAA,EAAA,2BAA2C,IAAI+E,GAG/C/E,EAAA,wBACAA,EAAA,wBACAA,EAAA,sBAA0B,IAC1BA,EAAA,gCAAuE,KACvEA,EAAA,2BAA+B,IAG/BA,EAAA,yBAKN,KAAK,iBAAmBgF,EAAA,CAC1B,CAEA,KAAKC,EAAyC,CAE5C,KAAK,oBAAsBA,EAAK,eAAiB,EACnD,CAEU,YAAmB,CAE3B1B,EAA2B,8BAA8B,KAAK,IAAI,EAClEA,EAA2B,mBAAmB,KAAK,IAAI,EAGvD,KAAK,OAAO,KAAK,WAAY,KAAK,QAAS,IAAI,EAC/C,KAAK,OAAO,KAAK,UAAW,KAAK,QAAS,IAAI,EAG9C,KAAK,eAAA,EAGL,KAAK,SAAA,EAGL,KAAK,gBAAA,EAGL,KAAK,mBAAA,EAGL,KAAK,UAAA,EAGL,KAAK,2BAAA,EAGL,KAAK,uBAAA,EAGL,KAAK,6BAAA,EAGD,KAAK,qBACP,KAAK,KAAK,YAAY,IAAK,IAAM,CAC/B,KAAK,kBAAA,CACP,CAAC,CAEL,CAKQ,gBAAuB,CAC7B,KAAK,aAAe,IAAI2B,EAAK,CAC3B,WAAY,SACZ,iBAAkB,GAClB,iBAAkB,EAClB,YAAa,EACb,eAAgB,CAAA,CACjB,EAGD,MAAMC,EAAeC,EAAY,uBAAA,EACjC,KAAK,aAAa,WAAW,SAASD,CAAY,EAClD,KAAK,aAAa,WAAW,QAAA,EAG7B,MAAME,EAAiBD,EAAY,qBAAqB,KAAK,aAAa,KAAK,EAC/E,KAAK,aAAa,cAAc,SAASC,CAAc,EACvD,KAAK,aAAa,cAAc,QAAA,CAClC,CAKQ,UAAiB,CAEvB,KAAK,IAAI,UAAU,EAAG,EAAG,KAAK,UAAW,KAAK,WAAY,OAAQ,EAC/D,UAAU,EAAG,CAAC,EAGF,KAAK,IAAI,UAAU,EAAG,EAAG,KAAK,UAAW,GAAI,OAAQ,EACjE,UAAU,EAAG,CAAC,EACV,SAAS,EAAG,EAGnB,MAAMC,EAAY,KAAK,IAAI,KACzB,GACA,GACA,KAAK,oBAAA,EACL,CACE,WAAY,eACZ,SAAU,OACV,MAAO,UACP,UAAW,MAAA,CACb,EAEFA,EAAU,UAAU,EAAG,EAAG,EAC1BA,EAAU,QAAQ,YAAY,EAG9B,KAAK,yBAAA,EAGL,KAAK,kBAAA,EAGL,MAAMC,EAAa,KAAK,oBAAA,EAClBC,EAAe,KAAK,IAAI,KAC5B,KAAK,QACL,GACA,OAAO,KAAK,aAAa,QAAQ,MAAM,KAAK,aAAa,WAAW,KAAKD,CAAU,IACnF,CACE,WAAY,eACZ,SAAU,OACV,MAAO,UACP,UAAW,MAAA,CACb,EAEFC,EAAa,UAAU,EAAG,EAC1BA,EAAa,UAAU,EAAG,EAAG,UAAW,GAAK,GAAM,EAAI,EACvDA,EAAa,QAAQ,eAAe,EAGpC,MAAMC,EAAW,KAAK,IAAI,KACxB,KAAK,UAAY,GACjB,GACA,QAAQ,KAAK,aAAa,IAAI,GAC9B,CACE,WAAY,eACZ,SAAU,OACV,MAAO,SAAA,CACT,EAEFA,EAAS,UAAU,EAAG,EAAG,EACzBA,EAAS,QAAQ,WAAW,EAG5B,KAAK,oBAAA,EAGL,KAAK,sBAAA,EAGL,KAAK,2BAAA,CACP,CAKQ,uBAA8B,CACpC,KAAK,yBAA2B,KAAK,IAAI,UAAU,KAAK,UAAY,IAAK,GAAG,EAC5E,KAAK,yBAAyB,QAAQ,kBAAkB,EAGxD,MAAM5E,EAAK,KAAK,IAAI,UAAU,EAAG,EAAG,IAAK,GAAI,QAAU,EAAG,EAC1DA,EAAG,eAAe,EAAG,QAAU,EAAG,EAGlC,MAAM6E,EAAQ,KAAK,IAAI,KACrB,IAAK,EACL,SACA,CACE,WAAY,eACZ,SAAU,OACV,MAAO,SAAA,CACT,EACA,UAAU,EAAG,EAAG,EAGZC,EAAS,KAAK,aAAa,gBAC3BC,EAAa,KAAK,IAAI,KAC1B,GAAI,EACJD,IAAW,EAAI,OAAS,GAAGA,CAAM,GACjC,CACE,WAAY,eACZ,SAAU,OACV,MAAOA,IAAW,EAAI,UAAY,UAClC,UAAW,MAAA,CACb,EACA,UAAU,EAAG,EACfC,EAAW,UAAU,EAAG,EAAG,UAAW,GAAK,GAAM,EAAI,EACrDA,EAAW,QAAQ,cAAc,EAEjC,KAAK,yBAAyB,IAAI,CAAC/E,EAAI6E,EAAOE,CAAU,CAAC,CAC3D,CAKQ,4BAAmC,CACzC,KAAK,uBAAyB,KAAK,IAAI,UAAU,KAAK,UAAY,IAAK,GAAG,EAC1E,KAAK,uBAAuB,QAAQ,gBAAgB,EAGpD,MAAMC,EAAQ,KAAK,IAAI,KACrB,EAAG,EACH,QACA,CACE,WAAY,eACZ,SAAU,OACV,MAAO,UACP,UAAW,MAAA,CACb,EACA,UAAU,EAAG,EACfA,EAAM,UAAU,EAAG,EAAG,UAAW,GAAK,GAAM,EAAI,EAEhD,KAAK,uBAAuB,IAAIA,CAAK,EAGrC,KAAK,oBAAA,CACP,CAKQ,0BAAiC,CACvC,MAAMC,EAAqB,KAAK,IAAI,UAAU,GAAI,EAAE,EACpDA,EAAmB,QAAQ,sBAAsB,EAEjD,MAAMC,EAAS,CAAC,QAAS,SAAU,aAAa,EAC1CC,EAAc,CAAC,MAAO,MAAO,KAAK,EAClCC,EAAc,CAAC,QAAU,SAAU,QAAQ,EAC3CC,EAAoBH,EAAO,QAAQ,KAAK,aAAa,KAA2C,EAEtGA,EAAO,QAAQ,CAACI,EAAOpC,IAAU,CAC/B,MAAMqC,EAAWrC,GAASmC,EACpBG,EAAYtC,IAAUmC,EAGtBI,EAAM,KAAK,IAAI,OACnBvC,EAAQ,GAAI,EACZsC,EAAY,EAAI,EAChBD,EAAWH,EAAYlC,CAAK,EAAI,QAChCqC,EAAW,EAAI,EAAA,EAIXV,EAAQ,KAAK,IAAI,KACrB3B,EAAQ,GAAI,GACZiC,EAAYjC,CAAK,EACjB,CACE,WAAY,eACZ,SAAU,OACV,MAAOqC,EAAW,UAAY,UAC9B,UAAWC,EAAY,OAAS,QAAA,CAClC,EACA,UAAU,EAAG,EAGTE,EAAsBxC,IAAU,EAAI,GAAKA,IAAU,EAAI,GAAK,GAC5DyC,EAAmB,KAAK,IAAI,KAChCzC,EAAQ,GAAI,GACZ,KAAKwC,CAAmB,GACxB,CACE,WAAY,eACZ,SAAU,MACV,MAAOH,EAAW,UAAY,SAAA,CAChC,EACA,UAAU,EAAG,EAiBf,GAfAN,EAAmB,IAAI,CAACQ,EAAKZ,EAAOc,CAAgB,CAAC,EAGjDH,GACF,KAAK,OAAO,IAAI,CACd,QAASC,EACT,MAAO,IACP,SAAU,KACV,KAAM,GACN,OAAQ,GACR,KAAM,gBAAA,CACP,EAICvC,EAAQgC,EAAO,OAAS,EAAG,CAC7B,MAAMU,EAAO,KAAK,IAAI,UACpB1C,EAAQ,GAAK,GAAI,EACjB,GAAI,EACJqC,GAAYrC,EAAQmC,EAAoBD,EAAYlC,CAAK,EAAI,QAC7DqC,GAAYrC,EAAQmC,EAAoB,EAAI,EAAA,EAE9CJ,EAAmB,IAAIW,CAAI,CAC7B,CACF,CAAC,CACH,CAKQ,0BAAiC,CACvC,MAAMX,EAAqB,KAAK,SAAS,UAAU,sBAAsB,EACpEA,IAELA,EAAmB,QAAA,EACnB,KAAK,yBAAA,EACP,CAKQ,mBAA0B,CAChC,KAAK,qBAAuB,KAAK,IAAI,UAAU,KAAK,QAAS,EAAE,EAC/D,KAAK,qBAAqB,QAAQ,wBAAwB,EAG1D,MAAMY,EAAQ,KAAK,IAAI,UACrB,EAAG,EACH,KAAK,oBAAsB,EAC3B,GACA,OAAA,EAEFA,EAAM,eAAe,EAAG,OAAQ,EAChCA,EAAM,SAAS,EAAG,EAGlB,MAAMC,EAAqB,KAAK,aAAa,SAAW,KAAK,aAAa,YACpEC,EAAW,KAAK,IAAI,EAAG,KAAK,oBAAsBD,CAAkB,EAE1E,KAAK,YAAc,KAAK,IAAI,UAC1B,CAAC,KAAK,oBAAsB,EAAG,EAC/BC,EACA,GACA,KAAK,oBAAoBD,CAAkB,CAAA,EAE7C,KAAK,YAAY,UAAU,EAAG,EAAG,EAGjC,MAAME,EAAY,KAAK,IAAI,UACzB,CAAC,KAAK,oBAAsB,EAAI,KAAK,oBAAqB,EAC1D,EACA,GACA,OAAA,EAEFA,EAAU,UAAU,EAAG,EAEvB,KAAK,qBAAqB,IAAI,CAACH,EAAO,KAAK,YAAaG,CAAS,CAAC,CACpE,CAKQ,oBAAoBC,EAA4B,CACtD,OAAIA,EAAa,GAAY,QACzBA,EAAa,GAAY,SACtB,QACT,CAKQ,iBAAwB,CAE9B,MAAMC,EAAW,KAAK,IAAI,UACxB9F,EAAe,gBACfA,EAAe,eAAA,EAGX+F,EAAW,KAAK,IAAI,MAAM,EAAG,EAAG,WAAW,EAC3CC,EAAY,KAAK,IAAI,KACzB,EACA,GACA,GAAG,KAAK,aAAa,WAAW,MAAM,GACtC,CACE,WAAY,eACZ,SAAU,OACV,MAAO,SAAA,CACT,EAEFA,EAAU,UAAU,EAAG,EACvBA,EAAU,QAAQ,YAAY,EAE9BF,EAAS,IAAI,CAACC,EAAUC,CAAS,CAAC,EAClCF,EAAS,QAAQ,WAAW,EAG5B,MAAMG,EAAc,KAAK,IAAI,UAC3BjG,EAAe,mBACfA,EAAe,kBAAA,EAGXkG,EAAqB,KAAK,IAAI,UAClC,EACA,EACAlG,EAAe,WACfA,EAAe,YACf,SACA,EAAA,EAEFkG,EAAmB,eAAe,EAAG,QAAQ,EAE7C,MAAMC,EAAe,KAAK,IAAI,KAC5B,EACA,GACA,MACA,CACE,WAAY,eACZ,SAAU,OACV,MAAO,SAAA,CACT,EACA,UAAU,EAAG,EAEfF,EAAY,IAAI,CAACC,EAAoBC,CAAY,CAAC,EAClDF,EAAY,QAAQ,cAAc,EAGlC,MAAMG,EAAgB,KAAK,IAAI,UAC7B,KAAK,QACLpG,EAAe,oBAAA,EAGXqG,EAAuB,KAAK,IAAI,UACpC,EACA,EACArG,EAAe,WACfA,EAAe,YACf,SACA,EAAA,EAEFqG,EAAqB,eAAe,EAAG,QAAQ,EAE/C,MAAMC,EAAiB,KAAK,IAAI,KAC9B,EACA,KACA,QACA,CACE,WAAY,eACZ,SAAU,OACV,MAAO,SAAA,CACT,EACA,UAAU,EAAG,EAEfF,EAAc,IAAI,CAACC,EAAsBC,CAAc,CAAC,EACxDF,EAAc,QAAQ,gBAAgB,EAGtC,KAAK,oBAAA,EAGL,KAAK,4BAAA,CACP,CAKQ,qBAA4B,CAEZ,KAAK,SAAS,UAAU,gBAAgB,EAO1C,KAAK,SAAS,UAAU,cAAc,CAO5D,CAKQ,6BAAoC,CAE1C,KAAK,oBAAsB,IAAIG,EAAoB,KAAM,KAAK,YAAY,EAG1E,KAAK,KAAK,OAAO,GAAG,eAAiB1D,GAAgD,CACnF,KAAK,oBAAoBA,CAAa,CACxC,CAAC,CACH,CAMQ,uBAAuB2D,EAAkD,CAC/E,KAAK,mBAAmB,QAAQ,CAACC,EAAWC,IAAa,CACvD,MAAMC,EAAU,KAAK,gBAAgBD,EAAUF,CAAW,EACpD1E,EAAQ6E,EAAU3G,EAAe,OAAO,gBAAkBA,EAAe,OAAO,kBAChF4G,EAAQD,EAAU,GAAM,IAG9BF,EAAU,MAAA,EAGV,MAAMI,GAAU7G,EAAe,WAAa,IAAM,EAClDyG,EAAU,UAAU3E,EAAO8E,CAAK,EAChCH,EAAU,WAAW,EAAG,EAAGI,CAAM,EAGjCJ,EAAU,UAAU,EAAG3E,EAAO,EAAG,EACjC2E,EAAU,aAAa,EAAG,EAAGI,CAAM,EAGnC,KAAK,OAAO,IAAI,CACd,QAASJ,EACT,MAAOG,EAAQ,IACf,OAAQ,IACR,OAAQ,IACR,SAAU5G,EAAe,UAAU,oBAAsB,EACzD,KAAM,iBACN,KAAM,GACN,OAAQ,EAAA,CACT,EAGD,KAAK,OAAO,IAAI,CACd,QAASyG,EACT,MAAAG,EACA,SAAU,IACV,KAAM,QAAA,CACP,CACH,CAAC,CACH,CAKQ,wBAA+B,CACrC,KAAK,mBAAmB,QAASH,GAAc,CAE7C,KAAK,OAAO,aAAaA,CAAS,EAGlC,KAAK,OAAO,IAAI,CACd,QAASA,EACT,MAAO,EACP,OAAQ,EACR,OAAQ,EACR,SAAU,IACV,KAAM,SACN,WAAY,IAAM,CAChBA,EAAU,MAAA,CACZ,CAAA,CACD,CACH,CAAC,CACH,CAKQ,gBAAgBC,EAAkBF,EAAqD,CAC7F,GAAI,CAACA,EAAa,MAAO,GAEzB,OAAQE,EAAA,CACN,IAAK,YAEH,OAAO,KAAK,aAAa,mBAAqB,MAAQ,CAAC,KAAK,aAAa,iBAAiB,aAC5F,IAAK,UAEH,MAAO,GACT,QACE,MAAO,EAAA,CAEb,CAIQ,qBAA4B,CAClC,MAAMI,EAAkB,KAAK,IAAI,UAAU,KAAK,UAAY,IAAK,GAAG,EACpEA,EAAgB,QAAQ,gBAAgB,EAGxC,MAAMC,EAAa,KAAK,sBACtB,EACA,EACA,SACA,IAAM,KAAK,UAAU,CAAC,EACtB,CACE,WAAY,eACZ,SAAU,OACV,MAAO,SAAA,CACT,EAEFA,EAAW,QAAQ,aAAa,EAGhC,MAAMC,EAAkB,KAAK,sBAC3B,EACA,GACA,QACA,IAAM,KAAK,eAAA,EACX,CACE,WAAY,eACZ,SAAU,OACV,MAAO,SAAA,CACT,EAEFA,EAAgB,QAAQ,kBAAkB,EAG1C,MAAMC,EAAgB,KAAK,sBACzB,EACA,IACA,QACA,IAAM,KAAK,QAAA,EACX,CACE,WAAY,eACZ,SAAU,OACV,MAAO,SAAA,CACT,EAEFA,EAAc,QAAQ,iBAAiB,EAEvCH,EAAgB,IAAI,CAACC,EAAYC,EAAiBC,CAAa,CAAC,EAGhE,KAAK,oBAAA,CACP,CAKQ,4BAAmC,CAEzC,KAAK,mBAAqB,IAAIC,EAAmB,IAAI,EAGrD,KAAK,mBAAmB,uBAAuB,OAAQ,IAAM,CACvD,KAAK,aAAa,QAAU,QAAU,KAAK,aAAa,gBAC1D,KAAK,UAAU,CAAC,CAEpB,CAAC,EAED,KAAK,mBAAmB,uBAAuB,YAAa,IAAM,CAC5D,KAAK,aAAa,QAAU,QAAU,CAAC,KAAK,aAAa,kBAAoB,KAAK,aAAa,aAAA,GACjG,KAAK,eAAA,CAET,CAAC,EAED,KAAK,mBAAmB,uBAAuB,UAAW,IAAM,CAC9D,MAAMC,EAAQ,KAAK,aAAa,OAC3BA,IAAU,QAAUA,IAAU,eAAiB,KAAK,aAAa,gBACpE,KAAK,QAAA,CAET,CAAC,EAGD,QAAS5G,EAAI,EAAGA,GAAK,EAAGA,IACtB,KAAK,mBAAmB,uBAAuB,OAAOA,CAAC,GAAI,IAAM,CAC/D,GAAIA,GAAK,KAAK,UAAU,OAAQ,CAC9B,MAAMT,EAAO,KAAK,UAAUS,EAAI,CAAC,EAChBT,EAAK,QAAQ,MAAM,GAElC,KAAK,oBAAoBA,CAAI,CAEjC,CACF,CAAC,EAIH,KAAK,mBAAmB,uBAAuB,SAAU,IAAM,CAC7D,KAAK,mBAAA,CACP,CAAC,EAGD,KAAK,KAAK,YAAY,IAAK,IAAM,CAC/B,KAAK,0BAAA,CACP,CAAC,EAGD,KAAK,mBAAmB,OAAA,CAC1B,CAKQ,2BAAkC,CACxC,GAAI,CAAC,KAAK,mBAAoB,OAG9B,MAAMsH,EAAgB,KAAK,SAAS,UAAU,gBAAgB,EAC9D,GAAIA,EAAe,CACjB,MAAML,EAAaK,EAAc,UAAU,aAAa,EAClDJ,EAAkBI,EAAc,UAAU,kBAAkB,EAC5DH,EAAgBG,EAAc,UAAU,iBAAiB,EAE3DL,GACF,KAAK,mBAAmB,yBAAyBA,EAAY,IAAM,CAC7D,KAAK,aAAa,QAAU,QAAU,KAAK,aAAa,gBAC1D,KAAK,UAAU,CAAC,CAEpB,CAAC,EAGCC,GACF,KAAK,mBAAmB,yBAAyBA,EAAiB,IAAM,CAClE,KAAK,aAAa,QAAU,QAAU,CAAC,KAAK,aAAa,kBAAoB,KAAK,aAAa,aAAA,GACjG,KAAK,eAAA,CAET,CAAC,EAGCC,GACF,KAAK,mBAAmB,yBAAyBA,EAAe,IAAM,CACpE,MAAME,EAAQ,KAAK,aAAa,OAC3BA,IAAU,QAAUA,IAAU,eAAiB,KAAK,aAAa,gBACpE,KAAK,QAAA,CAET,CAAC,CAEL,CAGA,KAAK,uBAAA,CACP,CAKQ,wBAA+B,CAChC,KAAK,qBAGV,KAAK,UAAU,QAAStE,GAAkB,CACxC,KAAK,mBAAoB,2BAA2BA,CAAa,CACnE,CAAC,EAGD,KAAK,UAAU,QAASA,GAAkB,CACxC,KAAK,mBAAoB,yBAAyBA,EAAe,IAAM,CACpDA,EAAc,QAAQ,MAAM,GAE3C,KAAK,oBAAoBA,CAAa,CAE1C,CAAC,CACH,CAAC,EACH,CAKQ,WAAkB,CACxB,KAAK,aAAa,MAAA,EAGlB,KAAK,UAAU7C,EAAe,YAAY,EAG1C,KAAK,KAAK,YAAY,IAAK,IAAM,CAC/B,KAAK,oBAAA,CACP,CAAC,EAGD,KAAK,2BAAA,CACP,CAKQ,UAAUqH,EAAqB,CAClB,KAAK,aAAa,UAAUA,CAAK,EAEzC,QAAQ,CAACvH,EAAMgD,IAAU,CAClC,KAAK,KAAK,YAAYA,EAAQ,IAAK,IAAM,OACvC,KAAK,eAAehD,CAAI,GAExB2D,EAAA,KAAK,eAAL,MAAAA,EAAmB,KAAK,WAC1B,CAAC,CACH,CAAC,EAGD,KAAK,KAAK,YAAY4D,EAAQ,IAAM,IAAK,IAAM,CAC7C,KAAK,YAAA,EAEL,KAAK,2BAAA,CACP,CAAC,CACH,CAKQ,eAAevH,EAAkB,CACvC,MAAM+C,EAAgB,KAAK,IAAI,UAC7B7C,EAAe,gBACfA,EAAe,eAAA,EAIX2B,EAAW,KAAK,IAAI,SAAA,EACpB2F,EAAY,KAAK,aAAaxH,EAAK,IAAI,EAG7C6B,EAAS,kBAAkB2F,EAAU,IAAKA,EAAU,IAAKA,EAAU,OAAQA,EAAU,OAAQ,CAAC,EAC9F3F,EAAS,gBAAgB,IAAK,IAAK,IAAK,IAAK,EAAE,EAG/C,MAAM4F,EAAU,KAAK,IAAI,UAAU,EAAG,EAAG,IAAK,IAAK,SAAU,EAAG,EAChEA,EAAQ,eAAe,EAAG,SAAU,EAAG,EAGvC,MAAMC,EAAU,IAAI,OAAO,KAAK,UAAU,IAAK,IAAK,IAAK,GAAG,EAC5D3E,EAAc,eAAe2E,EAAS,OAAO,KAAK,UAAU,QAAQ,EAGpE3E,EAAc,GAAG,cAAe,IAAM,CAEhC,KAAK,aAAa,kBAAoB,CAACA,EAAc,QAAQ,YAAY,GAC3E,KAAK,oBAAoBA,CAAa,CAE1C,CAAC,EAGD,MAAMjC,EAAW,KAAK,IAAI,KACxB,EACA,IACAd,EAAK,KACL,CACE,WAAY,eACZ,SAAU,OACV,MAAO,UACP,UAAW,OACX,SAAU,CAAE,MAAO,GAAA,CAAI,CACzB,EACA,UAAU,EAAG,EACfc,EAAS,UAAU,EAAG,EAAG,UAAW,GAAK,GAAM,EAAI,EAGnD,MAAME,EAAU,KAAK,IAAI,OAAO,IAAK,GAAI,GAAI,QAAU,EAAG,EACpDE,EAAY,KAAK,IAAI,KACzB,IACA,GACA,GAAGlB,EAAK,KAAK,GACb,CACE,WAAY,eACZ,SAAU,OACV,MAAO,UACP,UAAW,MAAA,CACb,EACA,UAAU,EAAG,EAGT2H,EAAS,KAAK,IAAI,OAAO,GAAI,GAAI,GAAI,QAAU,EAAG,EAClDC,EAAW,KAAK,IAAI,KACxB,GACA,GACA,GAAG5H,EAAK,IAAI,GACZ,CACE,WAAY,eACZ,SAAU,OACV,MAAO,UACP,UAAW,MAAA,CACb,EACA,UAAU,EAAG,EAGf,IAAI6H,EAAyD,KAC7D,GAAI7H,EAAK,OAAS,aAAeA,EAAK,WAAa,QAAaA,EAAK,SAAW,EAAG,CACjF,MAAMoF,EAAQ,KAAK,aAAa,MAChC,IAAI0C,EAAe,EAInB,GAHI1C,IAAU,SAAU0C,EAAe,GAC9B1C,IAAU,gBAAe0C,EAAe,GAE7CA,EAAe,EAAG,CAEpB,MAAMC,EAAU,KAAK,IAAI,OAAO,EAAG,IAAK,GAAI,QAAU,EAAG,EAGnDC,EAAY,KAAK,IAAI,KACzB,EAAG,IACH,IAAIF,CAAY,GAChB,CACE,WAAY,eACZ,SAAU,OACV,MAAO,UACP,UAAW,MAAA,CACb,EACA,UAAU,EAAG,EAEfD,EAAoB,KAAK,IAAI,UAAU,EAAG,EAAG,CAACE,EAASC,CAAS,CAAC,EACjEH,EAAkB,SAAS,EAAG,EAG9B,KAAK,OAAO,IAAI,CACd,QAASA,EACT,MAAO,EACP,MAAO,IACP,SAAU,IACV,KAAM,GACN,OAAQ,GACR,KAAM,gBAAA,CACP,CACH,CACF,CAGA,IAAII,EAAiBjI,EAAK,MAC1B,GAAIA,EAAK,OAAS,aAAeA,EAAK,WAAa,OAAW,CAC5D,MAAMoF,EAAQ,KAAK,aAAa,MAChC,IAAI8C,EAAa,EACb9C,IAAU,SAAU8C,EAAa,IAC5B9C,IAAU,gBAAe8C,EAAa,GAC/CD,EAAiB,KAAK,MAAMjI,EAAK,MAAQkI,CAAU,CACrD,CAGA,GAAID,IAAmBjI,EAAK,MAAO,CACjCkB,EAAU,QAAQ,GAAG+G,CAAc,EAAE,EACrC/G,EAAU,SAAS,SAAS,EAG5B,MAAMiH,EAAgB,KAAK,IAAI,KAC7B,IAAK,GACL,IAAInI,EAAK,KAAK,IACd,CACE,WAAY,eACZ,SAAU,OACV,MAAO,UACP,UAAW,QAAA,CACb,EACA,UAAU,EAAG,EAEToI,EAAe,CAACvG,EAAU4F,EAAS3G,EAAUE,EAASE,EAAWiH,EAAeR,EAAQC,CAAQ,EAClGC,GAAmBO,EAAa,KAAKP,CAAiB,EAC1D9E,EAAc,IAAIqF,CAAY,CAChC,KAAO,CACL,MAAMA,EAAe,CAACvG,EAAU4F,EAAS3G,EAAUE,EAASE,EAAWyG,EAAQC,CAAQ,EACnFC,GAAmBO,EAAa,KAAKP,CAAiB,EAC1D9E,EAAc,IAAIqF,CAAY,CAChC,CAEArF,EAAc,QAAQ,OAAQ/C,CAAI,EAClC+C,EAAc,QAAQ,WAAY,EAAK,EAGvC,MAAMzB,EAAO,KAAK,IAAI,UAAU,EAAG,EAAG,IAAK,IAAK,QAAU,CAAC,EAC3DA,EAAK,SAAS,CAAC,EACfyB,EAAc,IAAIzB,CAAI,EACtByB,EAAc,WAAWzB,CAAI,EAC7ByB,EAAc,QAAQ,OAAQzB,CAAI,EAGlC,KAAK,qBAAqByB,CAAa,EAGnC,KAAK,qBACP,KAAK,oBAAoB,qBAAqBA,CAAa,EAG7D,KAAK,UAAU,KAAKA,CAAa,CACnC,CAKQ,gBAAgBL,EAAwB,CAC9C,OAAQA,EAAA,CACN,IAAK,OACH,MAAO,qBACT,IAAK,YACH,MAAO,0BACT,IAAK,UACH,MAAO,wBACT,QACE,MAAO,oBAAA,CAEb,CAKQ,aAAaA,EAAiD,CACpE,OAAQA,EAAA,CACN,IAAK,OACH,MAAO,CAAE,IAAK,QAAU,OAAQ,OAAA,EAClC,IAAK,YACH,MAAO,CAAE,IAAK,QAAU,OAAQ,MAAA,EAClC,IAAK,UACH,MAAO,CAAE,IAAK,SAAU,OAAQ,QAAA,EAClC,IAAK,QACH,MAAO,CAAE,IAAK,SAAU,OAAQ,QAAA,EAClC,QACE,MAAO,CAAE,IAAK,QAAU,OAAQ,OAAA,CAAS,CAE/C,CAKQ,qBAAqBK,EAAmD,CAE9EA,EAAc,QAAQ,YAAaA,EAAc,CAAC,EAClDA,EAAc,QAAQ,YAAaA,EAAc,CAAC,EAClDA,EAAc,QAAQ,aAAc,EAAK,EAEzC,MAAMzB,EAAOyB,EAAc,QAAQ,MAAM,EAGzC,KAAK,MAAM,aAAaA,CAAa,EAGrCA,EAAc,GAAG,cAAe,IAAM,CAChC,CAACA,EAAc,QAAQ,UAAU,GAAK,CAACA,EAAc,QAAQ,YAAY,IAE3E,KAAK,OAAO,IAAI,CACd,QAASA,EACT,OAAQ7C,EAAe,iBACvB,OAAQA,EAAe,iBACvB,SAAU,IACV,KAAM,QAAA,CACP,EAGGoB,GACF,KAAK,OAAO,IAAI,CACd,QAASA,EACT,MAAO,GACP,SAAU,IACV,KAAM,QAAA,CACP,EAGP,CAAC,EAEDyB,EAAc,GAAG,aAAc,IAAM,CAC/B,CAACA,EAAc,QAAQ,UAAU,GAAK,CAACA,EAAc,QAAQ,YAAY,IAE3E,KAAK,OAAO,IAAI,CACd,QAASA,EACT,OAAQ,EACR,OAAQ,EACR,SAAU,IACV,KAAM,QAAA,CACP,EAGGzB,GACF,KAAK,OAAO,IAAI,CACd,QAASA,EACT,MAAO,EACP,SAAU,IACV,KAAM,QAAA,CACP,EAGP,CAAC,EAGDyB,EAAc,GAAG,cAAgBsF,GAAkC,CAE7DA,EAAQ,oBAEZtF,EAAc,QAAQ,gBAAiB,KAAK,KAAK,GAAG,EACpDA,EAAc,SAAS,GAAI,EAC7B,CAAC,EAEDA,EAAc,GAAG,YAAa,IAAM,CAClC,MAAMuF,EAAgBvF,EAAc,QAAQ,eAAe,EAIvD,CAHeA,EAAc,QAAQ,YAAY,GAGlCuF,GAAiB,KAAK,KAAK,IAAMA,EAAgB,KAClE,KAAK,oBAAoBvF,CAAa,EAGxCA,EAAc,QAAQ,aAAc,EAAK,CAC3C,CAAC,EAGDA,EAAc,GAAG,YAAa,IAAM,CAClCA,EAAc,QAAQ,aAAc,EAAI,EACxC,KAAK,iBAAmB,GAGxBA,EAAc,SAAS7C,EAAe,UAAU,UAAU,EAC1D6C,EAAc,SAAS7C,EAAe,UAAU,UAAU,EAItD6C,EAAc,QAAQ,UAAU,GAClC,KAAK,oBAAoBA,CAAa,CAE1C,CAAC,EAGDA,EAAc,GAAG,OAAQ,CAACsF,EAA+BE,EAAeC,IAAkB,CAGxF,MAAMC,EADW,KAAK,MAAM,cAAgB,OAAO,MAAM,WAAa,KAAK,MAAM,cAAgB,OAAO,MAAM,SACnF,IAAgD,EAE3E1F,EAAc,EAAIwF,EAClBxF,EAAc,EAAIyF,EAAQC,CAE5B,CAAC,EAGD1F,EAAc,GAAG,UAAW,IAAM,CAEhCA,EAAc,SAAS,CAAC,EACxBA,EAAc,SAAS,CAAC,EAGxB,MAAM2F,EAAW,KAAK,YAAY3F,EAAc,EAAGA,EAAc,CAAC,EAE9D2F,GAAY,KAAK,gBAAgBA,EAAU3F,CAAa,EAE1D,KAAK,gBAAgB2F,EAAU3F,CAAa,EAG5C,KAAK,kBAAkBA,CAAa,EAGtCA,EAAc,SAAS,CAAC,CAC1B,CAAC,CACH,CAKQ,oBAAoBA,EAAmD,SAE7E,GAAI,CAAC,KAAK,aAAa,iBACrB,OAGF,MAAM/C,EAAO+C,EAAc,QAAQ,MAAM,EAGzC,GAFmBA,EAAc,QAAQ,UAAU,EAEnC,CAEd,KAAK,aAAa,oBAAoB/C,CAAI,EAC1C,KAAK,cAAc,OAAOA,EAAK,EAAE,EACjC+C,EAAc,QAAQ,WAAY,EAAK,EACvCA,EAAc,SAAS,CAAC,GAGxBY,EAAA,KAAK,eAAL,MAAAA,EAAmB,KAAK,gBAGxB,MAAMgD,EAAY5D,EAAc,UAAU,WAAW,EACjD4D,GACFA,EAAU,QAAA,EAIZ,KAAK,OAAO,IAAI,CACd,QAAS5D,EACT,MAAO,EACP,SAAU,IACV,KAAM,cAAA,CACP,CACH,KAAO,CAEL,KAAK,aAAa,oBAAoB/C,CAAI,EAC1C,KAAK,cAAc,IAAIA,EAAK,EAAE,EAC9B+C,EAAc,QAAQ,WAAY,EAAI,GAGtC4F,EAAA,KAAK,eAAL,MAAAA,EAAmB,KAAK,cAGxB,KAAK,OAAO,IAAI,CACd,QAAS5F,EACT,MAAO,IACP,SAAU,IACV,KAAM,cAAA,CACP,EAGD,MAAMlB,EAAW,KAAK,IAAI,SAAA,EAC1BA,EAAS,UAAU,EAAG,MAAU,CAAC,EACjCA,EAAS,kBAAkB,IAAK,IAAK,IAAK,IAAK,EAAE,EACjDA,EAAS,QAAQ,WAAW,EAC5BkB,EAAc,MAAMlB,EAAU,CAAC,EAG/B,KAAK,OAAO,IAAI,CACd,QAASA,EACT,MAAO,GACP,SAAU,IACV,KAAM,GACN,OAAQ,GACR,KAAM,gBAAA,CACP,CACH,CAGI,KAAK,aAAa,kBACpB,KAAK,mBAAA,CAET,CAKQ,aAAoB,CAE1B,MAAM+G,GADY,KAAK,UAAU,OACD,IAAM1I,EAAe,WAAaA,EAAe,cAC3E2I,EAAS,KAAK,QAAUD,EAAa,EAE3C,KAAK,UAAU,QAAQ,CAAC5I,EAAMgD,IAAU,CACtC,MAAMC,EAAU4F,EAAS7F,GAAS9C,EAAe,WAAaA,EAAe,cAG7EF,EAAK,QAAQ,YAAaiD,CAAO,EACjCjD,EAAK,QAAQ,YAAaE,EAAe,eAAe,EAExD,KAAK,OAAO,IAAI,CACd,QAASF,EACT,EAAGiD,EACH,EAAG/C,EAAe,gBAClB,SAAUA,EAAe,mBACzB,KAAM,QAAA,CACP,CACH,CAAC,EAGD,KAAK,uBAAA,CACP,CAKQ,gBAAuB,OAC7B,GAAI,KAAK,aAAa,iBAEpB,OAIF,MAAM4I,EAAgB,KAAK,aAAa,cAAc,SAAA,EACjDA,IAML,KAAK,aAAa,eAAeA,CAAa,GAG9CnF,EAAA,KAAK,eAAL,MAAAA,EAAmB,KAAK,kBAGxB,KAAK,qBAAqBmF,CAAa,EAGvC,KAAK,kBAAA,EACL,KAAK,oBAAA,EAGL,KAAK,wBAAA,EACP,CAKQ,yBAAgC,CACtC,KAAK,UAAU,QAAQ/F,GAAiB,CAEtCA,EAAc,QAAQ,kBAAmB,EAAI,EAGzC,KAAK,qBAEP,KAAK,MAAM,aAAaA,EAAe,EAAI,EAG3CA,EAAc,IAAI,WAAW,EAC7BA,EAAc,IAAI,MAAM,EACxBA,EAAc,IAAI,SAAS,EAG3B,KAAK,oBAAoB,qBAAqBA,CAAa,IAG3D,KAAK,MAAM,aAAaA,EAAe,EAAI,EAE3CA,EAAc,GAAG,YAAcsF,GAAkC,CAC/DtF,EAAc,QAAQ,aAAc,EAAI,EACxCA,EAAc,SAAS,GAAI,CAC7B,CAAC,EAEDA,EAAc,GAAG,OAAQ,CAACsF,EAA+BE,EAAeC,IAAkB,CACxFzF,EAAc,EAAIwF,EAClBxF,EAAc,EAAIyF,CACpB,CAAC,EAEDzF,EAAc,GAAG,UAAYsF,GAAkC,CAC7DtF,EAAc,QAAQ,aAAc,EAAK,EACzCA,EAAc,SAAS,EAAE,EAGzB,MAAMgG,EAAYhG,EAAc,QAAQ,WAAW,GAAKA,EAAc,EAChEiG,EAAYjG,EAAc,QAAQ,WAAW,GAAKA,EAAc,EAEtE,KAAK,OAAO,IAAI,CACd,QAASA,EACT,EAAGgG,EACH,EAAGC,EACH,SAAU,IACV,KAAM,cAAA,CACP,CACH,CAAC,GAIH,MAAMC,EAAalG,EAAc,QAAQ,MAAM,EAC3CkG,GACFA,EAAW,WAAW,EAAI,CAE9B,CAAC,CACH,CAKQ,SAAgB,CACtB,GAAK,KAAK,aAAa,iBAGnB,KAAK,aAAa,QAAU,cAAgB,KAAK,aAAa,QAAU,QAAQ,CAElF,MAAMC,EAAoB,KAAK,IAAI,UACjC,KAAK,QACL,KAAK,QACL,KAAK,UACL,KAAK,WACL,EACA,CAAA,EAEFA,EAAkB,SAAS,IAAI,EAG/B,KAAK,OAAO,IAAI,CACd,QAASA,EACT,MAAO,GACP,SAAU,IACV,KAAM,SACN,WAAY,IAAM,CAEhB,KAAK,mBAAA,EAGL,KAAK,aAAa,SAAA,EAKlB,KAAK,WAAW,SAAW,GAC3B,KAAK,WAAW,MAAQ,GACxB,KAAK,WAAW,cAAgB,GAChC,KAAK,SAAA,EAGL,KAAK,2BAAA,EAGL,KAAK,OAAO,IAAI,CACd,QAASA,EACT,MAAO,EACP,SAAU,IACV,KAAM,SACN,WAAY,IAAM,CAChBA,EAAkB,QAAA,EAElB,KAAK,aAAA,CACP,CAAA,CACD,CACH,CAAA,CACD,CACH,CACF,CAKQ,qBAA4B,CAClC,GAAI,CAAC,KAAK,uBAAwB,OAGZ,KAAK,uBAAuB,KAAK,OAAO,CAACC,EAAMnG,IAAUA,EAAQ,CAAC,EAC1E,QAAQmG,GAAQA,EAAK,SAAS,EAE5C,MAAMC,EAAmB,KAAK,aAAa,oBAAA,EAE3C,GAAIA,EAAiB,SAAW,EAAG,CACjC,MAAMC,EAAkB,KAAK,IAAI,KAC/B,EAAG,GACH,KACA,CACE,WAAY,eACZ,SAAU,OACV,MAAO,SAAA,CACT,EACA,UAAU,EAAG,EACf,KAAK,uBAAuB,IAAIA,CAAe,EAC/C,MACF,CAqKA,GAlKAD,EAAiB,QAAQ,CAACE,EAAWtG,IAAU,CAC7C,MAAMuG,EAAO,GAAKvG,EAAQ,GAGpBwG,EAAW,KAAK,IAAI,UAAU,EAAGD,CAAI,EAGrCE,EAAiBH,EAAU,eAAiB,QAC3BA,EAAU,iBAAmB,QAC7BA,EAAU,gBAAkB,EAC7CI,EAAyBD,GAAkBH,EAAU,iBAAmB,EACxEK,EAAwBF,GAAkBH,EAAU,iBAAmB,EAG7E,IAAIM,EAAUN,EAAU,eAAiB,aAAe,SAAW,SAC/DO,EAAcD,EAEdF,GACFE,EAAU,SACVC,EAAc,UACLF,IACTC,EAAU,SACVC,EAAc,UAIhB,MAAMC,EAAS,KAAK,IAAI,UACtB,EAAG,EAAG,IAAK,GACXF,EACA,EAAA,EAKF,GAHAE,EAAO,eAAe,EAAGD,CAAW,EAGhCJ,EAAgB,CAClB,MAAMM,EAAoBJ,EAAwB,IAAM,IACxD,KAAK,OAAO,IAAI,CACd,QAASG,EACT,MAAO,GACP,SAAUC,EACV,KAAM,GACN,OAAQ,GACR,KAAM,gBAAA,CACP,EACDD,EAAO,aAAaF,EAAS,EAAG,CAClC,CAGA,IAAII,EAAaV,EAAU,eAAiB,aAAe,SAAW,SAClEW,EAAYX,EAAU,eAAiB,aAAe,UAAY,UAElEI,GACFM,EAAa,SACbC,EAAY,WACHN,IACTK,EAAa,SACbC,EAAY,WAGd,MAAMC,EAAY,KAAK,IAAI,UACzB,KAAM,EAAG,GAAI,GACbF,CAAA,EAEFE,EAAU,eAAe,EAAG,QAAQ,EAEpC,MAAM7I,EAAW,KAAK,IAAI,KACxB,KAAM,EACNiI,EAAU,eAAiB,aAAe,KAAO,KACjD,CACE,WAAY,eACZ,SAAU,OACV,MAAOW,EACP,UAAW,MAAA,CACb,EACA,UAAU,EAAG,EAGTE,EAAW,KAAK,IAAI,KACxB,IAAK,EACLb,EAAU,KAAK,OAAS,EAAI,GAAGA,EAAU,KAAK,UAAU,EAAG,CAAC,CAAG,MAAQA,EAAU,KACjF,CACE,WAAY,eACZ,SAAU,OACV,MAAO,SAAA,CACT,EACA,UAAU,EAAG,EAAG,EAGlB,GAAIA,EAAU,eAAiB,aAAc,CAC3C,MAAMlE,EAAQ,KAAK,aAAa,MAChC,IAAIgF,EAAQ,EAIZ,GAHIhF,IAAU,SAAUgF,EAAQ,GACvBhF,IAAU,gBAAegF,EAAQ,GAEtCA,EAAQ,EAAG,CACb,MAAMpC,EAAY,KAAK,IAAI,KACzB,GAAI,EACJ,IAAIoC,CAAK,GACT,CACE,WAAY,eACZ,SAAU,OACV,MAAO,UACP,UAAW,MAAA,CACb,EACA,UAAU,EAAG,EACfZ,EAAS,IAAIxB,CAAS,CACxB,CACF,CAGA,GAAIsB,EAAU,eAAiB,QAAUA,EAAU,iBAAmB,OAAW,CAE/E,IAAIe,EAAiB,UACjBf,EAAU,iBAAmB,EAC/Be,EAAiB,UACRf,EAAU,iBAAmB,IACtCe,EAAiB,WAGnB,MAAMC,EAAY,KAAK,IAAI,KACzB,IAAK,EACL,KAAKhB,EAAU,cAAc,IAC7B,CACE,WAAY,eACZ,SAAU,OACV,MAAOe,EACP,UAAWf,EAAU,gBAAkB,EAAI,OAAS,QAAA,CACtD,EACA,UAAU,EAAG,EAAG,EAGlB,GAAIA,EAAU,gBAAkB,EAAG,CACjC,MAAMiB,EAAmBjB,EAAU,iBAAmB,EAAI,UAAY,UAChEkB,EAAc,KAAK,IAAI,KAC3B,IAAK,EACLlB,EAAU,iBAAmB,EAAI,KAAO,IACxC,CACE,WAAY,eACZ,SAAU,OACV,MAAOiB,CAAA,CACT,EACA,UAAU,EAAG,EACff,EAAS,IAAIgB,CAAW,CAC1B,CAEAhB,EAAS,IAAIc,CAAS,CACxB,CAMA,GAJAd,EAAS,IAAI,CAACM,EAAQI,EAAW7I,EAAU8I,CAAQ,CAAC,EACpD,KAAK,uBAAuB,IAAIX,CAAQ,GAGnCxG,EAAQ,GAAK,IAAM,GAAKA,EAAQoG,EAAiB,OAAS,EAAG,CAChE,MAAMqB,EAAU,KAAK,IAAI,UACvB,EAAGlB,EAAO,GAAI,IAAK,EACnB,SAAU,EAAA,EAEZ,KAAK,uBAAuB,IAAIkB,CAAO,CACzC,CACF,CAAC,EAGGrB,EAAiB,QAAU,EAAG,CAChC,MAAMsB,EAAc,KAAK,IAAI,KAC3B,EAAG,GAAKtB,EAAiB,OAAS,GAAK,GACvC,KAAK,KAAK,MAAMA,EAAiB,OAAS,CAAC,CAAC,UAC5C,CACE,WAAY,eACZ,SAAU,OACV,MAAO,UACP,UAAW,MAAA,CACb,EACA,UAAU,EAAG,EACf,KAAK,uBAAuB,IAAIsB,CAAW,CAC7C,CACF,CAKQ,uBAA8B,CACpC,GAAI,CAAC,KAAK,yBAA0B,OAEpC,MAAM7F,EAAa,KAAK,yBAAyB,UAAU,cAAc,EACzE,GAAI,CAACA,EAAY,OAEjB,MAAMD,EAAS,KAAK,aAAa,gBAC3B+F,EAAiB,SAAS9F,EAAW,OAAS,OAAS,IAAMA,EAAW,IAAI,EAGlFA,EAAW,QAAQD,IAAW,EAAI,OAAS,GAAGA,CAAM,EAAE,EACtDC,EAAW,SAASD,IAAW,EAAI,UAAY,SAAS,EAGpDA,EAAS+F,GACX,KAAK,OAAO,IAAI,CACd,QAAS,KAAK,yBACd,OAAQ,IACR,OAAQ,IACR,SAAU,IACV,KAAM,GACN,KAAM,SACN,WAAY,IAAM,OAEhB,MAAM7K,GAAK6D,EAAA,KAAK,2BAAL,YAAAA,EAA+B,KAAK,GAC3C7D,IACFA,EAAG,aAAa,SAAU,EAAG,EAC7B,KAAK,KAAK,YAAY,IAAK,IAAM,CAC/BA,EAAG,aAAa,EAAU,EAAG,CAC/B,CAAC,EAEL,CAAA,CACD,CAEL,CAKQ,UAAiB,CAEnB,KAAK,WAAW,WAClB,KAAK,sBAAA,EACL,KAAK,WAAW,SAAW,IAGzB,KAAK,WAAW,QAClB,KAAK,mBAAA,EACL,KAAK,WAAW,MAAQ,IAGtB,KAAK,WAAW,OAClB,KAAK,kBAAA,EACL,KAAK,WAAW,KAAO,IAGrB,KAAK,WAAW,YAClB,KAAK,oBAAA,EACL,KAAK,WAAW,UAAY,IAG1B,KAAK,WAAW,SAClB,KAAK,sBAAA,EACL,KAAK,WAAW,OAAS,IAGvB,KAAK,WAAW,OAClB,KAAK,YAAA,EACL,KAAK,WAAW,KAAO,IAGrB,KAAK,WAAW,gBAClB,KAAK,oBAAA,EACL,KAAK,WAAW,cAAgB,IAG9B,KAAK,WAAW,YAClB,KAAK,kBAAA,EACL,KAAK,WAAW,UAAY,GAEhC,CAKQ,uBAA8B,CACpC,MAAM8K,EAAc,KAAK,KAAK,IAG9B,GAAIA,EAAc,KAAK,qBAAqB,SAAW,IACrD,OAEF,KAAK,qBAAqB,SAAWA,EAErC,MAAMnG,EAAe,KAAK,SAAS,UAAU,eAAe,EAC5D,GAAIA,EAAc,CAChB,MAAMD,EAAa,KAAK,oBAAA,EACxBC,EAAa,QAAQ,OAAO,KAAK,aAAa,QAAQ,MAAM,KAAK,aAAa,WAAW,KAAKD,CAAU,GAAG,CAC7G,CAEA,KAAK,kBAAA,CACP,CAKQ,oBAA2B,CACjC,MAAME,EAAW,KAAK,SAAS,UAAU,WAAW,EAChDA,GACFA,EAAS,QAAQ,QAAQ,KAAK,aAAa,IAAI,EAAE,EAGnD,MAAMH,EAAY,KAAK,SAAS,UAAU,YAAY,EAClDA,GACFA,EAAU,QAAQ,KAAK,qBAAqB,CAEhD,CAKQ,mBAA0B,CAChC,MAAM2B,EAAY,KAAK,SAAS,UAAU,YAAY,EAClDA,GACFA,EAAU,QAAQ,GAAG,KAAK,aAAa,WAAW,KAAA,CAAM,EAAE,CAE9D,CAKQ,mBAA0B,CAChC,GAAI,CAAC,KAAK,aAAe,CAAC,KAAK,qBAAsB,OAErD,MAAM2E,EAAc,KAAK,YAAY,QAAQ,iBAAiB,GAAK,KAAK,aAAa,SAC/EC,EAAc,KAAK,aAAa,SAChClF,EAAqBkF,EAAc,KAAK,aAAa,YACrDC,EAAc,KAAK,IAAI,EAAG,KAAK,oBAAsBnF,CAAkB,EACvEoF,EAAW,KAAK,oBAAoBpF,CAAkB,EAGtDqF,EAAU,CAAE,MAAOJ,CAAA,EA+CzB,GA9CA,KAAK,OAAO,IAAI,CACd,QAASI,EACT,MAAOH,EACP,SAAU,IACV,KAAM,YACN,SAAU,IAAM,CACd,MAAMrG,EAAe,KAAK,SAAS,UAAU,eAAe,EAC5D,GAAIA,EAAc,CAChB,MAAMD,EAAa,KAAK,oBAAA,EACxBC,EAAa,QAAQ,OAAO,KAAK,MAAMwG,EAAQ,KAAK,CAAC,MAAM,KAAK,aAAa,WAAW,KAAKzG,CAAU,GAAG,CAC5G,CACF,CAAA,CACD,EAGD,KAAK,OAAO,IAAI,CACd,QAAS,KAAK,YACd,MAAOuG,EACP,SAAU,IACV,KAAM,YACN,SAAU,IAAM,OAEd,MAAMG,EAAoB,KAAK,YAAa,MAAQ,KAAK,oBACnDC,EAAe,KAAK,oBAAoBD,CAAiB,GAC/DvH,EAAA,KAAK,cAAL,MAAAA,EAAkB,aAAawH,EACjC,EACA,WAAY,IAAM,QAEhBxH,EAAA,KAAK,cAAL,MAAAA,EAAkB,aAAaqH,EACjC,CAAA,CACD,EAGGF,EAAcD,GAChB,KAAK,OAAO,IAAI,CACd,QAAS,KAAK,qBACd,OAAQ,KACR,OAAQ,KACR,SAAU,IACV,KAAM,SACN,KAAM,GACN,OAAQ,CAAA,CACT,EAICC,EAAcD,EAAa,CAC7B,MAAMvJ,EAAO,KAAK,IAAI,UAAU,EAAG,EAAG,KAAK,oBAAsB,GAAI,GAAI,QAAU,EAAG,EACtFA,EAAK,SAAS,CAAC,EACf,KAAK,qBAAqB,IAAIA,CAAI,EAElC,KAAK,OAAO,IAAI,CACd,QAASA,EACT,MAAO,GACP,SAAU,IACV,KAAM,SACN,KAAM,GACN,OAAQ,EACR,WAAY,IAAMA,EAAK,QAAA,CAAQ,CAChC,CACH,CAGA,KAAK,YAAY,QAAQ,kBAAmBwJ,CAAW,CACzD,CAKQ,oBAA2B,CACjC,MAAMM,EAAe,KAAK,SAAS,UAAU,eAAe,EAC5D,GAAI,CAACA,EAAc,OAGnB,MAAMC,EAAqB,KAAK,UAC7B,UAAwB,KAAK,cAAc,IAAItI,EAAc,QAAQ,MAAM,EAAE,EAAE,CAAC,EAChF,OAAqBA,EAAc,QAAQ,MAAM,CAAS,EAEvDuI,EAAiB,KAAK,aAAa,oBAAoBD,CAAkB,EAGzDD,EAAa,KAAK,OAAOjC,GAC7CA,aAAgB,OAAO,YAAY,MAAQA,EAAK,OAAS,cAAgBA,EAAK,OAAS,YAAA,EAE3E,QAAQ1J,GAAQA,EAAK,SAAS,EAE5C,MAAMyB,EAAYkK,EAAa,UAAU,YAAY,EAC/CG,EAAYH,EAAa,UAAU,YAAY,EAEjDlK,IACFA,EAAU,QAAQ,UAAUoK,EAAe,KAAK,EAAE,EAClDpK,EAAU,SAASoK,EAAe,MAAQ,EAAI,UAAY,SAAS,GAEjEC,GACFA,EAAU,QAAQ,UAAU,KAAK,cAAc,IAAI,GAAG,EAIxD,IAAIC,EAAU,GAGd,GAAIF,EAAe,KAAO,EAAG,CAC3B,MAAMG,EAAW,KAAK,IAAI,KACxB,EAAGD,EACH,QAAQF,EAAe,IAAI,GAC3B,CACE,WAAY,eACZ,SAAU,OACV,MAAO,SAAA,CACT,EACA,UAAU,EAAG,EACfF,EAAa,IAAIK,CAAQ,EACzBD,GAAW,EACb,CAGA,GAAIF,EAAe,UAAY,EAAG,CAChC,MAAMI,EAAgB,KAAK,IAAI,KAC7B,EAAGF,EACH,QAAQF,EAAe,SAAS,GAChC,CACE,WAAY,eACZ,SAAU,OACV,MAAO,SAAA,CACT,EACA,UAAU,EAAG,EACfF,EAAa,IAAIM,CAAa,EAC9BF,GAAW,EACb,CAGA,GAAIF,EAAe,OAAS,EAAG,CAC7B,MAAMzG,EAAa,KAAK,IAAI,KAC1B,EAAG2G,EACH,OAAOF,EAAe,MAAM,GAC5B,CACE,WAAY,eACZ,SAAU,OACV,MAAO,UACP,UAAW,MAAA,CACb,EACA,UAAU,EAAG,EACfF,EAAa,IAAIvG,CAAU,CAC7B,CACF,CAKQ,YAAYtF,EAAWC,EAA0B,CAEvD,MAAMmM,EAAa,KAAK,QAClBC,EAAa1L,EAAe,qBAGlC,OAFiB,OAAO,KAAK,SAAS,QAAQX,EAAGC,EAAGmM,EAAYC,CAAU,EAE3D,IACN,YAKF,IACT,CAKQ,gBAAgBhF,EAAkB7D,EAAmD,CAC3F,MAAM8I,EAAO,KAAK,UAAU,IAAIjF,CAAQ,EACxC,GAAKiF,EA2BL,OAxBA,KAAK,OAAO,IAAI,CACd,QAAS9I,EACT,EAAG8I,EAAK,EACR,EAAGA,EAAK,EACR,OAAQ3L,EAAe,UAAU,gBACjC,OAAQA,EAAe,UAAU,gBACjC,SAAUA,EAAe,UAAU,gBAAkB,EACrD,KAAM,WACN,WAAY,IAAM,CAEhB,KAAK,OAAO,IAAI,CACd,QAAS6C,EACT,OAAQ,EACR,OAAQ,EACR,SAAU7C,EAAe,UAAU,gBAAkB,EACrD,KAAM,aAAA,CACP,CACH,CAAA,CACD,EAGD,KAAK,sBAAsB2L,EAAK,EAAGA,EAAK,CAAC,EAGjCjF,EAAA,CACN,IAAK,YACH,KAAK,0BAA0B7D,CAAa,EAC5C,MACF,IAAK,UACH,KAAK,wBAAwBA,CAAa,EAC1C,MACF,QACE,QAAQ,KAAK,sBAAsB6D,CAAQ,EAAE,CAAA,CAEnD,CAKQ,kBAAkB7D,EAAmD,CAE3E,MAAMgG,EAAYhG,EAAc,QAAQ,WAAW,EAC7CiG,EAAYjG,EAAc,QAAQ,WAAW,EAGnD,KAAK,OAAO,IAAI,CACd,QAASA,EACT,EAAGA,EAAc,EAAI,GACrB,SAAU7C,EAAe,UAAU,mBAAqB,EACxD,KAAM,SACN,KAAM,GACN,OAAQ,EACR,WAAY,IAAM,CAEhB,KAAK,OAAO,IAAI,CACd,QAAS6C,EACT,EAAGgG,EACH,EAAGC,EACH,SAAU9I,EAAe,mBACzB,KAAM,UAAA,CACP,CACH,CAAA,CACD,EAGD,KAAK,sBAAsB6C,EAAc,EAAGA,EAAc,CAAC,CAC7D,CAKQ,sBAAsBxD,EAAWC,EAAiB,CAExD,MAAMqD,EAAS,KAAK,IAAI,SAAA,EACxBA,EAAO,YAAYtD,EAAGC,CAAC,EACvBqD,EAAO,SAAS,IAAI,EAGpBA,EAAO,UAAU3C,EAAe,OAAO,gBAAiB,EAAG,EAC3D2C,EAAO,WAAW,EAAG,EAAG,EAAE,EAG1B,KAAK,OAAO,IAAI,CACd,QAASA,EACT,OAAQ,EACR,OAAQ,EACR,MAAO,EACP,SAAU,IACV,KAAM,aACN,WAAY,IAAM,CAChBA,EAAO,QAAA,CACT,CAAA,CACD,EAGD,QAASpC,EAAI,EAAGA,EAAI,EAAGA,IAAK,CAC1B,MAAMqL,EAAQ,KAAK,IAAI,SAAA,EACvBA,EAAM,YAAYvM,EAAGC,CAAC,EACtBsM,EAAM,SAAS,IAAI,EACnBA,EAAM,UAAU5L,EAAe,OAAO,gBAAiB,EAAG,EAC1D4L,EAAM,WAAW,EAAG,EAAG,CAAC,EAExB,MAAMC,EAAStL,EAAI,EAAK,KAAK,GAAK,EAC5BuL,EAAW,GAEjB,KAAK,OAAO,IAAI,CACd,QAASF,EACT,EAAGvM,EAAI,KAAK,IAAIwM,CAAK,EAAIC,EACzB,EAAGxM,EAAI,KAAK,IAAIuM,CAAK,EAAIC,EACzB,MAAO,EACP,SAAU,IACV,KAAM,aACN,WAAY,IAAM,CAChBF,EAAM,QAAA,CACR,CAAA,CACD,CACH,CACF,CAKQ,sBAAsBvM,EAAWC,EAAiB,CAExD,MAAMqD,EAAS,KAAK,IAAI,SAAA,EACxBA,EAAO,YAAYtD,EAAGC,CAAC,EACvBqD,EAAO,SAAS,IAAI,EAGpBA,EAAO,UAAU,EAAG3C,EAAe,OAAO,kBAAmB,EAAG,EAChE2C,EAAO,UAAA,EACPA,EAAO,OAAO,IAAK,GAAG,EACtBA,EAAO,OAAO,GAAI,EAAE,EACpBA,EAAO,OAAO,GAAI,GAAG,EACrBA,EAAO,OAAO,IAAK,EAAE,EACrBA,EAAO,WAAA,EAGP,KAAK,OAAO,IAAI,CACd,QAASA,EACT,EAAGtD,EAAI,EACP,SAAU,IACV,KAAM,SACN,KAAM,GACN,OAAQ,CAAA,CACT,EAED,KAAK,OAAO,IAAI,CACd,QAASsD,EACT,MAAO,EACP,SAAU,IACV,KAAM,aACN,WAAY,IAAM,CAChBA,EAAO,QAAA,CACT,CAAA,CACD,CACH,CAKQ,wBAAwBE,EAAmD,CACjF,MAAM/C,EAAO+C,EAAc,QAAQ,MAAM,EAGzC,KAAK,aAAa,YAAY/C,EAAK,EAAE,EAGrC,MAAMiM,EAAY,KAAK,UAAU,QAAQlJ,CAAa,EAClDkJ,EAAY,KACd,KAAK,UAAU,OAAOA,EAAW,CAAC,EAClClJ,EAAc,QAAA,GAIhB,KAAK,YAAA,EAGL,KAAK,WAAW,SAAW,GAC3B,KAAK,WAAW,UAAY,GAC5B,KAAK,WAAW,OAAS,GACzB,KAAK,SAAA,CACP,CAKQ,0BAA0BA,EAAmD,CACnF,MAAM/C,EAAO+C,EAAc,QAAQ,MAAM,EAGzC,GAAI,KAAK,aAAa,iBAAkB,CACtC,KAAK,OAAO,IAAI,CACd,QAASA,EACT,EAAGA,EAAc,QAAQ,WAAW,EACpC,EAAGA,EAAc,QAAQ,WAAW,EACpC,SAAU7C,EAAe,mBACzB,KAAM,QAAA,CACP,EACD,MACF,CAGA,KAAK,OAAO,IAAI,CACd,QAAS6C,EACT,EAAG,KAAK,QACR,EAAG7C,EAAe,qBAClB,SAAUA,EAAe,mBACzB,KAAM,SACN,WAAY,IAAM,CAEhB,MAAM8C,EAAQ,KAAK,UAAU,QAAQD,CAAa,EAC9CC,IAAU,IACZ,KAAK,UAAU,OAAOA,EAAO,CAAC,EAIhC,KAAK,aAAa,eAAehD,CAAI,EAGrC,KAAK,YAAA,EAGL,KAAK,gBAAgBA,CAAI,CAC3B,CAAA,CACD,CACH,CAKQ,gBAAgB8I,EAA2B,CAEjD,MAAMoD,EAAgB,KAAK,IAAI,UAAU,KAAK,QAAShM,EAAe,qBAAuB,GAAG,EAE1FJ,EAAK,KAAK,IAAI,UAAU,EAAG,EAAG,IAAK,GAAI,EAAU,EAAG,EACpDL,EAAO,KAAK,IAAI,KACpB,EACA,EACA,UAAUqJ,EAAc,IAAI;AAAA,OAAUA,EAAc,KAAK,GACzD,CACE,WAAY,eACZ,SAAU,OACV,MAAO,UACP,MAAO,QAAA,CACT,EACA,UAAU,EAAG,EAEfoD,EAAc,IAAI,CAACpM,EAAIL,CAAI,CAAC,EAC5ByM,EAAc,QAAQ,gBAAgB,EAGtCA,EAAc,SAAS,CAAC,EACxB,KAAK,OAAO,IAAI,CACd,QAASA,EACT,MAAO,EACP,SAAU,GAAA,CACX,CACH,CAKQ,qBAAqBpD,EAA2B,CACtD,MAAMqD,EAAqB,KAAK,IAAI,UAClC,KAAK,QACLjM,EAAe,oBAAA,EAIXE,EAAS,KAAK,IAAI,MAAM,EAAG,EAAG,KAAK,gBAAgB,MAAM,CAAC,EAChEA,EAAO,QAAQ,QAAQ,EAGvB,MAAMU,EAAW,KAAK,IAAI,KACxB,EACA,IACAgI,EAAc,KACd,CACE,WAAY,eACZ,SAAU,OACV,MAAO,UACP,UAAW,OACX,SAAU,CAAE,MAAO,GAAA,CAAI,CACzB,EACA,UAAU,EAAG,EAGT5H,EAAY,KAAK,IAAI,KACzB,EACA,GACA,GAAG4H,EAAc,KAAK,GACtB,CACE,WAAY,eACZ,SAAU,OACV,MAAO,UACP,UAAW,MAAA,CACb,EACA,UAAU,EAAG,EAGTsD,EAAW,KAAK,IAAI,KACxB,EACA,GACAtD,EAAc,YACd,CACE,WAAY,eACZ,SAAU,OACV,MAAO,UACP,SAAU,CAAE,MAAO,GAAA,CAAI,CACzB,EACA,UAAU,EAAG,EAEfqD,EAAmB,IAAI,CAAC/L,EAAQU,EAAUI,EAAWkL,CAAQ,CAAC,EAC9DD,EAAmB,QAAQ,gBAAgB,EAC3CA,EAAmB,SAAS,CAAC,EAG7B,KAAK,OAAO,IAAI,CACd,QAASA,EACT,MAAO,IACP,SAAU,IACV,KAAM,cAAA,CACP,CACH,CAKQ,mBAA0B,CAEhC,MAAME,EAAiB,KAAK,SAAS,UAAU,0BAA0B,EACrEA,GACFA,EAAe,QAAA,EAIjB,MAAMjB,EAAe,KAAK,IAAI,UAAU,KAAK,UAAY,IAAK,GAAG,EACjEA,EAAa,QAAQ,eAAe,EAEpC,MAAMtL,EAAK,KAAK,IAAI,UAAU,EAAG,EAAG,IAAK,IAAK,EAAU,EAAG,EAErDwM,EAAgB,KAAK,uBAAA,EACrB7M,EAAO,KAAK,IAAI,KACpB,EACA,IACA,UAAU6M,CAAa,GACvB,CACE,WAAY,eACZ,SAAU,OACV,MAAO,SAAA,CACT,EAEF7M,EAAK,UAAU,EAAG,EAClBA,EAAK,QAAQ,YAAY,EAEzB,MAAM8M,EAAU,KAAK,IAAI,KACvB,EACA,IACA,UAAU,KAAK,cAAc,IAAI,IACjC,CACE,WAAY,eACZ,SAAU,OACV,MAAO,SAAA,CACT,EAEFA,EAAQ,UAAU,EAAG,EACrBA,EAAQ,QAAQ,YAAY,EAE5BnB,EAAa,IAAI,CAACtL,EAAIL,EAAM8M,CAAO,CAAC,EAGpC,KAAK,mBAAA,EAGiB,KAAK,aACzB,KAAK,UAAY,IACjB,IACA,WACA,IAAM,KAAK,iBAAA,EACX,CACE,WAAY,eACZ,SAAU,OACV,MAAO,SAAA,CACT,EAEY,QAAQ,0BAA0B,CAClD,CAKQ,wBAAiC,CACvC,IAAIC,EAAa,EACjB,YAAK,UAAU,QAAQzJ,GAAiB,CACtC,MAAM/C,EAAO+C,EAAc,QAAQ,MAAM,EACrC,KAAK,cAAc,IAAI/C,EAAK,EAAE,IAChCwM,GAAcxM,EAAK,MAEvB,CAAC,EACMwM,CACT,CAKQ,kBAAyB,SAC/B,GAAI,CAAC,KAAK,aAAa,iBACrB,OAOF,MAAMC,EAAS,KAAK,aAAa,iBAAA,EAG3BC,EAAa,OAA8D,aAAe,CAAA,EAChGA,EAAU,oBAAsBD,EAChC,KAAK,2BAAA,EAGDA,EAAO,SACT9I,EAAA,KAAK,eAAL,MAAAA,EAAmB,KAAK,qBAExBgF,EAAA,KAAK,eAAL,MAAAA,EAAmB,KAAK,iBAI1B,KAAK,oBAAoB8D,CAAM,EAG3BA,EAAO,SAAWA,EAAO,YAE3B,KAAK,KAAK,YAAY,IAAM,IAAM,CAChC,KAAK,2BAAA,CACP,CAAC,EAGD,KAAK,KAAK,YAAY,IAAM,IAAM,CAChC,KAAK,mBAAA,EACL,KAAK,oBAAA,CACP,CAAC,EAIH,KAAK,UAAY,KAAK,UAAU,OAAO1J,GAAiB,CACtD,MAAM/C,EAAO+C,EAAc,QAAQ,MAAM,EACzC,OAAI,KAAK,cAAc,IAAI/C,EAAK,EAAE,GAChC+C,EAAc,QAAA,EACP,IAEF,EACT,CAAC,EAGD,KAAK,cAAc,MAAA,EAGnB,MAAM+F,EAAgB,KAAK,SAAS,UAAU,gBAAgB,EAC1DA,GACF,KAAK,OAAO,IAAI,CACd,QAASA,EACT,MAAO,EACP,SAAU,IACV,WAAY,IAAMA,EAAc,QAAA,CAAQ,CACzC,EAIH,KAAK,mBAAA,EAGL,KAAK,WAAW,SAAW,GAC3B,KAAK,WAAW,UAAY,GAC5B,KAAK,WAAW,OAAS,GACzB,KAAK,WAAW,KAAO,GACvB,KAAK,WAAW,cAAgB,GAChC,KAAK,SAAA,CACP,CAKQ,oBAAoB2D,EAA+B,CACzD,MAAME,EAAkB,KAAK,IAAI,UAAU,KAAK,QAAS,KAAK,OAAO,EAE/D7M,EAAK,KAAK,IAAI,UAAU,EAAG,EAAG,IAAK,IAAK,EAAU,EAAG,EAErD8M,EAAY,KAAK,IAAI,KACzB,EACA,KACAH,EAAO,QAAU,WAAa,aAC9B,CACE,WAAY,eACZ,SAAU,OACV,MAAOA,EAAO,QAAU,UAAY,UACpC,UAAW,MAAA,CACb,EACA,UAAU,EAAG,EAGf,IAAII,EAAgB,aAAaJ,EAAO,cAAc;AAAA;AAAA,EAElDA,EAAO,gBACTI,GAAiB;AAAA,EACbJ,EAAO,eAAe,KAAO,IAC/BI,GAAiB,aAAaJ,EAAO,eAAe,IAAI;AAAA,GAEtDA,EAAO,eAAe,UAAY,IACpCI,GAAiB,cAAcJ,EAAO,eAAe,SAAS;AAAA,GAE5DA,EAAO,eAAe,OAAS,IACjCI,GAAiB,YAAYJ,EAAO,eAAe,MAAM;AAAA,GAE3DI,GAAiB,SAASJ,EAAO,eAAe,KAAK;AAAA;AAAA,GAErDI,GAAiB,YAAYJ,EAAO,WAAW;AAAA;AAAA,EAGjDI,GAAiB,SAASJ,EAAO,eAAiB,EAAI,IAAM,EAAE,GAAGA,EAAO,cAAc,GAEtF,MAAMK,EAAa,KAAK,IAAI,KAC1B,EACA,IACAD,EACA,CACE,WAAY,eACZ,SAAU,OACV,MAAO,UACP,MAAO,SACP,YAAa,CAAA,CACf,EACA,UAAU,EAAG,EAGf,GAAI,CAACJ,EAAO,SAAWA,EAAO,gBAAkBA,EAAO,eAAe,OAAS,GACvDA,EAAO,eAAe,KAAOA,EAAO,eAAe,WACpDA,EAAO,eAAgB,CAC1C,MAAMM,EAAmB,KAAK,IAAI,KAChC,EACA,GACA,mBACA,CACE,WAAY,eACZ,SAAU,OACV,MAAO,UACP,UAAW,MAAA,CACb,EACA,UAAU,EAAG,EACfJ,EAAgB,IAAII,CAAgB,CACtC,CAGF,MAAMxK,EAAc,KAAK,aACvB,EACA,IACA,MACA,IAAM,CACJ,KAAK,OAAO,IAAI,CACd,QAASoK,EACT,MAAO,EACP,SAAU,IACV,WAAY,IAAMA,EAAgB,QAAA,CAAQ,CAC3C,CACH,EACA,CACE,WAAY,eACZ,SAAU,OACV,MAAO,SAAA,CACT,EAGFA,EAAgB,IAAI,CAAC7M,EAAI8M,EAAWE,EAAYvK,CAAW,CAAC,EAC5DoK,EAAgB,SAAS,CAAC,EAG1B,KAAK,OAAO,IAAI,CACd,QAASA,EACT,MAAO,EACP,SAAU,IACV,KAAM,cAAA,CACP,CACH,CAKQ,qBAA8B,CACpC,MAAMK,EAAe,KAAK,aAAa,MACjCC,EAAYC,EAAeF,CAAY,EAAE,MAEzCG,EAAe,KAAK,uBAAA,EACpBC,EAAWlN,EAAe,YAAY8M,CAAY,EAExD,MAAO,GAAGC,CAAS,KAAKE,CAAY,IAAIC,CAAQ,GAClD,CAKQ,wBAAiC,CACvC,MAAMC,EAAO,KAAK,aAAa,KAE/B,OAAI,KAAK,aAAa,QAAU,QACvBA,EACE,KAAK,aAAa,QAAU,SAC9BA,EAAOnN,EAAe,YAAY,MAElCmN,EAAOnN,EAAe,YAAY,MAAQA,EAAe,YAAY,MAEhF,CAKQ,oBAA2B,CACjC,MAAMmN,EAAO,KAAK,aAAa,KACzBjI,EAAQ,KAAK,aAAa,MAEhC,GAAIA,IAAU,SAAWiI,GAAQnN,EAAe,YAAY,MAAO,CACjE,MAAMoN,EAAsB,KAAK,aAAa,YAC9C,KAAK,aAAa,aAAA,EAClB,KAAK,oBAAoB,MAAOA,EAAqB,KAAK,aAAa,WAAW,EAClF,KAAK,oBAAA,CACP,SAAWlI,IAAU,UACViI,GAAQnN,EAAe,YAAY,MAAQA,EAAe,YAAY,OAAQ,CACvF,MAAMoN,EAAsB,KAAK,aAAa,YAC9C,KAAK,aAAa,aAAA,EAClB,KAAK,oBAAoB,MAAOA,EAAqB,KAAK,aAAa,WAAW,EAClF,KAAK,oBAAA,CACP,CACF,CAKQ,qBAA4B,CAElC,KAAK,aAAa,cAAc,MAAA,EAGhC,MAAMC,EAAgBlJ,EAAY,qBAAqB,KAAK,aAAa,KAAK,EAC9E,KAAK,aAAa,cAAc,SAASkJ,CAAa,EACtD,KAAK,aAAa,cAAc,QAAA,CAClC,CAKQ,oBAAoBN,EAAmBK,EAA6BE,EAA8B,CACxG,MAAMC,EAAsB,KAAK,IAAI,UAAU,KAAK,QAAS,KAAK,OAAO,EACzEA,EAAoB,SAAS,GAAI,EAEjC,MAAM3N,EAAK,KAAK,IAAI,UAAU,EAAG,EAAG,KAAK,UAAW,KAAK,WAAY,EAAU,EAAG,EAE5EL,EAAO,KAAK,IAAI,KACpB,EACA,IACA,GAAGwN,CAAS,OACZ,CACE,WAAY,eACZ,SAAU,OACV,MAAO,UACP,UAAW,MAAA,CACb,EACA,UAAU,EAAG,EAGTS,EAAcjO,EAAK,OACrBiO,GAAeA,EAAY,eAC7B,KAAK,iBAAiB,QAAQA,EAAY,cAAe,UAAW,CAClE,SAAU,IACV,UAAW,MAAA,CACZ,EAIH,MAAMC,EAAqB,KAAK,IAAI,KAClC,EACA,IACA,kBAAkBL,CAAmB,MAAME,CAAc,IACzD,CACE,WAAY,eACZ,SAAU,OACV,MAAO,SAAA,CACT,EACA,UAAU,EAAG,EAGTI,EAAuB,KAAK,iCAAiCX,CAAS,EACtEY,EAAa,KAAK,IAAI,KAC1B,EACA,GACAD,EACA,CACE,WAAY,eACZ,SAAU,OACV,MAAO,UACP,MAAO,QAAA,CACT,EACA,UAAU,EAAG,EAGTE,EAAe,KAAK,aACxB,EACA,IACA,SACA,IAAM,CACJ,KAAK,0BAAA,EACLL,EAAoB,QAAA,CACtB,EACA,CACE,WAAY,eACZ,SAAU,OACV,MAAO,SAAA,CACT,EAGIM,EAAa,KAAK,aACtB,EACA,IACA,SACA,IAAM,CACJ,KAAK,OAAO,IAAI,CACd,QAASN,EACT,MAAO,EACP,SAAU,IACV,WAAY,IAAMA,EAAoB,QAAA,CAAQ,CAC/C,CACH,EACA,CACE,WAAY,eACZ,SAAU,OACV,MAAO,SAAA,CACT,EAGFA,EAAoB,IAAI,CAAC3N,EAAIL,EAAMkO,EAAoBE,EAAYC,EAAcC,CAAU,CAAC,EAC5FN,EAAoB,SAAS,CAAC,EAG9B,KAAK,OAAO,IAAI,CACd,QAASA,EACT,MAAO,EACP,SAAU,GAAA,CACX,EAGDhO,EAAK,SAAS,CAAC,EACf,KAAK,OAAO,IAAI,CACd,QAASA,EACT,MAAO,EACP,SAAU,IACV,MAAO,IACP,KAAM,cAAA,CACP,EAGDkO,EAAmB,SAAS,CAAC,EAC7B,KAAK,OAAO,IAAI,CACd,QAASA,EACT,MAAO,EACP,SAAU,IACV,MAAO,GAAA,CACR,EAGD,QAASlN,EAAI,EAAGA,EAAI,GAAIA,IAAK,CAC3B,MAAMuN,EAAW,KAAK,IAAI,OACxB,OAAO,KAAK,QAAQ,KAAM,GAAG,EAC7B,OAAO,KAAK,QAAQ,KAAM,GAAG,EAC7B,OAAO,KAAK,QAAQ,EAAG,CAAC,EACxB,SACA,EAAA,EAEFP,EAAoB,IAAIO,CAAQ,EAGhC,KAAK,OAAO,IAAI,CACd,QAASA,EACT,MAAO,EACP,MAAO,IACP,SAAU,IACV,MAAO,OAAO,KAAK,QAAQ,EAAG,GAAI,EAClC,KAAM,QAAA,CACP,CACH,CAGA,MAAMzJ,EAAY,KAAK,SAAS,UAAU,YAAY,EAClDA,GACFA,EAAU,QAAQ,KAAK,qBAAqB,EAI9C,KAAK,yBAAA,EAGL,KAAK,yBAAA,CACP,CAKQ,iCAAiC0I,EAA2B,CAClE,OAAIA,IAAc,MACT;AAAA,wBACEA,IAAc,MAChB;AAAA,mBAEF,EACT,CAKQ,2BAAkC,CAExC,KAAK,iBAAiB,gBAAiB,MAAM,CAC/C,CAMQ,yBAAgC,CAGxC,CAKQ,6BAA6B3D,EAAuB,CAC1D,MAAM2E,EAAmB,KAAK,IAAI,UAAU,KAAK,QAAS,GAAG,EAC7DA,EAAiB,SAAS,GAAI,EAE9B,MAAMnO,EAAK,KAAK,IAAI,UAAU,EAAG,EAAG,IAAK,IAAK,SAAU,GAAI,EAC5DA,EAAG,eAAe,EAAG,QAAQ,EAE7B,MAAMoO,EAAW,KAAK,IAAI,KACxB,KAAM,EACN,IACA,CACE,WAAY,eACZ,SAAU,OACV,MAAO,SAAA,CACT,EACA,UAAU,EAAG,EAETC,EAAc,KAAK,IAAI,KAC3B,GAAI,IACJ,GAAG7E,EAAU,IAAI;AAAA,IAAQA,EAAU,cAAc,cACjD,CACE,WAAY,eACZ,SAAU,OACV,MAAO,UACP,UAAW,MAAA,CACb,EACA,UAAU,EAAG,EAET8E,EAAa,KAAK,IAAI,KAC1B,GAAI,GACJ,0BACA,CACE,WAAY,eACZ,SAAU,OACV,MAAO,SAAA,CACT,EACA,UAAU,EAAG,EAEfH,EAAiB,IAAI,CAACnO,EAAIoO,EAAUC,EAAaC,CAAU,CAAC,EAC5DH,EAAiB,SAAS,CAAC,EAC3BA,EAAiB,SAAS,CAAC,EAG3B,KAAK,OAAO,IAAI,CACd,QAASA,EACT,MAAO,IACP,MAAO,EACP,SAAU,IACV,KAAM,eACN,WAAY,IAAM,CAEhB,KAAK,OAAO,IAAI,CACd,QAASA,EACT,MAAO,EACP,SAAU,IACV,KAAM,GACN,OAAQ,EACR,KAAM,gBAAA,CACP,EAGD,KAAK,KAAK,YAAY,IAAM,IAAM,CAChC,KAAK,OAAO,IAAI,CACd,QAASA,EACT,MAAO,GACP,MAAO,EACP,SAAU,IACV,KAAM,SACN,WAAY,IAAMA,EAAiB,QAAA,CAAQ,CAC5C,CACH,CAAC,CACH,CAAA,CACD,CACH,CAMQ,+BAA+BI,EAAuC,CAC5E,MAAMC,EAAiBD,EAAQ,eAEzBE,EAAgBF,EAAQ,SAG9B,IAAIG,EAAe,SACfC,EAAY,IACZC,EAAc,GAEdJ,IAAmB,GACrBE,EAAe,SACfC,EAAY,KACZC,EAAc,OACLJ,IAAmB,IAC5BE,EAAe,SACfC,EAAY,IACZC,EAAc,OAGhB,MAAMT,EAAmB,KAAK,IAAI,UAAU,KAAK,QAAS,GAAG,EAC7DA,EAAiB,SAAS,GAAI,EAE9B,MAAMnO,EAAK,KAAK,IAAI,UAAU,EAAG,EAAG,IAAK,IAAK0O,EAAc,GAAI,EAChE1O,EAAG,eAAe,EAAG,QAAQ,EAE7B,MAAMoO,EAAW,KAAK,IAAI,KACxB,KAAM,EACNO,EACA,CACE,WAAY,eACZ,SAAU,OACV,MAAO,SAAA,CACT,EACA,UAAU,EAAG,EAETN,EAAc,KAAK,IAAI,KAC3B,GAAI,IACJ,GAAGO,CAAW,IAAIH,CAAa;AAAA,IAAQD,CAAc,aACrD,CACE,WAAY,eACZ,SAAU,OACV,MAAO,UACP,UAAW,OACX,MAAO,QAAA,CACT,EACA,UAAU,EAAG,EAETF,EAAa,KAAK,IAAI,KAC1B,GAAI,GACJ,6BACA,CACE,WAAY,eACZ,SAAU,OACV,MAAO,SAAA,CACT,EACA,UAAU,EAAG,EAEfH,EAAiB,IAAI,CAACnO,EAAIoO,EAAUC,EAAaC,CAAU,CAAC,EAC5DH,EAAiB,SAAS,CAAC,EAC3BA,EAAiB,SAAS,CAAC,EAG3B,MAAMlE,EAAoBuE,IAAmB,EAAI,IAAM,IACvD,KAAK,OAAO,IAAI,CACd,QAASL,EACT,MAAO,IACP,MAAO,EACP,SAAUlE,EACV,KAAM,eACN,WAAY,IAAM,CAEhB,MAAM4E,EAAeL,IAAmB,EAAI,EAAI,EAChD,KAAK,OAAO,IAAI,CACd,QAASL,EACT,MAAO,EACP,SAAUK,IAAmB,EAAI,IAAM,IACvC,KAAM,GACN,OAAQK,EACR,KAAM,gBAAA,CACP,EAGD,MAAMC,EAAcN,IAAmB,EAAI,IAAO,IAClD,KAAK,KAAK,YAAYM,EAAa,IAAM,CACvC,KAAK,OAAO,IAAI,CACd,QAASX,EACT,MAAO,GACP,MAAO,EACP,SAAU,IACV,KAAM,SACN,WAAY,IAAMA,EAAiB,QAAA,CAAQ,CAC5C,CACH,CAAC,CACH,CAAA,CACD,CACH,CAKQ,0BAAiC,CACvC,GAAI,CAAC,KAAK,qBAAsB,OAGhC,MAAMnI,EAAY,KAAK,qBAAqB,KAAK,CAAC,EAC9CA,GACF,KAAK,OAAO,IAAI,CACd,QAASA,EACT,MAAO,GACP,SAAU,IACV,KAAM,GACN,OAAQ,EACR,KAAM,QAAA,CACP,EAIH,KAAK,OAAO,IAAI,CACd,QAAS,KAAK,qBACd,EAAG,KAAK,qBAAqB,EAAI,EACjC,SAAU,IACV,KAAM,GACN,OAAQ,EACR,KAAM,QAAA,CACP,EAGD,KAAK,WAAW,SAAW,GAC3B,KAAK,WAAW,UAAY,GAC5B,KAAK,WAAW,OAAS,GACzB,KAAK,SAAA,CACP,CAKQ,cAAqB,CACvB,KAAK,aAAa,cAChB,KAAK,aAAa,SAAW,UAC/B,KAAK,YAAY,EAAI,EACZ,KAAK,aAAa,SAAW,aACtC,KAAK,YAAY,EAAK,EAEf,KAAK,aAAa,QAAU,eAC5B,KAAK,aAAa,UAAY5F,EAAe,mBAEtD,KAAK,aAAa,OAAS,UAC3B,KAAK,YAAY,EAAI,EAEzB,CAKQ,4BAAmC,CAErC,KAAK,0BACP,KAAK,yBAAyB,QAAA,EAIhC,KAAK,yBAA2B,KAAK,IAAI,UAAU,KAAK,QAAS,KAAK,OAAO,EAC7E,KAAK,yBAAyB,SAAS,GAAI,EAG3C,MAAMkC,EAAU,KAAK,IAAI,UACvB,EAAG,EACH,KAAK,UAAW,KAAK,WACrB,EAAU,EAAA,EAEZA,EAAQ,UAAU,EAAG,EAGrB,MAAMwK,EAAY,KAAK,IAAI,KACzB,EAAG,KACH,gBACA,CACE,WAAY,eACZ,SAAU,OACV,MAAO,UACP,UAAW,MAAA,CACb,EACA,UAAU,EAAG,EAGTiC,EAAqB,KAAK,2BAAA,EAC1BC,EAAgB,KAAK,IAAI,KAC7B,EAAG,KACHD,EACA,CACE,WAAY,eACZ,SAAU,OACV,MAAO,SAAA,CACT,EACA,UAAU,EAAG,EAEf,KAAK,yBAAyB,IAAI,CAACzM,EAASwK,EAAWkC,CAAa,CAAC,EAGrE,KAAK,0BACH,KAAM,EACN,OACA;AAAA,UACA,SACA,YAAA,EAIF,KAAK,0BACH,IAAK,EACL,OACA;AAAA,WACA,SACA,MAAA,EAIF,MAAMC,EAAU,KAAK,yBAAyB,KAAK,OAAOvL,GACxDA,aAAiB,OAAO,YAAY,WAAaA,IAAUpB,CAAA,EAG7D2M,EAAQ,QAASnP,GAAW,CACtBA,aAAkB,OAAO,YAAY,YACvCA,EAAO,SAAS,CAAC,EACjBA,EAAO,SAAS,CAAC,EAErB,CAAC,EAGD,KAAK,yBAAyB,SAAS,CAAC,EACxC,KAAK,OAAO,IAAI,CACd,QAAS,KAAK,yBACd,MAAO,EACP,SAAU,IACV,KAAM,SACN,WAAY,IAAM,CAEhBmP,EAAQ,QAAQ,CAACnP,EAAQoD,IAAU,CAC7BpD,aAAkB,OAAO,YAAY,WACvC,KAAK,KAAK,YAAYoD,EAAQ,IAAK,IAAM,CACvC,KAAK,OAAO,IAAI,CACd,QAASpD,EACT,MAAO,EACP,MAAO,EACP,SAAU,IACV,KAAM,cAAA,CACP,CACH,CAAC,CAEL,CAAC,CACH,CAAA,CACD,CACH,CAKQ,0BACNL,EACAC,EACAsF,EACA/D,EACAiB,EACAb,EACM,CACN,GAAI,CAAC,KAAK,yBAA0B,OAEpC,MAAM6F,EAAkB,KAAK,IAAI,UAAUzH,EAAGC,CAAC,EAGzCY,EAAS,KAAK,IAAI,UAAU,EAAG,EAAG,IAAK,IAAK,OAAQ,EAK1D,GAJAA,EAAO,eAAe,EAAG4B,CAAK,EAC9B5B,EAAO,eAAA,EAGHe,IAAkB,aAAc,CAClC,MAAMG,EAAO,KAAK,IAAI,UAAU,EAAG,EAAG,IAAK,IAAKU,EAAO,EAAG,EAC1DV,EAAK,SAAS,EAAG,EACjB0F,EAAgB,MAAM1F,EAAM,CAAC,EAG7B,KAAK,OAAO,IAAI,CACd,QAASA,EACT,MAAO,GACP,MAAO,KACP,SAAU,IACV,KAAM,GACN,OAAQ,GACR,KAAM,gBAAA,CACP,CACH,CAGA,MAAM0N,EAAU,KAAK,IAAI,UAAU,EAAG,KAAM,IAAK,GAAIhN,CAAK,EAGpD4K,EAAY,KAAK,IAAI,KACzB,EAAG,KACH9H,EACA,CACE,WAAY,eACZ,SAAU,OACV,MAAO,UACP,UAAW,MAAA,CACb,EACA,UAAU,EAAG,EAGTsH,EAAW,KAAK,IAAI,KACxB,EAAG,IACHrL,EACA,CACE,WAAY,eACZ,SAAU,OACV,MAAO,UACP,MAAO,SACP,YAAa,EAAA,CACf,EACA,UAAU,EAAG,GAGEI,IAAkB,aAC/B,CAAC,SAAU,SAAU,QAAQ,EAC7B,CAAC,SAAU,QAAS,OAAO,GAEtB,QAAQ,CAAC8N,EAASjM,IAAU,CACnC,MAAMkM,EAAc,KAAK,IAAI,KAC3B,EAAG,GAAKlM,EAAQ,GAChB,KAAKiM,CAAO,GACZ,CACE,WAAY,eACZ,SAAU,OACV,MAAO,SAAA,CACT,EACA,UAAU,EAAG,EACfjI,EAAgB,IAAIkI,CAAW,CACjC,CAAC,EAGD,MAAMC,EAAW,KAAK,IAAI,UAAU,EAAG,IAAK,IAAK,GAAI,EAAU,EAAG,EAClEA,EAAS,eAAe,EAAG,OAAQ,EAEnC,MAAMrC,EAAa,KAAK,IAAI,KAC1B,EAAG,IACH,KAAK,mCAAmC3L,CAAa,EACrD,CACE,WAAY,eACZ,SAAU,OACV,MAAO,UACP,MAAO,SACP,YAAa,EACb,SAAU,CAAE,MAAO,GAAA,CAAI,CACzB,EACA,UAAU,EAAG,EAEf6F,EAAgB,IAAI,CAACmI,EAAUrC,CAAU,CAAC,EAG1C,MAAMsC,EAAe,KAAK,aACxB,EAAG,IACH,OACA,IAAM,KAAK,wBAAwBjO,CAAa,EAChD,CACE,WAAY,eACZ,SAAU,OACV,MAAO,SAAA,CACT,EAIFf,EAAO,GAAG,cAAe,IAAM,CAC7B4G,EAAgB,SAAS,IAAI,EAC7B5G,EAAO,aAAa,OAAQ,EAC5B,KAAK,OAAO,IAAI,CACd,QAAS4G,EACT,EAAGxH,EAAI,GACP,SAAU,IACV,KAAM,QAAA,CACP,CACH,CAAC,EAEDY,EAAO,GAAG,aAAc,IAAM,CAC5B4G,EAAgB,SAAS,CAAC,EAC1B5G,EAAO,aAAa,OAAQ,EAC5B,KAAK,OAAO,IAAI,CACd,QAAS4G,EACT,EAAAxH,EACA,SAAU,IACV,KAAM,QAAA,CACP,CACH,CAAC,EAGDY,EAAO,GAAG,cAAe,IAAM,CAC7B,KAAK,wBAAwBe,CAAa,CAC5C,CAAC,EAED6F,EAAgB,IAAI,CAAC5G,EAAQ4O,EAASpC,EAAWR,EAAUgD,CAAY,CAAC,EACxE,KAAK,yBAAyB,IAAIpI,CAAe,CACnD,CAKQ,4BAAqC,CAG3C,OAFc,KAAK,aAAa,MAExB,CACN,IAAK,QACH,MAAO,kCACT,IAAK,SACH,MAAO,6BACT,IAAK,cACH,MAAO,gCACT,QACE,MAAO,cAAA,CAEb,CAKQ,mCAAmC7F,EAA8C,CACvF,MAAMiE,EAAQ,KAAK,aAAa,MAEhC,GAAIjE,IAAkB,aACpB,OAAQiE,EAAA,CACN,IAAK,QACH,MAAO;AAAA;AAAA,iBACT,IAAK,SACH,MAAO;AAAA;AAAA,qBACT,IAAK,cACH,MAAO;AAAA;AAAA,mBACT,QACE,MAAO,eAAA,KAGX,QAAQA,EAAA,CACN,IAAK,QACH,MAAO;AAAA;AAAA,gBACT,IAAK,SACH,MAAO;AAAA;AAAA,sBACT,IAAK,cACH,MAAO;AAAA;AAAA,oBACT,QACE,MAAO,iBAAA,CAGf,CAKQ,wBAAwB0D,EAA0D,CAExF,GAAI,CAACA,EAAc,kBAAmB,OAAO,KAE7C,MAAM1D,EAAQ,KAAK,aAAa,MAChC,IAAIiK,EAAa,EACbrN,EAAQ,SACRnB,EAAO,GA2BX,GAxBIiI,EAAc,oBAAsB,WAElC1D,IAAU,UACZiK,EAAa,EACbrN,EAAQ,SACRnB,EAAO,KACEuE,IAAU,gBACnBiK,EAAa,EACbrN,EAAQ,SACRnB,EAAO,MAEAiI,EAAc,oBAAsB,cAEzC1D,IAAU,UACZiK,EAAa,GACbrN,EAAQ,SACRnB,EAAO,KACEuE,IAAU,gBACnBiK,EAAa,GACbrN,EAAQ,QACRnB,EAAO,OAIPwO,IAAe,EAAG,OAAO,KAE7B,MAAMxP,EAAY,KAAK,IAAI,UAAU,GAAI,EAAE,EAGrCC,EAAK,KAAK,IAAI,UAAU,EAAG,EAAG,GAAI,GAAIkC,EAAO,EAAG,EACtDlC,EAAG,eAAe,EAAGkC,CAAK,EAG1B,MAAMvC,EAAO,KAAK,IAAI,KACpB,EAAG,EACH,GAAGoB,CAAI,GAAG,KAAK,IAAIwO,CAAU,CAAC,GAC9B,CACE,WAAY,eACZ,SAAU,OACV,MAAO,IAAIrN,EAAM,SAAS,EAAE,EAAE,SAAS,EAAG,GAAG,CAAC,GAC9C,UAAW,MAAA,CACb,EACA,UAAU,EAAG,EAEf,OAAAnC,EAAU,IAAI,CAACC,EAAIL,CAAI,CAAC,EACjBI,CACT,CAKQ,qBAAqBsM,EAAkDrD,EAA2B,CACxG,MAAM1I,EAAS+L,EAAmB,KAAK,CAAC,EACxC,GAAI,CAAC/L,EAAQ,OAEb,IAAIkP,EAAc,GAClB,MAAMlK,EAAQ,KAAK,aAAa,MAwBhC,GAtBI0D,EAAc,oBAAsB,YACtCwG,EAAc;AAAA,EACVlK,IAAU,SACZkK,GAAe;AAAA,eACNlK,IAAU,cACnBkK,GAAe;AAAA,eAEfA,GAAe;AAAA,cAERxG,EAAc,oBAAsB,aAC7CwG,EAAc;AAAA,EACVlK,IAAU,SACZkK,GAAe;AAAA,aACNlK,IAAU,cACnBkK,GAAe;AAAA,cAEfA,GAAe;AAAA,YAERxG,EAAc,oBAAsB,aAC7CwG,EAAc;AAAA;AAAA,gBAGZ,CAACA,EAAa,OAGlB,MAAMC,EAAmB,KAAK,IAAI,UAAU,EAAG,IAAI,EACnDA,EAAiB,WAAW,EAAK,EACjCA,EAAiB,SAAS,GAAI,EAE9B,MAAMzP,EAAK,KAAK,IAAI,UAAU,EAAG,EAAG,IAAK,GAAI,EAAU,EAAG,EAC1DA,EAAG,eAAe,EAAG,QAAQ,EAE7B,MAAML,EAAO,KAAK,IAAI,KACpB,EAAG,EACH6P,EACA,CACE,WAAY,eACZ,SAAU,OACV,MAAO,UACP,MAAO,SACP,YAAa,CAAA,CACf,EACA,UAAU,EAAG,EAEfC,EAAiB,IAAI,CAACzP,EAAIL,CAAI,CAAC,EAC/B0M,EAAmB,IAAIoD,CAAgB,EAGvCnP,EAAO,eAAA,EACPA,EAAO,GAAG,cAAe,IAAM,CAC7BmP,EAAiB,WAAW,EAAI,EAChC,KAAK,OAAO,IAAI,CACd,QAASA,EACT,MAAO,EACP,SAAU,GAAA,CACX,CACH,CAAC,EAEDnP,EAAO,GAAG,aAAc,IAAM,CAC5B,KAAK,OAAO,IAAI,CACd,QAASmP,EACT,MAAO,EACP,SAAU,IACV,WAAY,IAAMA,EAAiB,WAAW,EAAK,CAAA,CACpD,CACH,CAAC,CACH,CAKQ,wBAAwBpO,EAA4C,CAC1E,GAAI,CAAC,KAAK,yBAA0B,OAEpC,KAAK,sBAAwBA,EAG7B,MAAMqO,EAAmBrO,IAAkB,aAAe,OAAS,OAC7DsO,EAAc,KAAK,IAAI,KAC3B,EAAG,IACH,GAAGD,CAAgB,UACnB,CACE,WAAY,eACZ,SAAU,OACV,MAAO,UACP,UAAW,MAAA,CACb,EACA,UAAU,EAAG,EACfC,EAAY,SAAS,CAAC,EACtB,KAAK,yBAAyB,IAAIA,CAAW,EAG7C,KAAK,OAAO,IAAI,CACd,QAASA,EACT,MAAO,EACP,MAAO,IACP,SAAU,IACV,KAAM,GACN,KAAM,QAAA,CACP,EAGD,KAAK,KAAK,YAAY,IAAM,IAAM,CAChC,KAAK,2BAA2B,IAAM,CAEpC,MAAMC,EAAc,KAAK,uBAAuBvO,CAAa,EAC7D,KAAK,kBAAkBuO,CAAW,CACpC,CAAC,CACH,CAAC,CACH,CAKQ,2BAA2BC,EAA+B,CAC3D,KAAK,0BAEV,KAAK,OAAO,IAAI,CACd,QAAS,KAAK,yBACd,MAAO,EACP,MAAO,GACP,SAAU,IACV,KAAM,SACN,WAAY,IAAM,QAChBhM,EAAA,KAAK,2BAAL,MAAAA,EAA+B,UAC/B,KAAK,yBAA2B,OAC5BgM,GAAYA,EAAA,CAClB,CAAA,CACD,CACH,CAKQ,uBAAuBxO,EAA8C,CAW3E,MADiB,CAAC,GARQkD,EAAY,6BAA6B,KAAK,aAAa,KAAK,EAGlD,OAAOrE,GAC7CA,EAAK,eAAiBmB,CAAA,CAIU,EAAE,KAAK,IAAM,KAAK,OAAA,EAAW,EAAG,EAClD,MAAM,EAAG,CAAC,CAC5B,CAKQ,kBAAkBuO,EAA2B,CAE/C,KAAK,iBACP,KAAK,gBAAgB,QAAA,EAIvB,KAAK,gBAAkB,KAAK,IAAI,UAAU,KAAK,QAAS,KAAK,OAAO,EACpE,KAAK,gBAAgB,SAAS,GAAI,EAGlC,MAAMtN,EAAU,KAAK,IAAI,UACvB,EAAG,EACH,KAAK,UAAW,KAAK,WACrB,EAAU,EAAA,EAEZA,EAAQ,UAAU,EAAG,EAGrB,MAAMwK,EAAY,KAAK,IAAI,KACzB,EAAG,KACH,iBACA,CACE,WAAY,eACZ,SAAU,OACV,MAAO,UACP,UAAW,MAAA,CACb,EACA,UAAU,EAAG,EAGTR,EAAW,KAAK,IAAI,KACxB,EAAG,KACH,kBACA,CACE,WAAY,eACZ,SAAU,OACV,MAAO,SAAA,CACT,EACA,UAAU,EAAG,EAEf,KAAK,gBAAgB,IAAI,CAAChK,EAASwK,EAAWR,CAAQ,CAAC,EAGvDsD,EAAY,QAAQ,CAAC1P,EAAMgD,IAAU,CACnC,KAAK,qBAAqBhD,EAAMgD,CAAK,CACvC,CAAC,EAGD,KAAK,gBAAgB,SAAS,CAAC,EAC/B,KAAK,OAAO,IAAI,CACd,QAAS,KAAK,gBACd,MAAO,EACP,SAAU,IACV,KAAM,QAAA,CACP,EAGD,KAAK,oBAAA,CACP,CAKQ,qBAAqBhD,EAAYgD,EAAqB,CAC5D,GAAI,CAAC,KAAK,gBAAiB,OAE3B,MAAM4M,EAAc,IAGdC,EADS,GAAoBD,EAAc,EAC1B5M,EAAQ4M,EAEzB7M,EAAgB,KAAK,IAAI,UAAU8M,EAAO,CAAC,EACjD9M,EAAc,SAAS,GAAG,EAG1B,MAAM3C,EAAS,KAAK,IAAI,MAAM,EAAG,EAAG,KAAK,gBAAgBJ,EAAK,IAAI,CAAC,EACnEI,EAAO,eAAA,EAGP,MAAMU,EAAW,KAAK,IAAI,KACxB,EAAG,IACHd,EAAK,KACL,CACE,WAAY,eACZ,SAAU,OACV,MAAO,UACP,UAAW,OACX,SAAU,CAAE,MAAO,GAAA,CAAI,CACzB,EACA,UAAU,EAAG,EAGT8P,EAAW,KAAK,IAAI,KACxB,EAAG,IACH9P,EAAK,YACL,CACE,WAAY,eACZ,SAAU,OACV,MAAO,UACP,SAAU,CAAE,MAAO,GAAA,EACnB,MAAO,QAAA,CACT,EACA,UAAU,EAAG,EAGTkB,EAAY,KAAK,IAAI,KACzB,IAAK,GACL,GAAGlB,EAAK,KAAK,GACb,CACE,WAAY,eACZ,SAAU,OACV,MAAO,UACP,UAAW,MAAA,CACb,EACA,UAAU,EAAG,EAGf,IAAI+P,EACA/P,EAAK,WACP+P,EAAe,KAAK,IAAI,KACtB,GAAI,GACJ,MAAM/P,EAAK,QAAQ,GACnB,CACE,WAAY,eACZ,SAAU,OACV,MAAO,UACP,UAAW,MAAA,CACb,EACA,UAAU,EAAG,GAIjB,IAAIgQ,EACJ,GAAIhQ,EAAK,aAAc,CACrB,MAAMiQ,EAAgBjQ,EAAK,eAAiB,aAAe,KAAO,QAClEgQ,EAAe,KAAK,IAAI,KACtB,EAAG,GACHC,EACA,CACE,WAAY,eACZ,SAAU,OACV,MAAOjQ,EAAK,eAAiB,aAAe,UAAY,UACxD,UAAW,MAAA,CACb,EACA,UAAU,EAAG,CACjB,CAGA,GAAIA,EAAK,eAAiB,aAAc,CAEtC,MAAMkQ,EAAW,KAAK,IAAI,UAAU,EAAG,EAAGhQ,EAAe,WAAa,GAAIA,EAAe,YAAc,GAAI,SAAU,EAAG,EACxHgQ,EAAS,SAAS,EAAG,EACrBnN,EAAc,MAAMmN,EAAU,CAAC,EAE/B,KAAK,OAAO,IAAI,CACd,QAASA,EACT,MAAO,GACP,MAAO,IACP,SAAU,KACV,KAAM,GACN,OAAQ,GACR,KAAM,gBAAA,CACP,CACH,MAAWlQ,EAAK,eAAiB,QAE/BI,EAAO,eAAe,EAAG,QAAQ,EAInC,MAAMgP,EAAe,KAAK,aACxB,EAAG,IACH,KACA,IAAM,KAAK,eAAepP,CAAI,EAC9B,CACE,WAAY,eACZ,SAAU,OACV,MAAO,SAAA,CACT,EAIFI,EAAO,GAAG,cAAe,IAAM,CAC7B2C,EAAc,SAAS,GAAG,EAC1B,KAAK,OAAO,IAAI,CACd,QAASA,EACT,EAAG,IACH,SAAU,IACV,KAAM,QAAA,CACP,CACH,CAAC,EAED3C,EAAO,GAAG,aAAc,IAAM,CAC5B2C,EAAc,SAAS,GAAG,EAC1B,KAAK,OAAO,IAAI,CACd,QAASA,EACT,EAAG,EACH,SAAU,IACV,KAAM,QAAA,CACP,CACH,CAAC,EAGD3C,EAAO,GAAG,cAAe,IAAM,CAC7B,KAAK,eAAeJ,CAAI,CAC1B,CAAC,EAED,MAAMoI,EAAe,CAAChI,EAAQU,EAAUgP,EAAU5O,EAAWkO,CAAY,EACrEW,GAAc3H,EAAa,KAAK2H,CAAY,EAC5CC,GAAc5H,EAAa,KAAK4H,CAAY,EAEhDjN,EAAc,IAAIqF,CAAY,EAC9B,KAAK,gBAAgB,IAAIrF,CAAa,CACxC,CAKQ,eAAe/C,EAAkB,OACvC,GAAI,CAAC,KAAK,gBAAiB,OAK3B,MAAMmQ,EAFmB,KAAK,aAAa,oBAAA,EACL,OACL,EAG7BA,EAAY,IAAM,GACpB,KAAK,2BAA2BA,CAAS,EAI3C,MAAMC,EAAoB,KAAK,gBAAgB,KAAK,KAAK5M,GAChDA,aAAiB,OAAO,YAAY,WACpCA,EAAM,KAAK,eACT,OAAA6M,aAAmB,OAAO,YAAY,SACtC1M,EAAA0M,EAAQ,QAAR,YAAA1M,EAAe,SAAA,CAEzB,EAGGyM,GACF,KAAK,OAAO,IAAI,CACd,QAASA,EACT,OAAQ,IACR,OAAQ,IACR,SAAU,IACV,KAAM,GACN,KAAM,QAAA,CACP,EAIH,KAAK,aAAa,WAAWpQ,EAAK,EAAE,GAGpC2D,EAAA,KAAK,eAAL,MAAAA,EAAmB,KAAK,gBAGxB,KAAK,6BAA6B3D,EAAM,IAAM,CAE5C,KAAK,kBAAA,CACP,CAAC,CACH,CAKQ,2BAA2BsQ,EAA8B,CAC/D,MAAMC,EAAe,KAAK,MAAMD,EAAiB,CAAC,EAC5CrC,EAAmB,KAAK,IAAI,UAAU,KAAK,QAAS,GAAG,EAC7DA,EAAiB,SAAS,IAAI,EAE9B,MAAMnO,EAAK,KAAK,IAAI,UAAU,EAAG,EAAG,IAAK,IAAK,SAAU,GAAI,EAC5DA,EAAG,eAAe,EAAG,QAAQ,EAG7B,MAAMoO,EAAW,KAAK,IAAI,KACxB,KAAM,EACN,KACA,CACE,WAAY,eACZ,SAAU,OACV,MAAO,SAAA,CACT,EACA,UAAU,EAAG,EAGTtB,EAAY,KAAK,IAAI,KACzB,GAAI,IACJ,eACA,CACE,WAAY,eACZ,SAAU,OACV,MAAO,UACP,UAAW,MAAA,CACb,EACA,UAAU,EAAG,EAETE,EAAa,KAAK,IAAI,KAC1B,GAAI,GACJ,KAAKwD,CAAc,SAASC,CAAY,aACxC,CACE,WAAY,eACZ,SAAU,OACV,MAAO,SAAA,CACT,EACA,UAAU,EAAG,EAETC,EAAa,KAAK,IAAI,KAC1B,GAAI,GACJ,uBACA,CACE,WAAY,eACZ,SAAU,OACV,MAAO,SAAA,CACT,EACA,UAAU,EAAG,EAEfvC,EAAiB,IAAI,CAACnO,EAAIoO,EAAUtB,EAAWE,EAAY0D,CAAU,CAAC,EACtEvC,EAAiB,SAAS,CAAC,EAC3BA,EAAiB,SAAS,CAAC,EAG3B,KAAK,OAAO,IAAI,CACd,QAASA,EACT,MAAO,IACP,MAAO,EACP,SAAU,IACV,KAAM,eACN,WAAY,IAAM,CAEhB,KAAK,OAAO,IAAI,CACd,QAASA,EACT,MAAO,GACP,SAAU,IACV,KAAM,GACN,OAAQ,EACR,KAAM,iBACN,WAAY,IAAM,CAEhB,KAAK,KAAK,YAAY,IAAM,IAAM,CAChC,KAAK,OAAO,IAAI,CACd,QAASA,EACT,MAAO,GACP,MAAO,EACP,SAAU,IACV,KAAM,SACN,WAAY,IAAMA,EAAiB,QAAA,CAAQ,CAC5C,CACH,CAAC,CACH,CAAA,CACD,CACH,CAAA,CACD,EAGD,MAAMwC,EAAe,KAAK,IAAI,UAC5B,KAAK,QACL,KAAK,QACL,KAAK,UACL,KAAK,WACL,SACA,EAAA,EAEFA,EAAa,SAAS,GAAI,EAE1B,KAAK,OAAO,IAAI,CACd,QAASA,EACT,MAAO,EACP,SAAU,IACV,WAAY,IAAMA,EAAa,QAAA,CAAQ,CACxC,CACH,CAKQ,6BAA6BzQ,EAAY2P,EAA8B,CAE7E,MAAMe,EAAqB,KAAK,IAAI,UAAU,KAAK,QAAS,KAAK,OAAO,EACxEA,EAAmB,SAAS,GAAI,EAEhC,MAAMtQ,EAAS,KAAK,IAAI,MAAM,EAAG,EAAG,KAAK,gBAAgBJ,EAAK,IAAI,CAAC,EACnEI,EAAO,SAAS,CAAC,EAEjB,MAAMU,EAAW,KAAK,IAAI,KACxB,EAAG,KACHd,EAAK,KACL,CACE,WAAY,eACZ,SAAU,OACV,MAAO,UACP,UAAW,MAAA,CACb,EACA,UAAU,EAAG,EAET2Q,EAAe,KAAK,IAAI,KAC5B,EAAG,IACH,eACA,CACE,WAAY,eACZ,SAAU,OACV,MAAO,UACP,UAAW,MAAA,CACb,EACA,UAAU,EAAG,EAEfD,EAAmB,IAAI,CAACtQ,EAAQU,EAAU6P,CAAY,CAAC,EAGvD,KAAK,OAAO,IAAI,CACd,QAASD,EACT,MAAO,IACP,SAAU,IACV,KAAM,GACN,OAAQ,EACR,KAAM,SACN,WAAY,IAAM,CAEhB,KAAK,OAAO,IAAI,CACd,QAASA,EACT,MAAO,EACP,MAAO,GACP,SAAU,IACV,KAAM,SACN,WAAY,IAAM,CAChBA,EAAmB,QAAA,EACnBf,EAAA,CACF,CAAA,CACD,CACH,CAAA,CACD,CACH,CAKQ,mBAA0B,CAC3B,KAAK,iBAEV,KAAK,OAAO,IAAI,CACd,QAAS,KAAK,gBACd,MAAO,EACP,MAAO,GACP,SAAU,IACV,KAAM,SACN,WAAY,IAAM,QAChBhM,EAAA,KAAK,kBAAL,MAAAA,EAAsB,UACtB,KAAK,gBAAkB,OAGvB,KAAK,mBAAA,EAGL,KAAK,WAAW,SAAW,GAC3B,KAAK,WAAW,cAAgB,GAChC,KAAK,SAAA,CACP,CAAA,CACD,CACH,CAKQ,4BAAmC,CAEzC,MAAM+I,EAAY,CAChB,KAAM,KAAK,aAAa,KACxB,cAAe,CAAC,GAAG,KAAK,aAAa,aAAa,EAClD,MAAO,KAAK,aAAa,MACzB,KAAM,KAAK,aAAa,KACxB,SAAU,KAAK,aAAa,SAC5B,YAAa,KAAK,aAAa,YAC/B,eAAgB,KAAK,aAAa,eAClC,OAAQ,KAAK,aAAa,OAC1B,oBAAqB,IAAA,EAGtB,OAAuD,YAAcA,EACtE,KAAK,KAAK,IAAI,YAAaA,CAAS,CACtC,CAKQ,qBAA4B,CAClC,MAAMpF,EAAgB,KAAK,SAAS,UAAU,gBAAgB,EAC9D,GAAI,CAACA,EAAe,OAEpB,MAAML,EAAaK,EAAc,UAAU,aAAa,EAClDJ,EAAkBI,EAAc,UAAU,kBAAkB,EAC5DH,EAAgBG,EAAc,UAAU,iBAAiB,EAEzDD,EAAQ,KAAK,aAAa,MAC1BuJ,EAAe,KAAK,aAAa,aAAA,EAGnC3J,GACF,KAAK,iBAAiBA,EAAY2J,GAAgBvJ,IAAU,MAAM,EAGhEH,GACF,KAAK,iBAAiBA,EAAiB0J,GAAgBvJ,IAAU,QAAU,CAAC,KAAK,aAAa,gBAAgB,EAG5GF,GAEF,KAAK,iBAAiBA,EAAeyJ,IAAiBvJ,IAAU,QAAUA,IAAU,aAAa,CAErG,CAKQ,sBACN9H,EACAC,EACAC,EACAC,EACAC,EAC8B,CAC9B,MAAME,EAAY,KAAK,IAAI,UAAUN,EAAGC,CAAC,EAGnCM,EAAK,KAAK,IAAI,UAAU,EAAG,EAAG,IAAK,GAAI,OAAQ,EACrDA,EAAG,eAAe,CAAE,cAAe,EAAA,CAAM,EAGzC,MAAM+Q,EAAU,KAAK,IAAI,KAAK,EAAG,EAAGpR,EAAME,GAAS,CACjD,WAAY,eACZ,SAAU,OACV,MAAO,SAAA,CACR,EACD,OAAAkR,EAAQ,UAAU,EAAG,EAErBhR,EAAU,IAAI,CAACC,EAAI+Q,CAAO,CAAC,EAG3B/Q,EAAG,GAAG,cAAe,IAAM,QAEzB6D,EAAA,KAAK,eAAL,MAAAA,EAAmB,KAAK,eACxBjE,EAAA,CACF,CAAC,EAGDI,EAAG,GAAG,cAAe,IAAM,OACzBA,EAAG,aAAa,OAAQ,EACxBD,EAAU,SAAS,IAAI,GAEvB8D,EAAA,KAAK,eAAL,MAAAA,EAAmB,KAAK,cAC1B,CAAC,EAED7D,EAAG,GAAG,aAAc,IAAM,CACxBA,EAAG,aAAa,OAAQ,EACxBD,EAAU,SAAS,CAAC,CACtB,CAAC,EAEMA,CACT,CAKQ,iBAAiBD,EAAsCkR,EAAwB,CACrF,GAAI,EAAClR,GAAA,MAAAA,EAAQ,OAAQA,EAAO,KAAK,OAAS,EAAG,CAC3C,QAAQ,KAAK,0BAA0B,EACvC,MACF,CAEA,MAAMmR,EAAWnR,EAAO,KAAK,CAAC,EACxBG,EAAaH,EAAO,KAAK,CAAC,EAEhC,GAAI,CAACmR,GAAY,CAAChR,EAAY,CAC5B,QAAQ,KAAK,6BAA6B,EAC1C,MACF,CAEI+Q,GACFC,EAAS,aAAa,OAAQ,EAC9BhR,EAAW,SAAS,SAAS,EAC7BgR,EAAS,eAAA,IAETA,EAAS,aAAa,OAAQ,EAC9BhR,EAAW,SAAS,SAAS,EAC7BgR,EAAS,mBAAA,EAEb,CAKQ,oBAA2B,CAEjC,MAAM3F,EAAe,KAAK,SAAS,UAAU,eAAe,EACxDA,GACFA,EAAa,QAAA,EAIf,MAAM4F,EAAgB,KAAK,SAAS,UAAU,0BAA0B,EACpEA,GACFA,EAAc,QAAA,EAIhB,MAAM9E,EAAgB,KAAK,SAAS,UAAU,gBAAgB,EAC1DA,GACFA,EAAc,QAAA,EAIhB,KAAK,mBAAA,CACP,CAKQ,oBAA2B,CACjC,KAAK,UAAU,QAAQnJ,GAAiB,CAEtC,GAAIA,EAAc,QAAQ,UAAU,EAAG,CACrCA,EAAc,QAAQ,WAAY,EAAK,EACvCA,EAAc,SAAS,CAAC,EAGxB,MAAM4D,EAAY5D,EAAc,UAAU,WAAW,EACjD4D,GACFA,EAAU,QAAA,CAEd,CACF,CAAC,EAGD,KAAK,cAAc,MAAA,CACrB,CAKQ,YAAYsK,EAA0B,CAE5C,MAAMC,EAAa,SAAS,eAAe,gBAAgB,EACvDA,IACED,EACF,KAAK,iBAAiB,qBAAqBC,CAAU,EAErD,KAAK,iBAAiB,oBAAoBA,CAAU,GAKxD,KAAK,KAAK,YAAY,IAAM,IAAM,CAChC,MAAMC,EAAe,KAAK,IAAI,UAAU,KAAK,QAAS,KAAK,OAAO,EAE5DrR,EAAK,KAAK,IAAI,UAAU,EAAG,EAAG,KAAK,UAAW,KAAK,WAAY,EAAU,EAAG,EAE5E8M,EAAY,KAAK,IAAI,KACzB,EACA,KACAqE,EAAY,QAAU,UACtB,CACE,WAAY,eACZ,SAAU,OACV,MAAOA,EAAY,UAAY,UAC/B,UAAW,MAAA,CACb,EACA,UAAU,EAAG,EAETG,EAAQ,KAAK,aAAa,MAC1BC,EAAY,KAAK,IAAI,KACzB,EACA,EACA,SAAS,KAAK,aAAa,QAAQ;AAAA,SACzBD,EAAM,WAAW;AAAA,YACdA,EAAM,oBAAoB,IAAIA,EAAM,eAAe;AAAA,QACvDA,EAAM,eAAe,GAC9B,CACE,WAAY,eACZ,SAAU,OACV,MAAO,UACP,MAAO,SACP,YAAa,EAAA,CACf,EACA,UAAU,EAAG,EAETE,EAAc,KAAK,aACvB,KACA,IACA,OACA,IAAM,CACJ,KAAK,MAAM,QAAA,CACb,EACA,CACE,WAAY,eACZ,SAAU,OACV,MAAO,SAAA,CACT,EAGIC,EAAa,KAAK,aACtB,IACA,IACF,QACA,IAAM,CACJ,KAAK,MAAM,MAAM,eAAe,CAClC,EACA,CACE,WAAY,eACZ,SAAU,OACV,MAAO,SAAA,CACT,EAGFJ,EAAa,IAAI,CAACrR,EAAI8M,EAAWyE,EAAWC,EAAaC,CAAU,CAAC,EACpEJ,EAAa,SAAS,GAAI,EAC1BA,EAAa,SAAS,CAAC,EAGrB,KAAK,OAAO,IAAI,CACd,QAASA,EACT,MAAO,EACP,SAAU,GAAA,CACX,CACH,CAAC,CACH,CAKQ,iBAAiBK,EAAiB9O,EAAuC,OAAc,CAC7F,MAAM+O,EAAwB,KAAK,IAAI,UAAU,KAAK,QAAS,GAAG,EAClEA,EAAsB,SAAS,IAAI,EAEnC,MAAMC,EAAS,CACb,KAAM,QACN,QAAS,SACT,QAAS,OAAA,EAGL5R,EAAK,KAAK,IAAI,UAAU,EAAG,EAAG,IAAK,GAAI4R,EAAOhP,CAAI,EAAG,EAAG,EAC9D5C,EAAG,eAAe,EAAG,QAAQ,EAE7B,MAAML,EAAO,KAAK,IAAI,KACpB,EAAG,EACH+R,EACA,CACE,WAAY,eACZ,SAAU,OACV,MAAO,UACP,UAAW,MAAA,CACb,EACA,UAAU,EAAG,EAEfC,EAAsB,IAAI,CAAC3R,EAAIL,CAAI,CAAC,EACpCgS,EAAsB,SAAS,CAAC,EAChCA,EAAsB,SAAS,CAAC,EAGhC,KAAK,OAAO,IAAI,CACd,QAASA,EACT,MAAO,EACP,MAAO,EACP,SAAU,IACV,KAAM,eACN,WAAY,IAAM,CAEhB,KAAK,KAAK,YAAY,IAAM,IAAM,CAChC,KAAK,OAAO,IAAI,CACd,QAASA,EACT,MAAO,GACP,MAAO,EACP,SAAU,IACV,KAAM,SACN,WAAY,IAAMA,EAAsB,QAAA,CAAQ,CACjD,CACH,CAAC,CACH,CAAA,CACD,CACH,CAMQ,2BAA2BE,EAA8B,CAE/D,QAAQ,KAAK,8CAA8C,CA2I7D,CAKQ,oBACNpS,EACAC,EACAsF,EACA8M,EACA5P,EACA3C,EACAyR,EACM,CACN,GAAI,CAAC,KAAK,yBAA0B,OAEpC,MAAM9J,EAAkB,KAAK,IAAI,UAAUzH,EAAGC,CAAC,EAGzCuR,EAAW,KAAK,IAAI,UAAU,EAAG,EAAG,IAAK,IAAK/O,CAAK,EACzD+O,EAAS,eAAe,EAAGD,EAAU,SAAW,OAAQ,EAEpDA,GACFC,EAAS,eAAA,EAIX,MAAMnE,EAAY,KAAK,IAAI,KACzB,EAAG,IACH9H,EACA,CACE,WAAY,eACZ,SAAU,OACV,MAAOgM,EAAU,UAAY,UAC7B,UAAW,MAAA,CACb,EACA,UAAU,EAAG,EAGTe,EAAe,KAAK,IAAI,KAC5B,EAAG,GACHD,EACA,CACE,WAAY,eACZ,SAAU,OACV,MAAOd,EAAU,UAAY,SAAA,CAC/B,EACA,UAAU,EAAG,EAEXA,IAEFC,EAAS,GAAG,cAAe,IAAM,CAC/B/J,EAAgB,SAAS,IAAI,EAC7B+J,EAAS,aAAa,OAAO,QAAQ,MAAM,aAAa/O,CAAK,EAAE,SAAS,EAAE,EAAE,KAAK,CACnF,CAAC,EAED+O,EAAS,GAAG,aAAc,IAAM,CAC9B/J,EAAgB,SAAS,CAAC,EAC1B+J,EAAS,aAAa/O,CAAK,CAC7B,CAAC,EAGD+O,EAAS,GAAG,cAAe,IAAM,CAE/B/J,EAAgB,SAAS,GAAI,EAE7B,KAAK,KAAK,YAAY,IAAK,IAAM,CAC/BA,EAAgB,SAAS,CAAC,EAC1B3H,EAAA,CACF,CAAC,CACH,CAAC,GAGH2H,EAAgB,IAAI,CAAC+J,EAAUnE,EAAWiF,CAAY,CAAC,EACvD,KAAK,yBAAyB,IAAI7K,CAAe,CACnD,CAKQ,kBAAkB2K,EAAuCG,EAA4B,CAEvF,KAAK,0BACP,KAAK,OAAO,IAAI,CACd,QAAS,KAAK,yBACd,MAAO,EACP,MAAO,GACP,SAAU,IACV,KAAM,SACN,WAAY,IAAM,QAChBnO,EAAA,KAAK,2BAAL,MAAAA,EAA+B,UAC/B,KAAK,yBAA2B,MAClC,CAAA,CACD,EAGH,GAAI,CACF,IAAI8I,EACAqF,EACFrF,EAAS,KAAK,aAAa,eAAekF,EAAc,MAAM,EAE9DlF,EAAS,KAAK,aAAa,gBAAgBkF,EAAc,MAAM,EAIjE,MAAMI,EAActF,EAAO,SAAW,UAAY,UAAY,UAC9D,KAAK,iBAAiBA,EAAO,QAASsF,CAAW,EAGjD,KAAK,KAAK,YAAY,IAAK,IAAM,CAC/B,KAAK,uBAAA,EACL,KAAK,sBAAA,EAGL,KAAK,2BAAA,CACP,CAAC,CAEH,OAASC,EAAO,CACd,QAAQ,MAAM,2BAA4BA,CAAK,EAC/C,KAAK,iBAAiB,kBAAmB,OAAO,CAClD,CACF,CAKQ,sBAA+B,CAGrC,OAFc,KAAK,aAAa,MAExB,CACN,IAAK,QACH,MAAO,mBACT,IAAK,SACH,MAAO,sBACT,IAAK,cACH,MAAO,wBACT,QACE,MAAO,kBAAA,CAEb,CAMQ,4BAAmC,CAG3C,CASQ,oBAA2B,CACjC,GAAI,CAEF,KAAK,gBAAkB,IAAIC,EAAgB,KAAM,CAC/C,UAAW,GACX,iBAAkB,GAClB,gBAAiB,IACjB,wBAAyB,CACvB,MAAO,UACP,QAAS,GACT,YAAa,EACb,YAAa,UACb,WAAY,GACZ,cAAe,QACf,SAAU,IAAA,CACZ,CACD,EAGD,KAAK,gBAAkB,IAAIC,EAAgB,IAAI,EAC/C,KAAK,gBAAgB,WAAW,EAAK,EAGrC,KAAK,yBAAA,EAGL,KAAK,4BAAA,CASP,OAASF,EAAO,CACd,QAAQ,MAAM,kCAAmCA,CAAK,CACxD,CACF,CAKQ,0BAAiC,CAEnC,KAAK,UAAU,OAAS,GAC1B,KAAK,qBAAqB,IAAI,YAAa,KAAK,UAAU,CAAC,EAAE,iBAAmB,KAAK,UAAU,CAAC,CAAC,EAI/F,KAAK,sBACP,KAAK,qBAAqB,IAAI,eAAgB,KAAK,oBAAoB,EAIrE,KAAK,wBACP,KAAK,qBAAqB,IAAI,iBAAkB,KAAK,sBAAsB,EAIzE,KAAK,0BACP,KAAK,qBAAqB,IAAI,mBAAoB,KAAK,wBAAwB,CAEnF,CAKQ,6BAAoC,CACrC,KAAK,kBAEV,KAAK,gBAAgB,GAAG,mBAAqB9N,GAAS,OACpD,KAAK,eAAiB,IACtBP,EAAA,KAAK,kBAAL,MAAAA,EAAsB,WAAW,GAEnC,CAAC,EAED,KAAK,gBAAgB,GAAG,sBAAwBO,GAAS,CACvD,KAAK,wBAAwBA,CAAI,CACnC,CAAC,EAED,KAAK,gBAAgB,GAAG,qBAAsB,IAAM,QAClDP,EAAA,KAAK,kBAAL,MAAAA,EAAsB,iBACxB,CAAC,EAED,KAAK,gBAAgB,GAAG,qBAAsB,IAAM,CAClD,KAAK,gBAAA,CACP,CAAC,EAED,KAAK,gBAAgB,GAAG,mBAAoB,IAAM,CAChD,KAAK,gBAAA,CACP,CAAC,EAED,KAAK,gBAAgB,GAAG,iBAAmBO,GAAS,CAClD,QAAQ,MAAM,kBAAmBA,EAAK,KAAK,EAC3C,KAAK,gBAAA,CACP,CAAC,EAGD,KAAK,MAAM,GAAG,SAAU,IAAM,QAC5BP,EAAA,KAAK,kBAAL,MAAAA,EAAsB,UACxB,CAAC,EACH,CAKQ,wBAAwBwO,EAAsB,OACpD,GAAI,CAAC,KAAK,iBAAmB,CAAC,KAAK,gBAAiB,OAEpD,MAAMC,EAAc,KAAK,gBAAgB,eAAA,EACzC,GAAI,CAACA,EAAa,OAElB,MAAM/O,EAAW,KAAK,gBAAgB,YAAA,EACtC,GAAI,CAACA,EAAU,OAGf,MAAMgP,EAAa,KAAK,gBAAgB,eAAA,KACrC1O,EAAA,KAAK,gBAAiF,gBAAtF,YAAAA,EAAqG,MAAM,SAAU,EACxH,KAAK,gBAAgB,kBAAkBN,EAAUgP,CAAU,EAG3D,IAAIC,EACJ,GAAIF,EAAY,cAAe,CAC7B,MAAMG,EAAgB,KAAK,qBAAqB,IAAIH,EAAY,aAAa,GACzD,KAAK,SAAS,UAAUA,EAAY,aAAa,EAEjEG,GAAA,MAAAA,EAAe,YACjBD,EAAeC,EAAc,UAAA,EAG7B,KAAK,gBAAgB,gBAAgBA,CAAa,EAGlD,KAAK,gBAAgB,iBACnBH,EAAY,cACZA,EAAY,gBAAA,EAGlB,CAGA,KAAK,gBAAgB,mBAAmBA,EAAaE,CAAY,EAGjE,MAAME,EAAYnP,EAAS,iBAAmB,EAG9C,KAAK,gBAAgB,qBACnBmP,EAHc,GAKd,WAAM,OAAA7O,EAAA,KAAK,kBAAL,YAAAA,EAAsB,YAC5B6O,EAAY,IAAA,OAAM,OAAA7O,EAAA,KAAK,kBAAL,YAAAA,EAAsB,gBAAiB,OACzD,IAAA,OAAM,OAAAA,EAAA,KAAK,kBAAL,YAAAA,EAAsB,eAAa,EAI3C,KAAK,gBAAgB,uBACnB,WAAM,OAAAA,EAAA,KAAK,kBAAL,YAAAA,EAAsB,YAC5B6O,EAAY,IAAA,OAAM,OAAA7O,EAAA,KAAK,kBAAL,YAAAA,EAAsB,gBAAiB,OACzD,IAAA,OAAM,OAAAA,EAAA,KAAK,kBAAL,YAAAA,EAAsB,eAAa,EAIvCyO,EAAY,SAAW,QAAUA,EAAY,UAC/C,KAAK,KAAK,YAAYA,EAAY,SAAU,IAAM,QAChDzO,EAAA,KAAK,kBAAL,MAAAA,EAAsB,UACxB,CAAC,CAEL,CAKQ,iBAAwB,CAC9B,KAAK,eAAiB,GAElB,KAAK,kBACP,KAAK,gBAAgB,WAAW,EAAK,EACrC,KAAK,gBAAgB,gBAAA,GAIvB,KAAK,gBAAA,CAGP,CAKQ,mBAA0B,CAIhC,KAAK,cAAc8O,CAAyB,EACzC,KAAK,IAAM,CAEZ,CAAC,EACA,MAAOT,GAAU,CAChB,QAAQ,MAAM,4BAA6BA,CAAK,CAClD,CAAC,CACL,CAKO,cAAcU,EAAuC,CAC1D,OAAK,KAAK,gBAKN,KAAK,gBAAgB,YAAYA,EAAO,EAAE,EAErC,QAAQ,QAAA,GAIjB,KAAK,8BAAA,EAEE,KAAK,gBAAgB,cAAcA,CAAM,GAZvC,QAAQ,OAAO,IAAI,MAAM,kCAAkC,CAAC,CAavE,CAKQ,+BAAsC,CAE5C,KAAK,iBAAmB,GAGxB,KAAK,qBAAA,CACP,CAKQ,sBAA6B,CAGrC,CAKQ,iBAAwB,CAGhC,CAKO,wBAAwBC,EAActC,EAA8C,CACzF,KAAK,qBAAqB,IAAIsC,EAAMtC,CAAO,CAC7C,CAKO,kBAA4B,CACjC,OAAO,KAAK,cACd,CAKO,wBAA8C,OACnD,QAAO1M,EAAA,KAAK,kBAAL,YAAAA,EAAsB,mBAAoB,IACnD,CAKO,cAAqB,CACtB,KAAK,iBACP,KAAK,gBAAgB,aAAA,CAEzB,CAKO,SAAgB,CAEjB,KAAK,sBACP,KAAK,oBAAoB,QAAA,EACzB,KAAK,oBAAsB,QAIzB,KAAK,qBACP,KAAK,mBAAmB,QAAA,EACxB,KAAK,mBAAqB,QAI5B,KAAK,KAAK,OAAO,IAAI,cAAc,EAGnC,MAAM,QAAA,CACR,CAOA,gBAAgBiP,EAAkB,CAChC,KAAK,aAAeA,EACpB,KAAK,sBAAsBA,EAAK,SAAUA,EAAK,gBAAgB,EAC/D,KAAK,sBAAsBA,EAAK,MAAOA,EAAK,IAAI,CAClD,CAKA,iBAAiBC,EAAqB,CACpC,KAAK,iBAAA,EACLA,EAAM,QAAQ,CAAC7S,EAAMgD,IAAU,CAC7B,KAAK,eAAehD,EAAMgD,CAAK,CACjC,CAAC,CACH,CAKA,wBAAwB8P,EAAuB,CAC7C,KAAK,uBAAuBA,CAAS,CACvC,CAKA,uBAAuBC,EAA0B,CAC/C,KAAK,oBAAoBA,CAAU,CACrC,CAKA,6BAA6BnO,EAAsB,CACjD,KAAK,sBAAsBA,CAAM,CACnC,CAKA,sBAAsBQ,EAAeiI,EAAoB,CACnD,KAAK,WACP,KAAK,UAAU,QAAQ,GAAGjI,CAAK,UAAUiI,CAAI,EAAE,CAEnD,CAKA,oBACEwF,EACAG,EACAC,EACAzB,EACAnS,EACM,CACN,KAAK,6BAA6BwT,EAAOG,EAAcC,EAAczB,EAASnS,CAAQ,CACxF,CAKA,sBACEyT,EACAzT,EACM,CACN,KAAK,+BAA+ByT,EAAWzT,CAAQ,CACzD,CAKA,yBACEwT,EACArB,EACAnS,EACM,CACN,KAAK,kCAAkCwT,EAAOrB,EAASnS,CAAQ,CACjE,CAKA,mBACEmS,EACA0B,EACA7T,EACM,CACN,KAAK,yBAAyBmS,EAAS0B,EAAe7T,CAAQ,CAChE,CAKA,uBAAuBoN,EAA+B,CACpD,KAAK,0BAA0BA,CAAM,CACvC,CAKA,YAAY+E,EAAiB2B,EAAwC,OAAc,CACjF,MAAMnR,EAAQmR,IAAU,UAAY,UAAYA,IAAU,UAAY,UAAY,UAClF,KAAK,uBAAuB3B,EAASxP,CAAK,CAC5C,CAKA,UAAUgQ,EAAqB,CAC7B,KAAK,uBAAuBA,EAAO,SAAS,CAC9C,CAKA,mBAAmBZ,EAA0B,CAC3C,KAAK,qBAAqBA,CAAK,CACjC,CAKA,kBAAkBA,EAA0B,CAC1C,KAAK,oBAAoBA,CAAK,CAChC,CAKA,qBAAqBhM,EAAegM,EAA0B,CAC5D,KAAK,uBAAuBhM,EAAOgM,CAAK,CAC1C,CAKA,cAAqB,CACnB,KAAK,WAAA,CACP,CAIQ,6BACNyB,EACAG,EACAC,EACAzB,EACAnS,EACM,CAENA,EAASwT,EAAM,MAAM,EAAG,KAAK,IAAII,EAAcJ,EAAM,MAAM,CAAC,CAAC,CAC/D,CAEQ,+BACNC,EACAzT,EACM,CAENA,EAAS,OAAO,CAClB,CAEQ,kCACNwT,EACArB,EACAnS,EACM,CAEFwT,EAAM,OAAS,GACjBxT,EAASwT,EAAM,CAAC,CAAC,CAErB,CAEQ,yBACNrB,EACA0B,EACA7T,EACM,CAENA,EAAS6T,CAAa,CACxB,CAEQ,0BAA0BzG,EAA+B,CAE/D,QAAQ,IAAI,oBAAqBA,CAAM,CACzC,CAEQ,uBAAuB+E,EAAiBxP,EAAqB,CAEnE,MAAMmM,EAAc,KAAK,IAAI,KAC3B,KAAK,QAAQ,KAAK,QAClB,KAAK,QAAQ,KAAK,QAAU,IAC5BqD,EACA,CACE,SAAU,OACV,MAAAxP,EACA,OAAQ,UACR,gBAAiB,CAAA,CACnB,EAEFmM,EAAY,UAAU,EAAG,EACzBA,EAAY,SAAS,GAAI,EAGzB,KAAK,KAAK,YAAY,IAAM,IAAM,CAChCA,EAAY,QAAA,CACd,CAAC,CACH,CAEQ,qBAAqBiD,EAA0B,CAErD,QAAQ,IAAI,aAAcA,CAAK,CACjC,CAEQ,oBAAoBA,EAA0B,CAEpD,QAAQ,IAAI,WAAYA,CAAK,CAC/B,CAEQ,uBAAuBhM,EAAegM,EAA0B,CAEtE,QAAQ,IAAI,eAAgBhM,EAAOgM,CAAK,CAC1C,CAEQ,YAAmB,CAEzB,KAAK,iBAAA,EACL,KAAK,iBAAA,CACP,CAEQ,kBAAyB,CAE3B,KAAK,oBACP,KAAK,UAAU,QAASrO,GAAkB,CACxC,KAAK,mBAAoB,2BAA2BA,CAAa,CACnE,CAAC,EAIH,KAAK,UAAU,QAAQ/C,GAAQA,EAAK,SAAS,EAC7C,KAAK,UAAY,CAAA,CACnB,CAEQ,kBAAyB,CAE3B,KAAK,kBACP,KAAK,gBAAgB,QAAA,EACrB,KAAK,gBAAkB,QAErB,KAAK,2BACP,KAAK,yBAAyB,QAAA,EAC9B,KAAK,yBAA2B,OAEpC,CAKQ,wBAA+B,OACrC,KAAK,aAAe,IAAIoT,EAAa,IAAI,GAGzCzP,EAAA,KAAK,MAAM,WAAX,MAAAA,EAAqB,GAAG,YAAa,IAAM,CACzC,GAAI,KAAK,aAAc,CACrB,MAAMmN,EAAU,CAAC,KAAK,aAAa,UAAA,EACnC,KAAK,aAAa,WAAWA,CAAO,EACpC,KAAK,aAAa,aAAA,EAClB,KAAK,YAAYA,EAAU,UAAY,WAAY,MAAM,CAC3D,CACF,EACF,CAKQ,8BAAqC,CAC1B,KAAK,SAAS,IAAI,UAAU,IAI3C,KAAK,mBAAqB,IAAIuC,EAAyB,KAAM,CAC3D,OAAQ,GACR,eAAgB,GAChB,cAAe,MACf,aAAc,EAAA,CACf,EAGD,KAAK,OAAO,GAAG,2BAA6BF,GAAqC,CAC/E,KAAK,8BAA8BA,CAAK,CAC1C,CAAC,EAEL,CAKQ,8BAA8BA,EAAwC,CAC5E,OAAQA,EAAA,CACN,IAAK,MAEH,KAAK,mBAAqB,EAC1B,KAAK,OAAO,UAAY,GACxB,MACF,IAAK,SAEH,KAAK,mBAAqB,EAC1B,KAAK,OAAO,UAAY,EACxB,MACF,IAAK,OAEH,KAAK,mBAAqB,EAC1B,KAAK,OAAO,UAAY,EACxB,KAAA,CAON,CAKU,aACR5T,EACAC,EACAC,EACAC,EACAC,EACyB,CACzB,MAAMC,EAAS,MAAM,aAAaL,EAAGC,EAAGC,EAAMC,EAASC,CAAK,EAG5D,OAAAC,EAAO,mBAAA,EAEPA,EAAO,GAAG,cAAe,IAAM,OAC7BA,EAAO,mBAAmB,SAAS,EACnCA,EAAO,SAAS,IAAI,GACpB+D,EAAA,KAAK,eAAL,MAAAA,EAAmB,KAAK,cAC1B,CAAC,EAED/D,EAAO,GAAG,aAAc,IAAM,CAC5BA,EAAO,mBAAmB,SAAS,EACnCA,EAAO,SAAS,CAAC,CACnB,CAAC,EAEDA,EAAO,GAAG,cAAe,IAAM,OAC7BA,EAAO,SAAS,GAAI,GACpB+D,EAAA,KAAK,eAAL,MAAAA,EAAmB,KAAK,cAC1B,CAAC,EAED/D,EAAO,GAAG,YAAa,IAAM,CAC3BA,EAAO,SAAS,IAAI,EACpBF,EAAA,CACF,CAAC,EAEME,CACT,CAKS,OAAOV,EAAcC,EAAqB,CAEjDqD,EAA2B,kBAAkB,KAAK,KAAMrD,CAAK,EAGzDD,EAAO,IAAQC,GACjBqD,EAA2B,uBAAuB,KAAK,IAAI,EAIzDtD,EAAO,IAAOC,GAChBqD,EAA2B,kBAAkB,KAAK,IAAI,CAE1D,CAKQ,wBAAwBjD,EAAWC,EAAW8T,EAAwB,CAC5E9Q,EAA2B,sBAAsB,KAC/C,KACAjD,EACAC,EACA8T,EAAU,UAAY,SAAA,CAE1B,CAKQ,sBAA6B,CACnC9Q,EAA2B,qBAAqB,KAAK,IAAI,CAC3D,CAKQ,SAAgB,CAEtB,KAAK,oBAAoB,UAAA,EAGzB,KAAK,OAAO,QAAA,EAGZ,KAAK,KAAK,gBAAA,EAGN,KAAK,cACP,KAAK,aAAa,QAAA,EAIhB,KAAK,oBACP,KAAK,mBAAmB,QAAA,EAItB,KAAK,qBACP,KAAK,oBAAoB,QAAA,EAIvB,KAAK,oBACP,KAAK,mBAAmB,QAAA,EAItB,KAAK,iBACP,KAAK,gBAAgB,QAAA,EAIJ,CACjB,KAAK,gBACL,KAAK,yBACL,KAAK,qBACL,KAAK,uBACL,KAAK,yBACL,KAAK,yBACL,KAAK,eAAA,EAGI,QAAQ3C,GAAa,CAC1BA,GACFA,EAAU,QAAA,CAEd,CAAC,EAGD,KAAK,UAAU,QAAQG,GAAQ,CAC7BA,EAAK,QAAA,CACP,CAAC,EACD,KAAK,UAAY,CAAA,EAGb,KAAK,aACP,OAAO,OAAO,KAAK,WAAW,EAAE,QAAQ2C,GAAQ,CAC9CA,EAAK,QAAS4Q,GAAa,CACrBA,GAAA,MAAAA,EAAK,SACPA,EAAI,QAAA,CAER,CAAC,CACH,CAAC,CAQL,CACF"}