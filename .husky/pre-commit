#!/bin/sh

# Windowsç’°å¢ƒã®å ´åˆã¯CMDãƒ•ã‚¡ã‚¤ãƒ«ã‚’å®Ÿè¡Œ
if [ "$OS" = "Windows_NT" ]; then
    cmd.exe /c ".husky\\pre-commit.cmd"
    exit $?
fi

# ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸã‚‰å³åº§ã«çµ‚äº†
set -e

echo "ğŸ” Pre-commit checks starting..."

# 1. Security checks
echo "ğŸ›¡ï¸ Running security audits..."
npm audit --audit-level moderate || echo "âš ï¸ Security vulnerabilities detected, but continuing..."

# 2. Lint check (including security rules)
echo "ğŸ“ Running ESLint with security rules..."
pnpm run lint

# 3. Type check
echo "ğŸ”¬ Running TypeScript type check..."
pnpm run type-check

# 4. Security tests
echo "ğŸ”’ Running security tests..."
pnpm run test:run src/__tests__/security -- --reporter=dot

# 5. Testï¼ˆé«˜é€Ÿãƒ†ã‚¹ãƒˆã®ã¿ï¼‰
echo "ğŸ§ª Running core tests..."
pnpm run test:run -- --reporter=dot --testTimeout=10000

# 6. Format check
echo "ğŸ¨ Checking code formatting..."
pnpm run format

echo "âœ… All pre-commit checks passed!"